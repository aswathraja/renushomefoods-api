import{a as e,j as s}from"./vendor-animation-CcgChT4Y.js";import{A as l}from"./AdminNavBar--NFVZBTP.js";import{C as a}from"./dropdown-menu-DjLdUzkQ.js";import{u as t,A as r,e as c,B as n,c as i}from"./index-QkJ4t2go.js";import{B as d}from"./badge-DjmmXEHi.js";import{C as o}from"./calendar-D3_6b9UR.js";import{C as u,a as m,b as x,c as h}from"./card-CZoDjOMW.js";import{C as p}from"./checkbox-_sSNwR25.js";import{I as j}from"./input-hHw7iIA9.js";import{L as v}from"./label-CdSwSrYM.js";import{P as f,a as g,b}from"./popover-8ziMr3tt.js";import{S as N}from"./switch-CkWvZ_t_.js";import{T as w,a as y,b as C,c as S,d as A,e as D}from"./table-18gPuSSS.js";import{F as k,f as F,h as $,P as U,g as I}from"./vendor-icons-BYe_-sqm.js";import{f as P}from"./vendor-dates-BQQoqOpn.js";import"./TopBar-CO3pAy7f.js";import"./vendor-radix-CgisZDtL.js";import"./vendor-charts-1c3qO8Q0.js";import"./vendor-ui-utils-B4kPJlQS.js";import"./vendor-pdf-export-F3dE0gEs.js";const z=()=>{const{effectiveTheme:z}=t(),[T,O]=e.useState([]),[E,M]=e.useState(!1),[_,B]=e.useState(!1),[q,G]=e.useState(!1),[L,Y]=e.useState(null),[J,R]=e.useState(!1),[Z,K]=e.useState(""),[Q,V]=e.useState({from:new Date((new Date).getFullYear(),(new Date).getMonth(),1),to:new Date}),{from:W,to:H}=Q||{},[X,ee]=e.useState([]),[se,le]=e.useState([]),[ae,te]=e.useState(""),[re,ce]=e.useState(new Date),[ne,ie]=e.useState(new Date),[de,oe]=e.useState(!0),[ue,me]=e.useState(!0),[xe,he]=e.useState(!1),[pe,je]=e.useState(!1),ve=[{value:"Shipping",label:"Shipping"},{value:"Product Discount",label:"Product Discount"}],[fe,ge]=e.useState([{name:"Product Discount",discount:0,flatrate:!1}]),[be,Ne]=e.useState([]),[we,ye]=e.useState([]),[Ce,Se]=e.useState({}),Ae=()=>{te(""),ce(new Date),ie(new Date),oe(!0),me(!0),he(!1),je(!1),ge([{name:"Product Discount",discount:0,flatrate:!1}]),Ne([]),ye([]),Se({}),G(!1),Y(null)},[De,ke]=e.useState([]),[Fe,$e]=e.useState([]),[Ue,Ie]=e.useState([]),[Pe,ze]=e.useState([]),Te=()=>{M(!0);const e=localStorage.getItem("token");if(!e)return;const s={couponCode:Z||null,fromDate:W?W.toISOString().split("T")[0]:null,toDate:H?H.toISOString().split("T")[0]:null,products:X?.map(e=>e.value),users:se.map(e=>e.value),token:e};r.postData({endpoint:"/order/get-coupons",body:{request:c(s)},Authorization:`Bearer ${e}`,successCallback:e=>{O(e.coupons||[]),M(!1)},errorCallback:e=>{O([]),M(!1)}})};e.useEffect(()=>{r.postData({endpoint:"/inventory/get-products",body:{request:c({})},successCallback:e=>{ke(e),Ie([{value:"All",label:"All"},...e?.map(e=>({value:e.id,label:e.name}))])}});const e=localStorage.getItem("token");e&&r.get("/admin/user-list",{Authorization:`Bearer ${e}`}).then(e=>{$e(e.users||[]),ze([{value:"All",label:"All"},...e.users?.map(e=>({value:e.id,label:`${e.name} (${e.phone})`}))])}),Te()},[]),e.useEffect(()=>{Te()},[Z,W,H,X,se]);const Oe=()=>{if(fe.length<2){const e=ve.filter(e=>!fe.some(s=>s.name===e.value)),s=e.length>0?e[0].value:"Shipping";ge([...fe,{name:s,discount:0,flatrate:!0}])}},Ee=(e,s,l)=>{const a=[...fe];if("name"===s)a[e][s]=l?.value||"";else if("discount"===s){const t=a[e].flatrate?l:Math.min(100,l);a[e][s]=t}else a[e][s]=l;ge(a)};return s.jsxs(s.Fragment,{children:[s.jsx(l,{}),s.jsxs("div",{className:"container mx-auto mt-6 p-6 min-h-screen",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Coupons"}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx(n,{variant:"outline",onClick:()=>{Ae(),B(!0)},className:"border-green-600 text-green-600 hover:text-primary",children:"Add Coupon"}),s.jsxs(n,{variant:"outline",onClick:()=>R(!J),className:"border-green-600 text-green-600 hover:text-primary",children:[s.jsx(k,{className:"w-4 h-4 mr-2"})," Filters"]})]})]}),J&&s.jsxs(u,{className:"mb-6",children:[s.jsx(m,{children:s.jsx(x,{children:"Filters"})}),s.jsx(h,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(v,{htmlFor:"coupon-code-filter",children:"Coupon Code"}),s.jsx(j,{id:"coupon-code-filter",type:"text",value:Z,onChange:e=>K(e.target.value),placeholder:"Enter coupon code"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(v,{children:"Date Range"}),s.jsxs(f,{children:[s.jsx(g,{asChild:!0,children:s.jsxs(n,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[s.jsx(F,{className:"mr-2 h-4 w-4"}),W&&H?`${P(W,"dd/MM/yyyy")} - ${P(H,"dd/MM/yyyy")}`:"Select date range"]})}),s.jsx(b,{className:"w-auto p-0",align:"start",children:s.jsx(o,{mode:"range",selected:Q,onSelect:V,numberOfMonths:1,autoFocus:!0})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(v,{children:"Products"}),s.jsxs(f,{children:[s.jsx(g,{asChild:!0,children:s.jsx(n,{variant:"outline",role:"combobox","aria-expanded":!1,className:"w-full justify-between",children:X.length>0?`${X.length} product(s) selected`:"Select products"})}),s.jsx(b,{className:"w-full p-0",align:"start",children:s.jsx("div",{className:"p-3 space-y-2",children:Ue.map(e=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(p,{id:`product-filter-${e.value}`,checked:X.some(s=>s.value===e.value),onCheckedChange:s=>{const l=X.some(s=>s.value===e.value);if(s&&!l){const s=[...X,e],l=s.some(e=>"All"===e.value);ee(l?[{value:"All",label:"All"}]:s)}else!s&&l&&ee(X.filter(s=>s.value!==e.value))}}),s.jsx(v,{htmlFor:`product-filter-${e.value}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:e.label})]},e.value))})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(v,{children:"Users"}),s.jsxs(f,{children:[s.jsx(g,{asChild:!0,children:s.jsx(n,{variant:"outline",role:"combobox","aria-expanded":!1,className:"w-full justify-between",children:se.length>0?`${se.length} user(s) selected`:"Select users"})}),s.jsx(b,{className:"w-full p-0",align:"start",children:s.jsx("div",{className:"p-3 space-y-2",children:[{value:"All",label:"All"},{value:"New Users",label:"New Users"},...Pe.slice(1)].map(e=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(p,{id:`user-filter-${e.value}`,checked:se.some(s=>s.value===e.value),onCheckedChange:s=>{const l=se.some(s=>s.value===e.value);s&&!l?le([...se,e]):!s&&l&&le(se.filter(s=>s.value!==e.value))}}),s.jsx(v,{htmlFor:`user-filter-${e.value}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:e.label})]},e.value))})})]})]})]})})]}),_&&s.jsxs(u,{className:"mb-6",children:[s.jsx(m,{children:s.jsx(x,{children:q?"Edit Coupon":"Create Coupon"})}),s.jsxs(h,{children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(v,{htmlFor:"coupon-code",children:"Code"}),s.jsx(j,{id:"coupon-code",type:"text",value:ae,onChange:e=>{te(e.target.value);const s=e.target.value;s.trim()?/^[a-zA-Z0-9]+$/.test(s)?Se(e=>({...e,code:void 0})):Se(e=>({...e,code:"Coupon code must contain only alphabets and numbers."})):Se(e=>({...e,code:"Coupon code is required."}))},placeholder:"Enter coupon code"}),Ce.code&&s.jsx("p",{className:"text-sm text-red-500",children:Ce.code})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(v,{children:"Start Date"}),s.jsxs(f,{children:[s.jsx(g,{asChild:!0,children:s.jsxs(n,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[s.jsx(F,{className:"mr-2 h-4 w-4"}),re?re.toLocaleDateString():"Select date"]})}),s.jsx(b,{className:"w-auto p-0",align:"start",children:s.jsx(o,{mode:"single",selected:re||void 0,onSelect:ce,autoFocus:!0})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(v,{children:"End Date"}),s.jsxs(f,{children:[s.jsx(g,{asChild:!0,children:s.jsxs(n,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[s.jsx(F,{className:"mr-2 h-4 w-4"}),ne?ne.toLocaleDateString():"Select date"]})}),s.jsx(b,{className:"w-auto p-0",align:"start",children:s.jsx(o,{mode:"single",selected:ne||void 0,onSelect:ie,required:!1})})]})]}),s.jsx("div",{className:"space-y-3",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4 mb-0",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(N,{id:"active-switch",checked:de,onCheckedChange:oe}),s.jsx(v,{htmlFor:"active-switch",children:"Active"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(N,{id:"groupable-switch",checked:ue,onCheckedChange:me}),s.jsx(v,{htmlFor:"groupable-switch",children:"Groupable"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(N,{id:"new-users-switch",checked:xe,onCheckedChange:he}),s.jsx(v,{htmlFor:"new-users-switch",children:"For New Users"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(N,{id:"all-users-switch",checked:pe,onCheckedChange:e=>{je(e),e?we.some(e=>"All"===e.value)||ye([...we,{value:"All",label:"All"}]):ye(we.filter(e=>"All"!==e.value))}}),s.jsx(v,{htmlFor:"all-users-switch",children:"For All Users"})]})]})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(v,{children:"Discounts"}),fe.map((e,l)=>s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 p-4 border rounded-lg",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(v,{htmlFor:`discount-type-${l}`,children:"Discount Type"}),s.jsxs(f,{children:[s.jsx(g,{asChild:!0,children:s.jsx(n,{variant:"outline",role:"combobox","aria-expanded":!1,className:"w-full justify-between",children:ve.find(s=>s.value===e.name)?.label||"Select Discount Type"})}),s.jsx(b,{className:"w-full p-0",align:"start",children:s.jsx("div",{className:"p-3 space-y-2",children:ve.filter(e=>!fe.some((s,a)=>a!==l&&s.name===e.value)).map(a=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(p,{id:`discount-type-${l}-${a.value}`,checked:e.name===a.value,onCheckedChange:e=>{e&&Ee(l,"name",{value:a.value,label:a.label})}}),s.jsx(v,{htmlFor:`discount-type-${l}-${a.value}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:a.label})]},a.value))})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(v,{htmlFor:`discount-value-${l}`,children:"Discount"}),s.jsx(j,{id:`discount-value-${l}`,type:"number",placeholder:"Discount",value:e.discount,onChange:s=>{const a=parseFloat(s.target.value);Ee(l,"discount",a),!e.flatrate&&a>100?Se(e=>({...e,discounts:"Discount percentage cannot exceed 100%"})):Se(e=>({...e,discounts:void 0}))},max:e.flatrate?void 0:100,min:0})]}),s.jsx("div",{className:"space-y-2 pb-2 flex items-baseline-last",children:s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(v,{htmlFor:`percentage-rate-${l}`,children:"Percentage"}),s.jsx(N,{id:`flat-rate-${l}`,checked:e.flatrate,onCheckedChange:e=>Ee(l,"flatrate",e)}),s.jsx(v,{htmlFor:`flat-rate-${l}`,children:"Flat Rate"})]})}),s.jsxs("div",{className:"flex items-end space-x-2",children:[s.jsxs(n,{variant:"destructive",size:"sm",onClick:()=>(e=>{ge(fe.filter((s,l)=>l!==e))})(l),disabled:1===fe.length,children:[s.jsx($,{className:"h-4 w-4 mr-1"}),"Remove"]}),s.jsxs(n,{variant:"outline",size:"sm",onClick:Oe,disabled:fe.length>=2,children:[s.jsx(U,{className:"h-4 w-4 mr-1"}),"Add Discount"]})]})]},l)),Ce.discounts&&s.jsx("p",{className:"text-sm text-red-500",children:Ce.discounts})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(v,{children:"Products"}),s.jsxs(f,{children:[s.jsx(g,{asChild:!0,children:s.jsx(n,{variant:"outline",role:"combobox","aria-expanded":!1,className:"w-full justify-between",children:be.length>0?`${be.length} product(s) selected`:"Select products"})}),s.jsx(b,{className:"w-full p-0",align:"start",children:s.jsx("div",{className:"p-3 space-y-2",children:Ue.map(e=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(p,{id:`product-select-${e.value}`,checked:be.some(s=>s.value===e.value),onCheckedChange:s=>{const l=be.some(s=>s.value===e.value);if(s&&!l){const s=[...be,e],l=s.some(e=>"All"===e.value);Ne(l?[{value:"All",label:"All"}]:s)}else!s&&l&&Ne(be.filter(s=>s.value!==e.value))}}),s.jsx(v,{htmlFor:`product-select-${e.value}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:e.label})]},e.value))})})]}),Ce.products&&s.jsx("p",{className:"text-sm text-red-500",children:Ce.products}),be.length>0&&s.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:be.map(e=>s.jsx(d,{variant:"secondary",children:e.label},e.value))})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(v,{children:"Users"}),s.jsxs(f,{children:[s.jsx(g,{asChild:!0,children:s.jsx(n,{variant:"outline",role:"combobox","aria-expanded":!1,className:"w-full justify-between",children:we.length>0?`${we.length} user(s) selected`:"Select users"})}),s.jsx(b,{className:"w-full p-0",align:"start",children:s.jsx("div",{className:"p-3 space-y-2",children:Pe.map(e=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(p,{id:`user-select-${e.value}`,checked:we.some(s=>s.value===e.value),onCheckedChange:s=>{const l=we.some(s=>s.value===e.value);s&&!l?ye([...we,e]):!s&&l&&ye(we.filter(s=>s.value!==e.value))}}),s.jsx(v,{htmlFor:`user-select-${e.value}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:e.label})]},e.value))})})]}),we.length>0&&s.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:we.map(e=>s.jsx(d,{variant:"secondary",children:e.label},e.value))})]})]}),s.jsx("div",{className:"flex justify-end mt-6",children:s.jsx(n,{onClick:()=>{const e={};ae.trim()?/^[a-zA-Z0-9]+$/.test(ae)||(e.code="Coupon code must contain only alphabets and numbers."):e.code="Coupon code is required.",be&&0!==be.length||(e.products="At least one product must be selected."),we&&0!==we.length||(e.users="At least one user must be selected.");for(const a of fe)if(!a.flatrate&&a.discount>100){e.discounts="Discount percentage cannot exceed 100%";break}if(Se(e),Object.keys(e).length>0)return;const s=localStorage.getItem("token");if(!s)return;const l={couponId:q?L.id:void 0,code:ae,startDate:re?.toISOString().split("T")[0],endDate:ne?.toISOString().split("T")[0],isActive:de,isGroupable:ue,isForNewUsers:xe,isForAllUsers:pe,discounts:fe,productIds:be.some(e=>"All"===e.value)?De.map(e=>e.id):be?.map(e=>e.value),userIds:we.map(e=>e.value)};r.postData({endpoint:"/admin/save-coupon",body:{request:c(l)},Authorization:`Bearer ${s}`,successCallback:e=>{i.success(q?"Coupon Updated Successfully":"Coupon Saved Successfully"),Te(),Ae(),B(!1)},errorCallback:e=>{i.error(e?.error||e?.message||"An error occurred")}})},className:"bg-primary text-primary-foreground",children:"Save Coupon"})})]})]}),s.jsx(u,{children:s.jsx(h,{className:"p-0",children:E?s.jsxs("div",{className:"flex justify-center items-center py-8",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),s.jsx("span",{className:"ml-2",children:"Loading coupons..."})]}):s.jsx("div",{children:s.jsxs(w,{className:"w-full overflow-x-auto",style:{minWidth:"1900px"},children:[s.jsx(y,{children:s.jsxs(C,{className:"bg-muted/50",children:[s.jsx(S,{className:"text-left font-bold w-[130px] sticky left-0 z-30 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)] border-r [&+*]:relative",children:"Actions"}),s.jsx(S,{className:"text-left font-bold w-[120px]",children:"Code"}),s.jsx(S,{className:"text-left font-bold w-[120px]",children:"Start Date"}),s.jsx(S,{className:"text-left font-bold w-[120px]",children:"End Date"}),s.jsx(S,{className:"text-left font-bold w-[100px]",children:"Active"}),s.jsx(S,{className:"text-left font-bold w-[120px]",children:"Groupable"}),s.jsx(S,{className:"text-left font-bold w-[130px]",children:"For New Users"}),s.jsx(S,{className:"text-left font-bold w-[130px]",children:"For All Users"}),s.jsx(S,{className:"text-left font-bold w-[170px]",children:"Discounts"}),s.jsx(S,{className:"text-left font-bold w-[350px]",children:"Products"}),s.jsx(S,{className:"text-left font-bold w-[300px]",children:"Users"})]})}),s.jsx(A,{children:0===T.length?s.jsx(C,{children:s.jsx(D,{colSpan:11,className:"text-center py-8 text-gray-500",children:"No coupons found"})}):T.map(e=>s.jsxs(C,{children:[s.jsx(D,{className:"sticky left-0 z-20 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)] border-r w-[130px] [&+*]:relative",style:{position:"sticky",left:0},children:s.jsxs(n,{variant:"outline",size:"sm",onClick:()=>(e=>{te(e.code),ce(new Date(e.startDate.split("/").reverse().join("-"))),ie(new Date(e.endDate.split("/").reverse().join("-"))),oe(e.isActive),me(e.isGroupable),he(e.isForNewUsers),je(e.isForAllUsers),ge(JSON.parse(JSON.stringify(e.discounts||[{name:"Product Discount",discount:0,flatrate:!1}]))),Ne(e.products?.length===De.length?[{value:"All",label:"All"}]:e.products?.map(e=>({value:e.id,label:e.name}))||[]),ye(e.users?.length===Fe?.length?[{value:"All",label:"All"}]:e.users?.map(e=>({value:e.id,label:`${e.name} (${e.phone})`}))),G(!0),Y(e),B(!0)})(e),className:"border-primary text-primary",children:[s.jsx(I,{className:"text-primary h-4 w-4 mr-1"}),"Edit"]})}),s.jsx(D,{className:"font-medium",children:e.code}),s.jsx(D,{children:e.startDate}),s.jsx(D,{children:e.endDate}),s.jsx(D,{children:s.jsx("div",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium "+(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?"Yes":"No"})}),s.jsx(D,{children:s.jsx("div",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium "+(e.isGroupable?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isGroupable?"Yes":"No"})}),s.jsx(D,{children:s.jsx("div",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium "+(e.isForNewUsers?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isForNewUsers?"Yes":"No"})}),s.jsx(D,{children:s.jsx("div",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium "+(e.isForAllUsers?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isForAllUsers?"Yes":"No"})}),s.jsx(D,{children:s.jsx("div",{className:"space-y-1",children:e.discounts?.map((e,l)=>s.jsxs("div",{className:"text-xs",children:[e.name,": ",e.flatrate?"â‚¹":"",e.discount,e.flatrate?" Flat":"%"]},l))})}),s.jsx(D,{children:s.jsx("div",{className:"text-sm",children:e.products?.length===De.length?"All":e.products?.map(e=>e.name).join(", ")})}),s.jsx(D,{children:s.jsx("div",{className:"text-sm",children:e.isForAllUsers?"All":e.users?.map(e=>e.name).join(", ")})})]},e.id))})]})})})})]}),s.jsx(a,{})]})};export{z as default};

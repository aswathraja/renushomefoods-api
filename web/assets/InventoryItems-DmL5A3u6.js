import{r as e,j as s,F as i,P as a,J as t,X as r,a4 as l,G as n,I as c}from"./vendor-react-Tc4xLtOv.js";import{C as o}from"./dropdown-menu-Dweh6OYL.js";import{I as d}from"./InventoryNavBar-CfaS1G4w.js";import{u as m,A as p,e as u,B as x,c as h}from"./index-CCl3TzR2.js";import{C as g}from"./calendar-Cnbaz_2s.js";import{C as y,c as j,a as v,b}from"./card-ZRElQZzO.js";import{D as f,a as N,b as w,c as C,e as I,d as P}from"./dialog-CT_0QHuT.js";import{I as k}from"./input-F4kRSedd.js";import{L as S}from"./label-DxpSIJ1C.js";import{P as O,a as q,b as D}from"./popover-B3nRiRzT.js";import{S as L,a as A,b as $,c as F,d as z}from"./select-BWzYtSB5.js";import{T as E,a as B,b as M,c as U,d as T,e as G}from"./table-DDweQ1vw.js";import{T as Q}from"./textarea-LiP7jPED.js";import{P as V}from"./PhotoGallaryModal-piAobPR-.js";import{A as _,m as R}from"./vendor-animation-BGrdDg6I.js";import{f as W}from"./vendor-dates-BQQoqOpn.js";import"./vendor-charts-DKw1ZHYY.js";import"./vendor-ui-utils-B4kPJlQS.js";import"./vendor-radix-O0RUyoIw.js";import"./TopBar-DKySbC2h.js";import"./vendor-pdf-export-C4gp01y5.js";const H=[.42,0,.58,1],J={initial:{opacity:0,y:-25},animate:{opacity:1,y:0,transition:{duration:.2,staggerChildren:.02,delayChildren:.02}},exit:{opacity:0,y:0,transition:{when:"afterChildren",staggerChildren:.02,staggerDirection:-1}}},K={initial:{x:50},animate:{x:0,transition:{duration:.02,ease:H}},exit:{x:0,transition:{duration:.02,ease:H}}},Y=()=>{const{effectiveTheme:H}=m(),[Y,X]=e.useState([]),[Z,ee]=e.useState([]),[se,ie]=e.useState([]),[ae,te]=e.useState(!1),[re,le]=e.useState(null),[ne,ce]=e.useState({name:"",description:"",displayOrder:"",category:"",type:"",locations:[],images:[],invoices:[]}),[oe,de]=e.useState(""),[me,pe]=e.useState(null),[ue,xe]=e.useState(!1),[he,ge]=e.useState(null),[ye,je]=e.useState(!1),[ve,be]=e.useState({}),[fe,Ne]=e.useState(!1),we=e.useRef([]),[Ce,Ie]=e.useState(!1),[Pe,ke]=e.useState([]),[Se,Oe]=e.useState(0),[qe,De]=e.useState(!1),[Le,Ae]=e.useState(""),[$e,Fe]=e.useState(""),[ze,Ee]=e.useState({value:null,label:"All"}),[Be,Me]=e.useState(null),Ue=[{value:null,label:"All"},...Z.map(e=>({value:e.category,label:e.category}))],Te=Z.map(e=>({value:e.id,label:e.category}));e.useEffect(()=>{p.postData({endpoint:"/inventory/get-categories",body:{type:null},successCallback:e=>{Array.isArray(e)?ee(e):ee([])},errorCallback:()=>{ee([])}})},[]),e.useEffect(()=>{p.postData({endpoint:"/inventory/locations",body:{request:u({})},successCallback:e=>{Array.isArray(e)?ie(e):ie([])},errorCallback:()=>{ie([])}})},[]);const Ge=()=>{const e={name:Le||null,description:$e||null,category:ze?.value,image:Be?.value,isAdmin:!0},s=new Promise((s,i)=>{p.postData({endpoint:"/inventory/get-products",body:{request:u(e)},successCallback:e=>{Array.isArray(e)?s(e.map(e=>({...e,type:"Product"}))):s([])},errorCallback:e=>{s([])}})}),i=new Promise((s,i)=>{p.postData({endpoint:"/inventory/get-items",body:{request:u(e)},successCallback:e=>{Array.isArray(e)?s(e.map(e=>({...e,type:"Item"}))):s([])},errorCallback:e=>{s([])}})});Promise.all([s,i]).then(([e,s])=>{const i=[...e,...s];X(i)}).catch(e=>{X([]),h.error("Failed to fetch items")})};e.useEffect(()=>{Ge()},[]),e.useEffect(()=>{Ge()},[Le,$e,ze,Be]);const Qe=e=>{"Item"===e.type?(e=>{le(e),ce({name:e.name,description:e.description||"",displayOrder:e.displayOrder?.toString()||"",category:"",locations:e.ItemLocations?.map(e=>({location:{value:e.Location.id,label:e.Location.name},quantity:e.quantity.toString(),id:e.id}))||[],images:e.ItemImages?.map(e=>({file:null,description:e.description||"",displayOrder:e.displayOrder?.toString()||"",existing:{id:e.id,fileName:e.image,description:e.description,displayOrder:e.displayOrder}}))||[],invoices:e.ItemInvoices?.map(e=>({date:e.date?new Date(e.date):null,quantity:e.quantity.toString(),unitPrice:e.unitprice,basePrice:e.basePrice,weight:e.weight,bomCost:""}))||[],type:e.type}),pe(Te.find(s=>s.value===e.categoryId)||null),de(""),te(!0)})(e):"Product"===e.type&&(e=>{le(e),ce({name:e.name,description:e.tagline||"",displayOrder:e.displayOrder?.toString()||"",category:e.categoryid,locations:e.locations?.map(e=>({location:{value:e.id,label:e.name},quantity:e.ProductLocation?.quantity||e.quantity}))||[],images:e.ProductImages?.map(e=>({file:null,description:e.description||"",displayOrder:e.displayOrder?.toString()||"",existing:{id:e.id,fileName:e.fileName,description:e.description,displayOrder:e.displayOrder}}))||[],invoices:e.PriceLists?.map(e=>({date:new Date(e.updatedAt),quantity:e.quantity||"",unitPrice:e.unitprice.toString(),basePrice:e.basePrice.toString(),weight:e.weight||"",bomCost:e.bomCost?.toString()||""}))||[],type:e.type}),pe(Te.find(s=>s.value===e.categoryid)||null),de(""),te(!0)})(e)};e.useEffect(()=>{const e=e=>{e.target.closest(".dropdown")||je(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);const Ve=e=>{const s=[...ne.images];s[e].file=null,s[e].existing=void 0,ce({...ne,images:s}),we.current[e]&&(we.current[e].value=""),be(s=>({...s,[`image_${e}`]:""}))},_e=e=>`/static/inventory/${e}`;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"min-h-screen",children:[s.jsx(d,{}),s.jsxs("div",{className:"container mx-auto mt-6 px-4",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[s.jsx("h1",{className:"text-primary text-2xl font-bold",children:"Items"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(x,{variant:"outline",onClick:()=>De(!qe),className:"border-green-600 text-green-600 hover:text-primary",children:[s.jsx(i,{className:"w-4 h-4 mr-2"}),"Filters"]}),s.jsxs("div",{className:"relative",children:[s.jsxs(x,{variant:"outline",onClick:()=>je(!ye),className:"border-green-600 text-green-600 hover:text-primary",children:[s.jsx(a,{className:"w-4 h-4 mr-2"}),"Add"]}),s.jsx(_,{children:ye&&s.jsxs(R.ul,{className:"absolute right-0 top-full mt-2 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg z-10",variants:J,initial:"initial",animate:"animate",exit:"exit",children:[s.jsx(R.li,{variants:K,children:s.jsx("button",{className:"block w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>{le(null),ce({name:"",description:"",displayOrder:"",category:"",locations:[],images:[],invoices:[],type:"Item"}),pe(null),te(!0),je(!1)},children:"Item"})}),s.jsx(R.li,{variants:K,children:s.jsx("button",{className:"block w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>{le(null),ce({name:"",description:"",displayOrder:"",category:"",locations:[],images:[],invoices:[],type:"Product"}),pe(null),te(!0),je(!1)},children:"Product"})})]})})]})]})]}),qe&&s.jsx(y,{className:"mb-6",children:s.jsx(j,{className:"pt-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(S,{children:"Name"}),s.jsx(k,{value:Le,onChange:e=>Ae(e.target.value),placeholder:"Enter item name"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(S,{children:"Description"}),s.jsx(k,{value:$e,onChange:e=>Fe(e.target.value),placeholder:"Enter description"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(S,{children:"Category"}),s.jsxs(L,{value:ze?.value||void 0,onValueChange:e=>{const s=Ue.find(s=>s.value===("all"===e?null:e));Ee(s||{value:null,label:"All"})},children:[s.jsx(A,{className:"dark"===H?"bg-gray-800 text-white border-gray-600":"",children:s.jsx($,{placeholder:"Select Category"})}),s.jsx(F,{children:Ue.map(e=>s.jsx(z,{value:e.value||"all",children:e.label},e.value||"all"))})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(S,{children:"Image"}),s.jsxs(L,{value:null===Be?.value?"all":Be?.value?"has":"no",onValueChange:e=>{Me("all"===e?{value:null,label:"All"}:"has"===e?{value:!0,label:"Has Image"}:{value:!1,label:"No Image"})},children:[s.jsx(A,{children:s.jsx($,{placeholder:"Filter by image"})}),s.jsxs(F,{children:[s.jsx(z,{value:"all",children:"All"}),s.jsx(z,{value:"has",children:"Has Image"}),s.jsx(z,{value:"no",children:"No Image"})]})]})]})]})})}),ae&&s.jsxs(y,{className:"mb-6",children:[s.jsx(v,{children:s.jsx(b,{children:re?`Edit ${re.type}`:`Add ${ne.type}`})}),s.jsx("form",{onSubmit:e=>{if(e.preventDefault(),!ne.name.trim())return void h.error("Item name is required");if(!me)return void h.error("Category is required");const s=localStorage.getItem("token");if(!s)return void h.error("No token found");Ne(!0);let i="/inventory/save-item",a={...ne,name:ne.name,description:ne.description,displayOrder:ne.displayOrder?parseInt(ne.displayOrder):null,category:me.value,image:re?.image||"",locations:ne.locations.filter(e=>e.location).map(e=>({locationId:e.location.value,quantity:parseInt(e.quantity),id:e.id})),images:ne.images.map(e=>({file:e.file,description:e.description,displayOrder:parseInt(e.order)||null,existing:e.existing})),invoices:ne.invoices?.map(e=>({date:e.date?e.date?.toISOString()?.split("T")[0]:null,quantity:parseInt(e.quantity),unitPrice:parseFloat(e.unitPrice),basePrice:parseFloat(e.basePrice),weight:e.weight})),token:s,type:"item"};/^(Product)$/gim.test(ne.type)?(i="/inventory/save-product",a={id:re?.id,name:ne.name,categoryid:me.value,pricelists:ne.invoices.map(e=>({weight:e.weight,unitprice:parseFloat(e.unitPrice),basePrice:parseFloat(e.basePrice),bomCost:parseFloat(e.bomCost),quantity:parseInt(e.quantity),id:e.id})),productimages:ne.images.map(e=>({id:e?.existing?.id,fileName:e.existing?.fileName||"",productId:re?.id,displayOrder:parseInt(e.displayOrder),description:e.description})),tagline:ne.description,displayOrder:ne.displayOrder?parseInt(ne.displayOrder):re?.displayOrder,type:"product",locations:ne.locations.filter(e=>e.location).map(e=>({locationId:e.location.value,quantity:e.quantity})),token:s}):re&&(a.id=re?.id);const t=new FormData;t.append("request",u(a)),ne.images.forEach(e=>{e.file&&t.append("files",e.file)}),p.postFormData({endpoint:i,body:t,Authorization:`Bearer ${s}`,successCallback:e=>{Ne(!1),h.success(re?"Item updated successfully":"Item added successfully"),te(!1),le(null),ce({name:"",description:"",displayOrder:"",category:"",locations:[],images:[],invoices:[],type:""}),de(""),Ge()},errorCallback:e=>{Ne(!1),h.error("Failed to save item")}})},children:s.jsxs(j,{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs(S,{htmlFor:"item-name",children:[ne.type," Name"]}),s.jsx(k,{id:"item-name",value:ne.name,onChange:e=>ce({...ne,name:e.target.value}),placeholder:`Enter ${ne.type} Name`,required:!0})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(S,{htmlFor:"category",children:"Category"}),s.jsxs(L,{value:me?.value?.toString()||void 0,onValueChange:e=>{const s=Te.find(s=>s.value===parseInt(e));pe(s||null)},children:[s.jsx(A,{id:"category",className:"dark"===H?"bg-gray-800 text-white border-gray-600":"",children:s.jsx($,{placeholder:"Select Category"})}),s.jsx(F,{children:Te.map(e=>s.jsx(z,{value:e.value.toString(),children:e.label},e.value))})]})]}),"Product"===ne.type&&s.jsxs("div",{className:"space-y-2",children:[s.jsx(S,{htmlFor:"displayOrder",children:"Display Order"}),s.jsx(k,{id:"displayOrder",type:"number",value:ne.displayOrder,onChange:e=>ce({...ne,displayOrder:e.target.value}),placeholder:"Display Order",className:"dark"===H?"bg-gray-800 text-white border-gray-600":""})]}),"Item"===ne.type&&s.jsxs("div",{className:"space-y-2",children:[s.jsx(S,{htmlFor:"description",children:"Description"}),s.jsx(Q,{id:"description",value:ne.description,onChange:e=>ce({...ne,description:e.target.value}),placeholder:"Enter Description",rows:3,className:"dark"===H?"bg-gray-800 text-white border-gray-600":""})]})]}),"Product"===ne.type&&s.jsx("div",{className:"grid grid-cols-1 gap-4",children:s.jsxs("div",{className:"space-y-2",children:[s.jsx(S,{htmlFor:"description",children:"Description"}),s.jsx(Q,{id:"description",value:ne.description,onChange:e=>ce({...ne,description:e.target.value}),placeholder:"Enter Description",rows:3,className:"dark"===H?"bg-gray-800 text-white border-gray-600":""})]})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(S,{children:"Locations"}),s.jsxs("div",{className:"space-y-3",children:[ne.locations.map((e,i)=>s.jsxs("div",{className:"flex flex-wrap gap-2 p-4 border rounded-md items-end",children:[s.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[s.jsx(S,{children:"Location"}),s.jsxs(L,{value:e.location?.value?.toString()||void 0,onValueChange:e=>{const s=[...ne.locations],a=se.find(s=>s.id===parseInt(e));s[i].location=a?{value:a.id,label:a.name}:null,ce({...ne,locations:s})},children:[s.jsx(A,{children:s.jsx($,{placeholder:"Select Location"})}),s.jsx(F,{children:se.filter(s=>!ne.locations.some(i=>i.location?.value===s.id&&i!==e)).map(e=>s.jsx(z,{value:e.id.toString(),children:e.name},e.id))})]})]}),s.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px] mb-2",children:[s.jsx(S,{children:"Quantity"}),s.jsx(k,{type:"text",value:e.quantity,onChange:e=>{const s=[...ne.locations];s[i].quantity=e.target.value.replace(/[^0-9]/g,""),ce({...ne,locations:s})},placeholder:"Quantity",className:"dark"===H?"bg-gray-800 text-white border-gray-600":""})]}),s.jsxs("div",{className:"flex items-end gap-2 mb-2",children:[s.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:()=>ce({...ne,locations:[...ne.locations,{location:null,quantity:""}]}),children:s.jsx(a,{className:"h-4 w-4"})}),s.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:()=>{const e=ne.locations.filter((e,s)=>s!==i);ce({...ne,locations:e})},children:s.jsx(t,{className:"h-4 w-4"})})]})]},i)),0===ne.locations?.length&&s.jsxs(x,{type:"button",variant:"outline",onClick:()=>ce({...ne,locations:[...ne.locations,{location:null,quantity:""}]}),className:"w-full border-green-600 text-green-600 hover:text-primary",children:[s.jsx(a,{className:"w-4 h-4 mr-2"}),"Add Location"]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(S,{children:"Images"}),s.jsxs("div",{className:"space-y-3",children:[ne.images.map((e,i)=>s.jsxs("div",{className:"flex flex-wrap gap-2 p-4 border rounded-md items-end",children:[s.jsxs("div",{className:"space-y-2 flex-1 min-w-[150px]",children:[s.jsx(S,{children:"Image"}),e.existing?s.jsxs("div",{className:"relative group",children:[s.jsx(V,{title:"Item Images",imageSrcs:ne.images.filter(e=>e.existing).map(e=>_e(e.existing.fileName)),children:s.jsx("img",{src:_e(e.existing.fileName),alt:"Existing",className:"w-20 h-20 object-cover rounded-md border cursor-pointer hover:opacity-80 transition-opacity"})}),s.jsx("button",{type:"button",onClick:()=>Ve(i),className:"absolute -top-2 left-17 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors opacity-0 group-hover:opacity-100",children:s.jsx(r,{className:"h-3 w-3"})})]}):e.file?s.jsxs("div",{className:"relative",children:[s.jsx("img",{src:URL.createObjectURL(e.file),alt:"New",className:"w-20 h-20 object-cover rounded-md border"}),s.jsx("button",{type:"button",onClick:()=>Ve(i),className:"absolute -top-2 left-17 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",children:s.jsx(r,{className:"h-3 w-3"})})]}):s.jsx("div",{className:"w-20 h-20 border-2 border-dashed border-muted-foreground/30 rounded-md flex items-center justify-center cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>we.current[i]?.click(),children:s.jsx(l,{className:"h-6 w-6 text-muted-foreground"})}),s.jsx("input",{ref:e=>{we.current[i]=e},type:"file",accept:"image/jpeg,image/png,image/webp,image/gif",onChange:e=>((e,s)=>{const i=s.target.files?.[0];if(i){const s=(e=>["image/jpeg","image/png","image/webp","image/gif"].includes(e.type)?e.size>5242880?"File size must be less than 5MB":null:"Please upload a valid image file (JPEG, PNG, WebP, GIF)")(i);if(s)return void be(i=>({...i,[`image_${e}`]:s}));const a=[...ne.images];a[e].file=i,ce({...ne,images:a}),be(s=>({...s,[`image_${e}`]:""}))}})(i,e),className:"hidden"}),ve[`image_${i}`]&&s.jsx("p",{className:"text-sm text-red-500",children:ve[`image_${i}`]})]}),s.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[s.jsx(S,{children:"Description"}),s.jsx(k,{value:e.description,onChange:e=>{const s=[...ne.images];s[i].description=e.target.value,ce({...ne,images:s})},placeholder:"Description"})]}),s.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[s.jsx(S,{children:"Display Order"}),s.jsx(k,{type:"text",value:e.displayOrder,onChange:e=>{const s=[...ne.images];s[i].displayOrder=e.target.value.replace(/[^0-9]/g,""),ce({...ne,images:s})},placeholder:"Display Order",className:"dark"===H?"bg-gray-800 text-white border-gray-600":""})]}),s.jsxs("div",{className:"flex items-end gap-2",children:[s.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:()=>ce({...ne,images:[...ne.images,{file:null,description:"",order:"",existing:void 0}]}),children:s.jsx(a,{className:"h-4 w-4"})}),s.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:()=>{const e=ne.images.filter((e,s)=>s!==i);ce({...ne,images:e})},children:s.jsx(t,{className:"h-4 w-4"})})]})]},i)),0===ne.images?.length&&s.jsxs(x,{type:"button",variant:"outline",onClick:()=>ce({...ne,images:[...ne.images,{file:null,description:"",order:"",existing:void 0}]}),className:"w-full border-green-600 text-green-600 hover:text-primary",children:[s.jsx(a,{className:"h-4 w-4 mr-2"})," Add Image"]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(S,{children:"Product"===ne.type||"Product"===re?.type?"Price Lists":"Invoices"}),s.jsxs("div",{className:"space-y-3",children:[ne.invoices.map((e,i)=>s.jsxs("div",{className:"flex flex-wrap gap-2 p-4 border rounded-md items-end",children:[s.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[s.jsx(S,{children:"Date"}),s.jsxs(O,{children:[s.jsx(q,{asChild:!0,children:s.jsxs(x,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[s.jsx(n,{className:"mr-2 h-4 w-4"}),e.date?W(e.date,"yyyy-MM-dd"):"Invoice/Price List Date"]})}),s.jsx(D,{className:"w-auto p-0",children:s.jsx(g,{mode:"single",selected:e.date,onSelect:e=>{const s=[...ne.invoices];s[i].date=e,ce({...ne,invoices:s})},autoFocus:!0})})]})]}),s.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[s.jsx(S,{children:"Quantity"}),s.jsx(k,{type:"text",value:e.quantity,onChange:e=>{const s=[...ne.invoices];s[i].quantity=e.target.value.replace(/[^0-9]/g,""),ce({...ne,invoices:s})},placeholder:"Quantity"})]}),s.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[s.jsx(S,{children:"Unit Price"}),s.jsx(k,{type:"text",value:e.unitPrice,onChange:e=>{const s=[...ne.invoices];s[i].unitPrice=e.target.value.replace(/[^0-9.]/g,""),ce({...ne,invoices:s})},placeholder:"Unit Price",className:"dark"===H?"bg-gray-800 text-white border-gray-600":""})]}),s.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[s.jsx(S,{children:"Base Price"}),s.jsx(k,{type:"text",value:e.basePrice,onChange:e=>{const s=[...ne.invoices];s[i].basePrice=e.target.value.replace(/[^0-9.]/g,""),ce({...ne,invoices:s})},placeholder:"Base Price"})]}),s.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[s.jsx(S,{children:"Weight"}),s.jsx(k,{type:"text",value:e.weight,onChange:e=>{const s=[...ne.invoices];s[i].weight=e.target.value,ce({...ne,invoices:s})},placeholder:"Weight",className:"dark"===H?"bg-gray-800 text-white border-gray-600":""})]}),"Product"===ne.type||"Product"===re?.type?s.jsxs("div",{className:"flex items-end gap-2 flex-1 min-w-[150px]",children:[s.jsxs("div",{className:"space-y-2 flex-1",children:[s.jsx(S,{children:"BOM Cost"}),s.jsx(k,{type:"text",value:e.bomCost,onChange:e=>{const s=[...ne.invoices];s[i].bomCost=e.target.value.replace(/[^0-9.]/g,""),ce({...ne,invoices:s})},placeholder:"BOM Cost"})]}),s.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:()=>ce({...ne,invoices:[...ne.invoices,{date:null,quantity:"",unitPrice:"",basePrice:"",weight:"",bomCost:""}]}),children:s.jsx(a,{className:"h-4 w-4"})}),s.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:()=>{const e=ne.invoices.filter((e,s)=>s!==i);ce({...ne,invoices:e})},children:s.jsx(t,{className:"h-4 w-4"})})]}):s.jsxs("div",{className:"flex items-end gap-2",children:[s.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:()=>ce({...ne,invoices:[...ne.invoices,{date:null,quantity:"",unitPrice:"",basePrice:"",weight:"",bomCost:""}]}),children:s.jsx(a,{className:"h-4 w-4"})}),s.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:()=>{const e=ne.invoices.filter((e,s)=>s!==i);ce({...ne,invoices:e})},children:s.jsx(t,{className:"h-4 w-4"})})]})]},e.date+i)),0===ne.invoices?.length&&s.jsxs(x,{type:"button",variant:"outline",onClick:()=>ce({...ne,invoices:[...ne.invoices,{date:null,quantity:"",unitPrice:"",basePrice:"",weight:"",bomCost:""}]}),className:"w-full border-green-600 text-green-600 hover:text-primary",children:[s.jsx(a,{className:"w-4 h-4 mr-2"}),"Add ","Product"===ne.type||"Product"===re?.type?"SKU":"Invoice"]})]})]})]}),s.jsxs("div",{className:"flex justify-end gap-2 pt-6",children:[s.jsx(x,{type:"button",variant:"outline",onClick:()=>te(!1),disabled:fe,children:"Cancel"}),s.jsx(x,{type:"submit",disabled:fe,children:fe?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):re?`Update ${re.type}`:`Add ${ne.type}`})]})]})})]}),s.jsx(y,{children:s.jsx(j,{className:"p-0",children:s.jsxs(E,{children:[s.jsx(B,{children:s.jsxs(M,{children:[s.jsx(U,{style:{width:"100px"},children:"Actions"}),s.jsx(U,{children:"Image"}),s.jsx(U,{style:{width:"175px"},children:"Display Order"}),s.jsx(U,{style:{width:"200px"},children:"Name"}),s.jsx(U,{style:{width:"300px"},children:"Description"}),s.jsx(U,{children:"Type"}),s.jsx(U,{style:{width:"210px"},children:"Category"}),s.jsx(U,{style:{width:"150px"},children:"Base Price"}),s.jsx(U,{style:{width:"150px"},children:"Unit Price"}),s.jsx(U,{style:{width:"100px"},children:"Stock"}),s.jsx(U,{style:{width:"230px"},children:"Locations"}),s.jsx(U,{style:{width:"220px"},children:"Invoices"})]})}),s.jsxs(T,{children:[Y.map(e=>s.jsxs(M,{children:[s.jsx(G,{children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx(x,{size:"sm",variant:"outline",onClick:()=>Qe(e),children:s.jsx(c,{className:"h-4 w-4"})}),s.jsx(x,{size:"sm",variant:"outline",onClick:()=>(e=>{ge(e),xe(!0)})(e),children:s.jsx(t,{className:"h-4 w-4"})})]})}),s.jsx(G,{children:(()=>{const i=e.ItemImages||[],a=e.ProductImages||[],t=[...i.map((e,s)=>({url:_e(e.image),index:s})),...a.map((e,s)=>({url:_e(e.fileName),index:i.length+s}))];return t.length>0?s.jsx(V,{title:`${e.name} Images`,imageSrcs:t.map(e=>e.url),children:s.jsxs("div",{className:"relative group cursor-pointer",children:[s.jsx("img",{src:t[0].url,alt:e.name,className:"w-12 h-12 object-cover rounded-md border cursor-pointer hover:opacity-80 transition-opacity"}),t.length>1&&s.jsx("span",{className:"absolute -bottom-1 -right-1 bg-primary text-primary-foreground text-[10px] px-1 rounded-full",children:t.length})]})}):s.jsx("span",{className:"text-muted-foreground",children:"No Image"})})()}),s.jsx(G,{children:e.displayOrder??"-"}),s.jsx(G,{className:"font-medium",children:e.name}),s.jsx(G,{children:e.description||e.tagline||"-"}),s.jsx(G,{children:e.type}),s.jsx(G,{children:e.Category?.category}),s.jsxs(G,{children:["₹",e.PriceLists?.[0]?.basePrice||e.ItemInvoices?.[e.ItemInvoices.length-1]?.basePrice||"-"]}),s.jsxs(G,{children:["₹",e.PriceLists?.[0]?.unitprice||e.ItemInvoices?.[e.ItemInvoices.length-1]?.unitprice||"-"]}),s.jsx(G,{children:e.locations?.reduce((e,s)=>e+(s.ProductLocation.quantity||0),0)||e.ItemLocations?.reduce((e,s)=>e+(s.quantity||0),0)||"-"}),s.jsx(G,{children:e.locations?.map(e=>`${e.name} (${e.room}) [${e.ProductLocation.quantity}]`).join(", ")||e.ItemLocations?.map(e=>`${e.Location.name} (${e.Location.room}) [${e.quantity}]`).join(", ")||"-"}),s.jsx(G,{children:e.PriceLists?.length>0?`${new Date(e.updatedAt).toLocaleDateString()} (${e.PriceLists?.[e.PriceLists.length-1].quantity??0})`:e.ItemInvoices?.length>0?`${new Date(e.ItemInvoices?.[e.ItemInvoices.length-1].date).toLocaleDateString()} (${e.ItemInvoices?.[e.ItemInvoices.length-1].quantity??0} x ₹${e.ItemInvoices?.[e.ItemInvoices.length-1].unitprice})`:"-"})]},e.type+e.id)),0===Y.length&&s.jsx(M,{children:s.jsx(G,{colSpan:12,className:"text-center py-8 text-muted-foreground",children:"No items found. Add some items to get started."})})]})]})})})]})]}),s.jsx(f,{open:ue,onOpenChange:xe,children:s.jsxs(N,{className:"dark"===H?"bg-gray-800 text-white border-gray-600":"",children:[s.jsxs(w,{children:[s.jsx(C,{children:"Confirm Delete"}),s.jsxs(I,{children:['Are you sure you want to delete the item "',he?.name,'"? This action cannot be undone.']})]}),s.jsxs(P,{children:[s.jsx(x,{variant:"outline",onClick:()=>xe(!1),className:"dark"===H?"bg-gray-800 text-white border-gray-600":"",children:"Cancel"}),s.jsx(x,{variant:"destructive",onClick:()=>{if(!he)return;const e=localStorage.getItem("token");e?p.postData({endpoint:"/inventory/delete-item",body:{request:u({id:he.id,token:e})},successCallback:e=>{h.success("Item deleted successfully"),Ge(),xe(!1),ge(null)},errorCallback:e=>{h.error(e.error||"Failed to delete item"),xe(!1),ge(null)}}):h.error("No token found")},children:"Delete"})]})]})}),s.jsx(o,{})]})};export{Y as default};

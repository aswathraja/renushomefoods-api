import{u as ke,r as c,A as f,e as C,j as e,B as m,h as Pe,m as J,c as y}from"./index-8NHjPGoz.js";import{X as oe,C as Se}from"./dropdown-menu-IOzSXCNd.js";import{I as Fe}from"./InventoryNavBar-HZVxGX5V.js";import{f as qe,C as De,a as Le}from"./calendar-Cb0MDyMT.js";import{C as K,c as X,a as Ae,b as Te}from"./card-aC7JMF-Q.js";import{D as $e,a as Ee,b as ze,c as Be,e as Re,d as Me}from"./dialog-Bf3oO-7z.js";import{I as p}from"./input--giszOJS.js";import{L as d}from"./label-Bw9gQmNa.js";import{P as Oe,a as Ue,b as _e}from"./popover-DLNurMIj.js";import{S as T,a as $,b as E,c as z,d as b}from"./select-yFXPkn8m.js";import{T as Ve,a as He,b as Y,c as g,d as Ge,e as h}from"./table-FPrm8XH3.js";import{T as Qe}from"./textarea-DWqeqKxs.js";import{P as ce}from"./PhotoGallaryModal-CijRlrQy.js";import{F as We}from"./funnel-DwM2FtYa.js";import{P as j}from"./plus-Tfaf38P0.js";import{T as k}from"./trash-eSpX3OgP.js";import{U as Je}from"./upload-CTOUk30p.js";import{S as Ke}from"./square-pen-BDcX1V6T.js";import"./TopBar-CQtj2zh-.js";import"./chevron-left-BAl2MDb7.js";import"./chevron-down-BVO0TlBt.js";import"./index-BfCK_NNx.js";const de=[.42,0,.58,1],Xe={initial:{opacity:0,y:-25},animate:{opacity:1,y:0,transition:{duration:.2,staggerChildren:.02,delayChildren:.02}},exit:{opacity:0,y:0,transition:{when:"afterChildren",staggerChildren:.02,staggerDirection:-1}}},me={initial:{x:50},animate:{x:0,transition:{duration:.02,ease:de}},exit:{x:0,transition:{duration:.02,ease:de}}},Pa=()=>{const{effectiveTheme:x}=ke(),[Z,ee]=c.useState([]),[ae,B]=c.useState([]),[te,R]=c.useState([]),[ue,v]=c.useState(!1),[u,w]=c.useState(null),[s,l]=c.useState({name:"",description:"",rank:"",category:"",type:"",locations:[],images:[],invoices:[]}),[Ye,M]=c.useState(""),[P,N]=c.useState(null),[pe,I]=c.useState(!1),[O,U]=c.useState(null),[se,S]=c.useState(!1),[ie,_]=c.useState({}),F=c.useRef([]),[Ze,ea]=c.useState(!1),[aa,ta]=c.useState([]),[sa,ia]=c.useState(0),[re,he]=c.useState(!1),[V,ge]=c.useState(""),[H,xe]=c.useState(""),[G,ye]=c.useState({value:null,label:"All"}),[q,Q]=c.useState(null),ne=[{value:null,label:"All"},...ae.map(a=>({value:a.category,label:a.category}))],D=ae.map(a=>({value:a.id,label:a.category}));c.useEffect(()=>{f.postData({endpoint:"/inventory/get-categories",body:{type:null},successCallback:a=>{Array.isArray(a)?B(a):B([])},errorCallback:()=>{B([])}})},[]),c.useEffect(()=>{f.postData({endpoint:"/inventory/locations",body:{request:C({})},successCallback:a=>{Array.isArray(a)?R(a):R([])},errorCallback:()=>{R([])}})},[]);const L=()=>{const a={name:V||null,description:H||null,category:G?.value,image:q?.value,isAdmin:!0},t=new Promise((n,o)=>{f.postData({endpoint:"/inventory/get-products",body:{request:C(a)},successCallback:r=>{Array.isArray(r)?n(r.map(W=>({...W,type:"Product"}))):n([])},errorCallback:r=>{console.error("Failed to fetch products:",r),n([])}})}),i=new Promise((n,o)=>{f.postData({endpoint:"/inventory/get-items",body:{request:C(a)},successCallback:r=>{Array.isArray(r)?n(r.map(W=>({...W,type:"Item"}))):n([])},errorCallback:r=>{console.error("Failed to fetch items:",r),n([])}})});Promise.all([t,i]).then(([n,o])=>{const r=[...n,...o];ee(r)}).catch(n=>{console.error("Error fetching data:",n),ee([]),y.error("Failed to fetch items")})};c.useEffect(()=>{L()},[]),c.useEffect(()=>{L()},[V,H,G,q]);const je=a=>{if(a.preventDefault(),!s.name.trim()){y.error("Item name is required");return}if(!P){y.error("Category is required");return}const t=localStorage.getItem("token");if(!t){y.error("No token found");return}let i="/inventory/save-item",n={...s,name:s.name,description:s.description,rank:s.rank?parseInt(s.rank):null,category:P.value,image:u?.image||"",locations:s.locations.filter(r=>r.location).map(r=>({locationId:r.location.value,quantity:parseInt(r.quantity),id:r.id})),images:s.images.map(r=>({file:r.file,type:r.type,rank:parseInt(r.rank)||null,existing:r.existing})),invoices:s.invoices?.map(r=>({date:r.date?r.date?.toISOString()?.split("T")[0]:null,quantity:parseInt(r.quantity),unitPrice:parseFloat(r.unitPrice),basePrice:parseFloat(r.basePrice),weight:r.weight})),token:t,type:"item"};/^(Product)$/gim.test(s.type)?(i="/inventory/save-product",n={id:u?.id,name:s.name,categoryid:P.value,pricelists:s.invoices.map(r=>({weight:r.weight,unitprice:parseFloat(r.unitPrice),basePrice:parseFloat(r.basePrice),bomCost:parseFloat(r.bomCost),quantity:parseInt(r.quantity),id:r.id})),productimages:s.images.map(r=>({id:r?.id,fileName:r.existing?.fileName||"",productId:u?.id,rank:parseInt(r.rank),type:r.type})),tagline:s.description,rank:s.rank?parseInt(s.rank):u?.rank,type:"product",locations:s.locations.filter(r=>r.location).map(r=>({locationId:r.location.value,quantity:r.quantity})),token:t}):u&&(n.id=u?.id);const o=new FormData;o.append("request",C(n)),s.images.forEach(r=>{r.file&&o.append("files",r.file)}),f.postFormData({endpoint:i,body:o,Authorization:`Bearer ${t}`,successCallback:r=>{y.success(u?"Item updated successfully":"Item added successfully"),v(!1),w(null),l({name:"",description:"",rank:"",category:"",locations:[],images:[],invoices:[],type:""}),M(""),L()},errorCallback:r=>{y.error("Failed to save item"),console.error("Error saving item:",r)}})},ve=a=>{w(a),l({name:a.name,description:a.description||"",rank:a.rank?.toString()||"",category:"",locations:a.ItemLocations?.map(t=>({location:{value:t.Location.id,label:t.Location.name},quantity:t.quantity.toString(),id:t.id}))||[],images:a.ItemImages?.map(t=>({file:null,type:t.type||"",rank:t.rank,existing:{id:t.id,fileName:t.image,type:t.type,rank:null}}))||[],invoices:a.ItemInvoices?.map(t=>({date:t.date?new Date(t.date):null,quantity:t.quantity.toString(),unitPrice:t.unitprice,basePrice:t.basePrice,weight:t.weight,bomCost:""}))||[],type:a.type}),N(D.find(t=>t.value===a.categoryId)||null),M(""),v(!0)},fe=a=>{w(a),l({name:a.name,description:a.tagline||"",rank:a.rank?.toString()||"",category:a.categoryid,locations:a.locations?.map(t=>({location:{value:t.id,label:t.name},quantity:t.ProductLocation?.quantity||t.quantity}))||[],images:a.ProductImages?.map(t=>({file:null,type:t.type||"",rank:t.rank?.toString()||"",existing:{id:t.id,fileName:t.fileName,type:t.type,rank:t.rank}}))||[],invoices:a.PriceLists?.map(t=>({date:new Date(t.updatedAt),quantity:t.quantity||"",unitPrice:t.unitprice.toString(),basePrice:t.basePrice.toString(),weight:t.weight||"",bomCost:t.bomCost?.toString()||""}))||[],type:a.type}),N(D.find(t=>t.value===a.categoryid)||null),M(""),v(!0)},be=a=>{a.type==="Item"?ve(a):a.type==="Product"&&fe(a)},we=a=>{U(a),I(!0)};c.useEffect(()=>{const a=t=>{t.target.closest(".dropdown")||S(!1)};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[]);const Ne=()=>{if(!O)return;const a=localStorage.getItem("token");if(!a){y.error("No token found");return}f.postData({endpoint:"/inventory/delete-item",body:{request:C({id:O.id,token:a})},successCallback:t=>{y.success("Item deleted successfully"),L(),I(!1),U(null)},errorCallback:t=>{y.error(t.error||"Failed to delete item"),I(!1),U(null)}})},Ie=a=>["image/jpeg","image/png","image/webp","image/gif"].includes(a.type)?a.size>5*1024*1024?"File size must be less than 5MB":null:"Please upload a valid image file (JPEG, PNG, WebP, GIF)",Ce=(a,t)=>{const i=t.target.files?.[0];if(i){const n=Ie(i);if(n){_(r=>({...r,[`image_${a}`]:n}));return}const o=[...s.images];o[a].file=i,l({...s,images:o}),_(r=>({...r,[`image_${a}`]:""}))}},le=a=>{const t=[...s.images];t[a].file=null,t[a].existing=void 0,l({...s,images:t}),F.current[a]&&(F.current[a].value=""),_(i=>({...i,[`image_${a}`]:""}))},A=a=>`/static/inventory/${a}`;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"min-h-screen",children:[e.jsx(Fe,{}),e.jsxs("div",{className:"container mx-auto mt-6 px-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[e.jsx("h1",{className:"text-primary text-2xl font-bold",children:"Items"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",onClick:()=>he(!re),className:"border-green-600 text-green-600 hover:text-primary",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Filters"]}),e.jsxs("div",{className:"relative",children:[e.jsxs(m,{variant:"outline",onClick:()=>S(!se),className:"border-green-600 text-green-600 hover:text-primary",children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Add"]}),e.jsx(Pe,{children:se&&e.jsxs(J.ul,{className:"absolute right-0 top-full mt-2 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg z-10",variants:Xe,initial:"initial",animate:"animate",exit:"exit",children:[e.jsx(J.li,{variants:me,children:e.jsx("button",{className:"block w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>{w(null),l({name:"",description:"",rank:"",category:"",locations:[],images:[],invoices:[],type:"Item"}),N(null),v(!0),S(!1)},children:"Item"})}),e.jsx(J.li,{variants:me,children:e.jsx("button",{className:"block w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>{w(null),l({name:"",description:"",rank:"",category:"",locations:[],images:[],invoices:[],type:"Product"}),N(null),v(!0),S(!1)},children:"Product"})})]})})]})]})]}),re&&e.jsx(K,{className:"mb-6",children:e.jsx(X,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Name"}),e.jsx(p,{value:V,onChange:a=>ge(a.target.value),placeholder:"Enter item name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Description"}),e.jsx(p,{value:H,onChange:a=>xe(a.target.value),placeholder:"Enter description"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Category"}),e.jsxs(T,{value:G?.value||void 0,onValueChange:a=>{const t=ne.find(i=>i.value===(a==="all"?null:a));ye(t||{value:null,label:"All"})},children:[e.jsx($,{className:x==="dark"?"bg-gray-800 text-white border-gray-600":"",children:e.jsx(E,{placeholder:"Select Category"})}),e.jsx(z,{children:ne.map(a=>e.jsx(b,{value:a.value||"all",children:a.label},a.value||"all"))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Image"}),e.jsxs(T,{value:q?.value===null?"all":q?.value?"has":"no",onValueChange:a=>{Q(a==="all"?{value:null,label:"All"}:a==="has"?{value:!0,label:"Has Image"}:{value:!1,label:"No Image"})},children:[e.jsx($,{children:e.jsx(E,{placeholder:"Filter by image"})}),e.jsxs(z,{children:[e.jsx(b,{value:"all",children:"All"}),e.jsx(b,{value:"has",children:"Has Image"}),e.jsx(b,{value:"no",children:"No Image"})]})]})]})]})})}),ue&&e.jsxs(K,{className:"mb-6",children:[e.jsx(Ae,{children:e.jsx(Te,{children:u?`Edit ${u.type}`:`Add ${s.type}`})}),e.jsx("form",{onSubmit:je,children:e.jsxs(X,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"item-name",children:[s.type," Name"]}),e.jsx(p,{id:"item-name",value:s.name,onChange:a=>l({...s,name:a.target.value}),placeholder:`Enter ${s.type} Name`,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"category",children:"Category"}),e.jsxs(T,{value:P?.value?.toString()||void 0,onValueChange:a=>{const t=D.find(i=>i.value===parseInt(a));N(t||null)},children:[e.jsx($,{id:"category",className:x==="dark"?"bg-gray-800 text-white border-gray-600":"",children:e.jsx(E,{placeholder:"Select Category"})}),e.jsx(z,{children:D.map(a=>e.jsx(b,{value:a.value.toString(),children:a.label},a.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"rank",children:"Rank"}),e.jsx(p,{id:"rank",type:"number",value:s.rank,onChange:a=>l({...s,rank:a.target.value}),placeholder:"Rank",className:x==="dark"?"bg-gray-800 text-white border-gray-600":""})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"description",children:"Description"}),e.jsx(Qe,{id:"description",value:s.description,onChange:a=>l({...s,description:a.target.value}),placeholder:"Enter Description",rows:3,className:x==="dark"?"bg-gray-800 text-white border-gray-600":""})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Locations"}),e.jsxs("div",{className:"space-y-3",children:[s.locations.map((a,t)=>e.jsxs("div",{className:"flex flex-wrap gap-2 p-4 border rounded-md items-end",children:[e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Location"}),e.jsxs(T,{value:a.location?.value?.toString()||void 0,onValueChange:i=>{const n=[...s.locations],o=te.find(r=>r.id===parseInt(i));n[t].location=o?{value:o.id,label:o.name}:null,l({...s,locations:n})},children:[e.jsx($,{children:e.jsx(E,{placeholder:"Select Location"})}),e.jsx(z,{children:te.filter(i=>!s.locations.some(n=>n.location?.value===i.id&&n!==a)).map(i=>e.jsx(b,{value:i.id.toString(),children:i.name},i.id))})]})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px] mb-2",children:[e.jsx(d,{children:"Quantity"}),e.jsx(p,{type:"text",value:a.quantity,onChange:i=>{const n=[...s.locations];n[t].quantity=i.target.value.replace(/[^0-9]/g,""),l({...s,locations:n})},placeholder:"Quantity",className:x==="dark"?"bg-gray-800 text-white border-gray-600":""})]}),e.jsxs("div",{className:"flex items-end gap-2 mb-2",children:[e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>l({...s,locations:[...s.locations,{location:null,quantity:""}]}),children:e.jsx(j,{className:"h-4 w-4"})}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>{const i=s.locations.filter((n,o)=>o!==t);l({...s,locations:i})},children:e.jsx(k,{className:"h-4 w-4"})})]})]},t)),s.locations?.length===0&&e.jsxs(m,{type:"button",variant:"outline",onClick:()=>l({...s,locations:[...s.locations,{location:null,quantity:""}]}),className:"w-full border-green-600 text-green-600 hover:text-primary",children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Add Location"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Images"}),e.jsxs("div",{className:"space-y-3",children:[s.images.map((a,t)=>e.jsxs("div",{className:"flex flex-wrap gap-2 p-4 border rounded-md items-end",children:[e.jsxs("div",{className:"space-y-2 flex-1 min-w-[150px]",children:[e.jsx(d,{children:"Image"}),a.existing?e.jsxs("div",{className:"relative group",children:[e.jsx(ce,{title:"Item Images",imageSrcs:s.images.filter(i=>i.existing).map(i=>A(i.existing.fileName)),children:e.jsx("img",{src:A(a.existing.fileName),alt:"Existing",className:"w-20 h-20 object-cover rounded-md border cursor-pointer hover:opacity-80 transition-opacity"})}),e.jsx("button",{type:"button",onClick:()=>le(t),className:"absolute -top-2 left-17 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(oe,{className:"h-3 w-3"})})]}):a.file?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:URL.createObjectURL(a.file),alt:"New",className:"w-20 h-20 object-cover rounded-md border"}),e.jsx("button",{type:"button",onClick:()=>le(t),className:"absolute -top-2 left-17 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",children:e.jsx(oe,{className:"h-3 w-3"})})]}):e.jsx("div",{className:"w-20 h-20 border-2 border-dashed border-muted-foreground/30 rounded-md flex items-center justify-center cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>F.current[t]?.click(),children:e.jsx(Je,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx("input",{ref:i=>{F.current[t]=i},type:"file",accept:"image/jpeg,image/png,image/webp,image/gif",onChange:i=>Ce(t,i),className:"hidden"}),ie[`image_${t}`]&&e.jsx("p",{className:"text-sm text-red-500",children:ie[`image_${t}`]})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Type"}),e.jsx(p,{value:a.type,onChange:i=>{const n=[...s.images];n[t].type=i.target.value,l({...s,images:n})},placeholder:"Type"})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Rank"}),e.jsx(p,{type:"text",value:a.rank,onChange:i=>{const n=[...s.images];n[t].rank=i.target.value.replace(/[^0-9]/g,""),l({...s,images:n})},placeholder:"Rank",className:x==="dark"?"bg-gray-800 text-white border-gray-600":""})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>l({...s,images:[...s.images,{file:null,type:"",rank:"",existing:void 0}]}),children:e.jsx(j,{className:"h-4 w-4"})}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>{const i=s.images.filter((n,o)=>o!==t);l({...s,images:i})},children:e.jsx(k,{className:"h-4 w-4"})})]})]},t)),s.images?.length===0&&e.jsxs(m,{type:"button",variant:"outline",onClick:()=>l({...s,images:[...s.images,{file:null,type:"",rank:"",existing:void 0}]}),className:"w-full border-green-600 text-green-600 hover:text-primary",children:[e.jsx(j,{className:"h-4 w-4 mr-2"})," Add Image"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:s.type==="Product"||u?.type==="Product"?"Price Lists":"Invoices"}),e.jsxs("div",{className:"space-y-3",children:[s.invoices.map((a,t)=>e.jsxs("div",{className:"flex flex-wrap gap-2 p-4 border rounded-md items-end",children:[e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Date"}),e.jsxs(Oe,{children:[e.jsx(Ue,{asChild:!0,children:e.jsxs(m,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),a.date?qe(a.date,"yyyy-MM-dd"):"Invoice/Price List Date"]})}),e.jsx(_e,{className:"w-auto p-0",children:e.jsx(Le,{mode:"single",selected:a.date,onSelect:i=>{const n=[...s.invoices];n[t].date=i,l({...s,invoices:n})},autoFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Quantity"}),e.jsx(p,{type:"text",value:a.quantity,onChange:i=>{const n=[...s.invoices];n[t].quantity=i.target.value.replace(/[^0-9]/g,""),l({...s,invoices:n})},placeholder:"Quantity"})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Unit Price"}),e.jsx(p,{type:"text",value:a.unitPrice,onChange:i=>{const n=[...s.invoices];n[t].unitPrice=i.target.value.replace(/[^0-9.]/g,""),l({...s,invoices:n})},placeholder:"Unit Price",className:x==="dark"?"bg-gray-800 text-white border-gray-600":""})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Base Price"}),e.jsx(p,{type:"text",value:a.basePrice,onChange:i=>{const n=[...s.invoices];n[t].basePrice=i.target.value.replace(/[^0-9.]/g,""),l({...s,invoices:n})},placeholder:"Base Price"})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Weight"}),e.jsx(p,{type:"text",value:a.weight,onChange:i=>{const n=[...s.invoices];n[t].weight=i.target.value,l({...s,invoices:n})},placeholder:"Weight",className:x==="dark"?"bg-gray-800 text-white border-gray-600":""})]}),s.type==="Product"||u?.type==="Product"?e.jsxs("div",{className:"flex items-end gap-2 flex-1 min-w-[150px]",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(d,{children:"BOM Cost"}),e.jsx(p,{type:"text",value:a.bomCost,onChange:i=>{const n=[...s.invoices];n[t].bomCost=i.target.value.replace(/[^0-9.]/g,""),l({...s,invoices:n})},placeholder:"BOM Cost"})]}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>l({...s,invoices:[...s.invoices,{date:null,quantity:"",unitPrice:"",basePrice:"",weight:"",bomCost:""}]}),children:e.jsx(j,{className:"h-4 w-4"})}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>{const i=s.invoices.filter((n,o)=>o!==t);l({...s,invoices:i})},children:e.jsx(k,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>l({...s,invoices:[...s.invoices,{date:null,quantity:"",unitPrice:"",basePrice:"",weight:"",bomCost:""}]}),children:e.jsx(j,{className:"h-4 w-4"})}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>{const i=s.invoices.filter((n,o)=>o!==t);l({...s,invoices:i})},children:e.jsx(k,{className:"h-4 w-4"})})]})]},a.date+t)),s.invoices?.length===0&&e.jsxs(m,{type:"button",variant:"outline",onClick:()=>l({...s,invoices:[...s.invoices,{date:null,quantity:"",unitPrice:"",basePrice:"",weight:"",bomCost:""}]}),className:"w-full border-green-600 text-green-600 hover:text-primary",children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Add ",s.type==="Product"||u?.type==="Product"?"SKU":"Invoice"]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-6",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(m,{type:"submit",children:u?`Update ${u.type}`:`Add ${s.type}`})]})]})})]}),e.jsx(K,{children:e.jsx(X,{className:"p-0",children:e.jsxs(Ve,{children:[e.jsx(He,{children:e.jsxs(Y,{children:[e.jsx(g,{style:{width:"100px"},children:"Actions"}),e.jsx(g,{children:"Image"}),e.jsx(g,{style:{width:"200px"},children:"Name"}),e.jsx(g,{style:{width:"300px"},children:"Description"}),e.jsx(g,{children:"Type"}),e.jsx(g,{style:{width:"210px"},children:"Category"}),e.jsx(g,{style:{width:"140px"},children:"Base Price"}),e.jsx(g,{style:{width:"120px"},children:"Unit Price"}),e.jsx(g,{style:{width:"100px"},children:"Stock"}),e.jsx(g,{style:{width:"230px"},children:"Locations"}),e.jsx(g,{style:{width:"220px"},children:"Invoices"})]})}),e.jsxs(Ge,{children:[Z.map(a=>e.jsxs(Y,{children:[e.jsx(h,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{size:"sm",variant:"outline",onClick:()=>be(a),children:e.jsx(Ke,{className:"h-4 w-4"})}),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>we(a),children:e.jsx(k,{className:"h-4 w-4"})})]})}),e.jsx(h,{children:(()=>{const t=a.ItemImages||[],i=a.ProductImages||[],n=[...t.map((o,r)=>({url:A(o.image),index:r})),...i.map((o,r)=>({url:A(o.fileName),index:t.length+r}))];return n.length>0?e.jsx(ce,{title:`${a.name} Images`,imageSrcs:n.map(o=>o.url),children:e.jsxs("div",{className:"relative group cursor-pointer",children:[e.jsx("img",{src:n[0].url,alt:a.name,className:"w-12 h-12 object-cover rounded-md border cursor-pointer hover:opacity-80 transition-opacity"}),n.length>1&&e.jsx("span",{className:"absolute -bottom-1 -right-1 bg-primary text-primary-foreground text-[10px] px-1 rounded-full",children:n.length})]})}):e.jsx("span",{className:"text-muted-foreground",children:"No Image"})})()}),e.jsx(h,{className:"font-medium",children:a.name}),e.jsx(h,{children:a.description||a.tagline||"-"}),e.jsx(h,{children:a.type}),e.jsx(h,{children:a.Category?.category}),e.jsxs(h,{children:["₹",a.PriceLists?.[0]?.basePrice||a.ItemInvoices?.[a.ItemInvoices.length-1]?.basePrice||"-"]}),e.jsxs(h,{children:["₹",a.PriceLists?.[0]?.unitprice||a.ItemInvoices?.[a.ItemInvoices.length-1]?.unitprice||"-"]}),e.jsx(h,{children:a.locations?.reduce((t,i)=>t+(i.ProductLocation.quantity||0),0)||a.ItemLocations?.reduce((t,i)=>t+(i.quantity||0),0)||"-"}),e.jsx(h,{children:a.locations?.map(t=>`${t.name} (${t.room}) [${t.ProductLocation.quantity}]`).join(", ")||a.ItemLocations?.map(t=>`${t.Location.name} (${t.Location.room}) [${t.quantity}]`).join(", ")||"-"}),e.jsx(h,{children:a.PriceLists?.length>0?`${new Date(a.updatedAt).toLocaleDateString()} (${a.PriceLists?.[a.PriceLists.length-1].quantity??0})`:a.ItemInvoices?.length>0?`${new Date(a.ItemInvoices?.[a.ItemInvoices.length-1].date).toLocaleDateString()} (${a.ItemInvoices?.[a.ItemInvoices.length-1].quantity??0} x ₹${a.ItemInvoices?.[a.ItemInvoices.length-1].unitprice})`:"-"})]},a.type+a.id)),Z.length===0&&e.jsx(Y,{children:e.jsx(h,{colSpan:11,className:"text-center py-8 text-muted-foreground",children:"No items found. Add some items to get started."})})]})]})})})]})]}),e.jsx($e,{open:pe,onOpenChange:I,children:e.jsxs(Ee,{className:x==="dark"?"bg-gray-800 text-white border-gray-600":"",children:[e.jsxs(ze,{children:[e.jsx(Be,{children:"Confirm Delete"}),e.jsxs(Re,{children:['Are you sure you want to delete the item "',O?.name,'"? This action cannot be undone.']})]}),e.jsxs(Me,{children:[e.jsx(m,{variant:"outline",onClick:()=>I(!1),className:x==="dark"?"bg-gray-800 text-white border-gray-600":"",children:"Cancel"}),e.jsx(m,{variant:"destructive",onClick:Ne,children:"Delete"})]})]})}),e.jsx(Se,{})]})};export{Pa as default};

import{a as e,b as r,j as s}from"./vendor-animation-CcgChT4Y.js";import{C as t}from"./dropdown-menu-DjLdUzkQ.js";import{T as d}from"./TopNav-BcoF5Zho.js";import{u as a,g as o,A as l,e as i,c,B as n}from"./index-QkJ4t2go.js";import{B as m}from"./badge-DjmmXEHi.js";import{C as u,c as x,a as h,b as g}from"./card-CZoDjOMW.js";import{D as p,a as b,b as j,c as v,d as N}from"./dialog-B1BfGlYi.js";import{I as y}from"./input-hHw7iIA9.js";import{L as f}from"./label-CdSwSrYM.js";import{ac as k}from"./vendor-icons-BYe_-sqm.js";import"./vendor-radix-CgisZDtL.js";import"./vendor-charts-1c3qO8Q0.js";import"./vendor-ui-utils-B4kPJlQS.js";import"./NavBar-Zl-a5m7p.js";import"./TopBar-CO3pAy7f.js";import"./vendor-pdf-export-F3dE0gEs.js";const w=()=>{const{effectiveTheme:w}=a(),[C,P]=e.useState(""),[D,S]=e.useState(""),[O,I]=e.useState([]),[Y,F]=e.useState(!!localStorage.getItem("token")),[T,q]=e.useState(null),[L,M]=e.useState(null),[z,A]=e.useState(null),[E,R]=e.useState(null),[H,$]=r.useState({}),[B,U]=e.useState(!1),[J,K]=e.useState(null),G=o(),Q=!!localStorage.getItem("token");e.useEffect(()=>{const e=localStorage.getItem("token");e&&l.postData({endpoint:"/order/get-user-orders",body:{request:i({token:e})},isCriticalApi:!0,successCallback:e=>{e.error?c.error(e.error):I(e.orders||[]),F(!1)},errorCallback:e=>{c.error("Failed to fetch user orders: "+e?.error),F(!1)}})},[]);return s.jsxs("div",{className:"min-h-screen flex flex-col",children:[s.jsx(d,{}),s.jsx("div",{className:"flex-1 pt-8 pb-20 px-4",children:s.jsxs("div",{className:"max-w-7xl mx-auto py-4",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center",children:s.jsx(k,{size:"50px",className:"text-primary"})}),s.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground mb-2",children:Q?"Your Orders":"Order Tracking"}),s.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:Q?"Track and manage all your orders":"Track your order status in real-time"})]}),!Q&&s.jsx(u,{className:"mb-6",children:s.jsxs(x,{className:"p-4 sm:p-6",children:[s.jsx("div",{className:"text-center mb-4",children:s.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Track Your Order"})}),s.jsx("form",{onSubmit:e=>{e.preventDefault(),C&&D?(F(!0),l.postData({endpoint:"/order/get-order-details",body:{request:i({id:C,phone:D})},isCriticalApi:!0,successCallback:e=>{e.error?c.error(e.error):I([e]),F(!1)},errorCallback:e=>{c.error("Failed to fetch order details: "+e?.error),F(!1)}})):c.error("Please enter both Order ID and Phone Number")},children:s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:flex lg:gap-4 lg:items-end lg:justify-center",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs(f,{htmlFor:"order-id",className:"text-sm font-medium text-foreground",children:["Order ID ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(y,{id:"order-id",type:"text",value:C,onChange:e=>P(e.target.value),placeholder:"Enter Your Order ID",required:!0,className:"h-11 sm:h-12 text-sm sm:text-base"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(f,{htmlFor:"phone",className:"text-sm font-medium text-foreground",children:["Phone Number ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(y,{id:"phone",type:"tel",value:D,onChange:e=>S(e.target.value),placeholder:"Enter Your Phone Number",required:!0,className:"h-11 sm:h-12 text-sm sm:text-base"})]}),s.jsx("div",{className:"lg:w-40",children:s.jsx(n,{type:"submit",className:"w-full h-11 sm:h-12 text-sm sm:text-base font-medium",disabled:Y,children:Y?"Tracking...":"Track Order"})})]})})]})}),s.jsx("div",{className:"w-full",children:Y&&Q?s.jsxs("div",{className:"text-center py-16 lg:py-20",children:[s.jsx("div",{className:"w-12 h-12 lg:w-16 lg:h-16 mx-auto mb-4",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 lg:h-16 lg:w-16 border-b-2 border-primary mx-auto"})}),s.jsx("p",{className:"text-sm lg:text-base text-muted-foreground",children:"Loading your orders..."})]}):s.jsxs(s.Fragment,{children:[0===O.length&&Q&&s.jsxs("div",{className:"text-center py-16 lg:py-20",children:[s.jsx("div",{className:"w-16 h-16 lg:w-20 lg:h-20 mx-auto mb-4 bg-muted rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-2xl lg:text-3xl",children:"ðŸ›’"})}),s.jsx("h3",{className:"text-xl lg:text-2xl font-semibold text-foreground mb-2",children:"No Orders Yet"}),s.jsx("p",{className:"text-sm lg:text-base text-muted-foreground max-w-md mx-auto",children:"Place your first order to discover our delicious range of healthy snacks and instant foods!"})]}),O.length>0&&s.jsx("div",{children:O.map((e,r)=>s.jsxs(u,{className:"mb-4",children:[s.jsxs(h,{className:"flex flex-row justify-between items-center",children:[s.jsxs(g,{className:"text-lg",children:["Order #",e.order?.id]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("span",{className:"font-bold",children:["Order Total : ",(()=>{const r=e.products?.reduce((e,r)=>e+r.quantity*(r.priceList?.unitprice||0),0)||0,s=e.totalDiscount||0,t="Home Delivery"===e.order?.shippingMethod&&r<999?99:0,d=e.shippingDiscount||0;return`â‚¹${(r-s+(t>0?t-d:0)).toFixed(2)}`})()]}),s.jsx(m,{variant:"Payment Processed"===e.order?.status||"Ordered"===e.order?.status||"Delivered"===e.order?.status||"Payment Processed"===e.order?.status?"default":"Cancelled"===e.order?.status?"destructive":"secondary",children:e.order?.status})]})]}),s.jsxs(x,{children:[s.jsxs("div",{className:"space-y-2 mb-4",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Name & Address:"})," ",e.order?.name,", ",e.order?.address,", ",e.order?.city,", ",e.order?.state," - ",e.order?.pincode]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Mobile:"})," ",e.order?.mobile," | ",s.jsx("strong",{children:"Email:"})," ",e.order?.email," "]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Order Date:"})," ",e.order?.orderedDate?new Date(e.order.orderedDate).toLocaleDateString():""," | ",s.jsx("strong",{children:"Delivered"===e.order?.status?"Delivery Date: ":"Estimated Delivery Date: "})," ",e.order?.expectedDeliveryDate?new Date(e.order.expectedDeliveryDate).toLocaleDateString():""," "]}),e.order?.deliveryNote&&s.jsxs("p",{children:[s.jsx("strong",{children:"Notes:"})," ",e.order?.deliveryNote]})]}),s.jsxs("div",{className:"flex flex-wrap gap-2 mb-4 mr-2",children:[s.jsxs(n,{variant:T===r&&"products"===L?"default":"outline",size:"sm",className:T===r&&"products"===L?"":"border-green-600 text-green-600 hover:bg-green-50",onClick:()=>{T===r&&"products"===L?M(null):(q(r),M("products"))},children:[T===r&&"products"===L?"Hide":"Show"," Order Details"]}),s.jsxs(n,{variant:T===r&&"tracking"===L?"default":"outline",size:"sm",className:T===r&&"tracking"===L?"":"border-green-600 text-green-600 hover:bg-green-50",onClick:()=>{T===r&&"tracking"===L?M(null):(q(r),M("tracking"))},children:[T===r&&"tracking"===L?"Hide":"Show"," Order Tracking"]}),Q&&("Payment Processed"===e.order?.status||"Ordered"===e.order?.status||"Processing"===e.order?.status||"Packed"===e.order?.status)&&s.jsx(n,{variant:"destructive",size:"sm",onClick:()=>{return r=e.order?.id,K(r),void U(!0);var r},disabled:z===e.order?.id,children:z===e.order?.id?"Cancelling...":"Cancel Order"}),Q&&("Delivered"===e.order?.status||"Cancelled"===e.order?.status)&&s.jsx(n,{variant:"outline",size:"sm",className:"border-green-600 text-green-600 hover:bg-green-50",onClick:()=>(e=>{R(e);const r=localStorage.getItem("token");r?l.postData({endpoint:"/order/reorder",body:{request:i({id:e,token:r})},successCallback:e=>{e.error?c.error(e.error):(c.success(e.response?.message||"Order reordered successfully"),l.postData({endpoint:"/order/pending-order",body:{request:i({token:localStorage.getItem("token")})},successCallback:e=>{if(e?.products&&Array.isArray(e.products)&&e.products.length>0){let r=[];try{const e=localStorage.getItem("cart");e&&(r=JSON.parse(e))}catch{r=[]}const s=[...e.products];r.forEach(e=>{const r=s.findIndex(r=>r.productId===e.productId&&r.priceList?.id===e.priceList?.id);-1===r?s.push(e):s[r].quantity=e.quantity}),localStorage.setItem("cart",JSON.stringify(s)),G("/checkout")}},errorCallback:e=>{G("/")}}),c.success(`New cart created with ${e?.productsCount} item(s). Check your cart to proceed.`)),R(null)},errorCallback:e=>{c.error("Failed to reorder: "+e?.error),R(null)}}):c.error("Please login to reorder")})(e.order?.id),disabled:E===e.order?.id,children:E===e.order?.id?"Reordering...":"Reorder"}),Q&&("Shipped"===e.order?.status||"Delivered"===e.order?.status)&&s.jsx(n,{variant:"outline",size:"sm",className:"border-green-600 text-green-600 hover:bg-green-50",onClick:()=>(e=>{$(r=>({...r,[e]:!0}));const r=localStorage.getItem("token");if(!r)return c.error("Please login to download invoice"),void $(r=>({...r,[e]:!1}));l.postData({endpoint:"/order/download-invoice",body:{request:i({orderId:e,token:r})},responseType:"blob",successCallback:r=>{const s=window.URL.createObjectURL(r),t=document.createElement("a");t.href=s,t.download=`Renus Home Foods - Order Invoice - ${e}.pdf`,document.body.appendChild(t),t.click(),window.URL.revokeObjectURL(s),document.body.removeChild(t),c.success("Invoice downloaded successfully"),$(r=>({...r,[e]:!1}))},errorCallback:r=>{c.error("Failed to download invoice: "+r?.error),$(r=>({...r,[e]:!1}))}})})(e.order?.id),disabled:!0===H[e.order?.id],children:!0===H[e.order?.id]?"Downloading...":"Download Invoice"})]}),T===r&&"products"===L&&e.products&&e.products.length>0&&s.jsxs("div",{className:"mt-4",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("b",{children:"Order Notes: "})," ",e?.order?.notes]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full border "+("dark"===w?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"),children:[s.jsx("thead",{children:s.jsxs("tr",{className:""+("dark"===w?"bg-gray-700":"bg-gray-50"),children:[s.jsx("th",{className:"text-left p-3 font-medium",children:"Products"}),s.jsx("th",{className:"text-left p-3 font-medium",children:"Name"}),s.jsx("th",{className:"text-left p-3 font-medium",children:"Weight"}),s.jsx("th",{className:"text-left p-3 font-medium",children:"Price"}),s.jsx("th",{className:"text-left p-3 font-medium",children:"Quantity"}),s.jsx("th",{className:"text-left p-3 font-medium",children:"Total"})]})}),s.jsx("tbody",{children:e.products.map((e,r)=>s.jsxs("tr",{className:"border-t "+("dark"===w?"border-gray-600":"border-gray-200"),children:[s.jsx("td",{className:"p-3",children:s.jsx("div",{className:"flex items-center",children:s.jsx("img",{src:e.image?`/static/inventory/${e.image}`:"/img/logo.webp",className:"w-12 h-12 object-cover rounded",alt:e.name||"Product"})})}),s.jsx("td",{className:"p-3",children:e.name}),s.jsx("td",{className:"p-3",children:e.priceList?.weight}),s.jsxs("td",{className:"p-3",children:["â‚¹",e.priceList?.unitprice]}),s.jsx("td",{className:"p-3",children:e.quantity}),s.jsxs("td",{className:"p-3",children:["â‚¹",e.quantity*(e.priceList?.unitprice||0)]})]},r))})]})}),s.jsx("div",{className:"mt-4",children:s.jsx("table",{className:"w-full border "+("dark"===w?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"),children:s.jsx("tbody",{children:(()=>{const r=e.products.reduce((e,r)=>e+r.quantity*(r.priceList?.unitprice||0),0).toFixed(2),t=(e.totalDiscount||0).toFixed(2),d="Home Delivery"===e.order?.shippingMethod&&r<999?99:0,a=e.shippingDiscount||0,o=e.couponCode||null,l=Math.max(0,d-a),i=(r-t+l).toFixed(2);return s.jsxs(s.Fragment,{children:[s.jsxs("tr",{className:"border-t "+("dark"===w?"border-gray-600":"border-gray-200"),children:[s.jsx("td",{className:"p-3 text-right font-medium",children:"Subtotal"}),s.jsxs("td",{className:"p-3 text-right",children:["â‚¹",r]})]}),t>0&&s.jsxs("tr",{className:"border-t "+("dark"===w?"border-gray-600":"border-gray-200"),children:[s.jsxs("td",{className:"p-3 text-right font-medium",children:["Discount (Code: ",o,")"]}),s.jsxs("td",{className:"p-3 text-right",children:["-â‚¹",t]})]}),s.jsxs("tr",{className:"border-t "+("dark"===w?"border-gray-600":"border-gray-200"),children:[s.jsxs("td",{className:"p-3 text-right font-medium",children:["Shipping",o&&a>0?` (Code: ${o})`:""]}),s.jsxs("td",{className:"p-3 text-right",children:["â‚¹",l.toFixed(2)]})]}),s.jsxs("tr",{className:"border-t "+("dark"===w?"border-gray-600":"border-gray-200"),children:[s.jsx("td",{className:"p-3 text-right font-medium",children:"Total"}),s.jsxs("td",{className:"p-3 text-right font-bold",children:["â‚¹",i]})]}),s.jsxs("tr",{className:"border-t "+("dark"===w?"border-gray-600":"border-gray-200"),children:[s.jsx("td",{className:"p-3 text-right font-medium",children:"Shipping Method"}),s.jsx("td",{className:"p-3 text-right",children:e.order?.shippingMethod})]}),s.jsxs("tr",{className:"border-t "+("dark"===w?"border-gray-600":"border-gray-200"),children:[s.jsx("td",{className:"p-3 text-right font-medium",children:"Payment Method"}),s.jsx("td",{className:"p-3 text-right",children:e.order?.paymentMethod})]})]})})()})})})]}),T===r&&"tracking"===L&&s.jsx("div",{className:"mt-4",children:s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"flex justify-between items-center relative",style:{zIndex:2},children:("Cancelled"===e.order?.status?[{key:"cancelled",label:"Cancelled",descPending:"",descInProgress:"",descCompleted:"Your order has been cancelled and refunded",img:"/img/cancelled.svg"}]:[{key:"ordered",label:"Ordered",descPending:"",descInProgress:"Your order has been successfully placed",descCompleted:"Your order has been successfully placed",img:"/img/ordered.svg"},{key:"processing",label:"Processing",descPending:"Your order will be prepared shortly",descInProgress:"Your order is being prepared",descCompleted:"Your order was prepared",img:"/img/processing.svg"},{key:"packed",label:"Packed",descPending:"Your order will be packed soon",descInProgress:"Your order is being packed",descCompleted:"Your order was packed",img:"/img/packed.svg"},{key:"dispatched",label:"Shipped",descPending:"Your order will be dispatched soon",descInProgress:"Your order has been shipped",descCompleted:"Your order was shipped",img:"/img/shipped.svg"},{key:"delivered",label:"Delivered",descPending:"Your order will be delivered soon",descInProgress:"Your order has been delivered",descCompleted:"Your order has been delivered",img:"/img/delivered.svg"}]).map((r,t)=>{const d="Payment Processed"===e.order?.status&&t<=0||"Ordered"===e.order?.status&&t<=0||"Processing"===e.order?.status&&t<=1||"Packed"===e.order?.status&&t<=2||"Shipped"===e.order?.status&&t<=3||"Delivered"===e.order?.status&&t<=4||"Cancelled"===e.order?.status&&t<=0,a="Payment Processed"===e.order?.status&&0===t||"Ordered"===e.order?.status&&0===t||"Processing"===e.order?.status&&1===t||"Packed"===e.order?.status&&2===t||"Shipped"===e.order?.status&&3===t||"Delivered"===e.order?.status&&4===t,o="Ordered"===e.order?.status&&t>0||"Payment Processed"===e.order?.status&&t>0||"Processing"===e.order?.status&&t>1||"Packed"===e.order?.status&&t>2||"Shipped"===e.order?.status&&t>3||"Delivered"===e.order?.status&&t>4||"Cancelled"===e.order?.status&&t>0;return s.jsx("div",{className:"text-center relative flex w-44 h-36 z-2 bg-background",children:s.jsxs("div",{className:"p-3 rounded-lg border-2 "+(d?"border-green-500 text-green-500":a?"border-blue-500":"border-gray-300"),children:[s.jsx("img",{src:r.img,alt:r.label,className:"w-20 h-12 mx-auto mb-2 object-contain "+("dark"===w?"brightness-0 invert":"")}),s.jsx("div",{className:"font-bold text-sm "+(d?"text-green-600":"text-grey-600"),children:r.label}),o&&s.jsx("small",{className:"block mt-1 text-sm "+("dark"===w?"text-gray-300":"text-gray-600"),children:r.descPending}),a&&s.jsx("small",{className:"block mt-1 text-sm "+("dark"===w?"text-green-200":"text-green-600"),children:r.descInProgress}),d&&!a&&s.jsx("small",{className:"block mt-1 text-sm "+("dark"===w?"text-green-200":"text-green-600"),children:r.descCompleted})]})},r.key)})}),"Cancelled"!==e.order?.status&&s.jsx("div",{className:"absolute top-1/2 left-0 right-0 -translate-y-1/2 pointer-events-none",children:s.jsx("div",{className:"relative h-1 bg-gray-300",children:s.jsx("div",{className:"h-full absolute left-0 bg-green-500 transition-all duration-300",style:{width:`${(()=>{const r=["Payment Processed","Ordered","Processing","Packed","Shipped","Delivered"],s=r.indexOf(e.order?.status);return s<=0?"0%":s>=r.length-1?"100%":s/(r.length-1)*100+"%"})()}`}})})})]})})]})]},r))})]})})]})}),s.jsx(p,{open:B,onOpenChange:U,children:s.jsxs(b,{className:"sm:max-w-[425px]",children:[s.jsx(j,{children:s.jsx(v,{children:"Cancel Order"})}),s.jsx("div",{className:"py-4",children:s.jsx("p",{children:"Are you sure you want to cancel this order? This action cannot be undone."})}),s.jsxs(N,{children:[s.jsx(n,{variant:"outline",onClick:()=>{U(!1),K(null)},children:"No, Keep Order"}),s.jsx(n,{variant:"destructive",onClick:()=>{if(!J)return;U(!1),A(J);const e=localStorage.getItem("token");if(!e)return c.error("Please login to cancel orders"),void A(null);l.postData({endpoint:"/order/cancel-order",body:{request:i({id:J,token:e})},successCallback:r=>{r.error?c.error(r.error):(c.success(r.response?.message||"Order cancelled successfully"),l.postData({endpoint:"/order/get-user-orders",body:{request:i({token:e})},successCallback:e=>{e.error?c.error(e.error):I(e.orders||[]),F(!1)},errorCallback:e=>{c.error("Failed to refresh orders: "+e?.error),F(!1)}})),A(null),K(null)},errorCallback:e=>{c.error("Failed to cancel order: "+e?.error),A(null),K(null)}})},children:"Yes, Cancel Order"})]})]})}),s.jsx(t,{})]})};export{w as default};

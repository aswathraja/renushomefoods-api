import{i as ze,u as Ge,f as Oe,r as l,j as e,B as c,g as Ue,A as $,e as E,R as Je,c as I}from"./index-DbPu8K_2.js";import{A as We}from"./AdminNavBar-BdCuqM3g.js";import{X as _e,C as Xe}from"./dropdown-menu-ndXhbIqo.js";import{B as ee}from"./badge-BJnljuJY.js";import{f as g,C as Ke,a as Qe}from"./calendar-CtL8W_QE.js";import{C as se,c as te,a as Ve,b as Ye}from"./card-BaY4vyi0.js";import{C as B}from"./checkbox-Dk4ekfhY.js";import{D as Ze,a as es,b as ss,c as ts,d as as}from"./dialog-CLav4IZ4.js";import{I as ae}from"./input-uIhbwgE_.js";import{L as r}from"./label-Dx_XjS3E.js";import{P as H,a as L,b as q}from"./popover-Cyc9eECO.js";import{S as ge}from"./switch-UufABLlO.js";import{T as ls}from"./textarea-BoYb-92F.js";import{P as ve}from"./PhotoGallaryModal-B6q__LCK.js";import{T as rs,a as is,b as le,c as x,d as ns,e as h}from"./table-BtW2LytS.js";import{P as os}from"./plus-CAVwJglQ.js";import{F as cs}from"./funnel-CYFOiLLx.js";import{U as ds}from"./upload-6cL1VcWr.js";import{S as ms}from"./square-pen-BU1ldGM8.js";import{T as hs}from"./trash-BdGa3PjJ.js";import{S as z,a as Ne}from"./star-2T_lnI9d.js";import"./TopBar-BblwwY8A.js";import"./chevron-left-BlR7maOI.js";import"./chevron-down-mIi7_xTw.js";import"./index-DsFJuTvR.js";const xs=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],us=ze("search",xs),Gs=()=>{const{effectiveTheme:ps}=Ge(),{user:re}=Oe(),[ye,ie]=l.useState([]),[be,G]=l.useState(!1),[we,S]=l.useState(!1),[v,ne]=l.useState(!1),[oe,ce]=l.useState(null),[Ce,N]=l.useState(!1),[O,R]=l.useState(null),[de,Se]=l.useState(!1),[P,Re]=l.useState(""),[u,me]=l.useState("All"),[k,Pe]=l.useState(!0),[i,ke]=l.useState({}),[n,F]=l.useState([]),[U,J]=l.useState(""),[D,W]=l.useState(""),[p,T]=l.useState(0),[_,X]=l.useState(!1),[A,K]=l.useState(""),[he,y]=l.useState(null),[Q,f]=l.useState(null),[fs,Fe]=l.useState([]),[d,j]=l.useState([]),[b,xe]=l.useState([]),[ue,V]=l.useState(!1),[m,w]=l.useState({}),M=l.useRef(null),Y=()=>{G(!0);const s=localStorage.getItem("token");if(!s)return;const t={products:n.map(a=>a.id),highlight:k};P.trim()&&(t.name=P.trim()),u!=="All"&&(t.rating=u),i.from&&(t.fromDate=g(i.from,"yyyy-MM-dd")),i.to&&(t.toDate=g(i.to,"yyyy-MM-dd")),$.postData({endpoint:"/order/get-reviews",body:{request:E(t)},Authorization:`Bearer ${s}`,successCallback:a=>{ie(a.reviews||[]),G(!1)},errorCallback:a=>{ie([]),G(!1)}})},De=()=>{b.length>0||(V(!0),$.postData({endpoint:"/inventory/get-products",body:{request:E({})},successCallback:s=>{xe(s||[]),V(!1)},errorCallback:()=>{xe([]),V(!1)}}))};l.useEffect(()=>{Y(),De()},[P,u,k,i,n]);const pe=ye,Z=()=>{J(""),W(""),T(0),X(!1),K(""),y(null),f(null),Fe([]),j([]),w({}),ne(!1),ce(null)},Te=s=>{if(s.target.files&&s.target.files.length>0){const t=s.target.files[0];if(!["image/jpeg","image/png","image/webp","image/gif"].includes(t.type)){w(C=>({...C,file:"Please upload a valid image file (JPEG, PNG, WebP, GIF)"}));return}if(t.size>5*1024*1024){w(C=>({...C,file:"File size must be less than 5MB"}));return}y(t),w(C=>({...C,file:""}));const o=new FileReader;o.onloadend=()=>{f(o.result)},o.readAsDataURL(t)}else y(null),f(null)},Ae=()=>{y(null),f(null),M.current&&(M.current.value="")},Me=s=>{T(p===s?s-.5:s)},fe=(s,t)=>{j(t?[...d,s]:d.filter(a=>a.id!==s.id))},$e=()=>{j([])},Ee=()=>{const s={};return U.trim()||(s.name="Name is required."),D.trim()?/^[0-9+\-\s]{7,15}$/.test(D.trim())||(s.phone="Please enter a valid phone number"):s.phone="Phone number is required.",p===0&&(s.rating="Please select a rating."),A.trim()?A.trim().length<10&&(s.review="Review must be at least 10 characters long."):s.review="Review is required.",w(s),Object.keys(s).length===0},Ie=()=>{if(!Ee())return;const s=localStorage.getItem("token");if(!s)return;const t={id:v?oe?.id:void 0,name:U.trim(),phone:D.trim(),review:A.trim(),rating:p,highlight:_,userId:v?oe?.userId??re?.id:re?.id,products:d.map(o=>o.id)},a=new FormData;a.append("request",E(t)),he&&a.append("photo",he),$.postFormData({endpoint:"/order/save-review",body:a,Authorization:`Bearer ${s}`,successCallback:o=>{I.success(v?"Review updated successfully":"Review saved successfully"),Y(),Z(),S(!1)},errorCallback:o=>{I.error(o?.error||o?.message||"Failed to save review")}})},Be=s=>{J(s.name),W(s.phone),T(s.rating),X(s.highlight||!1),K(s.review),y(null),s.photo?f(`/static${s.photo}`):f(null),s.products&&s.products.length>0?j(s.products.map(t=>({id:t.id,name:t.name}))):j([]),ne(!0),ce(s),S(!0)},He=()=>{if(!O)return;const s=localStorage.getItem("token");if(!s)return;const t={id:O.id};$.postData({endpoint:"/order/delete-review",body:{request:E(t)},Authorization:`Bearer ${s}`,successCallback:()=>{I.success("Review deleted successfully"),Y(),N(!1),R(null)},errorCallback:a=>{I.error(a?.error||a?.message||"Failed to delete review"),N(!1),R(null)}})},Le=()=>{N(!1),R(null)},qe=s=>{try{return g(new Date(s),"dd/MM/yyyy")}catch{return s}},je=(s,t=!1)=>e.jsx("div",{className:"flex items-center gap-0.5",children:[1,2,3,4,5].map(a=>t?e.jsx("button",{type:"button",onClick:()=>Me(a),className:"focus:outline-none transition-transform hover:scale-110",children:a<=Math.floor(s)?e.jsx(z,{className:"h-5 w-5 fill-yellow-400 text-yellow-400"}):s>=a-.5&&s<a?e.jsx(Ne,{className:"h-5 w-5 fill-yellow-400 text-yellow-400"}):e.jsx(z,{className:"h-5 w-5 fill-muted text-muted"})},a):e.jsx(Je.Fragment,{children:a<=Math.floor(s)?e.jsx(z,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}):s>=a-.5&&s<a?e.jsx(Ne,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}):e.jsx(z,{className:"h-4 w-4 fill-muted text-muted"})},a))});return e.jsxs("div",{children:[e.jsx(We,{}),e.jsxs("div",{className:"container mx-auto mt-6 p-6 min-h-screen",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Reviews"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",onClick:()=>{Z(),S(!0)},className:"border-green-600 text-green-600 hover:text-primary",children:[e.jsx(os,{className:"w-4 h-4 mr-2"}),"Add"]}),e.jsxs(c,{variant:"outline",onClick:()=>Se(!de),className:"border-green-600 text-green-600 hover:text-primary",children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Filters"]})]})]}),de&&e.jsx(se,{className:"mb-6",children:e.jsx(te,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Name"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(us,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(ae,{value:P,onChange:s=>Re(s.target.value),placeholder:"Search by name",className:"pl-8"})]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Rating"}),e.jsxs(H,{children:[e.jsx(L,{asChild:!0,children:e.jsx(c,{variant:"outline",className:`w-full justify-start text-left font-normal mt-1 ${u==="All"&&"text-muted-foreground"}`,children:u==="All"?"All Ratings":`${u} Star`})}),e.jsx(q,{className:"w-auto p-0",align:"start",children:e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 cursor-pointer",onClick:()=>me("All"),children:[e.jsx(B,{checked:u==="All",readOnly:!0}),e.jsx(r,{className:"cursor-pointer",children:"All Ratings"})]}),[1,2,3,4,5].map(s=>e.jsxs("div",{className:"flex items-center space-x-2 cursor-pointer",onClick:()=>me(s),children:[e.jsx(B,{checked:u===s,readOnly:!0}),e.jsxs(r,{className:"cursor-pointer flex items-center gap-1",children:[s," Star",s!==1&&"s"]})]},s))]})})]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Featured"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(ge,{id:"filter-featured",checked:k,onCheckedChange:s=>Pe(s)}),e.jsx(r,{htmlFor:"filter-featured",className:"text-sm cursor-pointer",children:k?"Featured only":"Show all"})]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Date Range"}),e.jsxs(H,{children:[e.jsx(L,{asChild:!0,children:e.jsxs(c,{variant:"outline",className:`w-full justify-start text-left font-normal mt-1 ${!i.from&&!i.to&&"text-muted-foreground"}`,children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"}),i.from?i.to?e.jsxs(e.Fragment,{children:[g(i.from,"dd/MM/yyyy")," -"," ",g(i.to,"dd/MM/yyyy")]}):g(i.from,"dd/MM/yyyy"):"Select date range"]})}),e.jsx(q,{className:"w-auto p-0",align:"start",children:e.jsx(Qe,{autoFocus:!0,mode:"range",defaultMonth:i.from,selected:{from:i.from,to:i.to},onSelect:s=>ke(s||{}),numberOfMonths:2})})]})]}),e.jsxs("div",{className:"sm:col-span-2 lg:col-span-4",children:[e.jsx(r,{children:"Products"}),e.jsxs(H,{children:[e.jsx(L,{asChild:!0,children:e.jsx(c,{variant:"outline",role:"combobox","aria-expanded":!1,className:`w-full justify-start text-left font-normal mt-1 ${n.length===0&&"text-muted-foreground"}`,children:n.length>0?`${n.length} product(s) selected`:"Select products"})}),e.jsxs(q,{className:"w-full p-0",align:"start",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b",children:[e.jsx("span",{className:"text-sm font-medium",children:"Filter by Products"}),n.length>0&&e.jsx("button",{type:"button",onClick:()=>F([]),className:"text-xs text-primary hover:underline",children:"Clear all"})]}),ue?e.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"Loading products..."}):b.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"No products available"}):e.jsx("div",{className:"max-h-[200px] overflow-y-auto p-3 space-y-2",children:b.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{id:`filter-product-${s.id}`,checked:n.some(t=>t.id===s.id),onCheckedChange:t=>{const a=n.some(o=>o.id===s.id);t&&!a?F([...n,s]):!t&&a&&F(n.filter(o=>o.id!==s.id))}}),e.jsx(r,{htmlFor:`filter-product-${s.id}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:s.name})]},s.id))})]})]}),n.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:n.map(s=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-primary/10 text-primary text-xs rounded-full",children:[s.name,e.jsx("button",{type:"button",onClick:()=>F(n.filter(t=>t.id!==s.id)),className:"hover:text-primary/70",children:"×"})]},s.id))})]})]})})}),we&&e.jsxs(se,{className:"mb-6",children:[e.jsx(Ve,{children:e.jsx(Ye,{children:v?"Edit Review":"Create Review"})}),e.jsxs(te,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs(r,{children:["Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(ae,{value:U,onChange:s=>J(s.target.value),placeholder:"Enter name"}),m.name&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:m.name})]}),e.jsxs("div",{children:[e.jsxs(r,{children:["Phone ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(ae,{value:D,onChange:s=>W(s.target.value),placeholder:"Enter phone number"}),m.phone&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:m.phone})]}),e.jsxs("div",{className:"flex",children:[e.jsxs("div",{children:[e.jsxs(r,{children:["Rating ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"py-2 pr-2",children:je(p,!0)}),p>0&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:[p," star",p!==1?"s":""]}),m.rating&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:m.rating})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Highlight Review"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(ge,{id:"highlight-review",checked:_,onCheckedChange:s=>X(s)}),e.jsx(r,{htmlFor:"highlight-review",className:"text-sm cursor-pointer",children:_?"Highlighted":"Not highlighted"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Highlighted reviews will be featured prominently"})]})]}),e.jsxs("div",{children:[e.jsxs(r,{children:["Photo ",e.jsx("span",{className:"text-muted-foreground",children:"(Optional)"})]}),Q?e.jsxs("div",{className:"relative",children:[e.jsx(ve,{title:"Review Photo",imageSrcs:[Q],children:e.jsx("img",{src:Q,alt:"Preview",className:"w-full h-32 object-cover rounded-lg"})}),e.jsx("button",{type:"button",onClick:Ae,className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",children:e.jsx(_e,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/30 rounded-lg p-4 text-center cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>M.current?.click(),children:[e.jsx(ds,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Click to upload a photo"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"JPEG, PNG, WebP, GIF (max 5MB)"}),e.jsx("input",{ref:M,type:"file",accept:"image/jpeg,image/png,image/webp,image/gif",onChange:Te,className:"hidden"})]}),m.file&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:m.file})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs(r,{children:["Products ",e.jsx("span",{className:"text-muted-foreground",children:"(Optional)"})]}),e.jsxs(H,{children:[e.jsx(L,{asChild:!0,children:e.jsx(c,{type:"button",variant:"outline",className:Ue("w-full justify-between text-left font-normal",d.length===0&&"text-muted-foreground"),children:d.length>0?`${d.length} product(s) selected`:"Select products"})}),e.jsxs(q,{className:"w-full p-0",align:"start",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b",children:[e.jsx("span",{className:"text-sm font-medium",children:"Select Products"}),d.length>0&&e.jsx("button",{type:"button",onClick:$e,className:"text-xs text-primary hover:underline",children:"Clear all"})]}),ue?e.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"Loading products..."}):b.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"No products available"}):e.jsx("div",{className:"max-h-[200px] overflow-y-auto p-3 space-y-2",children:b.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{id:`product-${s.id}`,checked:d.some(t=>t.id===s.id),onCheckedChange:t=>{fe(s,t)}}),e.jsx(r,{htmlFor:`product-${s.id}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:s.name})]},s.id))})]})]}),d.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:d.map(s=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-primary/10 text-primary text-xs rounded-full",children:[s.name,e.jsx("button",{type:"button",onClick:()=>fe(s,!1),className:"hover:text-primary/70",children:"×"})]},s.id))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs(r,{children:["Review ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(ls,{rows:4,value:A,onChange:s=>K(s.target.value),placeholder:"Share your experience..."}),m.review&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:m.review})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(c,{variant:"outline",onClick:()=>{Z(),S(!1)},children:"Cancel"}),e.jsx(c,{onClick:Ie,children:v?"Update Review":"Save Review"})]})]})]}),e.jsx(se,{children:e.jsx(te,{className:"p-0",children:be?e.jsx("div",{className:"p-6 text-center",children:"Loading..."}):e.jsxs(rs,{children:[e.jsx(is,{children:e.jsxs(le,{children:[e.jsx(x,{children:"Name"}),e.jsx(x,{children:"Phone"}),e.jsx(x,{children:"Rating"}),e.jsx(x,{children:"Highlight"}),e.jsx(x,{className:"w-[300px]",children:"Review"}),e.jsx(x,{children:"Photo"}),e.jsx(x,{children:"Products"}),e.jsx(x,{children:"Date"}),e.jsx(x,{className:"sticky right-0 bg-background",children:"Actions"})]})}),e.jsxs(ns,{children:[pe.map((s,t)=>e.jsxs(le,{className:t%2===0?"bg-muted/20":"",children:[e.jsx(h,{className:"font-medium",children:s.name}),e.jsx(h,{children:s.phone}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[je(s.rating),e.jsxs("span",{className:"ml-1 text-sm text-muted-foreground",children:["(",s.rating,")"]})]})}),e.jsx(h,{className:"min-w-[130px]",children:s.highlight?e.jsx(ee,{variant:"default",className:"bg-yellow-500 hover:bg-yellow-600",children:"★ Featured"}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})}),e.jsx(h,{className:"min-w-[280px] sm:w-[300px]",children:s.review.length>80?s.review.substring(0,80)+"...":s.review}),e.jsx(h,{children:s.photo?e.jsx(ve,{title:"Review Photo",imageSrcs:[`/static${s.photo}`],children:e.jsx("img",{src:`/static${s.photo}`,alt:"Review",className:"w-16 h-12 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity"})}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"No photo"})}),e.jsx(h,{className:"min-w-[160px]",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.products?.slice(0,2).map(a=>e.jsx(ee,{variant:"secondary",className:"text-xs",children:a.name},a.id)),s.products?.length>2&&e.jsxs(ee,{variant:"outline",className:"text-xs",children:["+",s.products.length-2]}),(!s.products||s.products.length===0)&&e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})]})}),e.jsx(h,{children:qe(s.updatedAt)}),e.jsx(h,{className:"sticky right-0 bg-background",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(c,{size:"sm",variant:"outline",title:"Edit Review",onClick:()=>Be(s),children:e.jsx(ms,{className:"w-4 h-4"})}),e.jsx(c,{size:"sm",variant:"outline",title:"Delete Review",onClick:()=>{R(s),N(!0)},children:e.jsx(hs,{className:"w-4 h-4"})})]})})]},s.id)),pe.length===0&&e.jsx(le,{children:e.jsx(h,{colSpan:9,className:"text-center",children:"No Reviews found."})})]})]})})})]}),e.jsx(Ze,{open:Ce,onOpenChange:N,children:e.jsxs(es,{children:[e.jsx(ss,{children:e.jsx(ts,{children:"Delete Review"})}),e.jsx("div",{className:"py-4",children:e.jsxs("p",{children:['Are you sure you want to delete this review by "',O?.name,'"? This action cannot be undone.']})}),e.jsxs(as,{children:[e.jsx(c,{variant:"outline",onClick:Le,children:"Cancel"}),e.jsx(c,{variant:"destructive",onClick:He,children:"Confirm Delete"})]})]})}),e.jsx(Xe,{})]})};export{Gs as default};

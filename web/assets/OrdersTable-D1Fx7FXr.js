import{j as e,c as s,a0 as r,a1 as t,I as d,L as n,a2 as l,r as a}from"./vendor-react-Tc4xLtOv.js";import{B as o,c as i,A as c,e as x}from"./index-CCl3TzR2.js";import{B as m}from"./badge-BZaNuTv-.js";import{T as h,a as j,b as p,c as u,d as f,e as w}from"./table-DDweQ1vw.js";const N=({orders:a,expandedOrderId:i,setExpandedOrderId:c,viewType:x="ViewOnly",onEditOrder:N,onDownloadInvoice:v,isDownloadingInvoiceMap:g})=>{const b=e=>{switch(e.toLowerCase()){case"ordered":case"shipped":case"delivered":return"default";case"payment processed":return"secondary";case"processing":case"packed":default:return"outline";case"cancelled":return"destructive"}},y=e=>{const s=e.orderTotal-e.productDiscount;return s+(s<999&&"Home Delivery"===e.shippingMethod?99-e.shippingDiscount:0)};return e.jsxs("div",{className:"w-full",children:[e.jsxs(h,{children:[e.jsx(j,{children:e.jsxs(p,{className:"bg-muted/50",children:[e.jsx(u,{className:"w-[50px] text-left font-bold"}),e.jsx(u,{className:"min-w-[100px] text-left font-bold",children:"Order ID"}),e.jsx(u,{className:"min-w-[100px] text-left font-bold",children:"User ID"}),e.jsx(u,{className:"min-w-[150px] text-left font-bold",children:"Customer Name"}),e.jsx(u,{className:"min-w-[180px] text-left font-bold",children:"Customer Phone"}),e.jsx(u,{className:"min-w-[180px] text-left font-bold",children:"Customer Email"}),e.jsx(u,{className:"min-w-[120px] text-left font-bold",children:"Order Date"}),e.jsx(u,{className:"min-w-[175px] text-left font-bold",children:"Order Status"}),e.jsx(u,{className:"min-w-[120px] text-left font-bold",children:"Order Total"}),e.jsx(u,{className:"min-w-[175px] text-left font-bold",children:"Shipping Method"}),e.jsx(u,{className:"min-w-[180px] text-left font-bold",children:"Est. Delivery Date"}),e.jsx(u,{className:"min-w-[150px] text-left font-bold",children:"Delivery Name"}),e.jsx(u,{className:"min-w-[300px] text-left font-bold",children:"Address"}),e.jsx(u,{className:"min-w-[150px] text-left font-bold",children:"City"}),e.jsx(u,{className:"min-w-[120px] text-left font-bold",children:"State"}),e.jsx(u,{className:"min-w-[150px] text-left font-bold",children:"Country"}),e.jsx(u,{className:"min-w-[100px] text-left font-bold",children:"Pincode"}),e.jsx(u,{className:"min-w-[180px] text-left font-bold",children:"Delivery Phone"})]})}),e.jsx(f,{children:a.map(a=>e.jsxs(s.Fragment,{children:[e.jsxs(p,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>c(i===a.orderId?null:a.orderId),className:"hover:text-primary",children:i===a.orderId?e.jsx(r,{className:"h-4 w-4"}):e.jsx(t,{className:"h-4 w-4"})}),"ManageOrders"===x&&e.jsxs(e.Fragment,{children:[N&&e.jsx(o,{variant:"outline",size:"sm",onClick:()=>N(a),className:"hover:text-primary",children:e.jsx(d,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>v(a.orderId),disabled:!0===g[a.orderId],className:"hover:text-primary",children:!0===g[a.orderId]?e.jsx(n,{className:"h-4 w-4 animate-spin"}):e.jsx(l,{className:"h-4 w-4"})})]})]})}),e.jsx(w,{className:"font-medium",children:a.orderId}),e.jsx(w,{children:a.userId}),e.jsx(w,{children:a.customerName}),e.jsx(w,{children:a.customerPhone}),e.jsx(w,{children:a.customerEmail}),e.jsx(w,{children:new Date(a.orderDate).toLocaleDateString()}),e.jsx(w,{children:e.jsx(m,{variant:b(a.orderStatus),children:a.orderStatus})}),e.jsxs(w,{className:"font-medium",children:["₹",y(a).toFixed(2)]}),e.jsx(w,{children:a.shippingMethod}),e.jsx(w,{children:new Date(a.expectedDeliveryDate).toLocaleDateString()}),e.jsx(w,{children:a.deliveryName}),e.jsx(w,{className:"max-w-[200px] truncate",children:a.addressLine1}),e.jsx(w,{children:a.city}),e.jsx(w,{children:a.state}),e.jsx(w,{children:a.country}),e.jsx(w,{children:a.pincode}),e.jsx(w,{children:a.deliveryPhone})]}),i===a.orderId&&e.jsx(p,{children:e.jsx(w,{colSpan:18,className:"p-0",children:e.jsxs("div",{className:"p-6 bg-muted/20",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Order Details"}),e.jsxs(h,{children:[e.jsx(j,{children:e.jsxs(p,{children:[e.jsx(u,{children:"Product Name"}),e.jsx(u,{children:"Category"}),e.jsx(u,{children:"Quantity"}),e.jsx(u,{children:"Price"}),e.jsx(u,{children:"Total"})]})}),e.jsxs(f,{children:[a.products.map((s,r)=>e.jsxs(p,{children:[e.jsx(w,{children:s.productName}),e.jsx(w,{children:s.categoryName}),e.jsx(w,{children:s.quantity}),e.jsxs(w,{children:["₹",s.price]}),e.jsxs(w,{children:["₹",s.productTotal]})]},r)),a.productDiscount>0&&e.jsxs(p,{children:[e.jsx(w,{colSpan:4,children:"Discount"}),e.jsxs(w,{className:"text-red-600",children:["-₹",a.productDiscount.toFixed(2)]})]}),(()=>{const s=a.orderTotal-a.productDiscount<999&&"Home Delivery"===a.shippingMethod,r=s?99-a.shippingDiscount:0;return s?e.jsxs(p,{children:[e.jsx(w,{colSpan:4,children:"Shipping"}),e.jsxs(w,{children:["₹",r]})]}):null})(),e.jsxs(p,{children:[e.jsx(w,{colSpan:4,children:e.jsx("strong",{children:"Order Total"})}),e.jsx(w,{children:e.jsxs("strong",{children:["₹",y(a).toFixed(2)]})})]})]})]})]}),a.notes&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Order Notes"}),e.jsx("p",{className:"text-muted-foreground",children:a.notes})]})]})})})]},a.orderId))})]}),0===a.length&&e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No orders found"})]})},v=({viewType:s="ViewOnly",orders:r,expandedOrderId:t,setExpandedOrderId:d,onEditOrder:n})=>{const[l,o]=a.useState(""),[m,h]=a.useState(""),[j,p]=a.useState(void 0),[u,f]=a.useState({}),w=r.filter(e=>{const s=""===l||e.orderId.toString().includes(l)||e.customerName.toLowerCase().includes(l.toLowerCase())||e.customerPhone.includes(l)||e.customerEmail.toLowerCase().includes(l.toLowerCase()),r=""===m||"all-statuses"===m||e.orderStatus===m,t=!j||new Date(e.orderDate).toDateString()===j.toDateString();return s&&r&&t});return e.jsxs("div",{className:"space-y-6",children:["ViewOnly"===s&&e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Orders"}),e.jsxs("p",{className:"text-muted-foreground",children:[w.length," of ",r.length," orders"]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-2 w-full lg:w-auto",children:e.jsx("input",{type:"text",placeholder:"Search orders...",value:l,onChange:e=>o(e.target.value),className:"px-3 py-2 border rounded-md text-sm w-full sm:w-64"})})]}),e.jsx(N,{orders:w,expandedOrderId:t,setExpandedOrderId:d,viewType:s,onEditOrder:n,onDownloadInvoice:async e=>{f(s=>({...s,[e]:!0}));try{const s=localStorage.getItem("token");if(!s)return void i.error("Authentication required to download invoice");await c.postData({endpoint:"/order/download-invoice",body:{request:x({orderId:e,token:s})},responseType:"blob",successCallback:s=>{const r=window.URL.createObjectURL(s),t=document.createElement("a");t.href=r,t.download=`Renus Home Foods - Order Invoice - ${e}.pdf`,document.body.appendChild(t),t.click(),window.URL.revokeObjectURL(r),document.body.removeChild(t),i.success("Invoice downloaded successfully!")},errorCallback:e=>{i.error("Failed to download invoice")}})}catch(s){i.error("Failed to download invoice")}finally{f(s=>({...s,[e]:!1}))}},isDownloadingInvoiceMap:u})]})};export{v as O};

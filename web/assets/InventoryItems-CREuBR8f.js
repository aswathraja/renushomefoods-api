import{r as c,j as e,q as De}from"./vendor-react-Bk0qDDMD.js";import{C as Oe}from"./dropdown-menu-Dae-Y6FG.js";import{I as Fe}from"./InventoryNavBar-oXsC6gjC.js";import{u as qe,A as f,e as C,B as m,c as y}from"./index-Bzbs1pXN.js";import{C as Le}from"./calendar-BHXoJ3A4.js";import{C as X,c as Y,a as Ae,b as $e}from"./card-CEH0XzyS.js";import{D as Te,a as Ee,b as ze,c as Be,e as Me,d as Ue}from"./dialog-CLX5gY7u.js";import{I as h}from"./input-Cpcu6Bjn.js";import{L as d}from"./label-COuHthBN.js";import{P as Ve,a as _e,b as He}from"./popover-BbjHyeoe.js";import{S as A,a as $,b as T,c as E,d as b}from"./select-D6maGY_v.js";import{T as Re,a as Ge,b as Z,c as g,d as Qe,e as p}from"./table-D3hkCJyW.js";import{T as de}from"./textarea-Ds-7KeaI.js";import{P as me}from"./PhotoGallaryModal-DPLTyZGG.js";import{F as We,P as j,T as P,X as ue,U as Je,C as Ke,d as Xe}from"./vendor-icons-FTV6Dp_q.js";import{A as Ye,m as ee}from"./vendor-motion-DKNEqpS6.js";import"./vendor-base-ui-BXIcfa4M.js";import"./vendor-radix-B6Rg7jVq.js";import"./TopBar-CaoAhFRU.js";import"./vendor-pdf-CtkwMsdI.js";import"./vendor-charts-DTq7uDuz.js";const pe=[.42,0,.58,1],Ze={initial:{opacity:0,y:-25},animate:{opacity:1,y:0,transition:{duration:.2,staggerChildren:.02,delayChildren:.02}},exit:{opacity:0,y:0,transition:{when:"afterChildren",staggerChildren:.02,staggerDirection:-1}}},he={initial:{x:50},animate:{x:0,transition:{duration:.02,ease:pe}},exit:{x:0,transition:{duration:.02,ease:pe}}},ks=()=>{const{effectiveTheme:x}=qe(),[se,ae]=c.useState([]),[te,z]=c.useState([]),[ie,B]=c.useState([]),[ge,v]=c.useState(!1),[u,w]=c.useState(null),[t,n]=c.useState({name:"",description:"",displayOrder:"",category:"",type:"",locations:[],images:[],invoices:[]}),[es,M]=c.useState(""),[S,N]=c.useState(null),[xe,I]=c.useState(!1),[U,V]=c.useState(null),[re,k]=c.useState(!1),[le,_]=c.useState({}),[H,R]=c.useState(!1),D=c.useRef([]),[ss,as]=c.useState(!1),[ts,is]=c.useState([]),[rs,ls]=c.useState(0),[ne,ye]=c.useState(!1),[G,je]=c.useState(""),[Q,ve]=c.useState(""),[W,fe]=c.useState({value:null,label:"All"}),[O,J]=c.useState(null),oe=[{value:null,label:"All"},...te.map(s=>({value:s.category,label:s.category}))],F=te.map(s=>({value:s.id,label:s.category}));c.useEffect(()=>{f.postData({endpoint:"/inventory/get-categories",body:{type:null},successCallback:s=>{Array.isArray(s)?z(s):z([])},errorCallback:()=>{z([])}})},[]),c.useEffect(()=>{f.postData({endpoint:"/inventory/locations",body:{request:C({})},successCallback:s=>{Array.isArray(s)?B(s):B([])},errorCallback:()=>{B([])}})},[]);const q=()=>{const s={name:G||null,description:Q||null,category:W?.value,image:O?.value,isAdmin:!0},a=new Promise((l,o)=>{f.postData({endpoint:"/inventory/get-products",body:{request:C(s)},successCallback:r=>{Array.isArray(r)?l(r.map(K=>({...K,type:"Product"}))):l([])},errorCallback:r=>{console.error("Failed to fetch products:",r),l([])}})}),i=new Promise((l,o)=>{f.postData({endpoint:"/inventory/get-items",body:{request:C(s)},successCallback:r=>{Array.isArray(r)?l(r.map(K=>({...K,type:"Item"}))):l([])},errorCallback:r=>{console.error("Failed to fetch items:",r),l([])}})});Promise.all([a,i]).then(([l,o])=>{const r=[...l,...o];ae(r)}).catch(l=>{console.error("Error fetching data:",l),ae([]),y.error("Failed to fetch items")})};c.useEffect(()=>{q()},[]),c.useEffect(()=>{q()},[G,Q,W,O]);const be=s=>{if(s.preventDefault(),!t.name.trim()){y.error("Item name is required");return}if(!S){y.error("Category is required");return}const a=localStorage.getItem("token");if(!a){y.error("No token found");return}R(!0);let i="/inventory/save-item",l={...t,name:t.name,description:t.description,displayOrder:t.displayOrder?parseInt(t.displayOrder):null,category:S.value,image:u?.image||"",locations:t.locations.filter(r=>r.location).map(r=>({locationId:r.location.value,quantity:parseInt(r.quantity),id:r.id})),images:t.images.map(r=>({file:r.file,description:r.description,displayOrder:parseInt(r.order)||null,existing:r.existing})),invoices:t.invoices?.map(r=>({date:r.date?r.date?.toISOString()?.split("T")[0]:null,quantity:parseInt(r.quantity),unitPrice:parseFloat(r.unitPrice),basePrice:parseFloat(r.basePrice),weight:r.weight})),token:a,type:"item"};/^(Product)$/gim.test(t.type)?(i="/inventory/save-product",l={id:u?.id,name:t.name,categoryid:S.value,pricelists:t.invoices.map(r=>({weight:r.weight,unitprice:parseFloat(r.unitPrice),basePrice:parseFloat(r.basePrice),bomCost:parseFloat(r.bomCost),quantity:parseInt(r.quantity),id:r.id})),productimages:t.images.map(r=>({id:r?.existing?.id,fileName:r.existing?.fileName||"",productId:u?.id,displayOrder:parseInt(r.displayOrder),description:r.description})),tagline:t.description,displayOrder:t.displayOrder?parseInt(t.displayOrder):u?.displayOrder,type:"product",locations:t.locations.filter(r=>r.location).map(r=>({locationId:r.location.value,quantity:r.quantity})),token:a}):u&&(l.id=u?.id);const o=new FormData;o.append("request",C(l)),t.images.forEach(r=>{r.file&&o.append("files",r.file)}),f.postFormData({endpoint:i,body:o,Authorization:`Bearer ${a}`,successCallback:r=>{R(!1),y.success(u?"Item updated successfully":"Item added successfully"),v(!1),w(null),n({name:"",description:"",displayOrder:"",category:"",locations:[],images:[],invoices:[],type:""}),M(""),q()},errorCallback:r=>{R(!1),y.error("Failed to save item"),console.error("Error saving item:",r)}})},we=s=>{w(s),n({name:s.name,description:s.description||"",displayOrder:s.displayOrder?.toString()||"",category:"",locations:s.ItemLocations?.map(a=>({location:{value:a.Location.id,label:a.Location.name},quantity:a.quantity.toString(),id:a.id}))||[],images:s.ItemImages?.map(a=>({file:null,description:a.description||"",displayOrder:a.displayOrder?.toString()||"",existing:{id:a.id,fileName:a.image,description:a.description,displayOrder:a.displayOrder}}))||[],invoices:s.ItemInvoices?.map(a=>({date:a.date?new Date(a.date):null,quantity:a.quantity.toString(),unitPrice:a.unitprice,basePrice:a.basePrice,weight:a.weight,bomCost:""}))||[],type:s.type}),N(F.find(a=>a.value===s.categoryId)||null),M(""),v(!0)},Ne=s=>{w(s),n({name:s.name,description:s.tagline||"",displayOrder:s.displayOrder?.toString()||"",category:s.categoryid,locations:s.locations?.map(a=>({location:{value:a.id,label:a.name},quantity:a.ProductLocation?.quantity||a.quantity}))||[],images:s.ProductImages?.map(a=>({file:null,description:a.description||"",displayOrder:a.displayOrder?.toString()||"",existing:{id:a.id,fileName:a.fileName,description:a.description,displayOrder:a.displayOrder}}))||[],invoices:s.PriceLists?.map(a=>({date:new Date(a.updatedAt),quantity:a.quantity||"",unitPrice:a.unitprice.toString(),basePrice:a.basePrice.toString(),weight:a.weight||"",bomCost:a.bomCost?.toString()||""}))||[],type:s.type}),N(F.find(a=>a.value===s.categoryid)||null),M(""),v(!0)},Ie=s=>{s.type==="Item"?we(s):s.type==="Product"&&Ne(s)},Ce=s=>{V(s),I(!0)};c.useEffect(()=>{const s=a=>{a.target.closest(".dropdown")||k(!1)};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[]);const Pe=()=>{if(!U)return;const s=localStorage.getItem("token");if(!s){y.error("No token found");return}f.postData({endpoint:"/inventory/delete-item",body:{request:C({id:U.id,token:s})},successCallback:a=>{y.success("Item deleted successfully"),q(),I(!1),V(null)},errorCallback:a=>{y.error(a.error||"Failed to delete item"),I(!1),V(null)}})},Se=s=>["image/jpeg","image/png","image/webp","image/gif"].includes(s.type)?s.size>5*1024*1024?"File size must be less than 5MB":null:"Please upload a valid image file (JPEG, PNG, WebP, GIF)",ke=(s,a)=>{const i=a.target.files?.[0];if(i){const l=Se(i);if(l){_(r=>({...r,[`image_${s}`]:l}));return}const o=[...t.images];o[s].file=i,n({...t,images:o}),_(r=>({...r,[`image_${s}`]:""}))}},ce=s=>{const a=[...t.images];a[s].file=null,a[s].existing=void 0,n({...t,images:a}),D.current[s]&&(D.current[s].value=""),_(i=>({...i,[`image_${s}`]:""}))},L=s=>`/static/inventory/${s}`;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"min-h-screen",children:[e.jsx(Fe,{}),e.jsxs("div",{className:"container mx-auto mt-6 px-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[e.jsx("h1",{className:"text-primary text-2xl font-bold",children:"Items"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",onClick:()=>ye(!ne),className:"border-green-600 text-green-600 hover:text-primary",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Filters"]}),e.jsxs("div",{className:"relative",children:[e.jsxs(m,{variant:"outline",onClick:()=>k(!re),className:"border-green-600 text-green-600 hover:text-primary",children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Add"]}),e.jsx(Ye,{children:re&&e.jsxs(ee.ul,{className:"absolute right-0 top-full mt-2 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg z-10",variants:Ze,initial:"initial",animate:"animate",exit:"exit",children:[e.jsx(ee.li,{variants:he,children:e.jsx("button",{className:"block w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>{w(null),n({name:"",description:"",displayOrder:"",category:"",locations:[],images:[],invoices:[],type:"Item"}),N(null),v(!0),k(!1)},children:"Item"})}),e.jsx(ee.li,{variants:he,children:e.jsx("button",{className:"block w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>{w(null),n({name:"",description:"",displayOrder:"",category:"",locations:[],images:[],invoices:[],type:"Product"}),N(null),v(!0),k(!1)},children:"Product"})})]})})]})]})]}),ne&&e.jsx(X,{className:"mb-6",children:e.jsx(Y,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Name"}),e.jsx(h,{value:G,onChange:s=>je(s.target.value),placeholder:"Enter item name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Description"}),e.jsx(h,{value:Q,onChange:s=>ve(s.target.value),placeholder:"Enter description"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Category"}),e.jsxs(A,{value:W?.value||void 0,onValueChange:s=>{const a=oe.find(i=>i.value===(s==="all"?null:s));fe(a||{value:null,label:"All"})},children:[e.jsx($,{className:x==="dark"?"bg-gray-800 text-white border-gray-600":"",children:e.jsx(T,{placeholder:"Select Category"})}),e.jsx(E,{children:oe.map(s=>e.jsx(b,{value:s.value||"all",children:s.label},s.value||"all"))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Image"}),e.jsxs(A,{value:O?.value===null?"all":O?.value?"has":"no",onValueChange:s=>{J(s==="all"?{value:null,label:"All"}:s==="has"?{value:!0,label:"Has Image"}:{value:!1,label:"No Image"})},children:[e.jsx($,{children:e.jsx(T,{placeholder:"Filter by image"})}),e.jsxs(E,{children:[e.jsx(b,{value:"all",children:"All"}),e.jsx(b,{value:"has",children:"Has Image"}),e.jsx(b,{value:"no",children:"No Image"})]})]})]})]})})}),ge&&e.jsxs(X,{className:"mb-6",children:[e.jsx(Ae,{children:e.jsx($e,{children:u?`Edit ${u.type}`:`Add ${t.type}`})}),e.jsx("form",{onSubmit:be,children:e.jsxs(Y,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"item-name",children:[t.type," Name"]}),e.jsx(h,{id:"item-name",value:t.name,onChange:s=>n({...t,name:s.target.value}),placeholder:`Enter ${t.type} Name`,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"category",children:"Category"}),e.jsxs(A,{value:S?.value?.toString()||void 0,onValueChange:s=>{const a=F.find(i=>i.value===parseInt(s));N(a||null)},children:[e.jsx($,{id:"category",className:x==="dark"?"bg-gray-800 text-white border-gray-600":"",children:e.jsx(T,{placeholder:"Select Category"})}),e.jsx(E,{children:F.map(s=>e.jsx(b,{value:s.value.toString(),children:s.label},s.value))})]})]}),t.type==="Product"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"displayOrder",children:"Display Order"}),e.jsx(h,{id:"displayOrder",type:"number",value:t.displayOrder,onChange:s=>n({...t,displayOrder:s.target.value}),placeholder:"Display Order",className:x==="dark"?"bg-gray-800 text-white border-gray-600":""})]}),t.type==="Item"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"description",children:"Description"}),e.jsx(de,{id:"description",value:t.description,onChange:s=>n({...t,description:s.target.value}),placeholder:"Enter Description",rows:3,className:x==="dark"?"bg-gray-800 text-white border-gray-600":""})]})]}),t.type==="Product"&&e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"description",children:"Description"}),e.jsx(de,{id:"description",value:t.description,onChange:s=>n({...t,description:s.target.value}),placeholder:"Enter Description",rows:3,className:x==="dark"?"bg-gray-800 text-white border-gray-600":""})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Locations"}),e.jsxs("div",{className:"space-y-3",children:[t.locations.map((s,a)=>e.jsxs("div",{className:"flex flex-wrap gap-2 p-4 border rounded-md items-end",children:[e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Location"}),e.jsxs(A,{value:s.location?.value?.toString()||void 0,onValueChange:i=>{const l=[...t.locations],o=ie.find(r=>r.id===parseInt(i));l[a].location=o?{value:o.id,label:o.name}:null,n({...t,locations:l})},children:[e.jsx($,{children:e.jsx(T,{placeholder:"Select Location"})}),e.jsx(E,{children:ie.filter(i=>!t.locations.some(l=>l.location?.value===i.id&&l!==s)).map(i=>e.jsx(b,{value:i.id.toString(),children:i.name},i.id))})]})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px] mb-2",children:[e.jsx(d,{children:"Quantity"}),e.jsx(h,{type:"text",value:s.quantity,onChange:i=>{const l=[...t.locations];l[a].quantity=i.target.value.replace(/[^0-9]/g,""),n({...t,locations:l})},placeholder:"Quantity",className:x==="dark"?"bg-gray-800 text-white border-gray-600":""})]}),e.jsxs("div",{className:"flex items-end gap-2 mb-2",children:[e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>n({...t,locations:[...t.locations,{location:null,quantity:""}]}),children:e.jsx(j,{className:"h-4 w-4"})}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>{const i=t.locations.filter((l,o)=>o!==a);n({...t,locations:i})},children:e.jsx(P,{className:"h-4 w-4"})})]})]},a)),t.locations?.length===0&&e.jsxs(m,{type:"button",variant:"outline",onClick:()=>n({...t,locations:[...t.locations,{location:null,quantity:""}]}),className:"w-full border-green-600 text-green-600 hover:text-primary",children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Add Location"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Images"}),e.jsxs("div",{className:"space-y-3",children:[t.images.map((s,a)=>e.jsxs("div",{className:"flex flex-wrap gap-2 p-4 border rounded-md items-end",children:[e.jsxs("div",{className:"space-y-2 flex-1 min-w-[150px]",children:[e.jsx(d,{children:"Image"}),s.existing?e.jsxs("div",{className:"relative group",children:[e.jsx(me,{title:"Item Images",imageSrcs:t.images.filter(i=>i.existing).map(i=>L(i.existing.fileName)),children:e.jsx("img",{src:L(s.existing.fileName),alt:"Existing",className:"w-20 h-20 object-cover rounded-md border cursor-pointer hover:opacity-80 transition-opacity"})}),e.jsx("button",{type:"button",onClick:()=>ce(a),className:"absolute -top-2 left-17 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(ue,{className:"h-3 w-3"})})]}):s.file?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:URL.createObjectURL(s.file),alt:"New",className:"w-20 h-20 object-cover rounded-md border"}),e.jsx("button",{type:"button",onClick:()=>ce(a),className:"absolute -top-2 left-17 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",children:e.jsx(ue,{className:"h-3 w-3"})})]}):e.jsx("div",{className:"w-20 h-20 border-2 border-dashed border-muted-foreground/30 rounded-md flex items-center justify-center cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>D.current[a]?.click(),children:e.jsx(Je,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx("input",{ref:i=>{D.current[a]=i},type:"file",accept:"image/jpeg,image/png,image/webp,image/gif",onChange:i=>ke(a,i),className:"hidden"}),le[`image_${a}`]&&e.jsx("p",{className:"text-sm text-red-500",children:le[`image_${a}`]})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Description"}),e.jsx(h,{value:s.description,onChange:i=>{const l=[...t.images];l[a].description=i.target.value,n({...t,images:l})},placeholder:"Description"})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Display Order"}),e.jsx(h,{type:"text",value:s.displayOrder,onChange:i=>{const l=[...t.images];l[a].displayOrder=i.target.value.replace(/[^0-9]/g,""),n({...t,images:l})},placeholder:"Display Order",className:x==="dark"?"bg-gray-800 text-white border-gray-600":""})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>n({...t,images:[...t.images,{file:null,description:"",order:"",existing:void 0}]}),children:e.jsx(j,{className:"h-4 w-4"})}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>{const i=t.images.filter((l,o)=>o!==a);n({...t,images:i})},children:e.jsx(P,{className:"h-4 w-4"})})]})]},a)),t.images?.length===0&&e.jsxs(m,{type:"button",variant:"outline",onClick:()=>n({...t,images:[...t.images,{file:null,description:"",order:"",existing:void 0}]}),className:"w-full border-green-600 text-green-600 hover:text-primary",children:[e.jsx(j,{className:"h-4 w-4 mr-2"})," Add Image"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:t.type==="Product"||u?.type==="Product"?"Price Lists":"Invoices"}),e.jsxs("div",{className:"space-y-3",children:[t.invoices.map((s,a)=>e.jsxs("div",{className:"flex flex-wrap gap-2 p-4 border rounded-md items-end",children:[e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Date"}),e.jsxs(Ve,{children:[e.jsx(_e,{asChild:!0,children:e.jsxs(m,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"}),s.date?De(s.date,"yyyy-MM-dd"):"Invoice/Price List Date"]})}),e.jsx(He,{className:"w-auto p-0",children:e.jsx(Le,{mode:"single",selected:s.date,onSelect:i=>{const l=[...t.invoices];l[a].date=i,n({...t,invoices:l})},autoFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Quantity"}),e.jsx(h,{type:"text",value:s.quantity,onChange:i=>{const l=[...t.invoices];l[a].quantity=i.target.value.replace(/[^0-9]/g,""),n({...t,invoices:l})},placeholder:"Quantity"})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Unit Price"}),e.jsx(h,{type:"text",value:s.unitPrice,onChange:i=>{const l=[...t.invoices];l[a].unitPrice=i.target.value.replace(/[^0-9.]/g,""),n({...t,invoices:l})},placeholder:"Unit Price",className:x==="dark"?"bg-gray-800 text-white border-gray-600":""})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Base Price"}),e.jsx(h,{type:"text",value:s.basePrice,onChange:i=>{const l=[...t.invoices];l[a].basePrice=i.target.value.replace(/[^0-9.]/g,""),n({...t,invoices:l})},placeholder:"Base Price"})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Weight"}),e.jsx(h,{type:"text",value:s.weight,onChange:i=>{const l=[...t.invoices];l[a].weight=i.target.value,n({...t,invoices:l})},placeholder:"Weight",className:x==="dark"?"bg-gray-800 text-white border-gray-600":""})]}),t.type==="Product"||u?.type==="Product"?e.jsxs("div",{className:"flex items-end gap-2 flex-1 min-w-[150px]",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(d,{children:"BOM Cost"}),e.jsx(h,{type:"text",value:s.bomCost,onChange:i=>{const l=[...t.invoices];l[a].bomCost=i.target.value.replace(/[^0-9.]/g,""),n({...t,invoices:l})},placeholder:"BOM Cost"})]}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>n({...t,invoices:[...t.invoices,{date:null,quantity:"",unitPrice:"",basePrice:"",weight:"",bomCost:""}]}),children:e.jsx(j,{className:"h-4 w-4"})}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>{const i=t.invoices.filter((l,o)=>o!==a);n({...t,invoices:i})},children:e.jsx(P,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>n({...t,invoices:[...t.invoices,{date:null,quantity:"",unitPrice:"",basePrice:"",weight:"",bomCost:""}]}),children:e.jsx(j,{className:"h-4 w-4"})}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>{const i=t.invoices.filter((l,o)=>o!==a);n({...t,invoices:i})},children:e.jsx(P,{className:"h-4 w-4"})})]})]},s.date+a)),t.invoices?.length===0&&e.jsxs(m,{type:"button",variant:"outline",onClick:()=>n({...t,invoices:[...t.invoices,{date:null,quantity:"",unitPrice:"",basePrice:"",weight:"",bomCost:""}]}),className:"w-full border-green-600 text-green-600 hover:text-primary",children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Add ",t.type==="Product"||u?.type==="Product"?"SKU":"Invoice"]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-6",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>v(!1),disabled:H,children:"Cancel"}),e.jsx(m,{type:"submit",disabled:H,children:H?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):u?`Update ${u.type}`:`Add ${t.type}`})]})]})})]}),e.jsx(X,{children:e.jsx(Y,{className:"p-0",children:e.jsxs(Re,{children:[e.jsx(Ge,{children:e.jsxs(Z,{children:[e.jsx(g,{style:{width:"100px"},children:"Actions"}),e.jsx(g,{children:"Image"}),e.jsx(g,{style:{width:"175px"},children:"Display Order"}),e.jsx(g,{style:{width:"200px"},children:"Name"}),e.jsx(g,{style:{width:"300px"},children:"Description"}),e.jsx(g,{children:"Type"}),e.jsx(g,{style:{width:"210px"},children:"Category"}),e.jsx(g,{style:{width:"150px"},children:"Base Price"}),e.jsx(g,{style:{width:"150px"},children:"Unit Price"}),e.jsx(g,{style:{width:"100px"},children:"Stock"}),e.jsx(g,{style:{width:"230px"},children:"Locations"}),e.jsx(g,{style:{width:"220px"},children:"Invoices"})]})}),e.jsxs(Qe,{children:[se.map(s=>e.jsxs(Z,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{size:"sm",variant:"outline",onClick:()=>Ie(s),children:e.jsx(Xe,{className:"h-4 w-4"})}),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>Ce(s),children:e.jsx(P,{className:"h-4 w-4"})})]})}),e.jsx(p,{children:(()=>{const a=s.ItemImages||[],i=s.ProductImages||[],l=[...a.map((o,r)=>({url:L(o.image),index:r})),...i.map((o,r)=>({url:L(o.fileName),index:a.length+r}))];return l.length>0?e.jsx(me,{title:`${s.name} Images`,imageSrcs:l.map(o=>o.url),children:e.jsxs("div",{className:"relative group cursor-pointer",children:[e.jsx("img",{src:l[0].url,alt:s.name,className:"w-12 h-12 object-cover rounded-md border cursor-pointer hover:opacity-80 transition-opacity"}),l.length>1&&e.jsx("span",{className:"absolute -bottom-1 -right-1 bg-primary text-primary-foreground text-[10px] px-1 rounded-full",children:l.length})]})}):e.jsx("span",{className:"text-muted-foreground",children:"No Image"})})()}),e.jsx(p,{children:s.displayOrder??"-"}),e.jsx(p,{className:"font-medium",children:s.name}),e.jsx(p,{children:s.description||s.tagline||"-"}),e.jsx(p,{children:s.type}),e.jsx(p,{children:s.Category?.category}),e.jsxs(p,{children:["₹",s.PriceLists?.[0]?.basePrice||s.ItemInvoices?.[s.ItemInvoices.length-1]?.basePrice||"-"]}),e.jsxs(p,{children:["₹",s.PriceLists?.[0]?.unitprice||s.ItemInvoices?.[s.ItemInvoices.length-1]?.unitprice||"-"]}),e.jsx(p,{children:s.locations?.reduce((a,i)=>a+(i.ProductLocation.quantity||0),0)||s.ItemLocations?.reduce((a,i)=>a+(i.quantity||0),0)||"-"}),e.jsx(p,{children:s.locations?.map(a=>`${a.name} (${a.room}) [${a.ProductLocation.quantity}]`).join(", ")||s.ItemLocations?.map(a=>`${a.Location.name} (${a.Location.room}) [${a.quantity}]`).join(", ")||"-"}),e.jsx(p,{children:s.PriceLists?.length>0?`${new Date(s.updatedAt).toLocaleDateString()} (${s.PriceLists?.[s.PriceLists.length-1].quantity??0})`:s.ItemInvoices?.length>0?`${new Date(s.ItemInvoices?.[s.ItemInvoices.length-1].date).toLocaleDateString()} (${s.ItemInvoices?.[s.ItemInvoices.length-1].quantity??0} x ₹${s.ItemInvoices?.[s.ItemInvoices.length-1].unitprice})`:"-"})]},s.type+s.id)),se.length===0&&e.jsx(Z,{children:e.jsx(p,{colSpan:12,className:"text-center py-8 text-muted-foreground",children:"No items found. Add some items to get started."})})]})]})})})]})]}),e.jsx(Te,{open:xe,onOpenChange:I,children:e.jsxs(Ee,{className:x==="dark"?"bg-gray-800 text-white border-gray-600":"",children:[e.jsxs(ze,{children:[e.jsx(Be,{children:"Confirm Delete"}),e.jsxs(Me,{children:['Are you sure you want to delete the item "',U?.name,'"? This action cannot be undone.']})]}),e.jsxs(Ue,{children:[e.jsx(m,{variant:"outline",onClick:()=>I(!1),className:x==="dark"?"bg-gray-800 text-white border-gray-600":"",children:"Cancel"}),e.jsx(m,{variant:"destructive",onClick:Pe,children:"Delete"})]})]})}),e.jsx(Oe,{})]})};export{ks as default};

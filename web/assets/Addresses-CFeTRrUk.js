import{a as e,j as s}from"./vendor-animation-CcgChT4Y.js";import{C as r}from"./dropdown-menu-DjLdUzkQ.js";import{T as a}from"./TopNav-BcoF5Zho.js";import{g as t,A as d,c as n,B as i,e as o}from"./index-QkJ4t2go.js";import{B as l}from"./badge-DjmmXEHi.js";import{C as c,a as m,b as u,c as x}from"./card-CZoDjOMW.js";import{D as p,a as h,b as j,c as f,d as g}from"./dialog-B1BfGlYi.js";import{I as y}from"./input-group-ByqfbmvE.js";import{S as b}from"./switch-CkWvZ_t_.js";import{T as v}from"./textarea-Dez3uDdp.js";import{y as N,P as X,g as k,h as C}from"./vendor-icons-BYe_-sqm.js";import"./vendor-radix-CgisZDtL.js";import"./vendor-charts-1c3qO8Q0.js";import"./vendor-ui-utils-B4kPJlQS.js";import"./NavBar-Zl-a5m7p.js";import"./TopBar-CO3pAy7f.js";import"./vendor-pdf-export-F3dE0gEs.js";import"./input-hHw7iIA9.js";const w=({modalMode:w=!1})=>{const D=t(),[A,S]=e.useState([]),[L,q]=e.useState(!0),[I,z]=e.useState(!1),[F,P]=e.useState(null),[B,E]=e.useState(!1),[M,O]=e.useState(null),[T,$]=e.useState({name:"",addressLine1:"",city:"",state:"",country:"",pincode:"",phone:"",isDefault:!1}),[W,G]=e.useState({});e.useEffect(()=>{localStorage.getItem("token")||w?H():D("/login")},[D,w]);const H=async()=>{const e=localStorage.getItem("token");if(e)try{const s=await d.get("/user/addresses",{Authorization:`Bearer ${e}`});s.addresses?S(s.addresses||[]):n.error("Failed to fetch addresses")}catch{n.error("Error fetching addresses")}finally{q(!1)}},K=(e,s)=>{let r="";if("pincode"===e)/^\d{6}$/.test(s)||(r="Pincode must be exactly 6 digits.");else if("phone"===e){/^(\+\d{2} \d{10}|\+\d{12}|\d{10})$/.test(s)||(r="Phone number must be in format +XX XXXXXXXXXX, +XXXXXXXXXXXX, or XXXXXXXXXX.")}G(s=>({...s,[e]:r}))};return L?w?s.jsxs("div",{className:"text-center p-8",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),s.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading..."})]}):s.jsx("div",{className:"container mx-auto max-h-screen mt-8 px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"text-center p-8",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),s.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading..."})]})}):s.jsxs(s.Fragment,{children:[!w&&s.jsx(a,{}),s.jsxs("div",{className:w?"":"container min-h-screen mx-auto mt-8 px-4 sm:px-6 lg:px-8",children:[!w&&s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center",children:s.jsx(N,{size:"50px",className:"text-primary"})}),s.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground mb-2",children:"Your Addresses"}),s.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mb-4",children:"Manage your delivery addresses for faster checkout"}),s.jsxs(i,{onClick:()=>{P(null),$({name:"",addressLine1:"",city:"",state:"",country:"",pincode:"",phone:"",isDefault:!1}),G({}),z(!0)},className:"w-full sm:w-auto",children:[s.jsx(X,{className:"h-4 w-4 mr-2"}),"Add Address"]})]}),0===A.length?s.jsxs("div",{className:"text-center p-12",children:[s.jsx("div",{className:"text-muted-foreground mb-4",children:s.jsxs("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),s.jsx("p",{className:"text-lg text-muted-foreground",children:"No addresses found. Add your first address!"})]}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:A.map(e=>s.jsxs(c,{className:"h-full",children:[s.jsxs(m,{className:"flex flex-row items-center justify-between pb-2",children:[s.jsxs(u,{className:"text-lg mb-1",children:[e.name,e.isDefault&&s.jsx(l,{className:"mt-3 ml-2 bg-primary",children:"Default"})]}),s.jsxs("div",{className:"flex gap-2",children:[!e.isDefault&&s.jsx(i,{variant:"outline",size:"sm",onClick:()=>(async e=>{const s=localStorage.getItem("token");if(!s)return;const r={addressId:e.id,isDefault:!0,token:s};try{await d.postData({endpoint:"/user/address",body:{request:o(r)},successCallback:()=>{n.success("Default address updated successfully"),H()},errorCallback:e=>{n.error(e?.error||"Failed to update default address")}})}catch{n.error("Error updating default address")}})(e),className:"text-primary border-primary hover:bg-primary/10",children:"Make Default"}),s.jsx(i,{variant:"outline",size:"sm",onClick:()=>(e=>{P(e),$({name:e.name,addressLine1:e.addressLine1,city:e.city,state:e.state,country:e.country,pincode:e.pincode,phone:e.phone,isDefault:e.isDefault}),G({}),K("pincode",e.pincode),K("phone",e.phone),z(!0)})(e),className:"text-green-600 border-green-600 hover:text-primary",children:s.jsx(k,{className:"h-4 w-4"})}),s.jsx(i,{variant:"outline",size:"sm",onClick:()=>(e=>{O(e),E(!0)})(e),className:"text-red-600 border-red-600 hover:text-primary",children:s.jsx(C,{className:"h-4 w-4"})})]})]}),s.jsx(x,{children:s.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[s.jsx("p",{children:e.addressLine1}),s.jsxs("p",{children:[e.city,", ",e.state," ",e.pincode]}),s.jsx("p",{children:e.country}),s.jsxs("p",{children:["Phone: ",e.phone]})]})})]},e.id))}),s.jsx(p,{open:I,onOpenChange:z,children:s.jsxs(h,{className:"sm:max-w-[600px]",children:[s.jsx(j,{children:s.jsx(f,{children:F?"Edit Address":"Add Address"})}),s.jsxs("form",{onSubmit:async e=>{e.preventDefault();const s=localStorage.getItem("token");if(!s)return;if(Object.values(W).some(e=>""!==e))return void n.error("Please fix the validation errors before submitting.");const r={...T,token:s};F&&(r.addressId=F.id);try{await d.postData({endpoint:"/user/address",body:{request:o(r)},successCallback:()=>{n.success(F?"Address updated successfully":"Address added successfully"),z(!1),H()},errorCallback:e=>{n.error(e?.error||"Failed to save address")}})}catch{n.error("Error saving address")}},className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(y,{label:"Name",name:"name",value:T.name,onChange:e=>$(s=>({...s,name:e})),required:!0}),s.jsx(y,{label:"Phone",name:"phone",value:T.phone,onChange:e=>{const s=e.replace(/[^\d+\s]/g,"").slice(0,15);$(e=>({...e,phone:s})),K("phone",s)},error:W.phone,required:!0})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:["Address Line 1 ",s.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),s.jsx(v,{name:"addressLine1",value:T.addressLine1,onChange:e=>{const{name:s,value:r,type:a}=e.target;let t=r;"pincode"===s&&(t=r.replace(/\D/g,"").slice(0,6)),$(r=>({...r,[s]:"checkbox"===a?e.target.checked:t})),"pincode"!==s&&"phone"!==s||K(s,t)},className:"mt-2",required:!0})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(y,{label:"City",name:"city",value:T.city,onChange:e=>$(s=>({...s,city:e})),required:!0}),s.jsx(y,{label:"State",name:"state",value:T.state,onChange:e=>$(s=>({...s,state:e})),required:!0})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(y,{label:"Pincode",name:"pincode",value:T.pincode,onChange:e=>{const s=e.replace(/\D/g,"").slice(0,6);$(e=>({...e,pincode:s})),K("pincode",s)},error:W.pincode,required:!0}),s.jsx(y,{label:"Country",name:"country",value:T.country,onChange:e=>$(s=>({...s,country:e})),required:!0})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{htmlFor:"isDefault",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Set as default address"}),s.jsx(b,{id:"isDefault",name:"isDefault",checked:T.isDefault,onCheckedChange:e=>$(s=>({...s,isDefault:e}))})]}),s.jsxs(g,{children:[s.jsx(i,{type:"button",variant:"outline",onClick:()=>z(!1),children:"Cancel"}),s.jsxs(i,{type:"submit",children:[F?"Update":"Add"," Address"]})]})]})]})}),s.jsx(p,{open:B,onOpenChange:E,children:s.jsxs(h,{children:[s.jsx(j,{children:s.jsx(f,{children:"Confirm Delete"})}),s.jsxs("div",{className:"py-4",children:[s.jsx("p",{className:"text-muted-foreground",children:"Are you sure you want to delete this address?"}),M&&s.jsxs("div",{className:"mt-4 p-4 border rounded-md bg-muted/50",children:[s.jsx("p",{className:"font-medium",children:M.name}),s.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[M.addressLine1,s.jsx("br",{}),M.city,", ",M.state," ",M.pincode]})]})]}),s.jsxs(g,{children:[s.jsx(i,{variant:"outline",onClick:()=>E(!1),children:"Cancel"}),s.jsx(i,{variant:"destructive",onClick:async()=>{if(!M)return;const e=localStorage.getItem("token");if(e)try{const s=await d.delete("/user/address",{request:o({addressId:M.id,token:e})},{Authorization:e});s.status?(n.success("Address deleted successfully"),H()):n.error(s.error||"Failed to delete address")}catch{n.error("Error deleting address")}finally{E(!1),O(null)}},children:"Delete"})]})]})})]}),!w&&s.jsx(r,{})]})};export{w as default};

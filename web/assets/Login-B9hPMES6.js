import{r as l,b as S,f as k,j as e,k as h,B as C,L as I,A as g,e as j,c}from"./index-BoxPh3JM.js";import{L as E,C as q}from"./dropdown-menu-BLfYlWZi.js";import{T as F}from"./TopNav-CntDMABt.js";import{I as b}from"./input-Dho7y00w.js";import{L as y}from"./label-uPPhbx3V.js";import"./NavBar-DEHhcvRU.js";import"./TopBar-CX_8npq5.js";const O=()=>{const[m,N]=l.useState(""),[u,v]=l.useState(""),[x,o]=l.useState(!1),n=S(),{setUser:w}=k(),L=async a=>{a.preventDefault(),o(!0),g.postData({endpoint:"/user/login",body:{request:j({identifier:m,password:u})},successCallback:s=>{s.token?(localStorage.setItem("token",s.token),c.success("Logged in successfully!"),g.postData({endpoint:"/order/pending-order",body:{request:j({token:s.token})},successCallback:t=>{if(t?.products&&Array.isArray(t.products)&&t.products.length>0){let d=[];try{const r=localStorage.getItem("cart");r&&(d=JSON.parse(r))}catch{d=[]}const i=[...t.products];d.forEach(r=>{const p=i.findIndex(f=>f.productId===r.productId&&f.priceList?.id===r.priceList?.id);p===-1?i.push(r):i[p].quantity=r.quantity}),localStorage.setItem("cart",JSON.stringify(i)),c("You have a pending order, the cart has been updated.")}o(!1),n("/")},errorCallback:t=>{console.error("Error fetching pending order:",t),o(!1),n("/")}}),s.roles&&w({id:s.user?.id,username:s.user?.username,name:s.user?.name,email:s.user?.email,phone:s.user?.phone,roles:[...s.roles]})):(o(!1),console.error("Login failed:",s),c.error(s.message||s.error||"Login failed"),/(otp)/gmi.test(s?.message)===!0&&(sessionStorage.setItem("resetIdentifier",m),n("/reset-password")))},errorCallback:s=>{o(!1),console.error("Login failed:",s),c.error(s.error||"Login failed")}})};return l.useEffect(()=>{localStorage.getItem("token")&&n("/")},[]),e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(F,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center px-4 py-6 sm:py-8",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-42 h-42 sm:w-42 sm:h-42 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(E,{size:"xxl"})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground mb-2",children:"Welcome Back"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Sign in to your account to continue"})]}),e.jsxs("div",{className:"bg-card rounded-xl shadow-sm border border-border p-6 sm:p-8",children:[e.jsxs("form",{onSubmit:L,className:"space-y-5 sm:space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"identifier",className:"text-sm font-medium text-foreground",children:"Username or Phone Number"}),e.jsx(b,{type:"text",id:"identifier",value:m,onChange:a=>N(a.target.value),placeholder:"Enter your username or phone number",required:!0,className:"h-11 sm:h-12 text-sm sm:text-base"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(y,{htmlFor:"password",className:"text-sm font-medium text-foreground",children:"Password"}),e.jsx(h,{to:"/forgot-password",className:"text-xs sm:text-sm text-primary hover:underline",children:"Forgot Password?"})]}),e.jsx(b,{type:"password",id:"password",value:u,onChange:a=>v(a.target.value),placeholder:"Enter your password",required:!0,className:"h-11 sm:h-12 text-sm sm:text-base"})]}),e.jsx(C,{type:"submit",className:"w-full h-11 sm:h-12 text-sm sm:text-base font-medium",disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 mr-2 animate-spin"}),"Signing in..."]}):"Sign In"})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-border",children:e.jsxs("p",{className:"text-center text-sm text-muted-foreground",children:["Don't have an account?"," ",e.jsx(h,{to:"/register",className:"text-primary hover:underline font-medium",children:"Create account"})]})})]})]})}),e.jsx("footer",{className:"mt-auto",children:e.jsx(q,{})})]})};export{O as default};

import{r as e,j as s,ad as t,m as a,ae as r}from"./vendor-react-Tc4xLtOv.js";import{Q as i}from"./vendor-qr-CvcLm1-U.js";import{C as l}from"./dropdown-menu-Dweh6OYL.js";import{T as n}from"./TopNav-BXcsdcnw.js";import{a as d,u as o,A as c,e as m,c as u,B as x}from"./index-CCl3TzR2.js";import p from"./Addresses-ghsvjWg4.js";import{D as h,a as f,b as g,c as j,d as b}from"./dialog-CT_0QHuT.js";import{I as y}from"./input-F4kRSedd.js";import{L as N}from"./label-DxpSIJ1C.js";import{R as v,I as S,a as k}from"./vendor-radix-O0RUyoIw.js";import{T as C}from"./textarea-LiP7jPED.js";import"./vendor-charts-DKw1ZHYY.js";import"./vendor-ui-utils-B4kPJlQS.js";import"./NavBar-CdfgxkT6.js";import"./TopBar-DKySbC2h.js";import"./vendor-pdf-export-C4gp01y5.js";import"./vendor-animation-BGrdDg6I.js";import"./badge-BZaNuTv-.js";import"./card-ZRElQZzO.js";import"./input-group-BGtxGQoB.js";import"./switch-adH75S8E.js";const w=e.forwardRef(({className:e,...t},a)=>s.jsx(v,{className:d("grid gap-2",e),...t,ref:a}));w.displayName=v.displayName;const I=e.forwardRef(({className:e,...a},r)=>s.jsx(S,{ref:r,className:d("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...a,children:s.jsx(k,{className:"flex items-center justify-center",children:s.jsx(t,{className:"h-2.5 w-2.5 fill-current text-current"})})}));I.displayName=S.displayName;const P=()=>{const{effectiveTheme:t}=o(),d=a(),[v,S]=e.useState(!1),[k,P]=e.useState(0),[q,D]=e.useState(0),[O,F]=e.useState(0),[A,L]=e.useState([]),[B,E]=e.useState(null),[$,R]=e.useState("Home Delivery"),[T,H]=e.useState("UPI"),[M,U]=e.useState(null),[X,J]=e.useState(!1),[W,z]=e.useState(null),[Q,Y]=e.useState(300),[V,G]=e.useState(null),[Z,K]=e.useState(null),[_,ee]=e.useState({name:"",address:"",city:"",state:"",pincode:"",mobile:"",email:"",country:"",notes:"",userAddressId:null}),[se,te]=e.useState(null),[ae,re]=e.useState({}),[ie,le]=e.useState(!1),[ne,de]=e.useState(!1),[oe,ce]=e.useState([]),[me,ue]=e.useState(""),[xe,pe]=e.useState(null),[he,fe]=e.useState([]),[ge,je]=e.useState(0),[be,ye]=e.useState(0),Ne=e=>{const s=localStorage.getItem("token");if(!s)return;const t={id:se??void 0,mobile:_.mobile,email:_.email,name:_.name,products:e,createdBy:_.name,updatedBy:_.name,token:s};c.postData({endpoint:"/order/save-cart",body:{request:m(t)},successCallback:e=>{e.id&&te(e.id)},errorCallback:e=>{}})};e.useEffect(()=>{_.mobile&&_.mobile.length>=10&&c.postData({endpoint:"/order/pending-order",body:{request:m({token:localStorage.getItem("token")})},successCallback:e=>{if(e?.products&&Array.isArray(e.products)&&e.products.length>0){const s=[...e.products];A.forEach(e=>{const t=s.findIndex(s=>s.productId===e.productId&&s.priceList?.id===e.priceList?.id);-1===t?s.push(e):s[t].quantity=e.quantity}),L(s),localStorage.setItem("cart",JSON.stringify(s))}te(e.cartId||null)},errorCallback:e=>{}})},[_.mobile]),e.useEffect(()=>{X&&0===Q&&(J(!1),_.mobile&&_.mobile.length>=10&&c.postData({endpoint:"/order/pending-order",body:{request:m({mobile:_.mobile})},successCallback:e=>{e?.products&&Array.isArray(e.products)&&e.products.length>0&&L(e.products),te(e.cartId||null),u.error("The Payment Session Expired. Please click Place Order again to pay.",{duration:5e3})},errorCallback:e=>{}}))},[Q,X,A]);const ve=()=>{if(!Z.id||!V.id)return;const e=localStorage.getItem("token"),s={id:se??void 0,...Z,status:"Ordered",token:e||void 0,mobile:_.mobile,email:_.email,name:_.name,products:A,createdBy:_.name,updatedBy:_.name};c.postData({endpoint:"/order/save-cart",body:{request:m(s)},successCallback:s=>{null==s.id&&u.error("Cart update failed!");const t={id:M??void 0,...V,mobile:_.mobile,email:_.email,name:_.name,products:A,createdBy:_.name,updatedBy:_.name,status:"Payment Processed",token:e||void 0,couponId:xe?xe.id:void 0};c.postData({endpoint:"/order/place-order",body:{request:m(t)},successCallback:e=>{null==e.id&&u.error("Order update failed!")},errorCallback:()=>{u.error("Order update failed!")}})},errorCallback:()=>{u.error("Cart creation failed!")}})},Se=()=>{const e=localStorage.getItem("token");e?c.postData({endpoint:"/user/default-address",body:{request:m({token:e})},successCallback:e=>{e&&(ee(s=>({...s,name:e.name||s.name,address:e.addressLine1||s.address,city:e.city||s.city,state:e.state||s.state,pincode:e.pincode||s.pincode,mobile:e.phone||s.mobile,email:e.email||s.email,userAddressId:e.id,country:e.country})),le(!0))},errorCallback:e=>{le(!1)}}):le(!1)};e.useEffect(()=>{Se()},[]),e.useEffect(()=>{(()=>{const e=localStorage.getItem("token");if(A.length>0){const s=A.map(e=>e.productId).filter(e=>void 0!==e),t=e?[]:["New Users"];c.postData({endpoint:"/order/get-coupons",body:{request:m({products:s,token:e||void 0,users:t})},successCallback:e=>{e.coupons&&Array.isArray(e.coupons)?ce(e.coupons):ce([])},errorCallback:e=>{ce([])}})}else ce([])})()},[A]),e.useEffect(()=>{try{const e=localStorage.getItem("cart");e&&L(JSON.parse(e))}catch{L([])}},[]),e.useEffect(()=>{const e=A.reduce((e,s)=>s.priceList&&"number"==typeof s.priceList.unitprice?e+s.priceList.unitprice*s.quantity:e,0);P(e);let s=[],t=0;const a=localStorage.getItem("token");if(xe){if(A.length>0){const r=A.map(e=>e.productId).filter(e=>void 0!==e),i=a?[]:["New Users"];c.postData({endpoint:"/order/get-coupons",body:{request:m({couponCode:xe.code,products:r,token:a||void 0,users:i})},successCallback:a=>{if(a.coupons&&Array.isArray(a.coupons)){const a=xe.products.map(e=>e.id);A.forEach((r,i)=>{let l=0;r.productId&&a.includes(r.productId)&&xe.discounts.forEach(e=>{if("Shipping"===e.name&&!0===e.flatrate)ye(99===q?99-e.discount:0);else if("Shipping"===e.name&&!1===e.flatrate)if(q>=99){const s=e.discount/100*99;ye(s)}else ye(99);else if("Product Discount"===e.name&&!0===e.flatrate)l+=(r.priceList.unitprice-e.discount)*r.quantity;else if("Product Discount"===e.name&&!1===e.flatrate){const s=r.priceList?.unitprice?r.priceList.unitprice*r.quantity:0;l+=s*(e.discount/100)}}),s[i]=l,t+=l,fe(s),je(t);const n=xe&&xe.discounts.some(e=>"Shipping"===e.name)?99-be:e>=999?0:A.length>0&&"Home Delivery"===$?99:0;D(n),F(e-t+n)})}},errorCallback:a=>{pe(null),fe(s),je(t);const r=xe&&xe.discounts.some(e=>"Shipping"===e.name)?99-be:e>=999?0:A.length>0&&"Home Delivery"===$?99:0;D(r),F(e-t+r)}})}}else{s=A.map(()=>0),fe(s),je(t);const a=xe&&xe.discounts.some(e=>"Shipping"===e.name)?99-be:e>=999?0:A.length>0&&"Home Delivery"===$?99:0;D(a),F(e-t+a)}},[A,$,T,xe,be]);const ke=e=>{const{name:s,value:t}=e.target;let a=t;"pincode"===s&&(a=a.replace(/[^0-9]/g,"").slice(0,6)),"mobile"===s&&(a.startsWith("+")?(a=a.replace(/[^+0-9 ]/g,""),a="+"+a.slice(1).replace(/\+/g,""),a=a.replace(/^\+(\d{1,2})( ?)(\d{0,10}).*$/,(e,s,t,a)=>`+${s}${t}${a}`)):a=a.replace(/[^0-9]/g,"").slice(0,10)),ee({..._,[s]:a}),re({...ae,[s]:""})};return s.jsxs(s.Fragment,{children:[s.jsx(n,{}),B?s.jsx("div",{className:"flex justify-center",children:s.jsxs("div",{className:"container flex flex-col items-center justify-center justify-center-safe py-12 justify-self-center min-h-screen",children:[s.jsx("div",{className:"text-center mb-6",children:s.jsx(r,{className:"h-32 w-32 text-green-500 mx-auto"})}),s.jsx("h2",{className:"mt-6 text-2xl font-semibold text-green-600",children:"Order Placed Successfully"}),s.jsx("h4",{className:"mt-2 text-lg",children:"We will contact you within 24hrs for the payment confirmation, and the order will be processed within 3 working days."}),s.jsx("h4",{className:"mt-2",children:"You can get updates on WhatsApp on the status of the order."}),s.jsx("h4",{className:"mt-2",children:"This is a homemade food buisness start up so please bear with us for any small delays. But we guarantee the best quality."}),s.jsxs("h4",{className:"mt-4 text-lg font-medium",children:["Order ID: ",B.id]}),s.jsx(x,{variant:"outline",className:"py-3 px-4 mt-6 text-white hover:text-black bg-primary border-gray-400 hover:bg-green-50",onClick:()=>{d("/")},children:"Continue Shopping"})]})}):s.jsxs(s.Fragment,{children:[X?s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-background border border-border rounded-xl p-4 sm:p-6 lg:p-8 max-w-sm sm:max-w-md lg:max-w-lg w-full mx-auto shadow-2xl",children:[s.jsxs("div",{className:"text-center mb-4 sm:mb-6",children:[s.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-3 bg-primary/10 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-xl sm:text-2xl",children:"⏰"})}),s.jsx("h1",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-foreground",children:"Time remaining"}),s.jsxs("div",{className:"text-2xl sm:text-3xl lg:text-4xl font-mono font-bold text-primary mt-2",children:[Math.floor(Q/60),":",(Q%60).toString().padStart(2,"0")]})]}),s.jsxs("div",{className:"text-center mb-4 sm:mb-6",children:[s.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mb-3",children:"Complete your payment using the QR code below"}),s.jsx("div",{className:"bg-muted/50 rounded-lg p-3 mb-4",children:s.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground",children:["Please share a screenshot of the payment on WhatsApp to"," ",s.jsx("a",{className:"text-primary hover:underline font-medium",href:"https://wa.me/+919363720792",target:"_blank",rel:"noopener noreferrer",children:"+91 93637-20792"})," ","for us to start processing the order"]})})]}),s.jsx("div",{className:"flex justify-center mb-4 sm:mb-6",children:s.jsx("div",{className:"bg-background p-3 rounded-xl border border-border",children:s.jsx(i,{value:`upi://pay?pa=renugarenuga36-1@okhdfcbank&pn=Renus Home Foods&tn=Renus Home Foods Order ID ${M}&am=${O}`,size:180,qrStyle:"dots",eyeRadius:10,logoPaddingStyle:"circle",logoImage:"/img/logo.webp"})})}),s.jsxs("div",{className:"bg-muted/30 rounded-lg p-3 mb-4 text-center",children:[s.jsxs("div",{className:"text-sm sm:text-base font-semibold text-foreground",children:["Order ID: #",M]}),s.jsxs("div",{className:"text-lg sm:text-xl font-bold text-primary",children:["Total: ₹",O.toFixed(2)]})]}),s.jsx(x,{className:"w-full h-12 sm:h-14 text-sm sm:text-base font-semibold",onClick:()=>{J(!1),null!==M&&E({id:M}),L([]),ve(),localStorage.removeItem("cart")},children:"Confirm Payment"}),s.jsx("div",{className:"text-center mt-3",children:s.jsx("button",{onClick:()=>J(!1),className:"text-sm text-muted-foreground hover:text-foreground transition-colors",children:"Close and try again later"})})]})}):s.jsx(s.Fragment,{}),s.jsx("div",{className:"container mx-auto px-4 pt-6 pb-5",children:s.jsxs("div",{className:"py-4",children:[s.jsxs("div",{className:"mb-6 lg:mb-8",children:[s.jsx("h1",{className:"text-2xl lg:text-3xl font-bold",children:"Billing details"}),s.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Complete your order information"})]}),s.jsx("form",{action:"#",onSubmit:e=>e.preventDefault(),children:s.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-5 gap-6 lg:gap-8",children:[s.jsxs("div",{className:"xl:col-span-3 space-y-3",children:[s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs(N,{htmlFor:"name",className:"text-sm font-medium",children:["Name",s.jsx("sup",{children:"*"})]}),s.jsx(y,{type:"text",id:"name",name:"name",value:_.name,onChange:ke,disabled:ie,className:"w-full h-11 text-sm",placeholder:"Enter your full name"}),ae.name&&s.jsx("div",{className:"text-sm text-red-600 mt-1",children:ae.name})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(N,{htmlFor:"mobile",className:"text-sm font-medium",children:["Mobile",s.jsx("sup",{children:"*"})]}),s.jsx(y,{type:"tel",id:"mobile",name:"mobile",value:_.mobile,onChange:ke,inputMode:"tel",pattern:"(\\+[0-9]{1,2} ?)?[0-9]{10}",disabled:ie,className:"w-full h-11 text-sm",placeholder:"10 digit mobile number"}),ae.mobile&&s.jsx("div",{className:"text-sm text-red-600 mt-1",children:ae.mobile})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(N,{htmlFor:"address",className:"text-sm font-medium",children:["Address ",s.jsx("sup",{children:"*"})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.jsx(y,{type:"text",id:"address",name:"address",value:_.address,onChange:ke,placeholder:"House Number, Street Name, Area",disabled:ie,className:"flex-1 h-11 text-sm"}),ie&&s.jsx(x,{variant:"outline",onClick:()=>de(!0),className:"sm:w-auto w-full h-11 text-green-600 border-green-600 "+("dark"===t?"hover:bg-primary":"hover:bg-green-50"),children:"Change"})]}),ae.address&&s.jsx("div",{className:"text-sm text-red-600 mt-1",children:ae.address})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs(N,{htmlFor:"city",className:"text-sm font-medium",children:["Town/City",s.jsx("sup",{children:"*"})]}),s.jsx(y,{type:"text",id:"city",name:"city",value:_.city,onChange:ke,disabled:ie,className:"w-full h-11 text-sm",placeholder:"Enter City"}),ae.city&&s.jsx("div",{className:"text-sm text-red-600 mt-1",children:ae.city})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(N,{htmlFor:"state",className:"text-sm font-medium",children:["State",s.jsx("sup",{children:"*"})]}),s.jsx(y,{type:"text",id:"state",name:"state",value:_.state,onChange:ke,disabled:ie,className:"w-full h-11 text-sm",placeholder:"Enter State"}),ae.state&&s.jsx("div",{className:"text-sm text-red-600 mt-1",children:ae.state})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(N,{htmlFor:"pincode",className:"text-sm font-medium",children:["Pincode",s.jsx("sup",{children:"*"})]}),s.jsx(y,{type:"text",id:"pincode",name:"pincode",value:_.pincode,onChange:ke,inputMode:"numeric",pattern:"[0-9]*",disabled:ie,className:"w-full h-11 text-sm",placeholder:"6 digit Pincode"}),ae.pincode&&s.jsx("div",{className:"text-sm text-red-600 mt-1",children:ae.pincode})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(N,{htmlFor:"country",className:"text-sm font-medium",children:"Country"}),s.jsx(y,{type:"text",id:"country",name:"country",value:_.country,onChange:ke,disabled:ie,className:"w-full"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(N,{htmlFor:"email",className:"text-sm font-medium",children:"Email Address"}),s.jsx(y,{type:"email",id:"email",name:"email",value:_.email,onChange:ke,disabled:ie,className:"w-full"})]})]}),s.jsxs("div",{className:"space-y-2 pt-6",children:[s.jsx(N,{htmlFor:"notes",className:"text-sm font-medium",children:"Delivery Notes (Optional)"}),s.jsx(C,{id:"notes",name:"notes",placeholder:"Delivery Notes (Optional)",value:_.notes,onChange:ke,rows:5,className:"resize-none"})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsxs(N,{className:"text-sm font-medium",children:["Shipping Method",s.jsx("sup",{children:"*"})]}),s.jsxs(w,{value:$,onValueChange:e=>R(e),className:"space-y-1 pt-3",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(I,{value:"Home Delivery",id:"Shipping-Home"}),s.jsx(N,{htmlFor:"Shipping-Home",className:"text-sm font-normal cursor-pointer",children:"Home Delivery"}),"Home Delivery"===$&&k<999&&k>0&&s.jsxs("div",{className:"text-sm text-red-600 ml-4",children:["Add Products worth ₹",999-k," or more to get free shipping"]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(I,{value:"Free Store Pickup",id:"Shipping-Store"}),s.jsx(N,{htmlFor:"Shipping-Store",className:"text-sm font-normal cursor-pointer",children:"Free Store Pickup"})]})]})]}),s.jsxs("div",{className:"space-y-4 pt-6 border-b pb-2",children:[s.jsx("h4",{className:"text-lg font-semibold",children:"Payment Option"}),s.jsxs(w,{value:T,onValueChange:H,className:"space-y-1",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(I,{value:"Direct Bank Transfer",id:"Payment-Bank"}),s.jsx(N,{htmlFor:"Payment-Bank",className:"text-sm font-normal cursor-pointer",children:"Direct Bank Transfer"})]}),s.jsx("div",{className:"text-sm text-gray-600 ml-6",children:"Order will be processed once the amount is checked cleared in our accounts. Please include the order ID shown after placing the order in your payment remarks"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(I,{value:"UPI",id:"Payment-UPI"}),s.jsx(N,{htmlFor:"Payment-UPI",className:"text-sm font-normal cursor-pointer",children:"UPI/Google Pay/Paytm/PhonePe QR"})]}),s.jsx("div",{className:"text-sm text-gray-600 ml-6",children:"Pay Using the QR Shown after placing the order and confirm the order after payment"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(I,{value:"Cash on Delivery",id:"Payment-COD"}),s.jsx(N,{htmlFor:"Payment-COD",className:"text-sm font-normal cursor-pointer",children:"Cash on Delivery (COD)"})]}),s.jsx("div",{className:"text-sm text-gray-600 ml-6",children:"Order will be processed after personal confirmation of the order through phone."})]})]})]})]}),s.jsxs("div",{className:"xl:col-span-2",children:[s.jsxs("div",{className:"bg-card rounded-lg border border-border overflow-hidden",children:[s.jsxs("div",{className:"p-4 lg:p-6 border-b border-border",children:[s.jsx("h2",{className:"text-lg lg:text-xl font-semibold",children:"Order Summary"}),s.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[A.length," items in your cart"]})]}),s.jsx("div",{className:"lg:hidden",children:s.jsx("div",{className:"divide-y divide-border max-h-96 overflow-y-auto",style:{scrollbarWidth:"thin",paddingRight:"24px"},children:0===A.length?s.jsx("div",{className:"p-6 text-center text-muted-foreground",children:"Your cart is empty."}):A.map((e,t)=>s.jsx("div",{className:"p-4",children:s.jsxs("div",{className:"flex gap-3",children:[s.jsx("div",{className:"w-16 h-16 bg-muted rounded-lg overflow-hidden flex-shrink-0",children:s.jsx("img",{src:e.image?`/static/inventory/${e.image}`:"/img/logo.webp",alt:e.name||"Product",className:"w-full h-full object-cover"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"font-medium text-sm truncate",children:e.name}),s.jsx("p",{className:"text-xs text-muted-foreground",children:e.priceList?.weight}),s.jsxs("div",{className:"flex items-center justify-between mt-2",children:[s.jsxs("span",{className:"text-sm font-medium",children:["₹",e.priceList?.unitprice]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{type:"button",className:"w-6 h-6 rounded-full border border-border flex items-center justify-center text-xs hover:bg-accent",onClick:()=>{if(e.quantity>1){const e=A.map((e,s)=>s===t?{...e,quantity:e.quantity-1}:e);L(e),localStorage.setItem("cart",JSON.stringify(e)),Ne(e)}else{const e=A.filter((e,s)=>s!==t);L(e),localStorage.setItem("cart",JSON.stringify(e)),Ne(e)}},children:"-"}),s.jsx("span",{className:"text-sm font-medium min-w-[2rem] text-center",children:e.quantity}),s.jsx("button",{type:"button",className:"w-6 h-6 rounded-full border border-border flex items-center justify-center text-xs hover:bg-accent",onClick:()=>{const e=A.map((e,s)=>s===t?{...e,quantity:e.quantity+1}:e);L(e),localStorage.setItem("cart",JSON.stringify(e)),Ne(e)},children:"+"})]})]}),s.jsxs("div",{className:"text-right mt-1",children:[s.jsxs("span",{className:"text-sm font-semibold",children:["₹",e.priceList?.unitprice?e.priceList.unitprice*e.quantity:0]}),he[t]>0&&s.jsxs("div",{className:"text-xs text-green-600",children:["(-₹",he[t].toFixed(2),")"]})]})]})]})},t))})}),s.jsx("div",{className:"hidden lg:block max-h-96 overflow-y-auto",style:{scrollbarWidth:"thin",paddingRight:"24px"},children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"sticky top-0 bg-card z-10",children:s.jsxs("tr",{className:"border-b border-border",children:[s.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Product"}),s.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Weight"}),s.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Price"}),s.jsx("th",{className:"text-center p-3 text-sm font-medium",children:"Qty"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Total"})]})}),s.jsx("tbody",{children:0===A.length?s.jsx("tr",{children:s.jsx("td",{colSpan:5,className:"text-center p-6 text-muted-foreground",children:"Your cart is empty."})}):A.map((e,t)=>s.jsxs("tr",{className:"border-b border-border hover:bg-accent/50",children:[s.jsx("td",{className:"p-3",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-10 h-10 bg-muted rounded overflow-hidden",children:s.jsx("img",{src:e.image?`/static/inventory/${e.image}`:"/img/logo.webp",alt:e.name||"Product",className:"w-full h-full object-cover"})}),s.jsx("span",{className:"text-sm font-medium truncate",children:e.name})]})}),s.jsx("td",{className:"p-3 text-sm text-muted-foreground",children:e.priceList?.weight}),s.jsxs("td",{className:"p-3 text-sm",children:["₹",e.priceList?.unitprice]}),s.jsx("td",{className:"p-3",children:s.jsxs("div",{className:"flex items-center justify-center gap-1",children:[s.jsx("button",{type:"button",className:"w-6 h-6 rounded border border-border flex items-center justify-center text-xs hover:bg-accent",onClick:()=>{if(e.quantity>1){const e=A.map((e,s)=>s===t?{...e,quantity:e.quantity-1}:e);L(e),localStorage.setItem("cart",JSON.stringify(e)),Ne(e)}else{const e=A.filter((e,s)=>s!==t);L(e),localStorage.setItem("cart",JSON.stringify(e)),Ne(e)}},children:"-"}),s.jsx("span",{className:"text-sm font-medium min-w-[2rem] text-center",children:e.quantity}),s.jsx("button",{type:"button",className:"w-6 h-6 rounded border border-border flex items-center justify-center text-xs hover:bg-accent",onClick:()=>{const e=A.map((e,s)=>s===t?{...e,quantity:e.quantity+1}:e);L(e),localStorage.setItem("cart",JSON.stringify(e)),Ne(e)},children:"+"})]})}),s.jsx("td",{className:"p-3 text-sm text-right",children:s.jsxs("div",{children:["₹",e.priceList?.unitprice?e.priceList.unitprice*e.quantity:0,he[t]>0&&s.jsxs("div",{className:"text-xs text-green-600",children:["(-₹",he[t].toFixed(2),")"]})]})})]},t))})]})})]}),s.jsxs("div",{className:"mt-3",children:[s.jsx("div",{className:"bg-muted/30 rounded-lg p-3 lg:p-4",children:s.jsx("table",{className:"w-full "+("dark"===t?"table-dark":""),children:s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{colSpan:4,className:"text-end align-middle",children:s.jsx("strong",{children:"Subtotal"})}),s.jsxs("td",{colSpan:2,className:"text-end align-middle",children:["₹",k.toFixed(2)]})]}),xe&&ge>0&&s.jsxs("tr",{children:[s.jsx("td",{colSpan:4,className:"text-end align-middle",children:s.jsxs("strong",{children:["Discount (",xe.code,")"]})}),s.jsxs("td",{colSpan:2,className:"text-end align-middle",children:["-₹",ge.toFixed(2)]})]}),s.jsxs("tr",{children:[s.jsx("td",{colSpan:4,className:"text-end align-middle",children:s.jsx("strong",{children:"Shipping"})}),s.jsxs("td",{colSpan:2,className:"text-end align-middle",children:["₹",q.toFixed(2)]})]}),s.jsxs("tr",{children:[s.jsx("td",{colSpan:4,className:"text-end align-middle",children:s.jsx("strong",{children:"Total"})}),s.jsx("td",{colSpan:2,className:"text-end align-middle",children:s.jsxs("strong",{children:["₹",O.toFixed(2)]})})]})]})})}),s.jsxs("div",{className:"space-y-4 pt-4",children:[s.jsx(N,{className:"text-sm font-medium",children:"Coupons"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx(y,{type:"text",placeholder:"Enter coupon code",value:me,onChange:e=>ue(e.target.value),className:"flex-1"}),s.jsx(x,{type:"button",variant:"outline",onClick:()=>{if(!me.trim())return;const e=localStorage.getItem("token");if(A.length>0){const s=A.map(e=>e.productId).filter(e=>void 0!==e),t=e?[]:["New Users"];c.postData({endpoint:"/order/get-coupons",body:{request:m({couponCode:me,products:s,token:e||void 0,users:t})},successCallback:e=>{if(e.coupons&&Array.isArray(e.coupons)&&e.coupons.length>0){const s=e.coupons[0];pe(s),ue(""),u.success(`Coupon ${s.code} applied!`);let t=[],a=0;const r=s.products.map(e=>e.id);A.forEach((e,i)=>{let l=0;e.productId&&r.includes(e.productId)&&s.discounts.forEach(s=>{if("Shipping"===s.name&&!0===s.flatrate)ye(99===q?99:0);else if("Shipping"===s.name&&!1===s.flatrate)if(99===q){const e=s.discount/100*99;ye(e)}else ye(0);else if("Product Discount"===s.name&&!0===s.flatrate)l+=Math.round((e.priceList.unitprice-s.discount)*e.quantity);else if("Product Discount"===s.name&&!1===s.flatrate){const t=e.priceList?.unitprice?e.priceList.unitprice*e.quantity:0;l+=Math.round(t*(s.discount/100))}}),t[i]=l,a+=l}),fe(t),je(a)}else pe(null),u.error("Invalid Coupon Code")},errorCallback:e=>{pe(null),u.error("Error applying coupon")}})}},className:"px-6",children:"Apply"})]}),oe.length>0&&s.jsx("div",{className:"max-h-48 overflow-y-auto border rounded-lg",style:{scrollbarWidth:"thin",paddingRight:"16px"},children:oe.map((e,t)=>{const a=e.discounts.map(e=>!1===e.flatrate&&e.discount>0?`${e.discount}% off ${e.name}`:!0===e.flatrate?`${e.name.replace("Discount","Price")} ₹${e.discount} Flat`:"").filter(e=>e).join(" & ");return s.jsxs("div",{className:"p-3 "+(t===oe.length-1?"":"border-b"),children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"font-medium",children:e.code}),s.jsx(x,{type:"button",size:"sm",variant:xe&&xe.id===e.id?"default":"outline",onClick:()=>{xe&&xe.id===e.id?(pe(null),u("Coupon removed.")):(pe(e),u.success(`Coupon ${e.code} applied!`))},children:xe&&xe.id===e.id?"Remove":"Apply"})]}),a&&s.jsx("div",{className:"text-sm text-gray-600 mt-1",children:a})]},e.id)})})]})]}),s.jsx("div",{className:"pt-4",children:s.jsx(x,{type:"button",className:"w-full py-3 px-4 text-uppercase border-2 border-green-600 text-white hover:text-green-600 hover:bg-green-50",onClick:async()=>{if(Y(300),v)return;S(!0);const e=(()=>{const e={};return _.name?/^[A-Za-z ]+$/.test(_.name)||(e.name="Name must contain only alphabets."):e.name="Name is required.",_.address||(e.address="Address is required."),_.city||(e.city="City is required."),_.state||(e.state="State is required."),_.pincode?/^[0-9]{6}$/.test(_.pincode)||(e.pincode="Pincode must be 6 digits."):e.pincode="Pincode is required.",_.mobile?_.mobile.match(/^\\+[0-9]{1,2} ?[0-9]{10}$/)||_.mobile.match(/^[0-9]{10}$/)||(e.mobile="Mobile must be 10 digits or in format +CC XXXXXXXXXX."):e.mobile="Mobile is required.",e})();if(0===A.length)return u.error("Your cart is empty. Please add items before placing an order."),void S(!1);if(re(e),0===Object.keys(e).length){const e=localStorage.getItem("token"),s=(e,s)=>{const t={id:M??void 0,name:_.name,address:_.address,city:_.city,state:_.state,pincode:_.pincode,mobile:_.mobile,email:_.email,country:_.country,notes:_.notes,shippingMethod:$,paymentMethod:T,cartId:e,userAddressId:_.userAddressId,status:"Ordered",token:s||void 0,couponId:xe?xe.id:void 0};c.postData({endpoint:"/order/place-order",body:{request:m(t)},successCallback:s=>{if(!s.id)return u.error("Order creation failed!"),void S(!1);if("UPI"===T){U(s.id),J(!0),K({id:e}),G(s),S(!1),W&&(clearInterval(W),z(null));const t=setInterval(()=>{Y(e=>e>0?e-1:0)},1e3);z(t)}else u.success("Order placed successfully! Order ID: "+s.id),ee({name:"",address:"",city:"",state:"",pincode:"",mobile:"",email:"",country:"",notes:"",userAddressId:null}),L([]),localStorage.removeItem("cart"),E({id:s.id}),S(!1)},errorCallback:e=>{u.error("Order creation failed!"),S(!1)}})};if(!!e)if(se)s(se,e);else{const t={id:void 0,mobile:_.mobile,email:_.email,name:_.name,products:A,createdBy:_.name,updatedBy:_.name,token:e};c.postData({endpoint:"/order/save-cart",body:{request:m(t)},successCallback:t=>{if(!t.id)return u.error("Cart creation failed!"),void S(!1);s(t.id,e)},errorCallback:e=>{u.error("Cart creation failed!"),S(!1)}})}else{const t={id:void 0,mobile:_.mobile,email:_.email,name:_.name,products:A,createdBy:_.name,updatedBy:_.name,token:void 0};c.postData({endpoint:"/order/save-cart",body:{request:m(t)},successCallback:t=>{if(!t.id)return u.error("Cart creation failed!"),void S(!1);s(t.id,e)},errorCallback:e=>{u.error("Cart creation failed!"),S(!1)}})}}else u.error("Please check the form for any mistakes.",{duration:3e3}),S(!1)},disabled:v,children:v?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"mr-2",children:"Placing Order..."}),s.jsx("div",{className:"inline-block w-4 h-4 border-2 border-green-600 border-t-transparent rounded-full animate-spin"})]}):"Place Order"})})]})]})]})})]})})]}),s.jsx(h,{open:ne,onOpenChange:de,children:s.jsxs(f,{className:"max-w-4xl max-h-screen mt-4 mb-4 overflow-hidden",children:[s.jsx(g,{children:s.jsx(j,{children:"Select Default Address"})}),s.jsx("div",{className:"overflow-y-auto max-h-screen",children:s.jsx(p,{modalMode:!0})}),s.jsx(b,{children:s.jsx(x,{variant:"outline",onClick:()=>{de(!1),Se()},children:"Close"})})]})}),s.jsx(l,{})]})};export{P as default};

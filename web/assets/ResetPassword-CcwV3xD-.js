import{r,o as z,j as s,A as B,E as _,_ as Z,L as V}from"./vendor-react-Bv33ryjV.js";import{L as G,C as H}from"./dropdown-menu-BDj5FxyU.js";import{T as W}from"./TopNav-JT08H0jt.js";import{B as J,A as E,e as T,c as w}from"./index-BgzncNPj.js";import{C as K,a as Q,b as U,c as X}from"./card-dPuP1Ci1.js";import{I as j}from"./input-group-AlYMXmbe.js";import"./NavBar-BWSSAL5l.js";import"./TopBar-D2vj-zy0.js";import"./vendor-pdf-DxqLLkkN.js";import"./input-B6PrAciv.js";const de=()=>{const c=[{label:"At least 8 characters",test:e=>e.length>=8},{label:"One uppercase letter",test:e=>/[A-Z]/.test(e)},{label:"One lowercase letter",test:e=>/[a-z]/.test(e)},{label:"One digit",test:e=>/\d/.test(e)},{label:"One special character",test:e=>/[@$!%*?&()[\]{}#^~<>+=_|\\/.,:;"'-]/.test(e)}],[m,O]=r.useState(""),[a,F]=r.useState(""),[l,$]=r.useState(""),[i,u]=r.useState({}),[d,n]=r.useState(!1),[b,k]=r.useState(""),[P,y]=r.useState(!1),[x,I]=r.useState(!1),[f,R]=r.useState(c.map(()=>!1)),[p,N]=r.useState(null),[h,v]=r.useState(15),[S,C]=r.useState(!1),g=z(),o=sessionStorage.getItem("resetIdentifier");r.useEffect(()=>{o||g("/login")},[o,g]),r.useEffect(()=>{N(!l&&!a?null:a===l)},[a,l]),r.useEffect(()=>{if(h>0){const e=setInterval(()=>{v(t=>t-1)},1e3);return()=>clearInterval(e)}else C(!0)},[h]);const A=e=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&()[\]{}#^~<>+=_|\\/.,:;"'-])[A-Za-z\d@$!%*?&()[\]{}#^~<>+=_|\\/.,:;"'-]{8,}$/.test(e),L=e=>{if(!e)return"";let t=0;return e.length>=8&&t++,/[A-Z]/.test(e)&&t++,/[a-z]/.test(e)&&t++,/\d/.test(e)&&t++,/[@$!%*?&()[\]{}#^~<>+=_|\\/.,:;"'-]/.test(e)&&t++,t>=5?"Strong":t>=3?"Medium":"Weak"},D=()=>{const e={};return m.match(/^\d{4}$/)||(e.otp="OTP must be exactly 4 digits"),A(a)||(e.newPassword="Password must be at least 8 characters long and include a capital letter, a lowercase letter, a number, and a special character."),a!==l&&(e.confirmPassword="Passwords do not match"),o||(e.apiError="Missing identifier. Please restart the forgot password process."),u(e),Object.keys(e).length===0},M=async e=>{e.preventDefault(),u({}),D()&&(n(!0),E.postData({endpoint:"/user/reset-password",body:{request:T({identifier:o,otp:m,newPassword:a})},successCallback:()=>{n(!1),sessionStorage.removeItem("resetIdentifier"),w.success("Password has been reset. Please continue to login"),g("/login")},errorCallback:t=>{console.error("Error resetting password",t),n(!1),u({apiError:t?.error||"Failed to reset password. Please try again."})}}))},q=async()=>{!S||!o||(n(!0),E.postData({endpoint:"/user/forgot-password",body:{request:T({identifier:o,regenerate:!1})},successCallback:e=>{n(!1),w.success(e.message||"OTP resent successfully."),v(15),C(!1)},errorCallback:()=>{n(!1),w.error("Failed to resend OTP. Please try again.")}}))};return r.useEffect(()=>{k(L(a)),R(c.map(e=>e.test(a)))},[a]),s.jsxs(s.Fragment,{children:[s.jsx(W,{}),s.jsx("div",{className:"min-h-screen flex items-center justify-center py-6 sm:py-8 lg:py-12 px-4",children:s.jsxs("div",{className:"w-full max-w-md",children:[s.jsx("div",{className:"w-42 h-42 sm:w-42 sm:h-42 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center",children:s.jsx(G,{size:"xxl"})}),s.jsx("div",{className:"mb-6",children:s.jsxs(B,{to:"/login",className:"inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors",children:[s.jsx(_,{className:"h-4 w-4"}),"Back to Login"]})}),s.jsxs(K,{className:"shadow-lg",children:[s.jsxs(Q,{className:"text-center pb-6",children:[s.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center",children:s.jsx(Z,{className:"h-8 w-8 text-primary"})}),s.jsx(U,{className:"text-2xl sm:text-3xl font-bold",children:"Reset Password"}),s.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mt-2",children:"Enter the OTP sent to your email/phone and create a new password."})]}),s.jsx(X,{children:s.jsxs("form",{onSubmit:M,className:"space-y-6",children:[i.apiError&&s.jsx("div",{className:"bg-destructive/10 text-destructive border border-destructive/20 rounded-md p-3 text-sm",role:"alert",children:i.apiError}),s.jsx(j,{label:"OTP",type:"text",value:m,onChange:e=>{/^\d{0,4}$/.test(e)&&O(e)},placeholder:"Enter 4-digit OTP",inputMode:"numeric",maxLength:4,error:i.otp,required:!0}),s.jsx("div",{className:"text-center",children:S?s.jsx("button",{type:"button",className:"text-sm text-primary hover:text-primary/80 font-medium transition-colors disabled:opacity-50",onClick:e=>{d||(e.preventDefault(),q())},disabled:d,children:"Resend OTP"}):s.jsxs("span",{className:"text-sm text-muted-foreground",children:["Resend OTP in ",h,"s"]})}),s.jsxs("div",{children:[s.jsx(j,{label:"New Password",type:"password",value:a,onChange:e=>{F(e),!x&&e&&I(!0)},placeholder:"Enter new password",onFocus:()=>y(!0),onBlur:()=>y(!1),error:i.newPassword,showPasswordToggle:!0,required:!0}),(P||x)&&s.jsxs("div",{className:"mt-2",children:[x&&s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:`h-2 rounded-full transition-all ${b==="Strong"?"bg-primary":b==="Medium"?"bg-yellow-500":"bg-red-500"}`,style:{width:`${f.filter(Boolean).length/c.length*100}%`}})}),P&&s.jsx("ul",{className:"mt-2 space-y-1",children:c.map((e,t)=>s.jsxs("li",{className:`text-xs flex items-center gap-2 ${f[t]?"text-green-600":"text-red-500"}`,children:[f[t]?s.jsx("span",{className:"text-green-600",children:"✓"}):s.jsx("span",{className:"text-red-500",children:"✗"}),e.label]},e.label))})]})]}),s.jsxs("div",{children:[s.jsx(j,{label:"Confirm New Password",type:"password",value:l,onChange:e=>$(e),placeholder:"Confirm new password",error:i.confirmPassword,showPasswordToggle:!0,required:!0}),p!==null&&s.jsx("div",{className:"mt-2",children:s.jsx("span",{className:`text-xs flex items-center gap-2 ${p?"text-green-600":"text-red-500"}`,children:p?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"text-green-600",children:"✓"}),"Passwords match"]}):s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"text-red-500",children:"✗"}),"Passwords do not match"]})})})]}),s.jsxs(J,{type:"submit",className:"w-full h-11 text-sm sm:text-base",disabled:d,children:[d&&s.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),d?"Resetting Password...":"Reset Password"]})]})})]})]})}),s.jsx(H,{})]})};export{de as default};

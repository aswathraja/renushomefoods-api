import{a as e,j as s}from"./vendor-animation-CcgChT4Y.js";import{L as r,C as t}from"./dropdown-menu-DjLdUzkQ.js";import{T as a}from"./TopNav-BcoF5Zho.js";import{g as o,b as n,L as i,B as m,A as d,e as l,c}from"./index-QkJ4t2go.js";import{I as u}from"./input-hHw7iIA9.js";import{L as x}from"./label-CdSwSrYM.js";import{L as p}from"./vendor-icons-BYe_-sqm.js";import"./vendor-radix-CgisZDtL.js";import"./vendor-charts-1c3qO8Q0.js";import"./vendor-ui-utils-B4kPJlQS.js";import"./NavBar-Zl-a5m7p.js";import"./TopBar-CO3pAy7f.js";import"./vendor-pdf-export-F3dE0gEs.js";const h=()=>{const[h,f]=e.useState(""),[j,g]=e.useState(""),[b,y]=e.useState(!1),N=o(),{setUser:v}=n(),w=e=>{N(e),setTimeout(()=>{window.resetZoom&&window.resetZoom()},100)};return e.useEffect(()=>{!0===Boolean(localStorage.getItem("token"))&&N("/")},[]),s.jsxs("div",{className:"min-h-screen flex flex-col",children:[s.jsx(a,{}),s.jsx("div",{className:"flex-1 flex items-center justify-center px-4 py-6 sm:py-8",children:s.jsxs("div",{className:"w-full max-w-md",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("div",{className:"w-42 h-42 sm:w-42 sm:h-42 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center",children:s.jsx(r,{size:"xxl"})}),s.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground mb-2",children:"Welcome Back"}),s.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Sign in to your account to continue"})]}),s.jsxs("div",{className:"bg-card rounded-xl shadow-sm border border-border p-6 sm:p-8",children:[s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),y(!0),d.postData({endpoint:"/user/login",body:{request:l({identifier:h,password:j})},successCallback:e=>{e.token?(localStorage.setItem("token",e.token),c.success("Logged in successfully!"),d.postData({endpoint:"/order/pending-order",body:{request:l({token:e.token})},successCallback:e=>{if(e?.products&&Array.isArray(e.products)&&e.products.length>0){let s=[];try{const e=localStorage.getItem("cart");e&&(s=JSON.parse(e))}catch{s=[]}const r=[...e.products];s.forEach(e=>{const s=r.findIndex(s=>s.productId===e.productId&&s.priceList?.id===e.priceList?.id);-1===s?r.push(e):r[s].quantity=e.quantity}),localStorage.setItem("cart",JSON.stringify(r)),c("You have a pending order, the cart has been updated.")}y(!1),w("/")},errorCallback:e=>{y(!1),w("/")}}),e.roles&&v({id:e.user?.id,username:e.user?.username,name:e.user?.name,email:e.user?.email,phone:e.user?.phone,roles:[...e.roles]})):(y(!1),c.error(e.message||e.error||"Login failed"),!0===/(otp)/gim.test(e?.message)&&(sessionStorage.setItem("resetIdentifier",h),N("/reset-password")))},errorCallback:e=>{y(!1),c.error(e.error||"Login failed")}})},className:"space-y-5 sm:space-y-6",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(x,{htmlFor:"identifier",className:"text-sm font-medium text-foreground",children:"Username or Phone Number"}),s.jsx(u,{type:"text",id:"identifier",value:h,onChange:e=>f(e.target.value),placeholder:"Enter your username or phone number",required:!0,className:"h-11 sm:h-12 text-sm sm:text-base"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx(x,{htmlFor:"password",className:"text-sm font-medium text-foreground",children:"Password"}),s.jsx(i,{to:"/forgot-password",className:"text-xs sm:text-sm text-primary hover:underline",children:"Forgot Password?"})]}),s.jsx(u,{type:"password",id:"password",value:j,onChange:e=>g(e.target.value),placeholder:"Enter your password",required:!0,className:"h-11 sm:h-12 text-sm sm:text-base"})]}),s.jsx(m,{type:"submit",className:"w-full h-11 sm:h-12 text-sm sm:text-base font-medium",disabled:b,children:b?s.jsxs(s.Fragment,{children:[s.jsx(p,{className:"w-4 h-4 mr-2 animate-spin"}),"Signing in..."]}):"Sign In"})]}),s.jsx("div",{className:"mt-6 pt-6 border-t border-border",children:s.jsxs("p",{className:"text-center text-sm text-muted-foreground",children:["Don't have an account?"," ",s.jsx(i,{to:"/register",className:"text-primary hover:underline font-medium",children:"Create account"})]})})]})]})}),s.jsx("footer",{className:"mt-auto",children:s.jsx(t,{})})]})};export{h as default};

import{j as e,n as L,a5 as F,a6 as k,d as P,L as R,a7 as E,r as N}from"./vendor-react-Bv33ryjV.js";import{B as D,c as g,A as B,e as M}from"./index-BgzncNPj.js";import{B as H}from"./badge-FegKslFz.js";import{T as C,a as T,b as r,c as n,d as O,e as t}from"./table-bzACJohG.js";const U=({orders:h,expandedOrderId:d,setExpandedOrderId:b,viewType:v="ViewOnly",onEditOrder:p,onDownloadInvoice:i,isDownloadingInvoiceMap:f})=>{const m=s=>{switch(s.toLowerCase()){case"ordered":return"default";case"payment processed":return"secondary";case"processing":return"outline";case"packed":return"outline";case"shipped":return"default";case"delivered":return"default";case"cancelled":return"destructive";default:return"outline"}},y=s=>{const a=s.orderTotal-s.productDiscount,x=a<999&&s.shippingMethod==="Home Delivery"?99-s.shippingDiscount:0;return a+x};return e.jsxs("div",{className:"w-full",children:[e.jsxs(C,{children:[e.jsx(T,{children:e.jsxs(r,{className:"bg-muted/50",children:[e.jsx(n,{className:"w-[50px] text-left font-bold"}),e.jsx(n,{className:"min-w-[100px] text-left font-bold",children:"Order ID"}),e.jsx(n,{className:"min-w-[100px] text-left font-bold",children:"User ID"}),e.jsx(n,{className:"min-w-[150px] text-left font-bold",children:"Customer Name"}),e.jsx(n,{className:"min-w-[180px] text-left font-bold",children:"Customer Phone"}),e.jsx(n,{className:"min-w-[180px] text-left font-bold",children:"Customer Email"}),e.jsx(n,{className:"min-w-[120px] text-left font-bold",children:"Order Date"}),e.jsx(n,{className:"min-w-[175px] text-left font-bold",children:"Order Status"}),e.jsx(n,{className:"min-w-[120px] text-left font-bold",children:"Order Total"}),e.jsx(n,{className:"min-w-[175px] text-left font-bold",children:"Shipping Method"}),e.jsx(n,{className:"min-w-[180px] text-left font-bold",children:"Est. Delivery Date"}),e.jsx(n,{className:"min-w-[150px] text-left font-bold",children:"Delivery Name"}),e.jsx(n,{className:"min-w-[300px] text-left font-bold",children:"Address"}),e.jsx(n,{className:"min-w-[150px] text-left font-bold",children:"City"}),e.jsx(n,{className:"min-w-[120px] text-left font-bold",children:"State"}),e.jsx(n,{className:"min-w-[150px] text-left font-bold",children:"Country"}),e.jsx(n,{className:"min-w-[100px] text-left font-bold",children:"Pincode"}),e.jsx(n,{className:"min-w-[180px] text-left font-bold",children:"Delivery Phone"})]})}),e.jsx(O,{children:h.map(s=>e.jsxs(L.Fragment,{children:[e.jsxs(r,{children:[e.jsx(t,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>b(d===s.orderId?null:s.orderId),className:"hover:text-primary",children:d===s.orderId?e.jsx(F,{className:"h-4 w-4"}):e.jsx(k,{className:"h-4 w-4"})}),v==="ManageOrders"&&e.jsxs(e.Fragment,{children:[p&&e.jsx(D,{variant:"outline",size:"sm",onClick:()=>p(s),className:"hover:text-primary",children:e.jsx(P,{className:"h-4 w-4"})}),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>i(s.orderId),disabled:f[s.orderId]===!0,className:"hover:text-primary",children:f[s.orderId]===!0?e.jsx(R,{className:"h-4 w-4 animate-spin"}):e.jsx(E,{className:"h-4 w-4"})})]})]})}),e.jsx(t,{className:"font-medium",children:s.orderId}),e.jsx(t,{children:s.userId}),e.jsx(t,{children:s.customerName}),e.jsx(t,{children:s.customerPhone}),e.jsx(t,{children:s.customerEmail}),e.jsx(t,{children:new Date(s.orderDate).toLocaleDateString()}),e.jsx(t,{children:e.jsx(H,{variant:m(s.orderStatus),children:s.orderStatus})}),e.jsxs(t,{className:"font-medium",children:["₹",y(s).toFixed(2)]}),e.jsx(t,{children:s.shippingMethod}),e.jsx(t,{children:new Date(s.expectedDeliveryDate).toLocaleDateString()}),e.jsx(t,{children:s.deliveryName}),e.jsx(t,{className:"max-w-[200px] truncate",children:s.addressLine1}),e.jsx(t,{children:s.city}),e.jsx(t,{children:s.state}),e.jsx(t,{children:s.country}),e.jsx(t,{children:s.pincode}),e.jsx(t,{children:s.deliveryPhone})]}),d===s.orderId&&e.jsx(r,{children:e.jsx(t,{colSpan:18,className:"p-0",children:e.jsxs("div",{className:"p-6 bg-muted/20",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Order Details"}),e.jsxs(C,{children:[e.jsx(T,{children:e.jsxs(r,{children:[e.jsx(n,{children:"Product Name"}),e.jsx(n,{children:"Category"}),e.jsx(n,{children:"Quantity"}),e.jsx(n,{children:"Price"}),e.jsx(n,{children:"Total"})]})}),e.jsxs(O,{children:[s.products.map((a,o)=>e.jsxs(r,{children:[e.jsx(t,{children:a.productName}),e.jsx(t,{children:a.categoryName}),e.jsx(t,{children:a.quantity}),e.jsxs(t,{children:["₹",a.price]}),e.jsxs(t,{children:["₹",a.productTotal]})]},o)),s.productDiscount>0&&e.jsxs(r,{children:[e.jsx(t,{colSpan:4,children:"Discount"}),e.jsxs(t,{className:"text-red-600",children:["-₹",s.productDiscount.toFixed(2)]})]}),(()=>{const o=s.orderTotal-s.productDiscount<999&&s.shippingMethod==="Home Delivery",x=o?99-s.shippingDiscount:0;return o?e.jsxs(r,{children:[e.jsx(t,{colSpan:4,children:"Shipping"}),e.jsxs(t,{children:["₹",x]})]}):null})(),e.jsxs(r,{children:[e.jsx(t,{colSpan:4,children:e.jsx("strong",{children:"Order Total"})}),e.jsx(t,{children:e.jsxs("strong",{children:["₹",y(s).toFixed(2)]})})]})]})]})]}),s.notes&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Order Notes"}),e.jsx("p",{className:"text-muted-foreground",children:s.notes})]})]})})})]},s.orderId))})]}),h.length===0&&e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No orders found"})]})},Q=({viewType:h="ViewOnly",orders:d,expandedOrderId:b,setExpandedOrderId:v,onEditOrder:p})=>{const[i,f]=N.useState(""),[m,y]=N.useState(""),[s,a]=N.useState(void 0),[o,x]=N.useState({}),S=d.filter(l=>{const c=i===""||l.orderId.toString().includes(i)||l.customerName.toLowerCase().includes(i.toLowerCase())||l.customerPhone.includes(i)||l.customerEmail.toLowerCase().includes(i.toLowerCase()),u=m===""||m==="all-statuses"||l.orderStatus===m,w=!s||new Date(l.orderDate).toDateString()===s.toDateString();return c&&u&&w}),I=async l=>{x(c=>({...c,[l]:!0}));try{const c=localStorage.getItem("token");if(!c){g.error("Authentication required to download invoice");return}await B.postData({endpoint:"/order/download-invoice",body:{request:M({orderId:l,token:c})},responseType:"blob",successCallback:u=>{const w=window.URL.createObjectURL(u),j=document.createElement("a");j.href=w,j.download=`Renus Home Foods - Order Invoice - ${l}.pdf`,document.body.appendChild(j),j.click(),window.URL.revokeObjectURL(w),document.body.removeChild(j),g.success("Invoice downloaded successfully!")},errorCallback:u=>{g.error("Failed to download invoice"),console.error("Error downloading invoice:",u)}})}catch(c){g.error("Failed to download invoice"),console.error("Error downloading invoice:",c)}finally{x(c=>({...c,[l]:!1}))}};return e.jsxs("div",{className:"space-y-6",children:[h==="ViewOnly"&&e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Orders"}),e.jsxs("p",{className:"text-muted-foreground",children:[S.length," of ",d.length," orders"]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-2 w-full lg:w-auto",children:e.jsx("input",{type:"text",placeholder:"Search orders...",value:i,onChange:l=>f(l.target.value),className:"px-3 py-2 border rounded-md text-sm w-full sm:w-64"})})]}),e.jsx(U,{orders:S,expandedOrderId:b,setExpandedOrderId:v,viewType:h,onEditOrder:p,onDownloadInvoice:I,isDownloadingInvoiceMap:o})]})};export{Q as O};

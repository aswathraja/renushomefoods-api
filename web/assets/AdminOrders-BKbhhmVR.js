import{i as Re,r as d,j as e,B as P,c as ee,w as ws,g as Xe,L as Ze,u as ks,A as te,e as le}from"./index-DbPu8K_2.js";import{A as Os}from"./AdminNavBar-BdCuqM3g.js";import{X as Ds,C as Ms}from"./dropdown-menu-ndXhbIqo.js";import{O as As}from"./OrdersTable-PV36XDYU.js";import{f as Ne,a as Ee,C as Es}from"./calendar-CtL8W_QE.js";import{D as $e,a as Ue,b as Ve,c as ze}from"./dialog-CLav4IZ4.js";import{I as W}from"./input-uIhbwgE_.js";import{L as m}from"./label-Dx_XjS3E.js";import{P as Le,a as Fe,b as Te}from"./popover-Cyc9eECO.js";import{S as Q,a as H,b as _,c as G,d as g}from"./select-KOpAoyEo.js";import{T as qe}from"./textarea-BoYb-92F.js";import{B as Ye}from"./badge-BJnljuJY.js";import{T as Ke}from"./trash-2-WSuUzwgI.js";import{P as es}from"./plus-CAVwJglQ.js";import{Q as Ls}from"./index-D6JujfTB.js";import{C as Fs,a as Ts,b as qs,c as Rs}from"./card-BaY4vyi0.js";import{F as $s}from"./funnel-CYFOiLLx.js";import"./TopBar-BblwwY8A.js";import"./table-BtW2LytS.js";import"./chevron-down-mIi7_xTw.js";import"./square-pen-BU1ldGM8.js";import"./download-BuATT8GD.js";import"./chevron-left-BlR7maOI.js";import"./index-DsFJuTvR.js";const Us=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],Vs=Re("arrow-left-right",Us);const zs=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],Bs=Re("gift",zs);const Qs=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],Hs=Re("qr-code",Qs),_s=({coupons:D,customCoupon:$,setCustomCoupon:T,appliedCoupon:b,setAppliedCoupon:M,setTotalDiscount:A,setShippingDiscount:q,formData:E,newProducts:k=[],isLoading:R=!1})=>{const[S,a]=d.useState(""),h=E.products?.reduce((n,c)=>n+c.productTotal,0)||0,t=k.filter(n=>n.product&&n.quantity>0).reduce((n,c)=>n+c.total,0),U=h+t,y=n=>{if(!n.isActive)return!1;const c=new Date,O=new Date(n.startDate.split("/").reverse().join("-")),v=new Date(n.endDate.split("/").reverse().join("-"));if(c<O||c>v)return!1;if(n.products.length>0){const p=new Set(n.products.map(z=>z.name));if(![...E.products?.map(z=>z.productName)??[],...k?.map(z=>z.name)??[]].some(z=>p.has(z)))return!1}return!(!n.isForAllUsers&&n.users.length>0&&E.userId&&!n.users.some(F=>F.id===ws(E.userId)))},L=n=>{const c=[],O=new Set(n.products.map(v=>v.name));return E.products?.forEach(v=>{O.has(v.productName)&&c.push({name:v.productName,quantity:v.quantity,total:v.productTotal,price:v.price})}),k.filter(v=>v.product&&v.quantity>0).forEach(v=>{O.has(v.product.name)&&c.push({name:v.name,quantity:v.quantity,total:v.total,price:v.priceList?.unitprice||0})}),c},f=n=>n.reduce((c,O)=>c+O.quantity,0),I=n=>n.reduce((c,O)=>c+O.total,0),C=n=>{let c=0,O=0;const v=L(n);if(v.length===0){A(0),q(0),ee.error("Coupon not applicable to selected products"),M(null),a(""),T("");return}const p=f(v),F=I(v);n.discounts.forEach(X=>{const z=X.name.toLowerCase().includes("shipping");if(X.flatrate)z?O+=X.discount*p:c+=X.discount*p;else if(z){const de=U<999?99*X.discount/100:0;O+=de}else{const ce=F*X.discount/100;c+=ce}}),A(c),q(O),a(n.code),M(n)},se=()=>{M(null),T(""),A(0),q(0),a("")},K=()=>{if(!S.trim())return;const n=D.find(c=>c.code.toLowerCase()===S.toLowerCase()&&y(c));n?C(n):ee.error("Invalid Coupon Code"),T("")};return d.useEffect(()=>{a($);const n=D.find(c=>c.code.toLowerCase()===$.toLowerCase());n&&C(n)},[D]),e.jsxs("div",{className:"space-y-4",children:[b&&e.jsxs("div",{className:"border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Bs,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800",children:"Applied Coupon:"}),e.jsx(Ye,{variant:"secondary",children:b.code})]}),e.jsx(P,{variant:"ghost",size:"sm",onClick:se,children:e.jsx(Ds,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"mt-2 text-sm text-green-700",children:b.discounts.map((n,c)=>e.jsx("div",{children:n.flatrate?`₹${n.discount} off ${n.name}`:`${n.discount}% off ${n.name}`},c))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(m,{htmlFor:"customCoupon",children:"Enter Coupon Code"}),e.jsx(W,{id:"customCoupon",value:S,onChange:n=>a(n.target.value.toUpperCase()),placeholder:"Enter coupon code...",disabled:!!b})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(P,{onClick:K,disabled:!S.trim()||!!b,children:"Apply"})})]}),R?e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Available Coupons"}),e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),"Loading coupons..."]})]}):D.length>0&&!b?e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Available Coupons"}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:D.map(n=>e.jsx("div",{className:"border rounded-lg p-3 hover:bg-muted/20 cursor-pointer",onClick:()=>C(n),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Ye,{variant:"outline",children:n.code})}),e.jsx("div",{className:"mt-1 text-sm",children:n.discounts.map((c,O)=>e.jsxs("div",{children:[c.name," - ",c.flatrate?`₹${c.discount} off`:`${c.discount}% off`]},O))}),n.products.length>0&&e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Valid for ",n.products.map(c=>c.name).join(", ")]}),!n.isForAllUsers&&n.users.length>0&&e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Valid for ",n.users.map(c=>c.name).join(", ")]}),n.isForAllUsers&&e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Valid for All Users"}),n.isForNewUsers&&e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Valid for New Users"})]}),e.jsx(P,{variant:"outline",size:"sm",children:"Apply"})]})},n.id))})]}):!R&&D.length===0&&!b?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"No available coupons for this order"}):null]})},Gs=({newProducts:D,setNewProducts:$,existingProducts:T,onRemoveExistingProduct:b,categories:M,products:A,onCategoryChange:q,onProductChange:E,onPricelistChange:k,onQuantityChange:R,onRemoveNewProduct:S,effectiveTheme:a})=>{const h=()=>{$([...D,{quantity:1,total:0,categoryId:0,productId:0,priceListId:0}])},t=y=>!A||A.length===0?[]:A.filter(f=>(f.categoryId||f.categoryid||f.CategoryId)===y),U=y=>y?.PriceLists||[];return e.jsxs("div",{className:"space-y-4",children:[T&&T.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{className:"text-base font-medium",children:"Current Products"}),e.jsx("div",{className:"space-y-2",children:T.map((y,L)=>e.jsx("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:y.productName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:y.categoryName}),e.jsxs("p",{className:"text-sm",children:["Qty: ",y.quantity," × ₹",y.price," = ₹",y.productTotal]})]}),!a.includes("admin")&&e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>b(L),children:e.jsx(Ke,{className:"h-4 w-4"})})]})})},L))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{className:"text-base font-medium",children:"Add Products"}),e.jsxs(P,{onClick:h,variant:"outline",size:"sm",children:[e.jsx(es,{className:"h-4 w-4 mr-1"}),"Add Product"]})]}),D.map((y,L)=>e.jsxs("div",{className:"p-4 border rounded-lg space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Category"}),e.jsxs(Q,{value:y.categoryId?.toString()||"",onValueChange:f=>{const I=M.find(C=>C.id.toString()===f);q(L,I)},children:[e.jsx(H,{children:e.jsx(_,{placeholder:"Select Category"})}),e.jsx(G,{children:M.map(f=>e.jsx(g,{value:f.id.toString(),children:f.category},f.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Product"}),e.jsxs(Q,{value:y.productId?.toString()||"",onValueChange:f=>{const I=t(y.categoryId||0).find(C=>C.id.toString()===f);E(L,I)},disabled:!y.categoryId||A.length===0,children:[e.jsx(H,{className:"w-48",children:e.jsx(_,{placeholder:y.categoryId?A.length===0?"Loading Products...":"Select Product":"Select Category First"})}),e.jsx(G,{children:y.categoryId?t(y.categoryId||0).length>0?t(y.categoryId||0).map(f=>e.jsx(g,{value:f.id.toString(),children:f.name},f.id)):e.jsx(g,{value:"no-products",disabled:!0,children:"No products found for this category"}):e.jsx(g,{value:"select-category",disabled:!0,children:"Select a category first"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Price List"}),e.jsxs(Q,{value:y.priceListId?.toString()||"",onValueChange:f=>{const I=U(y.product).find(C=>C.id.toString()===f);k(L,I)},disabled:!y.product,children:[e.jsx(H,{children:e.jsx(_,{placeholder:"Select Price"})}),e.jsx(G,{children:U(y.product).map(f=>e.jsxs(g,{value:f.id.toString(),children:[f.weight," - ₹",f.unitprice]},f.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Quantity"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{type:"number",min:"1",value:y.quantity,onChange:f=>R(L,parseInt(f.target.value)||1),className:"w-30"}),e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>S(L),className:"px-2",children:e.jsx(Ke,{className:"h-4 w-4"})})]})]})]}),y.total>0&&e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t",children:[e.jsx("span",{className:"font-medium",children:"Product Total:"}),e.jsxs("span",{className:"font-semibold",children:["₹",y.total.toFixed(2)]})]})]},L)),D.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:'No products added. Click "Add Product" to add products to this order.'})]})]})},Js=({isOpen:D,onClose:$,isCreateMode:T,editingOrder:b,users:M,userAddresses:A,isLoadingAddresses:q,isLoadingCoupons:E,onSaveOrder:k,isSaving:R,setIsSaving:S,formData:a,setFormData:h,errors:t,newProducts:U,setNewProducts:y,categories:L,products:f,coupons:I,selectedUser:C,setSelectedUser:se,selectedAddress:K,setSelectedAddress:n,customCoupon:c,setCustomCoupon:O,appliedCoupon:v,setAppliedCoupon:p,totalDiscount:F,setTotalDiscount:X,shippingDiscount:z,setShippingDiscount:ce,onCategoryChange:de,onProductChange:be,onPricelistChange:Se,onQuantityChange:Ce,onRemoveNewProduct:Pe,onRemoveExistingProduct:he,effectiveTheme:xe})=>{const[re,pe]=d.useState(!1),[j,oe]=d.useState(!1),l=r=>{let u=r.replace(/[^\d+\s]/g,"");if(u.startsWith("+")){const V=u.match(/^(\+\d{0,2})(\s?)(\d{0,10})/);if(V){const we=V[1],je=V[2],ue=V[3];return we+(je||(ue.length>0?" ":""))+ue}}else return u.replace(/\D/g,"").slice(0,10);return u.slice(0,15)},Z=a.products?.reduce((r,u)=>r+u.productTotal,0)||0,Ie=U.filter(r=>r.product&&r.quantity>0).reduce((r,u)=>r+u.total,0),ie=Z+Ie,J=ie<999&&a.shippingMethod==="Home Delivery",Y=J?99-z:0,B=ie-F+Y;return e.jsx($e,{open:D,onOpenChange:$,children:e.jsxs(Ue,{className:"max-w-4xl max-h-screen mt-4 mb-4 overflow-y-auto",children:[e.jsx(Ve,{children:e.jsx(ze,{children:T?"Create Order":"Edit Order"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"user",children:"User"}),e.jsxs(Q,{value:C?.value==="new-customer"?C.value:C?.value?.id?.toString()||"",onValueChange:r=>{if(r==="new-customer")se({value:"new-customer",label:"New Customer"});else{const u=M.find(V=>V.id.toString()===r);u&&(se({value:u,label:`${u.name} (${u.phone})`}),h({...a,customerName:u.name,customerPhone:u.phone,customerEmail:u.email}))}},children:[e.jsx(H,{className:t.userId?"border-red-500":"",children:e.jsx(_,{placeholder:"Select User"})}),e.jsxs(G,{children:[e.jsx(g,{value:"new-customer",children:"New Customer"}),M?.map(r=>e.jsxs(g,{value:r.id.toString(),children:[r.name," (",r.phone,")"]},r.id))]})]}),t.userId&&e.jsx("p",{className:"text-sm text-red-500",children:t.userId})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"address",children:"User Address"}),e.jsxs(Q,{value:K?.value?.toString()||"",onValueChange:r=>{if(r==="new-address")n({value:"new-address",label:"New Address"}),h({...a,deliveryName:"",addressLine1:"",city:"",state:"",country:"",pincode:"",deliveryPhone:""});else{const u=A.find(V=>V.id.toString()===r);n(u?{value:u.id,label:`${u.name} - ${u.addressLine1}, ${u.city}`}:null),u&&h({...a,customerName:C?.value?.name||"",customerPhone:C?.value?.phone||"",customerEmail:C?.value?.email||"",deliveryName:u.name,addressLine1:u.addressLine1,city:u.city,state:u.state,country:u.country,pincode:u.pincode,deliveryPhone:u.phone})}},disabled:q,children:[e.jsx(H,{className:t.addressLine1?"border-red-500":"",children:e.jsx(_,{placeholder:q?"Loading addresses...":"Select Address"})}),e.jsxs(G,{children:[e.jsx(g,{value:"new-address",children:"New Address"}),A?.map(r=>e.jsxs(g,{value:r.id.toString(),children:[r.name," - ",r.addressLine1,", ",r.city]},r.id))]})]}),t.addressLine1&&e.jsx("p",{className:"text-sm text-red-500",children:t.addressLine1})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"customerName",children:"Customer Name"}),e.jsx(W,{id:"customerName",value:a.customerName||"",onChange:r=>h({...a,customerName:r.target.value}),className:t.customerName?"border-red-500":""}),t.customerName&&e.jsx("p",{className:"text-sm text-red-500",children:t.customerName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"customerPhone",children:"Customer Phone"}),e.jsx(W,{id:"customerPhone",value:a.customerPhone||"",onChange:r=>{const u=l(r.target.value);h({...a,customerPhone:u})},className:t.customerPhone?"border-red-500":""}),t.customerPhone&&e.jsx("p",{className:"text-sm text-red-500",children:t.customerPhone})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"customerEmail",children:"Customer Email"}),e.jsx(W,{id:"customerEmail",type:"email",value:a.customerEmail||"",onChange:r=>h({...a,customerEmail:r.target.value}),className:t.customerEmail?"border-red-500":""}),t.customerEmail&&e.jsx("p",{className:"text-sm text-red-500",children:t.customerEmail})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Order Date"}),e.jsxs(Le,{open:re,onOpenChange:pe,children:[e.jsx(Fe,{asChild:!0,children:e.jsx(P,{variant:"outline",className:Xe("w-full justify-start text-left font-normal",!a.orderDate&&"text-muted-foreground",t.orderDate&&"border-red-500"),children:a.orderDate?Ne(a.orderDate,"dd/MM/yyyy"):"Select date"})}),e.jsx(Te,{className:"w-auto p-0",align:"start",children:e.jsx(Ee,{mode:"single",selected:a.orderDate,onSelect:r=>{h({...a,orderDate:r}),pe(!1)},autoFocus:!0})})]}),t.orderDate&&e.jsx("p",{className:"text-sm text-red-500",children:t.orderDate})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Expected Delivery Date"}),e.jsxs(Le,{open:j,onOpenChange:oe,children:[e.jsx(Fe,{asChild:!0,children:e.jsx(P,{variant:"outline",className:Xe("w-full justify-start text-left font-normal",!a.expectedDeliveryDate&&"text-muted-foreground",t.expectedDeliveryDate&&"border-red-500"),children:a.expectedDeliveryDate?Ne(a.expectedDeliveryDate,"dd/MM/yyyy"):"Select date"})}),e.jsx(Te,{className:"w-auto p-0",align:"start",children:e.jsx(Ee,{mode:"single",selected:a.expectedDeliveryDate,onSelect:r=>{h({...a,expectedDeliveryDate:r}),oe(!1)},autoFocus:!0})})]}),t.expectedDeliveryDate&&e.jsx("p",{className:"text-sm text-red-500",children:t.expectedDeliveryDate})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"orderStatus",children:"Order Status"}),e.jsxs(Q,{value:a.orderStatus||"",onValueChange:r=>h({...a,orderStatus:r}),children:[e.jsx(H,{className:t.orderStatus?"border-red-500":"",children:e.jsx(_,{placeholder:"Select Order Status"})}),e.jsxs(G,{children:[e.jsx(g,{value:"Ordered",children:"Ordered"}),e.jsx(g,{value:"Payment Processed",children:"Payment Processed"}),e.jsx(g,{value:"Processing",children:"Processing"}),e.jsx(g,{value:"Packed",children:"Packed"}),e.jsx(g,{value:"Shipped",children:"Shipped"}),e.jsx(g,{value:"Delivered",children:"Delivered"}),e.jsx(g,{value:"Cancelled",children:"Cancelled"})]})]}),t.orderStatus&&e.jsx("p",{className:"text-sm text-red-500",children:t.orderStatus})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"shippingMethod",children:"Shipping Method"}),e.jsxs(Q,{value:a.shippingMethod||"",onValueChange:r=>h({...a,shippingMethod:r}),children:[e.jsx(H,{className:t.shippingMethod?"border-red-500":"",children:e.jsx(_,{placeholder:"Select Shipping Method"})}),e.jsxs(G,{children:[e.jsx(g,{value:"Home Delivery",children:"Home Delivery"}),e.jsx(g,{value:"Free Store Pickup",children:"Free Store Pickup"})]})]}),t.shippingMethod&&e.jsx("p",{className:"text-sm text-red-500",children:t.shippingMethod})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"paymentMethod",children:"Payment Method"}),e.jsxs(Q,{value:a.paymentMethod||"",onValueChange:r=>h({...a,paymentMethod:r}),children:[e.jsx(H,{className:t.paymentMethod?"border-red-500":"",children:e.jsx(_,{placeholder:"Select Payment Method"})}),e.jsxs(G,{children:[e.jsx(g,{value:"UPI",children:"UPI"}),e.jsx(g,{value:"Cash on Delivery",children:"Cash on Delivery"}),e.jsx(g,{value:"Direct Bank Transfer",children:"Direct Bank Transfer"})]})]}),t.paymentMethod&&e.jsx("p",{className:"text-sm text-red-500",children:t.paymentMethod})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"deliveryName",children:"Delivery Name"}),e.jsx(W,{id:"deliveryName",value:a.deliveryName||"",onChange:r=>h({...a,deliveryName:r.target.value}),className:t.deliveryName?"border-red-500":""}),t.deliveryName&&e.jsx("p",{className:"text-sm text-red-500",children:t.deliveryName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"deliveryPhone",children:"Delivery Phone"}),e.jsx(W,{id:"deliveryPhone",value:a.deliveryPhone||"",onChange:r=>{const u=l(r.target.value);h({...a,deliveryPhone:u})},className:t.deliveryPhone?"border-red-500":""}),t.deliveryPhone&&e.jsx("p",{className:"text-sm text-red-500",children:t.deliveryPhone})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"addressLine1",children:"Address Line 1"}),e.jsx(W,{id:"addressLine1",value:a.addressLine1||"",onChange:r=>h({...a,addressLine1:r.target.value}),className:t.addressLine1?"border-red-500":""}),t.addressLine1&&e.jsx("p",{className:"text-sm text-red-500",children:t.addressLine1})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"city",children:"City"}),e.jsx(W,{id:"city",value:a.city||"",onChange:r=>h({...a,city:r.target.value}),className:t.city?"border-red-500":""}),t.city&&e.jsx("p",{className:"text-sm text-red-500",children:t.city})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"state",children:"State"}),e.jsx(W,{id:"state",value:a.state||"",onChange:r=>h({...a,state:r.target.value}),className:t.state?"border-red-500":""}),t.state&&e.jsx("p",{className:"text-sm text-red-500",children:t.state})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"country",children:"Country"}),e.jsx(W,{id:"country",value:a.country||"",onChange:r=>h({...a,country:r.target.value}),className:t.country?"border-red-500":""}),t.country&&e.jsx("p",{className:"text-sm text-red-500",children:t.country})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"pincode",children:"Pincode"}),e.jsx(W,{id:"pincode",value:a.pincode||"",onChange:r=>{const u=r.target.value.replace(/[^\d]/g,"").slice(0,6);h({...a,pincode:u})},className:t.pincode?"border-red-500":""}),t.pincode&&e.jsx("p",{className:"text-sm text-red-500",children:t.pincode})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-medium",children:"Products"}),t.products&&e.jsx("p",{className:"text-sm text-red-500",children:t.products})]}),e.jsx(Gs,{newProducts:U,setNewProducts:y,existingProducts:a.products||[],onRemoveExistingProduct:he,categories:L,products:f,onCategoryChange:de,onProductChange:be,onPricelistChange:Se,onQuantityChange:Ce,onRemoveNewProduct:Pe,effectiveTheme:xe}),e.jsx("div",{className:"bg-muted/20 p-4 rounded-lg",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["₹",ie.toFixed(2)]})]}),F>0&&e.jsxs("div",{className:"flex justify-between text-destructive",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["-₹",F.toFixed(2)]})]}),J&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Shipping:"}),e.jsxs("span",{children:["₹",Y.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg border-t pt-2",children:[e.jsx("span",{children:"Order Total:"}),e.jsxs("span",{children:["₹",B.toFixed(2)]})]})]})})]}),e.jsx(_s,{coupons:I,customCoupon:c,setCustomCoupon:O,appliedCoupon:v,setAppliedCoupon:p,setTotalDiscount:X,setShippingDiscount:ce,formData:a,newProducts:U,isLoading:E}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"notes",children:"Order Notes"}),e.jsx(qe,{id:"notes",value:a.notes||"",onChange:r=>h({...a,notes:r.target.value}),placeholder:"Enter any additional notes for the order...",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"deliveryNote",children:"Delivery Note"}),e.jsx(qe,{id:"deliveryNote",value:a.deliveryNote||"",onChange:r=>h({...a,deliveryNote:r.target.value}),placeholder:"Enter delivery note...",rows:3,className:t.deliveryNote?"border-red-500":""}),t.deliveryNote&&e.jsx("p",{className:"text-sm text-red-500",children:t.deliveryNote})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4 border-t",children:[e.jsx(P,{variant:"outline",onClick:$,disabled:R(),children:"Close"}),e.jsx(P,{onClick:()=>{S(!0),k()},disabled:R(),children:R()?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):T?"Create Order":"Save Changes"})]})]})})},Ws=({isOpen:D,onClose:$,orderId:T,orderTotal:b,customerName:M,currentOrderStatus:A,onRefund:q,isRefunding:E})=>{const[k,R]=d.useState(b.toString()),[S,a]=d.useState(""),[h,t]=d.useState(""),[U,y]=d.useState(""),[L,f]=d.useState(A||"Pending"),[I,C]=d.useState({amount:!1,reason:!1,method:!1}),se=["Customer request","Product damaged","Product not as described","Wrong item delivered","Delivery failure","Quality issues","Order cancellation","Duplicate order","Payment error","Other"],K=["Original payment method","Bank transfer","Cash refund"],n=p=>{if(p.preventDefault(),!S||!h)return;const F={orderId:T,amount:parseFloat(k),reason:S,refundMethod:h,notes:U,orderStatus:L};q(F)},c=()=>{R(b.toString())},O=p=>{const F=b*p/100;R(F.toFixed(2))},v=()=>{const p=parseFloat(k);return p>0&&p<=b};return d.useEffect(()=>{R(b.toString())},[b]),d.useEffect(()=>{D||(R(b.toString()),a(""),t(""),y(""),f(A||"Pending"),C({amount:!1,reason:!1,method:!1}))},[D,b,A]),e.jsx($e,{open:D,onOpenChange:$,children:e.jsxs(Ue,{className:"max-w-md",children:[e.jsx(Ve,{children:e.jsxs(ze,{className:"flex items-center gap-2",children:[e.jsx(Vs,{className:"h-5 w-5"}),"Process Refund - Order #",T]})}),e.jsxs("form",{onSubmit:n,className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Order Summary"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Order ID:"}),e.jsxs("span",{className:"font-medium",children:["#",T]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Customer:"}),e.jsx("span",{className:"font-medium",children:M})]}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Total Amount:"}),e.jsxs("span",{children:["₹",b.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Quick Refund Options"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{type:"button",variant:"outline",size:"sm",onClick:c,className:"flex-1",children:"Full Refund"}),e.jsx(P,{type:"button",variant:"outline",size:"sm",onClick:()=>O(50),className:"flex-1",children:"50%"}),e.jsx(P,{type:"button",variant:"outline",size:"sm",onClick:()=>O(25),className:"flex-1",children:"25%"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"refundAmount",children:"Refund Amount (₹) *"}),e.jsx(W,{id:"refundAmount",type:"number",min:"0",max:b,step:"0.01",value:k,onChange:p=>R(p.target.value),onBlur:()=>C(p=>({...p,amount:!0})),placeholder:"Enter refund amount",className:!v()&&k&&I.amount?"border-red-500":""}),!v()&&k&&I.amount&&e.jsxs("p",{className:"text-sm text-red-500",children:["Amount must be between ₹0 and ₹",b.toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"refundReason",children:"Refund Reason *"}),e.jsxs(Q,{value:S,onValueChange:p=>{a(p),C(F=>({...F,reason:!0}))},children:[e.jsx(H,{className:!S&&I.reason?"border-red-500":"",children:e.jsx(_,{placeholder:"Select reason for refund"})}),e.jsx(G,{children:se.map(p=>e.jsx(g,{value:p,children:p},p))})]}),!S&&I.reason&&e.jsx("p",{className:"text-sm text-red-500",children:"Please select a reason"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"refundMethod",children:"Refund Method *"}),e.jsxs(Q,{value:h,onValueChange:p=>{t(p),C(F=>({...F,method:!0}))},children:[e.jsx(H,{className:!h&&I.method?"border-red-500":"",children:e.jsx(_,{placeholder:"Select refund method"})}),e.jsx(G,{children:K.map(p=>e.jsx(g,{value:p,children:p},p))})]}),!h&&I.method&&e.jsx("p",{className:"text-sm text-red-500",children:"Please select a refund method"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"refundNotes",children:"Additional Notes"}),e.jsx(qe,{id:"refundNotes",value:U,onChange:p=>y(p.target.value),placeholder:"Enter any additional notes about the refund...",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"refundOrderStatus",children:"Order Status After Refund"}),e.jsxs(Q,{value:L,onValueChange:f,children:[e.jsx(H,{children:e.jsx(_,{placeholder:"Select order status"})}),e.jsxs(G,{children:[e.jsx(g,{value:"Ordered",children:"Ordered"}),e.jsx(g,{value:"Payment Processed",children:"Payment Processed"}),e.jsx(g,{value:"Processing",children:"Processing"}),e.jsx(g,{value:"Packed",children:"Packed"}),e.jsx(g,{value:"Shipped",children:"Shipped"}),e.jsx(g,{value:"Delivered",children:"Delivered"}),e.jsx(g,{value:"Cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4 border-t",children:[e.jsx(P,{type:"button",variant:"outline",onClick:$,disabled:E,children:"Cancel"}),e.jsx(P,{type:"submit",disabled:E||!v()||!S||!h,variant:"destructive",children:E?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing Refund..."]}):`Process Refund of ₹${parseFloat(k||"0").toFixed(2)}`})]})]})]})})},Xs=({isOpen:D,onClose:$,onPaymentSuccess:T,orderId:b,orderTotal:M,customerName:A,customerPhone:q})=>{const k=(()=>{const S="renugarenuga36-1@okhdfcbank",a="Renus Home Foods",h=`Order #${b}`;return`upi://pay?pa=${S}&pn=${encodeURIComponent(a)}&am=${M}&cu=INR&tn=${encodeURIComponent(h)}`})(),R=()=>{navigator.clipboard.writeText("renugarenuga36-1@okhdfcbank").then(()=>{})};return e.jsx($e,{open:D,onOpenChange:$,children:e.jsxs(Ue,{className:"max-w-md max-h-screen mt-4 mb-4 flex flex-col p-0",children:[e.jsx(Ve,{className:"sticky top-0 bg-background z-10 px-6 py-4 border-b",children:e.jsxs(ze,{className:"flex items-center gap-2",children:[e.jsx(Hs,{className:"h-5 w-5"}),"UPI Payment - Order #",b]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-6",children:[e.jsxs("div",{className:"bg-muted/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Order Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Order ID:"}),e.jsxs("span",{className:"font-medium",children:["#",b]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Customer:"}),e.jsx("span",{className:"font-medium",children:A})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Phone:"}),e.jsx("span",{className:"font-medium",children:q})]}),e.jsxs("div",{className:"flex justify-between text-lg font-semibold border-t pt-2",children:[e.jsx("span",{children:"Total Amount:"}),e.jsxs("span",{children:["₹",M.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"font-medium mb-4",children:"Scan QR Code to Pay"}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-background p-3 rounded-xl border border-border",children:e.jsx(Ls,{value:k,size:180,qrStyle:"dots",eyeRadius:10,logoPaddingStyle:"circle",logoImage:"/img/logo.webp"})})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Scan this QR code using any UPI app (PhonePe, Google Pay, Paytm, etc.)"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Or pay manually:"}),e.jsx("div",{className:"bg-muted/20 p-3 rounded-lg",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"UPI ID:"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("code",{className:"flex-1 bg-background px-2 py-1 rounded text-sm",children:"renugarenuga36-1@okhdfcbank"}),e.jsx(P,{variant:"outline",size:"sm",onClick:R,children:"Copy"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Amount:"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("code",{className:"flex-1 bg-background px-2 py-1 rounded text-sm",children:["₹",M.toFixed(2)]}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>navigator.clipboard.writeText(M.toFixed(2)),children:"Copy"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Reference:"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("code",{className:"flex-1 bg-background px-2 py-1 rounded text-sm",children:["Order #",b]}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>navigator.clipboard.writeText(`Order #${b}`),children:"Copy"})]})]})]})})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Payment Instructions:"}),e.jsxs("ol",{className:"text-sm text-blue-700 space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:"Open your UPI app (PhonePe, Google Pay, Paytm, etc.)"}),e.jsx("li",{children:"Scan the QR code or use the UPI ID above"}),e.jsxs("li",{children:["Enter the exact amount: ₹",M.toFixed(2)]}),e.jsxs("li",{children:["Use reference: Order #",b]}),e.jsx("li",{children:"Complete the payment and share the transaction ID"})]})]})]}),e.jsxs("div",{className:"bg-background z-10 px-6 py-4 border-t flex justify-between",children:[e.jsx(P,{variant:"outline",onClick:$,children:"Close"}),e.jsx(P,{onClick:T,children:"Payment Completed"})]})]})})},Nt=()=>{const{effectiveTheme:D}=ks(),$=new Date,T=new Date($.getFullYear(),$.getMonth(),1),b=$,[M,A]=d.useState({from:T,to:b}),{from:q,to:E}=M||{},[k,R]=d.useState("All"),[S,a]=d.useState("All"),[h,t]=d.useState("All"),[U,y]=d.useState("All"),[L,f]=d.useState(!1),[I,C]=d.useState([]),[se,K]=d.useState([]),[n,c]=d.useState([]),[O,v]=d.useState([]),[p,F]=d.useState([]),[X,z]=d.useState(!1),[ce,de]=d.useState(!1),[be,Se]=d.useState([]),[Ce,Pe]=d.useState(null),[he,xe]=d.useState(!1),[re,pe]=d.useState(!1),[j,oe]=d.useState(null),[l,Z]=d.useState({userId:"",cartId:null,orderDate:new Date,orderStatus:"",shippingMethod:"",paymentMethod:"",expectedDeliveryDate:new Date,deliveryName:"",addressLine1:"",city:"",state:"",country:"",pincode:"",deliveryPhone:"",customerName:"",customerPhone:"",customerEmail:"",notes:"",deliveryNote:"",products:[]}),[Ie,ie]=d.useState({}),[J,Y]=d.useState([]),[B,r]=d.useState(null),[u,V]=d.useState(null),[we,je]=d.useState(""),[ue,ke]=d.useState(null),[Oe,Be]=d.useState(0),[De,Qe]=d.useState(0),[ss,ye]=d.useState(!1),[ts,ve]=d.useState(!1),[rs,Me]=d.useState(!1),[ge,He]=d.useState({orderId:0,orderTotal:0,customerName:"",customerPhone:""}),[fe,as]=d.useState({orderId:0,orderTotal:0,customerName:"",currentOrderStatus:""}),ns=[{value:"All",label:"All"},{value:"Pending",label:"Pending"},{value:"Delivered",label:"Delivered"},{value:"Cancelled",label:"Cancelled"}],ls=[{value:"All",label:"All"},...I.map(s=>({value:s.category,label:s.category}))],ds=[{value:"All",label:"All"},...se.map(s=>({value:s.name,label:s.name}))],is=[{value:"All",label:"All"},...n.map(s=>({value:JSON.stringify(s),label:s.name+" ( "+s.phone+" )"}))];d.useEffect(()=>{te.postData({endpoint:"/inventory/get-categories",body:{request:le({type:"Product"})},successCallback:s=>{Array.isArray(s)?C(s):C([])},errorCallback:()=>{C([])}})},[]),d.useEffect(()=>{const s=localStorage.getItem("token");if(!s){console.error("No token found");return}te.get("/admin/user-list",{Authorization:`Bearer ${s}`}).then(i=>{Array.isArray(i?.users)?c(i?.users||[]):c([])}).catch(i=>{console.error("Error fetching users:",i),c([])})},[]),d.useEffect(()=>{S&&S!=="All"?te.postData({endpoint:"/inventory/get-products",body:{request:le({category:S})},successCallback:s=>{K(s||[])},errorCallback:()=>{console.error("Failed to fetch products for filter"),K([])}}):K([])},[S]);const cs=()=>{te.postData({endpoint:"/inventory/get-products",body:{request:le({})},successCallback:s=>{K(i=>{const o=i.map(x=>x.id),N=(s||[]).filter(x=>!o.includes(x.id));return[...i,...N]})},errorCallback:s=>{console.error("Failed to fetch all products:",s)}})};d.useEffect(()=>{I.length>0&&cs()},[I.length]),d.useEffect(()=>{B&&B.value&&B.value!=="new-customer"&&us(B?.value?.id)},[B]),d.useEffect(()=>{he&&os()},[B,J,l.products,l.orderDate,he]);const Ae=()=>{const s=localStorage.getItem("token");if(!s){console.error("No token found");return}let i=null,o=null;if(U!=="All"&&U)try{const x=U;i=x.name,o=x.phone}catch(x){console.error("Error parsing user object:",x)}const N={fromDate:q?q.toISOString().split("T")[0]:null,toDate:E?E.toISOString().split("T")[0]:null,orderStatus:k!=="All"?k:null,category:S!=="All"?S:null,product:h!=="All"?h:null,name:i,phone:o};te.postData({endpoint:"/admin/fetch-orders",body:{request:le(N)},Authorization:`Bearer ${s}`,successCallback:x=>{if(j?.orderId){const ae=x.orders.find(w=>w.orderId===j?.orderId);oe(ae)}Se(x.orders||[])},errorCallback:x=>{console.error("Error fetching orders:",x)}})},os=()=>{de(!0);const s=l.products?.map(w=>w.productId).filter(Boolean)||[],i=J.filter(w=>w.product&&w.quantity>0).map(w=>w.productId).filter(Boolean),o=[...s,...i],N=B?.value?.id?[B.value.id]:[],x=l.orderDate?l.orderDate.toISOString().split("T")[0]:null,ae={products:o,token:localStorage.getItem("token")||void 0,users:N,fromStartDate:x,fromEndDate:x};te.postData({endpoint:"/order/get-coupons",body:{request:le(ae)},successCallback:w=>{let ne=[];if(w&&w.coupons)ne=w.coupons;else if(w&&w.response)try{ne=JSON.parse(w.response).coupons||[]}catch(me){console.error("Error parsing response:",me)}F(ne||[]),de(!1)},errorCallback:w=>{console.error("Error fetching coupons:",w),console.error("Error details:",w.response?.data),F([]),de(!1)}})},us=async s=>{if(!s){v([]),V(null);return}z(!0);try{const i=localStorage.getItem("token");if(!i){console.error("No token found");return}await te.postData({endpoint:"/admin/user-addresses",body:{request:le({userId:s})},Authorization:`Bearer ${i}`,successCallback:o=>{const N=o?.addresses||[];if(v(N),N.length>0){const x=N.find(ae=>ae.isDefault)||N[0];V({value:x.id,label:`${x.name} - ${x.addressLine1}, ${x.city}`}),Z({...l,customerEmail:B?.value?.email||"",customerName:B?.value?.name||"",customerPhone:B?.value?.phone||"",deliveryName:x.name,addressLine1:x.addressLine1,city:x.city,state:x.state,country:x.country,pincode:x.pincode,deliveryPhone:x.phone})}else V(null),Z({...l,deliveryName:"",addressLine1:"",city:"",state:"",country:"",pincode:"",deliveryPhone:""})},errorCallback:o=>{console.error("Error fetching user addresses:",o),v([]),V(null)}})}catch(i){console.error("Error fetching user addresses:",i),v([]),V(null)}finally{z(!1)}};d.useEffect(()=>{Ae()},[q,E,k,S,h,U]);const ms=()=>q&&E?`${Ne(q,"dd/MM/yyyy")} - ${Ne(E,"dd/MM/yyyy")}`:"Select date range",_e=()=>{Z({userId:"",orderDate:new Date,orderStatus:"",shippingMethod:"",paymentMethod:"",expectedDeliveryDate:new Date,deliveryName:"",addressLine1:"",city:"",state:"",country:"",pincode:"",deliveryPhone:"",customerName:"",customerPhone:"",customerEmail:"",notes:"",deliveryNote:"",products:[]}),ie({}),Y([]),r(null),V(null),je(""),ke(null),Be(0),Qe(0),oe(null),F([])},Ge=s=>{if(s){pe(!1),Y([]),oe(s),ke(p.find(o=>o.code===s.couponCode)||null),je(s.couponCode||""),Z({userId:s.userId.toString(),cartId:s.cartId,orderId:s.orderId,orderDate:new Date(s.orderDate),orderStatus:s.orderStatus,shippingMethod:s.shippingMethod,paymentMethod:s.paymentMethod,expectedDeliveryDate:new Date(s.expectedDeliveryDate),deliveryName:s.deliveryName,addressLine1:s.addressLine1,city:s.city,state:s.state,country:s.country,pincode:s.pincode,deliveryPhone:s.deliveryPhone,customerName:s.customerName,customerPhone:s.customerPhone,customerEmail:s.customerEmail,notes:s.notes||"",deliveryNote:s.deliveryNote||"",products:s.products});const i=n.find(o=>o.id===s.userId);r({value:i,label:`${i.name} (${i.phone})`})}else pe(!0),_e();xe(!0)},hs=()=>{xe(!1),_e()},xs=s=>{r(s),s&&s.value&&s.value!=="new-customer"?Z({...l,customerName:s.value.name,customerPhone:s.value.phone,customerEmail:s.value.email}):(v([]),V(null),s&&s.value==="new-customer"&&Z({...l,deliveryName:"",addressLine1:"",city:"",state:"",country:"",pincode:"",deliveryPhone:"",customerName:"",customerPhone:"",customerEmail:""}))},ps=async()=>{try{const s={};if(l.orderStatus||(s.orderStatus="Order status is required"),l.shippingMethod||(s.shippingMethod="Shipping method is required"),l.paymentMethod||(s.paymentMethod="Payment method is required"),l.deliveryName||(s.deliveryName="Delivery name is required"),l.addressLine1||(s.addressLine1="Address is required"),l.city||(s.city="City is required"),l.state||(s.state="State is required"),l.country||(s.country="Country is required"),l.pincode||(s.pincode="Pincode is required"),l.deliveryPhone||(s.deliveryPhone="Delivery phone is required"),l.customerName||(s.customerName="Customer name is required"),l.customerPhone||(s.customerPhone="Customer phone is required"),l.customerEmail||(s.customerEmail="Customer email is required"),l.products.length===0&&J.filter(N=>N.product&&N.quantity>0).length===0&&(s.products="At least one product is required"),Object.keys(s).length>0){ie(s);return}else ie({});const i={orderId:re?void 0:j?.orderId,userAddressId:!u?.value||u?.value==="new-address"?void 0:u?.value,cartId:l.cartId,orderDate:l.orderDate?l.orderDate.toISOString().split("T")[0]:null,orderStatus:l.orderStatus,shippingMethod:l.shippingMethod,expectedDeliveryDate:l.expectedDeliveryDate?l.expectedDeliveryDate.toISOString().split("T")[0]:null,deliveryName:l.deliveryName,addressLine1:l.addressLine1,city:l.city,state:l.state,country:l.country,pincode:l.pincode,deliveryPhone:l.deliveryPhone,customerName:l.customerName,customerPhone:l.customerPhone,customerEmail:l.customerEmail,products:[...l.products,...J.filter(N=>N.product&&N.quantity>0).map(N=>({quantity:N.quantity,productName:N.product.name,price:N.priceList.unitprice,categoryName:N.category.category,productTotal:N.priceList.unitprice*N.quantity,priceListId:N.priceListId,productDiscount:0}))],notes:l.notes||"",deliveryNote:l.deliveryNote||"",paymentMethod:l.paymentMethod,couponId:ue?.id||null,userId:B?.value?.id||null,totalDiscount:Oe,shippingDiscount:De},o=localStorage.getItem("token");if(!o){ee.error("Authentication token not found"),ye(!1);return}te.postData({endpoint:"/admin/save-order",body:{request:le(i)},Authorization:`Bearer ${o}`,successCallback:N=>{ye(!1);const x=i.products.reduce((Ps,Is)=>Ps+(Is.productTotal||0),0),ae=x<999&&l.shippingMethod==="Home Delivery"?99:0,w=j?(j?.orderTotal||0)-j?.productDiscount-j?.shippingDiscount+ae:0,ne=x-Oe-De+ae,me=N?.orderId||j?.orderId,Je=l.paymentMethod==="UPI",Ss=!re&&ne>w,Cs=!re&&ne<w,We=Math.abs(ne-w);ee.success(re?"Order created successfully!":"Order updated successfully!"),xe(!1),Ae(),re&&Je?(He({orderId:me||0,orderTotal:ne,customerName:l.customerName,customerPhone:l.customerPhone}),ve(!0)):Ss&&Je?(He({orderId:me||0,orderTotal:We,customerName:l.customerName,customerPhone:l.customerPhone}),ve(!0)):Cs&&(as({orderId:me||0,orderTotal:Number(We.toFixed(2)),customerName:l.customerName,currentOrderStatus:l.orderStatus}),Me(!0))},errorCallback:N=>{ye(!1),console.error("Error saving order:",N),ee.error(N?.error||N?.message||"Failed to save order")}})}catch(s){ye(!1),ee.error("Failed to save order"),console.error("Error saving order:",s)}},js=s=>{let i=`The Order has been cancelled or modified and we have refunded ₹${s.amount.toFixed(2)} via ${s.refundMethod} because of ${s.reason}.`;s.notes&&s.notes.trim().length>0&&(i+=` Additional Notes: ${s.notes}`);const o={orderId:j?.orderId||s.orderId,userAddressId:j?.userAddressId||null,cartId:j?.cartId||null,orderDate:j?.orderDate?new Date(j.orderDate).toISOString().split("T")[0]:null,orderStatus:s.orderStatus,shippingMethod:j?.shippingMethod||"",expectedDeliveryDate:j?.expectedDeliveryDate?new Date(j.expectedDeliveryDate).toISOString().split("T")[0]:null,deliveryName:j?.deliveryName||"",addressLine1:j?.addressLine1||"",city:j?.city||"",state:j?.state||"",country:j?.country||"",pincode:j?.pincode||"",deliveryPhone:j?.deliveryPhone||"",customerName:j?.customerName||"",customerPhone:j?.customerPhone||"",customerEmail:j?.customerEmail||"",products:j?.products||[],notes:j?.notes||"",deliveryNote:i,paymentMethod:j?.paymentMethod||"",couponId:ue?.id||null,userId:j?.userId||null,totalDiscount:j?.totalDiscount||0,shippingDiscount:j?.shippingDiscount||0},N=localStorage.getItem("token");if(!N){ee.error("Authentication token not found");return}te.postData({endpoint:"/admin/save-order",body:{request:le(o)},Authorization:`Bearer ${N}`,successCallback:x=>{ee.success("Refund processed successfully!"),Me(!1),Ae()},errorCallback:x=>{console.error("Error processing refund:",x),ee.error(x?.error||x?.message||"Failed to process refund")}})},ys=(s,i)=>{const o=[...J];o[s]={...o[s],category:i,categoryId:i?.id,product:null,productId:null,priceList:null,priceListId:null,total:0},Y(o)},vs=(s,i)=>{const o=[...J];o[s]={...o[s],product:i,productId:i?.id,priceList:null,priceListId:null,total:o[s].quantity*(i?.priceLists?.[0]?.unitprice||0)},Y(o)},gs=(s,i)=>{const o=[...J];o[s]={...o[s],priceList:i,priceListId:i?.id,total:o[s].quantity*(i?.unitprice||0)},Y(o)},fs=(s,i)=>{const o=[...J];o[s]={...o[s],quantity:i,total:i*(o[s].priceList?.unitprice||0)},Y(o)},Ns=s=>{Y(J.filter((i,o)=>o!==s))},bs=s=>{Z({...l,products:l.products.filter((i,o)=>o!==s)})};return e.jsxs(e.Fragment,{children:[e.jsx(Os,{}),e.jsxs("div",{className:"container mx-auto mt-6 p-6 min-h-screen",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Orders"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(P,{variant:"outline",onClick:()=>Ge(),className:"border-green-600 text-green-600 hover:text-primary",children:[e.jsx(es,{className:"w-4 h-4 mr-2"})," Create Order"]}),e.jsxs(P,{variant:"outline",onClick:()=>f(!L),className:"border-green-600 text-green-600 hover:text-primary",children:[e.jsx($s,{className:"w-4 h-4 mr-2"})," Filters"]})]})]}),L&&e.jsxs(Fs,{className:"mb-6",children:[e.jsx(Ts,{children:e.jsx(qs,{children:"Filters"})}),e.jsx(Rs,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Date Range"}),e.jsxs(Le,{children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(P,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(Es,{className:"mr-2 h-4 w-4"}),ms()]})}),e.jsx(Te,{className:"w-auto p-0",align:"start",children:e.jsx(Ee,{mode:"range",selected:M,onSelect:A,numberOfMonths:1,autoFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Order Status"}),e.jsxs(Q,{value:k,onValueChange:R,children:[e.jsx(H,{children:e.jsx(_,{})}),e.jsx(G,{children:ns.map(s=>e.jsx(g,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Category"}),e.jsxs(Q,{value:S,onValueChange:a,children:[e.jsx(H,{children:e.jsx(_,{})}),e.jsx(G,{children:ls.map(s=>e.jsx(g,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Product"}),e.jsxs(Q,{value:h,onValueChange:t,children:[e.jsx(H,{children:e.jsx(_,{})}),e.jsx(G,{children:ds.map(s=>e.jsx(g,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"User"}),e.jsxs(Q,{value:U,onValueChange:y,children:[e.jsx(H,{children:e.jsx(_,{})}),e.jsx(G,{children:is.map(s=>e.jsx(g,{value:s.value,children:s.label},s.value))})]})]})]})})]}),e.jsx(As,{orders:be,expandedOrderId:Ce,setExpandedOrderId:Pe,viewType:"ManageOrders",onEditOrder:Ge}),e.jsx(Js,{isOpen:he,onClose:hs,isCreateMode:re,editingOrder:j,users:n,userAddresses:O,isLoadingAddresses:X,isLoadingCoupons:ce,onSaveOrder:ps,setIsSaving:ye,isSaving:()=>ss,formData:l,setFormData:Z,errors:Ie,newProducts:J,setNewProducts:Y,categories:I,products:se,coupons:p,selectedUser:B,setSelectedUser:xs,selectedAddress:u,setSelectedAddress:V,customCoupon:we,setCustomCoupon:je,appliedCoupon:ue,setAppliedCoupon:ke,totalDiscount:Oe,setTotalDiscount:Be,shippingDiscount:De,setShippingDiscount:Qe,onCategoryChange:ys,onProductChange:vs,onPricelistChange:gs,onQuantityChange:fs,onRemoveNewProduct:Ns,onRemoveExistingProduct:bs,effectiveTheme:D}),e.jsx(Xs,{isOpen:ts,onClose:()=>ve(!1),onPaymentSuccess:()=>{ve(!1),ee.success("Payment successful!")},orderId:ge.orderId,orderTotal:ge.orderTotal,customerName:ge.customerName,customerPhone:ge.customerPhone}),e.jsx(Ws,{isOpen:rs,onClose:()=>Me(!1),orderId:fe.orderId,orderTotal:fe.orderTotal,customerName:fe.customerName,currentOrderStatus:fe.currentOrderStatus,onRefund:s=>{js(s)},isRefunding:!1})]}),e.jsx(Ms,{})]})};export{Nt as default};

import{r as e,m as s,j as r,aj as t,L as a}from"./vendor-react-Tc4xLtOv.js";import{L as o,C as n}from"./dropdown-menu-Dweh6OYL.js";import{T as i}from"./TopNav-BXcsdcnw.js";import{b as m,B as d,A as l,e as c,c as u}from"./index-CCl3TzR2.js";import{I as x}from"./input-F4kRSedd.js";import{L as p}from"./label-DxpSIJ1C.js";import"./vendor-charts-DKw1ZHYY.js";import"./vendor-ui-utils-B4kPJlQS.js";import"./vendor-radix-O0RUyoIw.js";import"./NavBar-CdfgxkT6.js";import"./TopBar-DKySbC2h.js";import"./vendor-pdf-export-C4gp01y5.js";import"./vendor-animation-BGrdDg6I.js";const h=()=>{const[h,f]=e.useState(""),[j,g]=e.useState(""),[b,y]=e.useState(!1),N=s(),{setUser:v}=m(),w=e=>{N(e),setTimeout(()=>{window.resetZoom&&window.resetZoom()},100)};return e.useEffect(()=>{!0===Boolean(localStorage.getItem("token"))&&N("/")},[]),r.jsxs("div",{className:"min-h-screen flex flex-col",children:[r.jsx(i,{}),r.jsx("div",{className:"flex-1 flex items-center justify-center px-4 py-6 sm:py-8",children:r.jsxs("div",{className:"w-full max-w-md",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("div",{className:"w-42 h-42 sm:w-42 sm:h-42 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center",children:r.jsx(o,{size:"xxl"})}),r.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground mb-2",children:"Welcome Back"}),r.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Sign in to your account to continue"})]}),r.jsxs("div",{className:"bg-card rounded-xl shadow-sm border border-border p-6 sm:p-8",children:[r.jsxs("form",{onSubmit:async e=>{e.preventDefault(),y(!0),l.postData({endpoint:"/user/login",body:{request:c({identifier:h,password:j})},successCallback:e=>{e.token?(localStorage.setItem("token",e.token),u.success("Logged in successfully!"),l.postData({endpoint:"/order/pending-order",body:{request:c({token:e.token})},successCallback:e=>{if(e?.products&&Array.isArray(e.products)&&e.products.length>0){let s=[];try{const e=localStorage.getItem("cart");e&&(s=JSON.parse(e))}catch{s=[]}const r=[...e.products];s.forEach(e=>{const s=r.findIndex(s=>s.productId===e.productId&&s.priceList?.id===e.priceList?.id);-1===s?r.push(e):r[s].quantity=e.quantity}),localStorage.setItem("cart",JSON.stringify(r)),u("You have a pending order, the cart has been updated.")}y(!1),w("/")},errorCallback:e=>{y(!1),w("/")}}),e.roles&&v({id:e.user?.id,username:e.user?.username,name:e.user?.name,email:e.user?.email,phone:e.user?.phone,roles:[...e.roles]})):(y(!1),u.error(e.message||e.error||"Login failed"),!0===/(otp)/gim.test(e?.message)&&(sessionStorage.setItem("resetIdentifier",h),N("/reset-password")))},errorCallback:e=>{y(!1),u.error(e.error||"Login failed")}})},className:"space-y-5 sm:space-y-6",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(p,{htmlFor:"identifier",className:"text-sm font-medium text-foreground",children:"Username or Phone Number"}),r.jsx(x,{type:"text",id:"identifier",value:h,onChange:e=>f(e.target.value),placeholder:"Enter your username or phone number",required:!0,className:"h-11 sm:h-12 text-sm sm:text-base"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx(p,{htmlFor:"password",className:"text-sm font-medium text-foreground",children:"Password"}),r.jsx(t,{to:"/forgot-password",className:"text-xs sm:text-sm text-primary hover:underline",children:"Forgot Password?"})]}),r.jsx(x,{type:"password",id:"password",value:j,onChange:e=>g(e.target.value),placeholder:"Enter your password",required:!0,className:"h-11 sm:h-12 text-sm sm:text-base"})]}),r.jsx(d,{type:"submit",className:"w-full h-11 sm:h-12 text-sm sm:text-base font-medium",disabled:b,children:b?r.jsxs(r.Fragment,{children:[r.jsx(a,{className:"w-4 h-4 mr-2 animate-spin"}),"Signing in..."]}):"Sign In"})]}),r.jsx("div",{className:"mt-6 pt-6 border-t border-border",children:r.jsxs("p",{className:"text-center text-sm text-muted-foreground",children:["Don't have an account?"," ",r.jsx(t,{to:"/register",className:"text-primary hover:underline font-medium",children:"Create account"})]})})]})]})}),r.jsx("footer",{className:"mt-auto",children:r.jsx(n,{})})]})};export{h as default};

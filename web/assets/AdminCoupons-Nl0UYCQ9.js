import{r,j as e,F as Be,C as V,e as _e,P as Re,d as qe}from"./vendor-react-Bv33ryjV.js";import{A as Ge}from"./AdminNavBar-C4EyqKDd.js";import{C as Me}from"./dropdown-menu-BDj5FxyU.js";import{u as Le,A as U,e as W,B as i,c as fe}from"./index-BgzncNPj.js";import{B as je}from"./badge-FegKslFz.js";import{C as K,f as ve}from"./calendar-DeP6F9X6.js";import{C as Q,a as ge,b as be,c as X}from"./card-dPuP1Ci1.js";import{C as A}from"./checkbox-DrHO4LUx.js";import{I as ee}from"./input-B6PrAciv.js";import{L as n}from"./label-bvSFhUHd.js";import{P as f,a as j,b as v}from"./popover-BSIvycCC.js";import{S as D}from"./switch-D6BMZ9fM.js";import{T as Ye,a as He,b as se,c as x,d as Je,e as d}from"./table-bzACJohG.js";import"./TopBar-D2vj-zy0.js";import"./vendor-pdf-DxqLLkkN.js";import"./index-BlLmK--u.js";const ms=()=>{const{effectiveTheme:Ze}=Le(),[le,te]=r.useState([]),[Ne,P]=r.useState(!1),[we,T]=r.useState(!1),[E,ae]=r.useState(!1),[Ce,re]=r.useState(null),[ne,ye]=r.useState(!1),[I,Se]=r.useState(""),[ce,Ae]=r.useState({from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}),{from:w,to:C}=ce||{},[h,O]=r.useState([]),[p,ie]=r.useState([]),[F,z]=r.useState(""),[k,B]=r.useState(new Date),[$,_]=r.useState(new Date),[oe,R]=r.useState(!0),[de,q]=r.useState(!0),[me,G]=r.useState(!1),[ue,M]=r.useState(!1),L=[{value:"Shipping",label:"Shipping"},{value:"Product Discount",label:"Product Discount"}],[m,y]=r.useState([{name:"Product Discount",discount:0,flatrate:!1}]),[o,S]=r.useState([]),[c,b]=r.useState([]),[N,g]=r.useState({}),xe=()=>{z(""),B(new Date),_(new Date),R(!0),q(!0),G(!1),M(!1),y([{name:"Product Discount",discount:0,flatrate:!1}]),S([]),b([]),g({}),ae(!1),re(null)},[Y,De]=r.useState([]),[Fe,ke]=r.useState([]),[he,$e]=r.useState([]),[pe,Ue]=r.useState([]),H=()=>{P(!0);const s=localStorage.getItem("token");if(!s)return;const l={couponCode:I||null,fromDate:w?w.toISOString().split("T")[0]:null,toDate:C?C.toISOString().split("T")[0]:null,products:h?.map(t=>t.value),users:p.map(t=>t.value),token:s};U.postData({endpoint:"/order/get-coupons",body:{request:W(l)},Authorization:`Bearer ${s}`,successCallback:t=>{te(t.coupons||[]),P(!1)},errorCallback:t=>{te([]),P(!1)}})};r.useEffect(()=>{U.postData({endpoint:"/inventory/get-products",body:{request:W({})},successCallback:l=>{De(l),$e([{value:"All",label:"All"},...l?.map(t=>({value:t.id,label:t.name}))])}});const s=localStorage.getItem("token");s&&U.get("/admin/user-list",{Authorization:`Bearer ${s}`}).then(l=>{ke(l.users||[]),Ue([{value:"All",label:"All"},...l.users?.map(t=>({value:t.id,label:`${t.name} (${t.phone})`}))])}),H()},[]),r.useEffect(()=>{H()},[I,w,C,h,p]);const Pe=()=>w&&C?`${ve(w,"dd/MM/yyyy")} - ${ve(C,"dd/MM/yyyy")}`:"Select date range",Te=()=>{const s={};F.trim()?/^[a-zA-Z0-9]+$/.test(F)||(s.code="Coupon code must contain only alphabets and numbers."):s.code="Coupon code is required.",(!o||o.length===0)&&(s.products="At least one product must be selected."),(!c||c.length===0)&&(s.users="At least one user must be selected.");for(const a of m)if(!a.flatrate&&a.discount>100){s.discounts="Discount percentage cannot exceed 100%";break}if(g(s),Object.keys(s).length>0)return;const l=localStorage.getItem("token");if(!l)return;const t={couponId:E?Ce.id:void 0,code:F,startDate:k?.toISOString().split("T")[0],endDate:$?.toISOString().split("T")[0],isActive:oe,isGroupable:de,isForNewUsers:me,isForAllUsers:ue,discounts:m,productIds:o.some(a=>a.value==="All")?Y.map(a=>a.id):o?.map(a=>a.value),userIds:c.map(a=>a.value)};U.postData({endpoint:"/admin/save-coupon",body:{request:W(t)},Authorization:`Bearer ${l}`,successCallback:a=>{fe.success(E?"Coupon Updated Successfully":"Coupon Saved Successfully"),H(),xe(),T(!1)},errorCallback:a=>{fe.error(a?.error||a?.message||"An error occurred")}})},Ee=()=>{if(m.length<2){const s=L.filter(t=>!m.some(a=>a.name===t.value)),l=s.length>0?s[0].value:"Shipping";y([...m,{name:l,discount:0,flatrate:!0}])}},J=(s,l,t)=>{const a=[...m];if(l==="name")a[s][l]=t?.value||"";else if(l==="discount"){const u=a[s].flatrate?t:Math.min(100,t);a[s][l]=u}else a[s][l]=t;y(a)},Ie=s=>{y(m.filter((l,t)=>t!==s))},Oe=s=>{M(s),s?c.some(l=>l.value==="All")||b([...c,{value:"All",label:"All"}]):b(c.filter(l=>l.value!=="All"))},ze=s=>{z(s.code),B(new Date(s.startDate.split("/").reverse().join("-"))),_(new Date(s.endDate.split("/").reverse().join("-"))),R(s.isActive),q(s.isGroupable),G(s.isForNewUsers),M(s.isForAllUsers),y(JSON.parse(JSON.stringify(s.discounts||[{name:"Product Discount",discount:0,flatrate:!1}]))),S(s.products?.length===Y.length?[{value:"All",label:"All"}]:s.products?.map(l=>({value:l.id,label:l.name}))||[]),b(s.users?.length===Fe?.length?[{value:"All",label:"All"}]:s.users?.map(l=>({value:l.id,label:`${l.name} (${l.phone})`}))),ae(!0),re(s),T(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(Ge,{}),e.jsxs("div",{className:"container mx-auto mt-6 p-6 min-h-screen",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Coupons"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(i,{variant:"outline",onClick:()=>{xe(),T(!0)},className:"border-green-600 text-green-600 hover:text-primary",children:"Add Coupon"}),e.jsxs(i,{variant:"outline",onClick:()=>ye(!ne),className:"border-green-600 text-green-600 hover:text-primary",children:[e.jsx(Be,{className:"w-4 h-4 mr-2"})," Filters"]})]})]}),ne&&e.jsxs(Q,{className:"mb-6",children:[e.jsx(ge,{children:e.jsx(be,{children:"Filters"})}),e.jsx(X,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"coupon-code-filter",children:"Coupon Code"}),e.jsx(ee,{id:"coupon-code-filter",type:"text",value:I,onChange:s=>Se(s.target.value),placeholder:"Enter coupon code"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Date Range"}),e.jsxs(f,{children:[e.jsx(j,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),Pe()]})}),e.jsx(v,{className:"w-auto p-0",align:"start",children:e.jsx(K,{mode:"range",selected:ce,onSelect:Ae,numberOfMonths:1,autoFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Products"}),e.jsxs(f,{children:[e.jsx(j,{asChild:!0,children:e.jsx(i,{variant:"outline",role:"combobox","aria-expanded":!1,className:"w-full justify-between",children:h.length>0?`${h.length} product(s) selected`:"Select products"})}),e.jsx(v,{className:"w-full p-0",align:"start",children:e.jsx("div",{className:"p-3 space-y-2",children:he.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{id:`product-filter-${s.value}`,checked:h.some(l=>l.value===s.value),onCheckedChange:l=>{const t=h.some(a=>a.value===s.value);if(l&&!t){const a=[...h,s],u=a.some(Z=>Z.value==="All");O(u?[{value:"All",label:"All"}]:a)}else!l&&t&&O(h.filter(a=>a.value!==s.value))}}),e.jsx(n,{htmlFor:`product-filter-${s.value}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:s.label})]},s.value))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Users"}),e.jsxs(f,{children:[e.jsx(j,{asChild:!0,children:e.jsx(i,{variant:"outline",role:"combobox","aria-expanded":!1,className:"w-full justify-between",children:p.length>0?`${p.length} user(s) selected`:"Select users"})}),e.jsx(v,{className:"w-full p-0",align:"start",children:e.jsx("div",{className:"p-3 space-y-2",children:[{value:"All",label:"All"},{value:"New Users",label:"New Users"},...pe.slice(1)].map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{id:`user-filter-${s.value}`,checked:p.some(l=>l.value===s.value),onCheckedChange:l=>{const t=p.some(a=>a.value===s.value);l&&!t?ie([...p,s]):!l&&t&&ie(p.filter(a=>a.value!==s.value))}}),e.jsx(n,{htmlFor:`user-filter-${s.value}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:s.label})]},s.value))})})]})]})]})})]}),we&&e.jsxs(Q,{className:"mb-6",children:[e.jsx(ge,{children:e.jsx(be,{children:E?"Edit Coupon":"Create Coupon"})}),e.jsxs(X,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"coupon-code",children:"Code"}),e.jsx(ee,{id:"coupon-code",type:"text",value:F,onChange:s=>{z(s.target.value);const l=s.target.value;l.trim()?/^[a-zA-Z0-9]+$/.test(l)?g(t=>({...t,code:void 0})):g(t=>({...t,code:"Coupon code must contain only alphabets and numbers."})):g(t=>({...t,code:"Coupon code is required."}))},placeholder:"Enter coupon code"}),N.code&&e.jsx("p",{className:"text-sm text-red-500",children:N.code})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Start Date"}),e.jsxs(f,{children:[e.jsx(j,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),k?k.toLocaleDateString():"Select date"]})}),e.jsx(v,{className:"w-auto p-0",align:"start",children:e.jsx(K,{mode:"single",selected:k||void 0,onSelect:B,autoFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"End Date"}),e.jsxs(f,{children:[e.jsx(j,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),$?$.toLocaleDateString():"Select date"]})}),e.jsx(v,{className:"w-auto p-0",align:"start",children:e.jsx(K,{mode:"single",selected:$||void 0,onSelect:_,required:!1})})]})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4 mb-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{id:"active-switch",checked:oe,onCheckedChange:R}),e.jsx(n,{htmlFor:"active-switch",children:"Active"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{id:"groupable-switch",checked:de,onCheckedChange:q}),e.jsx(n,{htmlFor:"groupable-switch",children:"Groupable"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{id:"new-users-switch",checked:me,onCheckedChange:G}),e.jsx(n,{htmlFor:"new-users-switch",children:"For New Users"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{id:"all-users-switch",checked:ue,onCheckedChange:Oe}),e.jsx(n,{htmlFor:"all-users-switch",children:"For All Users"})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(n,{children:"Discounts"}),m.map((s,l)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 p-4 border rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:`discount-type-${l}`,children:"Discount Type"}),e.jsxs(f,{children:[e.jsx(j,{asChild:!0,children:e.jsx(i,{variant:"outline",role:"combobox","aria-expanded":!1,className:"w-full justify-between",children:L.find(t=>t.value===s.name)?.label||"Select Discount Type"})}),e.jsx(v,{className:"w-full p-0",align:"start",children:e.jsx("div",{className:"p-3 space-y-2",children:L.filter(t=>!m.some((a,u)=>u!==l&&a.name===t.value)).map(t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{id:`discount-type-${l}-${t.value}`,checked:s.name===t.value,onCheckedChange:a=>{a&&J(l,"name",{value:t.value,label:t.label})}}),e.jsx(n,{htmlFor:`discount-type-${l}-${t.value}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:t.label})]},t.value))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:`discount-value-${l}`,children:"Discount"}),e.jsx(ee,{id:`discount-value-${l}`,type:"number",placeholder:"Discount",value:s.discount,onChange:t=>{const a=parseFloat(t.target.value);J(l,"discount",a),!s.flatrate&&a>100?g(u=>({...u,discounts:"Discount percentage cannot exceed 100%"})):g(u=>({...u,discounts:void 0}))},max:s.flatrate?void 0:100,min:0})]}),e.jsx("div",{className:"space-y-2 pb-2 flex items-baseline-last",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(n,{htmlFor:`percentage-rate-${l}`,children:"Percentage"}),e.jsx(D,{id:`flat-rate-${l}`,checked:s.flatrate,onCheckedChange:t=>J(l,"flatrate",t)}),e.jsx(n,{htmlFor:`flat-rate-${l}`,children:"Flat Rate"})]})}),e.jsxs("div",{className:"flex items-end space-x-2",children:[e.jsxs(i,{variant:"destructive",size:"sm",onClick:()=>Ie(l),disabled:m.length===1,children:[e.jsx(_e,{className:"h-4 w-4 mr-1"}),"Remove"]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:Ee,disabled:m.length>=2,children:[e.jsx(Re,{className:"h-4 w-4 mr-1"}),"Add Discount"]})]})]},l)),N.discounts&&e.jsx("p",{className:"text-sm text-red-500",children:N.discounts})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Products"}),e.jsxs(f,{children:[e.jsx(j,{asChild:!0,children:e.jsx(i,{variant:"outline",role:"combobox","aria-expanded":!1,className:"w-full justify-between",children:o.length>0?`${o.length} product(s) selected`:"Select products"})}),e.jsx(v,{className:"w-full p-0",align:"start",children:e.jsx("div",{className:"p-3 space-y-2",children:he.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{id:`product-select-${s.value}`,checked:o.some(l=>l.value===s.value),onCheckedChange:l=>{const t=o.some(a=>a.value===s.value);if(l&&!t){const a=[...o,s],u=a.some(Z=>Z.value==="All");S(u?[{value:"All",label:"All"}]:a)}else!l&&t&&S(o.filter(a=>a.value!==s.value))}}),e.jsx(n,{htmlFor:`product-select-${s.value}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:s.label})]},s.value))})})]}),N.products&&e.jsx("p",{className:"text-sm text-red-500",children:N.products}),o.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:o.map(s=>e.jsx(je,{variant:"secondary",children:s.label},s.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Users"}),e.jsxs(f,{children:[e.jsx(j,{asChild:!0,children:e.jsx(i,{variant:"outline",role:"combobox","aria-expanded":!1,className:"w-full justify-between",children:c.length>0?`${c.length} user(s) selected`:"Select users"})}),e.jsx(v,{className:"w-full p-0",align:"start",children:e.jsx("div",{className:"p-3 space-y-2",children:pe.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{id:`user-select-${s.value}`,checked:c.some(l=>l.value===s.value),onCheckedChange:l=>{const t=c.some(a=>a.value===s.value);l&&!t?b([...c,s]):!l&&t&&b(c.filter(a=>a.value!==s.value))}}),e.jsx(n,{htmlFor:`user-select-${s.value}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:s.label})]},s.value))})})]}),c.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:c.map(s=>e.jsx(je,{variant:"secondary",children:s.label},s.value))})]})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx(i,{onClick:Te,className:"bg-primary text-primary-foreground",children:"Save Coupon"})})]})]}),e.jsx(Q,{children:e.jsx(X,{className:"p-0",children:Ne?e.jsxs("div",{className:"flex justify-center items-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2",children:"Loading coupons..."})]}):e.jsx("div",{children:e.jsxs(Ye,{className:"w-full overflow-x-auto",style:{minWidth:"1900px"},children:[e.jsx(He,{children:e.jsxs(se,{className:"bg-muted/50",children:[e.jsx(x,{className:"text-left font-bold w-[130px] sticky left-0 z-30 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)] border-r [&+*]:relative",children:"Actions"}),e.jsx(x,{className:"text-left font-bold w-[120px]",children:"Code"}),e.jsx(x,{className:"text-left font-bold w-[120px]",children:"Start Date"}),e.jsx(x,{className:"text-left font-bold w-[120px]",children:"End Date"}),e.jsx(x,{className:"text-left font-bold w-[100px]",children:"Active"}),e.jsx(x,{className:"text-left font-bold w-[120px]",children:"Groupable"}),e.jsx(x,{className:"text-left font-bold w-[130px]",children:"For New Users"}),e.jsx(x,{className:"text-left font-bold w-[130px]",children:"For All Users"}),e.jsx(x,{className:"text-left font-bold w-[170px]",children:"Discounts"}),e.jsx(x,{className:"text-left font-bold w-[350px]",children:"Products"}),e.jsx(x,{className:"text-left font-bold w-[300px]",children:"Users"})]})}),e.jsx(Je,{children:le.length===0?e.jsx(se,{children:e.jsx(d,{colSpan:11,className:"text-center py-8 text-gray-500",children:"No coupons found"})}):le.map(s=>e.jsxs(se,{children:[e.jsx(d,{className:"sticky left-0 z-20 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)] border-r w-[130px] [&+*]:relative",style:{position:"sticky",left:0},children:e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>ze(s),className:"border-primary text-primary",children:[e.jsx(qe,{className:"text-primary h-4 w-4 mr-1"}),"Edit"]})}),e.jsx(d,{className:"font-medium",children:s.code}),e.jsx(d,{children:s.startDate}),e.jsx(d,{children:s.endDate}),e.jsx(d,{children:e.jsx("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${s.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.isActive?"Yes":"No"})}),e.jsx(d,{children:e.jsx("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${s.isGroupable?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.isGroupable?"Yes":"No"})}),e.jsx(d,{children:e.jsx("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${s.isForNewUsers?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.isForNewUsers?"Yes":"No"})}),e.jsx(d,{children:e.jsx("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${s.isForAllUsers?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.isForAllUsers?"Yes":"No"})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-1",children:s.discounts?.map((l,t)=>e.jsxs("div",{className:"text-xs",children:[l.name,": ",l.flatrate?"â‚¹":"",l.discount,l.flatrate?" Flat":"%"]},t))})}),e.jsx(d,{children:e.jsx("div",{className:"text-sm",children:s.products?.length===Y.length?"All":s.products?.map(l=>l.name).join(", ")})}),e.jsx(d,{children:e.jsx("div",{className:"text-sm",children:s.isForAllUsers?"All":s.users?.map(l=>l.name).join(", ")})})]},s.id))})]})})})})]}),e.jsx(Me,{})]})};export{ms as default};

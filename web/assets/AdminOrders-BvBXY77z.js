import{a as e,j as s}from"./vendor-animation-CcgChT4Y.js";import{A as t}from"./AdminNavBar--NFVZBTP.js";import{C as r}from"./dropdown-menu-DjLdUzkQ.js";import{O as a}from"./OrdersTable-RSnglsfB.js";import{B as d,c as n,s as l,a as o,u as i,A as c,e as u}from"./index-QkJ4t2go.js";import{C as m}from"./calendar-D3_6b9UR.js";import{D as h,a as p,b as x,c as j}from"./dialog-B1BfGlYi.js";import{I as v}from"./input-hHw7iIA9.js";import{L as y}from"./label-CdSwSrYM.js";import{P as g,a as N,b as f}from"./popover-8ziMr3tt.js";import{S as b,a as C,b as S,c as P,d as D}from"./select-BywG2TtB.js";import{T as I}from"./textarea-Dez3uDdp.js";import{B as w}from"./badge-DjmmXEHi.js";import{G as A,X as O,h as k,P as F,L,A as M,Q as E,F as T,f as q}from"./vendor-icons-BYe_-sqm.js";import{f as R}from"./vendor-dates-BQQoqOpn.js";import{Q as $}from"./vendor-qr-B-w8k581.js";import{C as U,a as z,b as V,c as B}from"./card-CZoDjOMW.js";import"./TopBar-CO3pAy7f.js";import"./vendor-radix-CgisZDtL.js";import"./vendor-charts-1c3qO8Q0.js";import"./vendor-ui-utils-B4kPJlQS.js";import"./table-18gPuSSS.js";import"./vendor-pdf-export-F3dE0gEs.js";const Q=({coupons:t,customCoupon:r,setCustomCoupon:a,appliedCoupon:o,setAppliedCoupon:i,setTotalDiscount:c,setShippingDiscount:u,formData:m,newProducts:h=[],isLoading:p=!1})=>{const[x,j]=e.useState(""),g=(m.products?.reduce((e,s)=>e+s.productTotal,0)||0)+h.filter(e=>e.product&&e.quantity>0).reduce((e,s)=>e+s.total,0),N=e=>{let s=0,t=0;const r=(e=>{const s=[],t=new Set(e.products.map(e=>e.name));return m.products?.forEach(e=>{t.has(e.productName)&&s.push({name:e.productName,quantity:e.quantity,total:e.productTotal,price:e.price})}),h.filter(e=>e.product&&e.quantity>0).forEach(e=>{t.has(e.product.name)&&s.push({name:e.name,quantity:e.quantity,total:e.total,price:e.priceList?.unitprice||0})}),s})(e);if(0===r.length)return c(0),u(0),n.error("Coupon not applicable to selected products"),i(null),j(""),void a("");const d=(e=>e.reduce((e,s)=>e+s.quantity,0))(r),l=(e=>e.reduce((e,s)=>e+s.total,0))(r);e.discounts.forEach(e=>{const r=e.name.toLowerCase().includes("shipping");if(e.flatrate)r?t+=e.discount*d:s+=e.discount*d;else if(r){const s=g<999?99*e.discount/100:0;t+=s}else{const t=l*e.discount/100;s+=t}}),c(s),u(t),j(e.code),i(e)};return e.useEffect(()=>{j(r);const e=t.find(e=>e.code.toLowerCase()===r.toLowerCase());e&&N(e)},[t]),s.jsxs("div",{className:"space-y-4",children:[o&&s.jsxs("div",{className:"border border-green-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(A,{className:"h-4 w-4 text-green-600"}),s.jsx("span",{className:"font-medium text-green-800",children:"Applied Coupon:"}),s.jsx(w,{variant:"secondary",children:o.code})]}),s.jsx(d,{variant:"ghost",size:"sm",onClick:()=>{i(null),a(""),c(0),u(0),j("")},children:s.jsx(O,{className:"h-4 w-4"})})]}),s.jsx("div",{className:"mt-2 text-sm text-green-700",children:o.discounts.map((e,t)=>s.jsx("div",{children:e.flatrate?`₹${e.discount} off ${e.name}`:`${e.discount}% off ${e.name}`},t))})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx(y,{htmlFor:"customCoupon",children:"Enter Coupon Code"}),s.jsx(v,{id:"customCoupon",value:x,onChange:e=>j(e.target.value.toUpperCase()),placeholder:"Enter coupon code...",disabled:!!o})]}),s.jsx("div",{className:"flex items-end",children:s.jsx(d,{onClick:()=>{if(!x.trim())return;const e=t.find(e=>e.code.toLowerCase()===x.toLowerCase()&&(e=>{if(!e.isActive)return!1;const s=new Date,t=new Date(e.startDate.split("/").reverse().join("-")),r=new Date(e.endDate.split("/").reverse().join("-"));if(s<t||s>r)return!1;if(e.products.length>0){const s=new Set(e.products.map(e=>e.name));if(![...m.products?.map(e=>e.productName)??[],...h?.map(e=>e.name)??[]].some(e=>s.has(e)))return!1}if(!e.isForAllUsers&&e.users.length>0&&m.userId&&!e.users.some(e=>e.id===l(m.userId)))return!1;return!0})(e));e?N(e):n.error("Invalid Coupon Code"),a("")},disabled:!x.trim()||!!o,children:"Apply"})})]}),p?s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{children:"Available Coupons"}),s.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),"Loading coupons..."]})]}):t.length>0&&!o?s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{children:"Available Coupons"}),s.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:t.map(e=>s.jsx("div",{className:"border rounded-lg p-3 hover:bg-muted/20 cursor-pointer",onClick:()=>N(e),children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(w,{variant:"outline",children:e.code})}),s.jsx("div",{className:"mt-1 text-sm",children:e.discounts.map((e,t)=>s.jsxs("div",{children:[e.name," - ",e.flatrate?`₹${e.discount} off`:`${e.discount}% off`]},t))}),e.products.length>0&&s.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Valid for ",e.products.map(e=>e.name).join(", ")]}),!e.isForAllUsers&&e.users.length>0&&s.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Valid for ",e.users.map(e=>e.name).join(", ")]}),e.isForAllUsers&&s.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Valid for All Users"}),e.isForNewUsers&&s.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Valid for New Users"})]}),s.jsx(d,{variant:"outline",size:"sm",children:"Apply"})]})},e.id))})]}):p||0!==t.length||o?null:s.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"No available coupons for this order"})]})},H=({newProducts:e,setNewProducts:t,existingProducts:r,onRemoveExistingProduct:a,categories:n,products:l,onCategoryChange:o,onProductChange:i,onPricelistChange:c,onQuantityChange:u,onRemoveNewProduct:m,effectiveTheme:h})=>{const p=e=>{if(!l||0===l.length)return[];return l.filter(s=>(s.categoryId||s.categoryid||s.CategoryId)===e)},x=e=>e?.PriceLists||[];return s.jsxs("div",{className:"space-y-4",children:[r&&r.length>0&&s.jsxs("div",{className:"space-y-3",children:[s.jsx(y,{className:"text-base font-medium",children:"Current Products"}),s.jsx("div",{className:"space-y-2",children:r.map((e,t)=>s.jsx("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:e.productName}),s.jsx("p",{className:"text-sm text-muted-foreground",children:e.categoryName}),s.jsxs("p",{className:"text-sm",children:["Qty: ",e.quantity," × ₹",e.price," = ₹",e.productTotal]})]}),!h.includes("admin")&&s.jsx(d,{variant:"ghost",size:"sm",onClick:()=>a(t),children:s.jsx(k,{className:"h-4 w-4"})})]})})},t))})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(y,{className:"text-base font-medium",children:"Add Products"}),s.jsxs(d,{onClick:()=>{t([...e,{quantity:1,total:0,categoryId:0,productId:0,priceListId:0}])},variant:"outline",size:"sm",children:[s.jsx(F,{className:"h-4 w-4 mr-1"}),"Add Product"]})]}),e.map((e,t)=>s.jsxs("div",{className:"p-4 border rounded-lg space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{children:"Category"}),s.jsxs(b,{value:e.categoryId?.toString()||"",onValueChange:e=>{const s=n.find(s=>s.id.toString()===e);o(t,s)},children:[s.jsx(C,{children:s.jsx(S,{placeholder:"Select Category"})}),s.jsx(P,{children:n.map(e=>s.jsx(D,{value:e.id.toString(),children:e.category},e.id))})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{children:"Product"}),s.jsxs(b,{value:e.productId?.toString()||"",onValueChange:s=>{const r=p(e.categoryId||0).find(e=>e.id.toString()===s);i(t,r)},disabled:!e.categoryId||0===l.length,children:[s.jsx(C,{className:"w-48",children:s.jsx(S,{placeholder:e.categoryId?0===l.length?"Loading Products...":"Select Product":"Select Category First"})}),s.jsx(P,{children:e.categoryId?p(e.categoryId||0).length>0?p(e.categoryId||0).map(e=>s.jsx(D,{value:e.id.toString(),children:e.name},e.id)):s.jsx(D,{value:"no-products",disabled:!0,children:"No products found for this category"}):s.jsx(D,{value:"select-category",disabled:!0,children:"Select a category first"})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{children:"Price List"}),s.jsxs(b,{value:e.priceListId?.toString()||"",onValueChange:s=>{const r=x(e.product).find(e=>e.id.toString()===s);c(t,r)},disabled:!e.product,children:[s.jsx(C,{children:s.jsx(S,{placeholder:"Select Price"})}),s.jsx(P,{children:x(e.product).map(e=>s.jsxs(D,{value:e.id.toString(),children:[e.weight," - ₹",e.unitprice]},e.id))})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{children:"Quantity"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(v,{type:"number",min:"1",value:e.quantity,onChange:e=>u(t,parseInt(e.target.value)||1),className:"w-30"}),s.jsx(d,{variant:"ghost",size:"sm",onClick:()=>m(t),className:"px-2",children:s.jsx(k,{className:"h-4 w-4"})})]})]})]}),e.total>0&&s.jsxs("div",{className:"flex justify-between items-center pt-2 border-t",children:[s.jsx("span",{className:"font-medium",children:"Product Total:"}),s.jsxs("span",{className:"font-semibold",children:["₹",e.total.toFixed(2)]})]})]},t)),0===e.length&&s.jsx("div",{className:"text-center py-8 text-muted-foreground",children:'No products added. Click "Add Product" to add products to this order.'})]})]})},G=({isOpen:t,onClose:r,isCreateMode:a,editingOrder:n,users:l,userAddresses:i,isLoadingAddresses:c,isLoadingCoupons:u,onSaveOrder:w,isSaving:A,setIsSaving:O,formData:k,setFormData:F,errors:M,newProducts:E,setNewProducts:T,categories:q,products:$,coupons:U,selectedUser:z,setSelectedUser:V,selectedAddress:B,setSelectedAddress:G,customCoupon:J,setCustomCoupon:W,appliedCoupon:Y,setAppliedCoupon:K,totalDiscount:X,setTotalDiscount:Z,shippingDiscount:_,setShippingDiscount:ee,onCategoryChange:se,onProductChange:te,onPricelistChange:re,onQuantityChange:ae,onRemoveNewProduct:de,onRemoveExistingProduct:ne,effectiveTheme:le})=>{const[oe,ie]=e.useState(!1),[ce,ue]=e.useState(!1),me=e=>{let s=e.replace(/[^\d+\s]/g,"");if(!s.startsWith("+"))return s.replace(/\D/g,"").slice(0,10);{const e=s.match(/^(\+\d{0,2})(\s?)(\d{0,10})/);if(e){const s=e[1],t=e[2],r=e[3];return s+(t||(r.length>0?" ":""))+r}}return s.slice(0,15)},he=(k.products?.reduce((e,s)=>e+s.productTotal,0)||0)+E.filter(e=>e.product&&e.quantity>0).reduce((e,s)=>e+s.total,0),pe=he<999&&"Home Delivery"===k.shippingMethod,xe=pe?99-_:0,je=he-X+xe;return s.jsx(h,{open:t,onOpenChange:r,children:s.jsxs(p,{className:"max-w-4xl max-h-screen mt-4 mb-4 overflow-y-auto",children:[s.jsx(x,{children:s.jsx(j,{children:a?"Create Order":"Edit Order"})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"user",children:"User"}),s.jsxs(b,{value:"new-customer"===z?.value?z.value:z?.value?.id?.toString()||"",onValueChange:e=>{if("new-customer"===e)V({value:"new-customer",label:"New Customer"});else{const s=l.find(s=>s.id.toString()===e);s&&(V({value:s,label:`${s.name} (${s.phone})`}),F({...k,customerName:s.name,customerPhone:s.phone,customerEmail:s.email}))}},children:[s.jsx(C,{className:M.userId?"border-red-500":"",children:s.jsx(S,{placeholder:"Select User"})}),s.jsxs(P,{children:[s.jsx(D,{value:"new-customer",children:"New Customer"}),l?.map(e=>s.jsxs(D,{value:e.id.toString(),children:[e.name," (",e.phone,")"]},e.id))]})]}),M.userId&&s.jsx("p",{className:"text-sm text-red-500",children:M.userId})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"address",children:"User Address"}),s.jsxs(b,{value:B?.value?.toString()||"",onValueChange:e=>{if("new-address"===e)G({value:"new-address",label:"New Address"}),F({...k,deliveryName:"",addressLine1:"",city:"",state:"",country:"",pincode:"",deliveryPhone:""});else{const s=i.find(s=>s.id.toString()===e);G(s?{value:s.id,label:`${s.name} - ${s.addressLine1}, ${s.city}`}:null),s&&F({...k,customerName:z?.value?.name||"",customerPhone:z?.value?.phone||"",customerEmail:z?.value?.email||"",deliveryName:s.name,addressLine1:s.addressLine1,city:s.city,state:s.state,country:s.country,pincode:s.pincode,deliveryPhone:s.phone})}},disabled:c,children:[s.jsx(C,{className:M.addressLine1?"border-red-500":"",children:s.jsx(S,{placeholder:c?"Loading addresses...":"Select Address"})}),s.jsxs(P,{children:[s.jsx(D,{value:"new-address",children:"New Address"}),i?.map(e=>s.jsxs(D,{value:e.id.toString(),children:[e.name," - ",e.addressLine1,", ",e.city]},e.id))]})]}),M.addressLine1&&s.jsx("p",{className:"text-sm text-red-500",children:M.addressLine1})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"customerName",children:"Customer Name"}),s.jsx(v,{id:"customerName",value:k.customerName||"",onChange:e=>F({...k,customerName:e.target.value}),className:M.customerName?"border-red-500":""}),M.customerName&&s.jsx("p",{className:"text-sm text-red-500",children:M.customerName})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"customerPhone",children:"Customer Phone"}),s.jsx(v,{id:"customerPhone",value:k.customerPhone||"",onChange:e=>{const s=me(e.target.value);F({...k,customerPhone:s})},className:M.customerPhone?"border-red-500":""}),M.customerPhone&&s.jsx("p",{className:"text-sm text-red-500",children:M.customerPhone})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"customerEmail",children:"Customer Email"}),s.jsx(v,{id:"customerEmail",type:"email",value:k.customerEmail||"",onChange:e=>F({...k,customerEmail:e.target.value}),className:M.customerEmail?"border-red-500":""}),M.customerEmail&&s.jsx("p",{className:"text-sm text-red-500",children:M.customerEmail})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{children:"Order Date"}),s.jsxs(g,{open:oe,onOpenChange:ie,children:[s.jsx(N,{asChild:!0,children:s.jsx(d,{variant:"outline",className:o("w-full justify-start text-left font-normal",!k.orderDate&&"text-muted-foreground",M.orderDate&&"border-red-500"),children:k.orderDate?R(k.orderDate,"dd/MM/yyyy"):"Select date"})}),s.jsx(f,{className:"w-auto p-0",align:"start",children:s.jsx(m,{mode:"single",selected:k.orderDate,onSelect:e=>{F({...k,orderDate:e}),ie(!1)},autoFocus:!0})})]}),M.orderDate&&s.jsx("p",{className:"text-sm text-red-500",children:M.orderDate})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{children:"Expected Delivery Date"}),s.jsxs(g,{open:ce,onOpenChange:ue,children:[s.jsx(N,{asChild:!0,children:s.jsx(d,{variant:"outline",className:o("w-full justify-start text-left font-normal",!k.expectedDeliveryDate&&"text-muted-foreground",M.expectedDeliveryDate&&"border-red-500"),children:k.expectedDeliveryDate?R(k.expectedDeliveryDate,"dd/MM/yyyy"):"Select date"})}),s.jsx(f,{className:"w-auto p-0",align:"start",children:s.jsx(m,{mode:"single",selected:k.expectedDeliveryDate,onSelect:e=>{F({...k,expectedDeliveryDate:e}),ue(!1)},autoFocus:!0})})]}),M.expectedDeliveryDate&&s.jsx("p",{className:"text-sm text-red-500",children:M.expectedDeliveryDate})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"orderStatus",children:"Order Status"}),s.jsxs(b,{value:k.orderStatus||"",onValueChange:e=>F({...k,orderStatus:e}),children:[s.jsx(C,{className:M.orderStatus?"border-red-500":"",children:s.jsx(S,{placeholder:"Select Order Status"})}),s.jsxs(P,{children:[s.jsx(D,{value:"Ordered",children:"Ordered"}),s.jsx(D,{value:"Payment Processed",children:"Payment Processed"}),s.jsx(D,{value:"Processing",children:"Processing"}),s.jsx(D,{value:"Packed",children:"Packed"}),s.jsx(D,{value:"Shipped",children:"Shipped"}),s.jsx(D,{value:"Delivered",children:"Delivered"}),s.jsx(D,{value:"Cancelled",children:"Cancelled"})]})]}),M.orderStatus&&s.jsx("p",{className:"text-sm text-red-500",children:M.orderStatus})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"shippingMethod",children:"Shipping Method"}),s.jsxs(b,{value:k.shippingMethod||"",onValueChange:e=>F({...k,shippingMethod:e}),children:[s.jsx(C,{className:M.shippingMethod?"border-red-500":"",children:s.jsx(S,{placeholder:"Select Shipping Method"})}),s.jsxs(P,{children:[s.jsx(D,{value:"Home Delivery",children:"Home Delivery"}),s.jsx(D,{value:"Free Store Pickup",children:"Free Store Pickup"})]})]}),M.shippingMethod&&s.jsx("p",{className:"text-sm text-red-500",children:M.shippingMethod})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"paymentMethod",children:"Payment Method"}),s.jsxs(b,{value:k.paymentMethod||"",onValueChange:e=>F({...k,paymentMethod:e}),children:[s.jsx(C,{className:M.paymentMethod?"border-red-500":"",children:s.jsx(S,{placeholder:"Select Payment Method"})}),s.jsxs(P,{children:[s.jsx(D,{value:"UPI",children:"UPI"}),s.jsx(D,{value:"Cash on Delivery",children:"Cash on Delivery"}),s.jsx(D,{value:"Direct Bank Transfer",children:"Direct Bank Transfer"})]})]}),M.paymentMethod&&s.jsx("p",{className:"text-sm text-red-500",children:M.paymentMethod})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"deliveryName",children:"Delivery Name"}),s.jsx(v,{id:"deliveryName",value:k.deliveryName||"",onChange:e=>F({...k,deliveryName:e.target.value}),className:M.deliveryName?"border-red-500":""}),M.deliveryName&&s.jsx("p",{className:"text-sm text-red-500",children:M.deliveryName})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"deliveryPhone",children:"Delivery Phone"}),s.jsx(v,{id:"deliveryPhone",value:k.deliveryPhone||"",onChange:e=>{const s=me(e.target.value);F({...k,deliveryPhone:s})},className:M.deliveryPhone?"border-red-500":""}),M.deliveryPhone&&s.jsx("p",{className:"text-sm text-red-500",children:M.deliveryPhone})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"addressLine1",children:"Address Line 1"}),s.jsx(v,{id:"addressLine1",value:k.addressLine1||"",onChange:e=>F({...k,addressLine1:e.target.value}),className:M.addressLine1?"border-red-500":""}),M.addressLine1&&s.jsx("p",{className:"text-sm text-red-500",children:M.addressLine1})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"city",children:"City"}),s.jsx(v,{id:"city",value:k.city||"",onChange:e=>F({...k,city:e.target.value}),className:M.city?"border-red-500":""}),M.city&&s.jsx("p",{className:"text-sm text-red-500",children:M.city})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"state",children:"State"}),s.jsx(v,{id:"state",value:k.state||"",onChange:e=>F({...k,state:e.target.value}),className:M.state?"border-red-500":""}),M.state&&s.jsx("p",{className:"text-sm text-red-500",children:M.state})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"country",children:"Country"}),s.jsx(v,{id:"country",value:k.country||"",onChange:e=>F({...k,country:e.target.value}),className:M.country?"border-red-500":""}),M.country&&s.jsx("p",{className:"text-sm text-red-500",children:M.country})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"pincode",children:"Pincode"}),s.jsx(v,{id:"pincode",value:k.pincode||"",onChange:e=>{const s=e.target.value.replace(/[^\d]/g,"").slice(0,6);F({...k,pincode:s})},className:M.pincode?"border-red-500":""}),M.pincode&&s.jsx("p",{className:"text-sm text-red-500",children:M.pincode})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h4",{className:"text-lg font-medium",children:"Products"}),M.products&&s.jsx("p",{className:"text-sm text-red-500",children:M.products})]}),s.jsx(H,{newProducts:E,setNewProducts:T,existingProducts:k.products||[],onRemoveExistingProduct:ne,categories:q,products:$,onCategoryChange:se,onProductChange:te,onPricelistChange:re,onQuantityChange:ae,onRemoveNewProduct:de,effectiveTheme:le}),s.jsx("div",{className:"bg-muted/20 p-4 rounded-lg",children:s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Subtotal:"}),s.jsxs("span",{children:["₹",he.toFixed(2)]})]}),X>0&&s.jsxs("div",{className:"flex justify-between text-destructive",children:[s.jsx("span",{children:"Discount:"}),s.jsxs("span",{children:["-₹",X.toFixed(2)]})]}),pe&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Shipping:"}),s.jsxs("span",{children:["₹",xe.toFixed(2)]})]}),s.jsxs("div",{className:"flex justify-between font-semibold text-lg border-t pt-2",children:[s.jsx("span",{children:"Order Total:"}),s.jsxs("span",{children:["₹",je.toFixed(2)]})]})]})})]}),s.jsx(Q,{coupons:U,customCoupon:J,setCustomCoupon:W,appliedCoupon:Y,setAppliedCoupon:K,setTotalDiscount:Z,setShippingDiscount:ee,formData:k,newProducts:E,isLoading:u}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"notes",children:"Order Notes"}),s.jsx(I,{id:"notes",value:k.notes||"",onChange:e=>F({...k,notes:e.target.value}),placeholder:"Enter any additional notes for the order...",rows:3})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"deliveryNote",children:"Delivery Note"}),s.jsx(I,{id:"deliveryNote",value:k.deliveryNote||"",onChange:e=>F({...k,deliveryNote:e.target.value}),placeholder:"Enter delivery note...",rows:3,className:M.deliveryNote?"border-red-500":""}),M.deliveryNote&&s.jsx("p",{className:"text-sm text-red-500",children:M.deliveryNote})]})]})]}),s.jsxs("div",{className:"flex justify-end space-x-2 pt-4 border-t",children:[s.jsx(d,{variant:"outline",onClick:r,disabled:A(),children:"Close"}),s.jsx(d,{onClick:()=>{O(!0),w()},disabled:A(),children:A()?s.jsxs(s.Fragment,{children:[s.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):a?"Create Order":"Save Changes"})]})]})})},J=({isOpen:t,onClose:r,orderId:a,orderTotal:n,customerName:l,currentOrderStatus:o,onRefund:i,isRefunding:c})=>{const[u,m]=e.useState(n.toString()),[g,N]=e.useState(""),[f,w]=e.useState(""),[A,O]=e.useState(""),[k,F]=e.useState(o||"Pending"),[E,T]=e.useState({amount:!1,reason:!1,method:!1}),q=e=>{m((n*e/100).toFixed(2))},R=()=>{const e=parseFloat(u);return e>0&&e<=n};return e.useEffect(()=>{m(n.toString())},[n]),e.useEffect(()=>{t||(m(n.toString()),N(""),w(""),O(""),F(o||"Pending"),T({amount:!1,reason:!1,method:!1}))},[t,n,o]),s.jsx(h,{open:t,onOpenChange:r,children:s.jsxs(p,{className:"max-w-md",children:[s.jsx(x,{children:s.jsxs(j,{className:"flex items-center gap-2",children:[s.jsx(M,{className:"h-5 w-5"}),"Process Refund - Order #",a]})}),s.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!g||!f)return;const s={orderId:a,amount:parseFloat(u),reason:g,refundMethod:f,notes:A,orderStatus:k};i(s)},className:"space-y-4",children:[s.jsxs("div",{className:"bg-muted/20 p-4 rounded-lg",children:[s.jsx("h4",{className:"font-medium mb-2",children:"Order Summary"}),s.jsxs("div",{className:"space-y-1 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Order ID:"}),s.jsxs("span",{className:"font-medium",children:["#",a]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Customer:"}),s.jsx("span",{className:"font-medium",children:l})]}),s.jsxs("div",{className:"flex justify-between font-semibold",children:[s.jsx("span",{children:"Total Amount:"}),s.jsxs("span",{children:["₹",n.toFixed(2)]})]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{children:"Quick Refund Options"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(d,{type:"button",variant:"outline",size:"sm",onClick:()=>{m(n.toString())},className:"flex-1",children:"Full Refund"}),s.jsx(d,{type:"button",variant:"outline",size:"sm",onClick:()=>q(50),className:"flex-1",children:"50%"}),s.jsx(d,{type:"button",variant:"outline",size:"sm",onClick:()=>q(25),className:"flex-1",children:"25%"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"refundAmount",children:"Refund Amount (₹) *"}),s.jsx(v,{id:"refundAmount",type:"number",min:"0",max:n,step:"0.01",value:u,onChange:e=>m(e.target.value),onBlur:()=>T(e=>({...e,amount:!0})),placeholder:"Enter refund amount",className:!R()&&u&&E.amount?"border-red-500":""}),!R()&&u&&E.amount&&s.jsxs("p",{className:"text-sm text-red-500",children:["Amount must be between ₹0 and ₹",n.toFixed(2)]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"refundReason",children:"Refund Reason *"}),s.jsxs(b,{value:g,onValueChange:e=>{N(e),T(e=>({...e,reason:!0}))},children:[s.jsx(C,{className:!g&&E.reason?"border-red-500":"",children:s.jsx(S,{placeholder:"Select reason for refund"})}),s.jsx(P,{children:["Customer request","Product damaged","Product not as described","Wrong item delivered","Delivery failure","Quality issues","Order cancellation","Duplicate order","Payment error","Other"].map(e=>s.jsx(D,{value:e,children:e},e))})]}),!g&&E.reason&&s.jsx("p",{className:"text-sm text-red-500",children:"Please select a reason"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"refundMethod",children:"Refund Method *"}),s.jsxs(b,{value:f,onValueChange:e=>{w(e),T(e=>({...e,method:!0}))},children:[s.jsx(C,{className:!f&&E.method?"border-red-500":"",children:s.jsx(S,{placeholder:"Select refund method"})}),s.jsx(P,{children:["Original payment method","Bank transfer","Cash refund"].map(e=>s.jsx(D,{value:e,children:e},e))})]}),!f&&E.method&&s.jsx("p",{className:"text-sm text-red-500",children:"Please select a refund method"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"refundNotes",children:"Additional Notes"}),s.jsx(I,{id:"refundNotes",value:A,onChange:e=>O(e.target.value),placeholder:"Enter any additional notes about the refund...",rows:3})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"refundOrderStatus",children:"Order Status After Refund"}),s.jsxs(b,{value:k,onValueChange:F,children:[s.jsx(C,{children:s.jsx(S,{placeholder:"Select order status"})}),s.jsxs(P,{children:[s.jsx(D,{value:"Ordered",children:"Ordered"}),s.jsx(D,{value:"Payment Processed",children:"Payment Processed"}),s.jsx(D,{value:"Processing",children:"Processing"}),s.jsx(D,{value:"Packed",children:"Packed"}),s.jsx(D,{value:"Shipped",children:"Shipped"}),s.jsx(D,{value:"Delivered",children:"Delivered"}),s.jsx(D,{value:"Cancelled",children:"Cancelled"})]})]})]}),s.jsxs("div",{className:"flex justify-end space-x-2 pt-4 border-t",children:[s.jsx(d,{type:"button",variant:"outline",onClick:r,disabled:c,children:"Cancel"}),s.jsx(d,{type:"submit",disabled:c||!R()||!g||!f,variant:"destructive",children:c?s.jsxs(s.Fragment,{children:[s.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing Refund..."]}):`Process Refund of ₹${parseFloat(u||"0").toFixed(2)}`})]})]})]})})},W=({isOpen:e,onClose:t,onPaymentSuccess:r,orderId:a,orderTotal:n,customerName:l,customerPhone:o})=>{const i=(()=>{const e=`Order #${a}`;return`upi://pay?pa=renugarenuga36-1@okhdfcbank&pn=${encodeURIComponent("Renus Home Foods")}&am=${n}&cu=INR&tn=${encodeURIComponent(e)}`})();return s.jsx(h,{open:e,onOpenChange:t,children:s.jsxs(p,{className:"max-w-md max-h-screen mt-4 mb-4 flex flex-col p-0",children:[s.jsx(x,{className:"sticky top-0 bg-background z-10 px-6 py-4 border-b",children:s.jsxs(j,{className:"flex items-center gap-2",children:[s.jsx(E,{className:"h-5 w-5"}),"UPI Payment - Order #",a]})}),s.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-6",children:[s.jsxs("div",{className:"bg-muted/20 p-4 rounded-lg",children:[s.jsx("h4",{className:"font-medium mb-2",children:"Order Details"}),s.jsxs("div",{className:"space-y-1 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Order ID:"}),s.jsxs("span",{className:"font-medium",children:["#",a]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Customer:"}),s.jsx("span",{className:"font-medium",children:l})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Phone:"}),s.jsx("span",{className:"font-medium",children:o})]}),s.jsxs("div",{className:"flex justify-between text-lg font-semibold border-t pt-2",children:[s.jsx("span",{children:"Total Amount:"}),s.jsxs("span",{children:["₹",n.toFixed(2)]})]})]})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("h4",{className:"font-medium mb-4",children:"Scan QR Code to Pay"}),s.jsx("div",{className:"flex justify-center mb-4",children:s.jsx("div",{className:"bg-background p-3 rounded-xl border border-border",children:s.jsx($,{value:i,size:180,qrStyle:"dots",eyeRadius:10,logoPaddingStyle:"circle",logoImage:"/img/logo.webp"})})}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Scan this QR code using any UPI app (PhonePe, Google Pay, Paytm, etc.)"})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("h4",{className:"font-medium",children:"Or pay manually:"}),s.jsx("div",{className:"bg-muted/20 p-3 rounded-lg",children:s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-sm text-muted-foreground",children:"UPI ID:"}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsx("code",{className:"flex-1 bg-background px-2 py-1 rounded text-sm",children:"renugarenuga36-1@okhdfcbank"}),s.jsx(d,{variant:"outline",size:"sm",onClick:()=>{navigator.clipboard.writeText("renugarenuga36-1@okhdfcbank").then(()=>{})},children:"Copy"})]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-sm text-muted-foreground",children:"Amount:"}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsxs("code",{className:"flex-1 bg-background px-2 py-1 rounded text-sm",children:["₹",n.toFixed(2)]}),s.jsx(d,{variant:"outline",size:"sm",onClick:()=>navigator.clipboard.writeText(n.toFixed(2)),children:"Copy"})]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-sm text-muted-foreground",children:"Reference:"}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsxs("code",{className:"flex-1 bg-background px-2 py-1 rounded text-sm",children:["Order #",a]}),s.jsx(d,{variant:"outline",size:"sm",onClick:()=>navigator.clipboard.writeText(`Order #${a}`),children:"Copy"})]})]})]})})]}),s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Payment Instructions:"}),s.jsxs("ol",{className:"text-sm text-blue-700 space-y-1 list-decimal list-inside",children:[s.jsx("li",{children:"Open your UPI app (PhonePe, Google Pay, Paytm, etc.)"}),s.jsx("li",{children:"Scan the QR code or use the UPI ID above"}),s.jsxs("li",{children:["Enter the exact amount: ₹",n.toFixed(2)]}),s.jsxs("li",{children:["Use reference: Order #",a]}),s.jsx("li",{children:"Complete the payment and share the transaction ID"})]})]})]}),s.jsxs("div",{className:"bg-background z-10 px-6 py-4 border-t flex justify-between",children:[s.jsx(d,{variant:"outline",onClick:t,children:"Close"}),s.jsx(d,{onClick:r,children:"Payment Completed"})]})]})})},Y=()=>{const{effectiveTheme:l}=i(),o=new Date,h=new Date(o.getFullYear(),o.getMonth(),1),p=o,[x,j]=e.useState({from:h,to:p}),{from:v,to:I}=x||{},[w,A]=e.useState("All"),[O,k]=e.useState("All"),[L,M]=e.useState("All"),[E,$]=e.useState("All"),[Q,H]=e.useState(!1),[Y,K]=e.useState([]),[X,Z]=e.useState([]),[_,ee]=e.useState([]),[se,te]=e.useState([]),[re,ae]=e.useState([]),[de,ne]=e.useState(!1),[le,oe]=e.useState(!1),[ie,ce]=e.useState([]),[ue,me]=e.useState(null),[he,pe]=e.useState(!1),[xe,je]=e.useState(!1),[ve,ye]=e.useState(null),[ge,Ne]=e.useState({userId:"",cartId:null,orderDate:new Date,orderStatus:"",shippingMethod:"",paymentMethod:"",expectedDeliveryDate:new Date,deliveryName:"",addressLine1:"",city:"",state:"",country:"",pincode:"",deliveryPhone:"",customerName:"",customerPhone:"",customerEmail:"",notes:"",deliveryNote:"",products:[]}),[fe,be]=e.useState({}),[Ce,Se]=e.useState([]),[Pe,De]=e.useState(null),[Ie,we]=e.useState(null),[Ae,Oe]=e.useState(""),[ke,Fe]=e.useState(null),[Le,Me]=e.useState(0),[Ee,Te]=e.useState(0),[qe,Re]=e.useState(!1),[$e,Ue]=e.useState(!1),[ze,Ve]=e.useState(!1),[Be,Qe]=e.useState({orderId:0,orderTotal:0,customerName:"",customerPhone:""}),[He,Ge]=e.useState({orderId:0,orderTotal:0,customerName:"",currentOrderStatus:""}),Je=[{value:"All",label:"All"},...Y.map(e=>({value:e.category,label:e.category}))],We=[{value:"All",label:"All"},...X.map(e=>({value:e.name,label:e.name}))],Ye=[{value:"All",label:"All"},..._.map(e=>({value:JSON.stringify(e),label:e.name+" ( "+e.phone+" )"}))];e.useEffect(()=>{c.postData({endpoint:"/inventory/get-categories",body:{request:u({type:"Product"})},successCallback:e=>{Array.isArray(e)?K(e):K([])},errorCallback:()=>{K([])}})},[]),e.useEffect(()=>{const e=localStorage.getItem("token");e&&c.get("/admin/user-list",{Authorization:`Bearer ${e}`}).then(e=>{Array.isArray(e?.users)?ee(e?.users||[]):ee([])}).catch(e=>{ee([])})},[]),e.useEffect(()=>{O&&"All"!==O?c.postData({endpoint:"/inventory/get-products",body:{request:u({category:O})},successCallback:e=>{Z(e||[])},errorCallback:()=>{Z([])}}):Z([])},[O]);e.useEffect(()=>{Y.length>0&&c.postData({endpoint:"/inventory/get-products",body:{request:u({})},successCallback:e=>{Z(s=>{const t=s.map(e=>e.id),r=(e||[]).filter(e=>!t.includes(e.id));return[...s,...r]})},errorCallback:e=>{}})},[Y.length]),e.useEffect(()=>{Pe&&Pe.value&&"new-customer"!==Pe.value&&Ze(Pe?.value?.id)},[Pe]),e.useEffect(()=>{he&&Xe()},[Pe,Ce,ge.products,ge.orderDate,he]);const Ke=()=>{const e=localStorage.getItem("token");if(!e)return;let s=null,t=null;if("All"!==E&&E)try{const e=E;s=e.name,t=e.phone}catch(a){}const r={fromDate:v?v.toISOString().split("T")[0]:null,toDate:I?I.toISOString().split("T")[0]:null,orderStatus:"All"!==w?w:null,category:"All"!==O?O:null,product:"All"!==L?L:null,name:s,phone:t};c.postData({endpoint:"/admin/fetch-orders",body:{request:u(r)},Authorization:`Bearer ${e}`,successCallback:e=>{if(ve?.orderId){const s=e.orders.find(e=>e.orderId===ve?.orderId);ye(s)}ce(e.orders||[])},errorCallback:e=>{}})},Xe=()=>{oe(!0);const e=[...ge.products?.map(e=>e.productId).filter(Boolean)||[],...Ce.filter(e=>e.product&&e.quantity>0).map(e=>e.productId).filter(Boolean)],s=Pe?.value?.id?[Pe.value.id]:[],t=ge.orderDate?ge.orderDate.toISOString().split("T")[0]:null,r={products:e,token:localStorage.getItem("token")||void 0,users:s,fromStartDate:t,fromEndDate:t};c.postData({endpoint:"/order/get-coupons",body:{request:u(r)},successCallback:e=>{let s=[];if(e&&e.coupons)s=e.coupons;else if(e&&e.response)try{s=JSON.parse(e.response).coupons||[]}catch(t){}ae(s||[]),oe(!1)},errorCallback:e=>{ae([]),oe(!1)}})},Ze=async e=>{if(!e)return te([]),void we(null);ne(!0);try{const s=localStorage.getItem("token");if(!s)return;await c.postData({endpoint:"/admin/user-addresses",body:{request:u({userId:e})},Authorization:`Bearer ${s}`,successCallback:e=>{const s=e?.addresses||[];if(te(s),s.length>0){const e=s.find(e=>e.isDefault)||s[0];we({value:e.id,label:`${e.name} - ${e.addressLine1}, ${e.city}`}),Ne({...ge,customerEmail:Pe?.value?.email||"",customerName:Pe?.value?.name||"",customerPhone:Pe?.value?.phone||"",deliveryName:e.name,addressLine1:e.addressLine1,city:e.city,state:e.state,country:e.country,pincode:e.pincode,deliveryPhone:e.phone})}else we(null),Ne({...ge,deliveryName:"",addressLine1:"",city:"",state:"",country:"",pincode:"",deliveryPhone:""})},errorCallback:e=>{te([]),we(null)}})}catch(s){te([]),we(null)}finally{ne(!1)}};e.useEffect(()=>{Ke()},[v,I,w,O,L,E]);const _e=()=>{Ne({userId:"",orderDate:new Date,orderStatus:"",shippingMethod:"",paymentMethod:"",expectedDeliveryDate:new Date,deliveryName:"",addressLine1:"",city:"",state:"",country:"",pincode:"",deliveryPhone:"",customerName:"",customerPhone:"",customerEmail:"",notes:"",deliveryNote:"",products:[]}),be({}),Se([]),De(null),we(null),Oe(""),Fe(null),Me(0),Te(0),ye(null),ae([])},es=e=>{if(e){je(!1),Se([]),ye(e),Fe(re.find(s=>s.code===e.couponCode)||null),Oe(e.couponCode||""),Ne({userId:e.userId.toString(),cartId:e.cartId,orderId:e.orderId,orderDate:new Date(e.orderDate),orderStatus:e.orderStatus,shippingMethod:e.shippingMethod,paymentMethod:e.paymentMethod,expectedDeliveryDate:new Date(e.expectedDeliveryDate),deliveryName:e.deliveryName,addressLine1:e.addressLine1,city:e.city,state:e.state,country:e.country,pincode:e.pincode,deliveryPhone:e.deliveryPhone,customerName:e.customerName,customerPhone:e.customerPhone,customerEmail:e.customerEmail,notes:e.notes||"",deliveryNote:e.deliveryNote||"",products:e.products});const s=_.find(s=>s.id===e.userId);De({value:s,label:`${s.name} (${s.phone})`})}else je(!0),_e();pe(!0)};return s.jsxs(s.Fragment,{children:[s.jsx(t,{}),s.jsxs("div",{className:"container mx-auto mt-6 p-6 min-h-screen",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Orders"}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs(d,{variant:"outline",onClick:()=>es(),className:"border-green-600 text-green-600 hover:text-primary",children:[s.jsx(F,{className:"w-4 h-4 mr-2"})," Create Order"]}),s.jsxs(d,{variant:"outline",onClick:()=>H(!Q),className:"border-green-600 text-green-600 hover:text-primary",children:[s.jsx(T,{className:"w-4 h-4 mr-2"})," Filters"]})]})]}),Q&&s.jsxs(U,{className:"mb-6",children:[s.jsx(z,{children:s.jsx(V,{children:"Filters"})}),s.jsx(B,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{children:"Date Range"}),s.jsxs(g,{children:[s.jsx(N,{asChild:!0,children:s.jsxs(d,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[s.jsx(q,{className:"mr-2 h-4 w-4"}),v&&I?`${R(v,"dd/MM/yyyy")} - ${R(I,"dd/MM/yyyy")}`:"Select date range"]})}),s.jsx(f,{className:"w-auto p-0",align:"start",children:s.jsx(m,{mode:"range",selected:x,onSelect:j,numberOfMonths:1,autoFocus:!0})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{children:"Order Status"}),s.jsxs(b,{value:w,onValueChange:A,children:[s.jsx(C,{children:s.jsx(S,{})}),s.jsx(P,{children:[{value:"All",label:"All"},{value:"Pending",label:"Pending"},{value:"Delivered",label:"Delivered"},{value:"Cancelled",label:"Cancelled"}].map(e=>s.jsx(D,{value:e.value,children:e.label},e.value))})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{children:"Category"}),s.jsxs(b,{value:O,onValueChange:k,children:[s.jsx(C,{children:s.jsx(S,{})}),s.jsx(P,{children:Je.map(e=>s.jsx(D,{value:e.value,children:e.label},e.value))})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{children:"Product"}),s.jsxs(b,{value:L,onValueChange:M,children:[s.jsx(C,{children:s.jsx(S,{})}),s.jsx(P,{children:We.map(e=>s.jsx(D,{value:e.value,children:e.label},e.value))})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{children:"User"}),s.jsxs(b,{value:E,onValueChange:$,children:[s.jsx(C,{children:s.jsx(S,{})}),s.jsx(P,{children:Ye.map(e=>s.jsx(D,{value:e.value,children:e.label},e.value))})]})]})]})})]}),s.jsx(a,{orders:ie,expandedOrderId:ue,setExpandedOrderId:me,viewType:"ManageOrders",onEditOrder:es}),s.jsx(G,{isOpen:he,onClose:()=>{pe(!1),_e()},isCreateMode:xe,editingOrder:ve,users:_,userAddresses:se,isLoadingAddresses:de,isLoadingCoupons:le,onSaveOrder:async()=>{try{const e={};if(ge.orderStatus||(e.orderStatus="Order status is required"),ge.shippingMethod||(e.shippingMethod="Shipping method is required"),ge.paymentMethod||(e.paymentMethod="Payment method is required"),ge.deliveryName||(e.deliveryName="Delivery name is required"),ge.addressLine1||(e.addressLine1="Address is required"),ge.city||(e.city="City is required"),ge.state||(e.state="State is required"),ge.country||(e.country="Country is required"),ge.pincode||(e.pincode="Pincode is required"),ge.deliveryPhone||(e.deliveryPhone="Delivery phone is required"),ge.customerName||(e.customerName="Customer name is required"),ge.customerPhone||(e.customerPhone="Customer phone is required"),ge.customerEmail||(e.customerEmail="Customer email is required"),0===ge.products.length&&0===Ce.filter(e=>e.product&&e.quantity>0).length&&(e.products="At least one product is required"),Object.keys(e).length>0)return void be(e);be({});const s={orderId:xe?void 0:ve?.orderId,userAddressId:!1===Boolean(Ie?.value)||"new-address"===Ie?.value?void 0:Ie?.value,cartId:ge.cartId,orderDate:ge.orderDate?ge.orderDate.toISOString().split("T")[0]:null,orderStatus:ge.orderStatus,shippingMethod:ge.shippingMethod,expectedDeliveryDate:ge.expectedDeliveryDate?ge.expectedDeliveryDate.toISOString().split("T")[0]:null,deliveryName:ge.deliveryName,addressLine1:ge.addressLine1,city:ge.city,state:ge.state,country:ge.country,pincode:ge.pincode,deliveryPhone:ge.deliveryPhone,customerName:ge.customerName,customerPhone:ge.customerPhone,customerEmail:ge.customerEmail,products:[...ge.products,...Ce.filter(e=>e.product&&e.quantity>0).map(e=>({quantity:e.quantity,productName:e.product.name,price:e.priceList.unitprice,categoryName:e.category.category,productTotal:e.priceList.unitprice*e.quantity,priceListId:e.priceListId,productDiscount:0}))],notes:ge.notes||"",deliveryNote:ge.deliveryNote||"",paymentMethod:ge.paymentMethod,couponId:ke?.id||null,userId:Pe?.value?.id||null,totalDiscount:Le,shippingDiscount:Ee},t=localStorage.getItem("token");if(!t)return n.error("Authentication token not found"),void Re(!1);c.postData({endpoint:"/admin/save-order",body:{request:u(s)},Authorization:`Bearer ${t}`,successCallback:e=>{Re(!1);const t=s.products.reduce((e,s)=>e+(s.productTotal||0),0),r=t<999&&"Home Delivery"===ge.shippingMethod?99:0,a=ve?(ve?.orderTotal||0)-ve?.productDiscount-ve?.shippingDiscount+r:0,d=t-Le-Ee+r,l=e?.orderId||ve?.orderId,o="UPI"===ge.paymentMethod,i=!xe&&d>a,c=!xe&&d<a,u=Math.abs(d-a);n.success(xe?"Order created successfully!":"Order updated successfully!"),pe(!1),Ke(),xe&&o?(Qe({orderId:l||0,orderTotal:d,customerName:ge.customerName,customerPhone:ge.customerPhone}),Ue(!0)):i&&o?(Qe({orderId:l||0,orderTotal:u,customerName:ge.customerName,customerPhone:ge.customerPhone}),Ue(!0)):c&&(Ge({orderId:l||0,orderTotal:Number(u.toFixed(2)),customerName:ge.customerName,currentOrderStatus:ge.orderStatus}),Ve(!0))},errorCallback:e=>{Re(!1),n.error(e?.error||e?.message||"Failed to save order")}})}catch(e){Re(!1),n.error("Failed to save order")}},setIsSaving:Re,isSaving:()=>qe,formData:ge,setFormData:Ne,errors:fe,newProducts:Ce,setNewProducts:Se,categories:Y,products:X,coupons:re,selectedUser:Pe,setSelectedUser:e=>{De(e),e&&e.value&&"new-customer"!==e.value?Ne({...ge,customerName:e.value.name,customerPhone:e.value.phone,customerEmail:e.value.email}):(te([]),we(null),e&&"new-customer"===e.value&&Ne({...ge,deliveryName:"",addressLine1:"",city:"",state:"",country:"",pincode:"",deliveryPhone:"",customerName:"",customerPhone:"",customerEmail:""}))},selectedAddress:Ie,setSelectedAddress:we,customCoupon:Ae,setCustomCoupon:Oe,appliedCoupon:ke,setAppliedCoupon:Fe,totalDiscount:Le,setTotalDiscount:Me,shippingDiscount:Ee,setShippingDiscount:Te,onCategoryChange:(e,s)=>{const t=[...Ce];t[e]={...t[e],category:s,categoryId:s?.id,product:null,productId:null,priceList:null,priceListId:null,total:0},Se(t)},onProductChange:(e,s)=>{const t=[...Ce];t[e]={...t[e],product:s,productId:s?.id,priceList:null,priceListId:null,total:t[e].quantity*(s?.priceLists?.[0]?.unitprice||0)},Se(t)},onPricelistChange:(e,s)=>{const t=[...Ce];t[e]={...t[e],priceList:s,priceListId:s?.id,total:t[e].quantity*(s?.unitprice||0)},Se(t)},onQuantityChange:(e,s)=>{const t=[...Ce];t[e]={...t[e],quantity:s,total:s*(t[e].priceList?.unitprice||0)},Se(t)},onRemoveNewProduct:e=>{Se(Ce.filter((s,t)=>t!==e))},onRemoveExistingProduct:e=>{Ne({...ge,products:ge.products.filter((s,t)=>t!==e)})},effectiveTheme:l}),s.jsx(W,{isOpen:$e,onClose:()=>Ue(!1),onPaymentSuccess:()=>{Ue(!1),n.success("Payment successful!")},orderId:Be.orderId,orderTotal:Be.orderTotal,customerName:Be.customerName,customerPhone:Be.customerPhone}),s.jsx(J,{isOpen:ze,onClose:()=>Ve(!1),orderId:He.orderId,orderTotal:He.orderTotal,customerName:He.customerName,currentOrderStatus:He.currentOrderStatus,onRefund:e=>{(e=>{let s=`The Order has been cancelled or modified and we have refunded ₹${e.amount.toFixed(2)} via ${e.refundMethod} because of ${e.reason}.`;e.notes&&e.notes.trim().length>0&&(s+=` Additional Notes: ${e.notes}`);const t={orderId:ve?.orderId||e.orderId,userAddressId:ve?.userAddressId||null,cartId:ve?.cartId||null,orderDate:ve?.orderDate?new Date(ve.orderDate).toISOString().split("T")[0]:null,orderStatus:e.orderStatus,shippingMethod:ve?.shippingMethod||"",expectedDeliveryDate:ve?.expectedDeliveryDate?new Date(ve.expectedDeliveryDate).toISOString().split("T")[0]:null,deliveryName:ve?.deliveryName||"",addressLine1:ve?.addressLine1||"",city:ve?.city||"",state:ve?.state||"",country:ve?.country||"",pincode:ve?.pincode||"",deliveryPhone:ve?.deliveryPhone||"",customerName:ve?.customerName||"",customerPhone:ve?.customerPhone||"",customerEmail:ve?.customerEmail||"",products:ve?.products||[],notes:ve?.notes||"",deliveryNote:s,paymentMethod:ve?.paymentMethod||"",couponId:ke?.id||null,userId:ve?.userId||null,totalDiscount:ve?.totalDiscount||0,shippingDiscount:ve?.shippingDiscount||0},r=localStorage.getItem("token");r?c.postData({endpoint:"/admin/save-order",body:{request:u(t)},Authorization:`Bearer ${r}`,successCallback:e=>{n.success("Refund processed successfully!"),Ve(!1),Ke()},errorCallback:e=>{n.error(e?.error||e?.message||"Failed to process refund")}}):n.error("Authentication token not found")})(e)},isRefunding:!1})]}),s.jsx(r,{})]})};export{Y as default};

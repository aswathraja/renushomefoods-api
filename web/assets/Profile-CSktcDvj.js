import{r as a,j as e,o as Se,L as S,p as ke,Z as ie,X as Ee,N as Ae}from"./vendor-react-Bv33ryjV.js";import{C as ce}from"./dropdown-menu-BDj5FxyU.js";import{T as me}from"./TopNav-JT08H0jt.js";import{b as ue,B as j,A as X,c as u,e as k}from"./index-BgzncNPj.js";import{C as _,a as H,b as J,c as Y}from"./card-dPuP1Ci1.js";import{I as c}from"./input-group-AlYMXmbe.js";import"./NavBar-BWSSAL5l.js";import"./TopBar-D2vj-zy0.js";import"./vendor-pdf-DxqLLkkN.js";import"./input-B6PrAciv.js";const xe=a.forwardRef(({className:o,value:i=0,max:A=100,variant:l="default",showPercentage:q=!1,...U},L)=>{const b=Math.min(Math.max(i/A*100,0),100),y={default:"bg-primary",success:"bg-green-500",warning:"bg-yellow-500",danger:"bg-red-500"};return e.jsxs("div",{ref:L,className:ue("relative h-2 w-full overflow-hidden rounded-full bg-secondary",o),...U,children:[e.jsx("div",{className:ue("h-full w-full flex-1 transition-all",y[l]),style:{transform:`translateX(-${100-b}%)`}}),q&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs font-medium text-primary-foreground",children:[Math.round(b),"%"]})})]})});xe.displayName="Progress";const E=[{label:"At least 8 characters",test:o=>o.length>=8},{label:"One uppercase letter",test:o=>/[A-Z]/.test(o)},{label:"One lowercase letter",test:o=>/[a-z]/.test(o)},{label:"One digit",test:o=>/\d/.test(o)},{label:"One special character",test:o=>/[@$!%*?&()[\]{}#^~<>+=_|\\/.,:;"'-]/.test(o)}],Te=()=>{const o=Se(),[i,A]=a.useState(null),[l,q]=a.useState(null),[U,L]=a.useState(!0),[b,y]=a.useState(""),[p,K]=a.useState(""),[N,Q]=a.useState(""),[B,he]=a.useState(E.map(()=>!1)),[D,W]=a.useState(!1),[ee,se]=a.useState(!1),[C,I]=a.useState(null),[v,re]=a.useState({}),[te,$]=a.useState(!1),[ae,F]=a.useState(!1),[ne,O]=a.useState(!1),[m,f]=a.useState({}),[n,x]=a.useState({}),[R,T]=a.useState(!1),[z,M]=a.useState(!1),[w,P]=a.useState({}),[h,V]=a.useState({}),G=()=>{const s=localStorage.getItem("token");s&&X.get("/user/details",{Authorization:`Bearer ${s}`}).then(r=>{A(r.user)}).catch(r=>{console.error("Error fetching user details:",r),u.error("Failed to load user details")})},Z=()=>{const s=localStorage.getItem("token");s&&X.postData({endpoint:"/user/default-address",body:{request:k({token:s})},successCallback:r=>{q(r)},errorCallback:r=>{console.error("Error fetching default address:",r)}})};a.useEffect(()=>{if(!localStorage.getItem("token")){o("/login");return}G(),Z(),L(!1)},[o]),a.useEffect(()=>{I(p&&N?p===N:null)},[p,N]);const ge=s=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&()[\]{}#^~<>+=_|\\/.,:;"'-])[A-Za-z\d@$!%*?&()[\]{}#^~<>+=_|\\/.,:;"'-]{8,}$/.test(s),le=()=>B.filter(Boolean).length,pe=()=>{const s=le();return s<=2?"danger":s<=4?"warning":"success"},fe=async s=>{s.preventDefault(),re({});const r={};if(b||(r.currentPassword="Current password is required"),ge(p)||(r.newPassword="Password must be at least 8 characters long and include a capital letter, a lowercase letter, a number, and a special character."),p!==N&&(r.confirmPassword="Passwords do not match"),Object.keys(r).length>0){re(r);return}$(!0);const t=localStorage.getItem("token");t&&X.postData({endpoint:"/user/change-password",body:{request:k({token:t,currentPassword:b,newPassword:p})},successCallback:oe=>{$(!1),u.success("Password changed successfully"),y(""),K(""),Q(""),W(!1),I(null)},errorCallback:oe=>{$(!1),u.error(oe?.error||"Failed to change password",{duration:5e3})}})},je=()=>{i&&(f({...i}),Object.keys(i).forEach(s=>{s in i&&g(s,String(i[s]||""))})),F(!0)},be=()=>{F(!1),f({}),P({}),G()},we=s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s),de=s=>/^(\+\d{1,3}\s?\d{10}|\+\d{12}|\d{10})$/.test(s),Ne=s=>/^\d{6}$/.test(s),g=(s,r)=>{const t={...w};switch(s){case"email":r&&!we(r)?t.email="Invalid email format":delete t.email;break;case"phone":r&&!de(r)?t.phone="Phone must be the format XXXXXXXXXX, +XX XXXXXXXXXX, or +XXXXXXXXXXXX":delete t.phone;break;default:!r||!r.trim()?t[s]="This field is required":delete t[s];break}P(t)},d=(s,r)=>{const t={...h};switch(s){case"phone":r&&!de(r)?t.phone="Phone must be the format XXXXXXXXXX, +XX XXXXXXXXXX, or +XXXXXXXXXXXX":delete t.phone;break;case"pincode":r&&!Ne(r)?t.pincode="Pincode must be exactly 6 digits":delete t.pincode;break;default:!r||!r.trim()?t[s]="This field is required":delete t[s];break}V(t)},ve=()=>{const s=localStorage.getItem("token");if(!s||!m.name||!m.username||!m.email||!m.phone){u.error("All fields are required");return}if(Object.keys(w).length>0){u.error("Please fix the errors before saving");return}T(!0),X.postData({endpoint:"/user/update",body:{request:k({token:s,...m})},successCallback:r=>{T(!1),u.success("User details updated successfully"),F(!1),f({}),P({}),G()},errorCallback:r=>{if(T(!1),r.email||r.phone||r.username)try{const t={};if(r.email&&(t.email=r.email),r.phone&&(t.phone=r.phone),r.username&&(t.username=r.username),Object.keys(t).length>0){P(t);return}}catch{}u.error("Failed to update user details")}})},Xe=()=>{l&&(x({...l}),Object.keys(l).forEach(s=>{s in l&&s!=="id"&&s!=="isDefault"&&d(s,String(l[s]||""))})),O(!0)},ye=()=>{O(!1),x({}),V({}),Z()},Ce=()=>{const s=localStorage.getItem("token");if(!s||!l||!n.name||!n.addressLine1||!n.city||!n.state||!n.country||!n.pincode||!n.phone){u.error("All fields are required");return}if(Object.keys(h).length>0){u.error("Please fix the errors before saving");return}M(!0),X.postData({endpoint:"/user/address",body:{request:k({token:s,addressId:l.id,...n})},successCallback:r=>{M(!1),u.success("Address updated successfully"),O(!1),x({}),V({}),Z()},errorCallback:r=>{M(!1);const t=r.error?JSON.parse(r.error).error:"Failed to update address";u.error(t)}})},Pe=()=>{const r=new Date().getHours();let t="Good Evening";return r>=5&&r<12?t="Good Morning":r>=12&&r<16&&(t="Good Afternoon"),`${t}${i?`, ${i.name}`:""}!`};return U?e.jsxs(e.Fragment,{children:[e.jsx(me,{}),e.jsx("div",{className:"container page-container flex justify-center items-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(S,{className:"h-8 w-8 animate-spin mx-auto text-primary"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading..."})]})}),e.jsx(ce,{})]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{}),e.jsxs("div",{className:"container min-h-screen mx-auto mt-8 px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(ke,{size:"50px",className:"text-primary"})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground mb-2",children:Pe()}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mb-4",children:"Manage your personal information and password"})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4 sm:gap-6 lg:gap-8",children:[e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs(_,{className:"w-full",children:[e.jsxs(H,{className:"flex flex-row items-center justify-between pb-3 sm:pb-4",children:[e.jsx(J,{className:"text-base sm:text-lg font-semibold",children:"User Details"}),!ae&&e.jsx(j,{variant:"outline",size:"sm",onClick:je,className:"text-green-600 border-green-600 hover:bg-green-50 h-8 sm:h-9 px-2 sm:px-3 text-xs sm:text-sm",children:"Edit"})]}),e.jsx(Y,{className:"pt-0",children:ae?e.jsxs("div",{className:"space-y-4",children:[e.jsx(c,{label:"Name",value:m.name||"",onChange:s=>{f({...m,name:s}),g("name",s)},onBlur:s=>g("name",s.target.value),required:!0,error:w.name}),e.jsx(c,{label:"Username",value:m.username||"",onChange:s=>{f({...m,username:s}),g("username",s)},onBlur:s=>g("username",s.target.value),required:!0,error:w.username}),e.jsx(c,{label:"Email",type:"email",value:m.email||"",onChange:s=>{const r=s.replace(/[^a-zA-Z0-9@._-]/g,"");f({...m,email:r}),g("email",r)},onBlur:s=>g("email",s.target.value),required:!0,error:w.email}),e.jsx(c,{label:"Phone",value:m.phone||"",onChange:s=>{const r=s.replace(/[^\d+\s]/g,"").slice(0,15);f({...m,phone:r}),g("phone",r)},onBlur:s=>g("phone",s.target.value),required:!0,error:w.phone}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(j,{variant:"outline",onClick:be,disabled:R,children:"Cancel"}),e.jsxs(j,{onClick:ve,disabled:R,children:[R&&e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}),"Save"]})]})]}):i?e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Name:"}),e.jsx("span",{className:"text-sm sm:text-base col-span-2 sm:col-span-3",children:i.name})]}),e.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Username:"}),e.jsx("span",{className:"text-sm sm:text-base col-span-2 sm:col-span-3",children:i.username})]}),e.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Email:"}),e.jsx("span",{className:"text-sm sm:text-base col-span-2 sm:col-span-3",children:i.email})]}),e.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Phone:"}),e.jsx("span",{className:"text-sm sm:text-base col-span-2 sm:col-span-3",children:i.phone})]})]}):e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Unable to load user details."})})]}),e.jsxs(_,{className:"w-full",children:[e.jsxs(H,{className:"flex flex-row items-center justify-between pb-3 sm:pb-4",children:[e.jsx(J,{className:"text-base sm:text-lg font-semibold",children:"Your Current Address Information"}),!ne&&l&&e.jsx(j,{variant:"outline",size:"sm",onClick:Xe,className:"text-green-600 border-green-600 hover:bg-green-50 h-8 sm:h-9 px-2 sm:px-3 text-xs sm:text-sm",children:"Edit"})]}),e.jsx(Y,{className:"pt-0",children:ne?e.jsxs("div",{className:"space-y-4",children:[e.jsx(c,{label:"Name",value:n.name||"",onChange:s=>{x({...n,name:s}),d("name",s)},onBlur:s=>d("name",s.target.value),required:!0,error:h.name}),e.jsx(c,{label:"Address",value:n.addressLine1||"",onChange:s=>{x({...n,addressLine1:s}),d("addressLine1",s)},onBlur:s=>d("addressLine1",s.target.value),required:!0,error:h.addressLine1}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(c,{label:"City",value:n.city||"",onChange:s=>{x({...n,city:s}),d("city",s)},onBlur:s=>d("city",s.target.value),required:!0,error:h.city}),e.jsx(c,{label:"State",value:n.state||"",onChange:s=>{x({...n,state:s}),d("state",s)},onBlur:s=>d("state",s.target.value),required:!0,error:h.state})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(c,{label:"Country",value:n.country||"",onChange:s=>{x({...n,country:s}),d("country",s)},onBlur:s=>d("country",s.target.value),required:!0,error:h.country}),e.jsx(c,{label:"Pincode",value:n.pincode||"",onChange:s=>{const r=s.replace(/\D/g,"").slice(0,6);x({...n,pincode:r}),d("pincode",r)},onBlur:s=>d("pincode",s.target.value),required:!0,error:h.pincode})]}),e.jsx(c,{label:"Phone",value:n.phone||"",onChange:s=>{const r=s.replace(/[^\d+\s]/g,"").slice(0,15);x({...n,phone:r}),d("phone",r)},onBlur:s=>d("phone",s.target.value),required:!0,error:h.phone}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(j,{variant:"outline",onClick:ye,disabled:z,children:"Cancel"}),e.jsxs(j,{onClick:Ce,disabled:z,children:[z&&e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}),"Save"]})]})]}):l?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Name:"})," ",l.name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Address:"})," ",l.addressLine1]}),e.jsxs("div",{children:[e.jsx("strong",{children:"City:"})," ",l.city]}),e.jsxs("div",{children:[e.jsx("strong",{children:"State:"})," ",l.state]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Country:"})," ",l.country]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Pincode:"})," ",l.pincode]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Phone:"})," ",l.phone]})]}):e.jsx("p",{className:"text-muted-foreground",children:"No default address set."})})]})]}),e.jsx("div",{children:e.jsxs(_,{children:[e.jsx(H,{children:e.jsx(J,{className:"text-lg font-semibold mt-2",children:"Change Password"})}),e.jsx(Y,{children:e.jsxs("form",{onSubmit:fe,noValidate:!0,className:"space-y-4",children:[v.apiError&&e.jsx("div",{className:"p-3 rounded-md bg-destructive/10 border border-destructive/20",children:e.jsx("p",{className:"text-sm text-destructive",children:v.apiError})}),e.jsx(c,{label:"Current Password",type:"password",value:b,onChange:y,required:!0,showPasswordToggle:!0,error:v.currentPassword}),e.jsxs("div",{children:[e.jsx(c,{label:"New Password",type:"password",value:p,onChange:s=>{K(s),he(E.map(r=>r.test(s))),!D&&s&&W(!0)},onFocus:()=>se(!0),onBlur:()=>se(!1),required:!0,showPasswordToggle:!0,error:v.newPassword}),(ee||D)&&e.jsxs("div",{className:"mt-3",children:[D&&e.jsx("div",{className:"mb-3",children:e.jsx(xe,{value:le(),max:E.length,variant:pe(),className:"h-2"})}),ee&&e.jsx("div",{className:"space-y-2",children:E.map((s,r)=>e.jsxs("div",{className:"flex items-center gap-2",children:[B[r]?e.jsx(ie,{className:"h-4 w-4 text-green-600"}):e.jsx(Ee,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:`text-sm ${B[r]?"text-green-600":"text-red-500"}`,children:s.label})]},s.label))})]})]}),e.jsxs("div",{children:[e.jsx(c,{label:"Confirm New Password",type:"password",value:N,onChange:Q,required:!0,showPasswordToggle:!0,error:v.confirmPassword}),C!==null&&e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[C?e.jsx(ie,{className:"h-4 w-4 text-green-600"}):e.jsx(Ae,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:`text-sm ${C?"text-green-600":"text-red-500"}`,children:C?"Passwords match":"Passwords do not match"})]})})]}),e.jsxs(j,{type:"submit",className:"w-full",disabled:te,children:[te&&e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}),"Change Password"]})]})})]})})]})]}),e.jsx(ce,{})]})};export{Te as default};

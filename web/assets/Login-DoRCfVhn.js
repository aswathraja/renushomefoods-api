import{r as i,o as k,j as e,A as g,L as C}from"./vendor-react-Bv33ryjV.js";import{L as I,C as E}from"./dropdown-menu-BDj5FxyU.js";import{T as q}from"./TopNav-JT08H0jt.js";import{a as A,B as F,A as j,e as y,c as l}from"./index-BgzncNPj.js";import{I as b}from"./input-B6PrAciv.js";import{L as N}from"./label-bvSFhUHd.js";import"./NavBar-BWSSAL5l.js";import"./TopBar-D2vj-zy0.js";import"./vendor-pdf-DxqLLkkN.js";const z=()=>{const[c,v]=i.useState(""),[u,w]=i.useState(""),[x,a]=i.useState(!1),m=k(),{setUser:L}=A(),p=r=>{m(r),setTimeout(()=>{window.resetZoom&&window.resetZoom()},100)},S=async r=>{r.preventDefault(),a(!0),j.postData({endpoint:"/user/login",body:{request:y({identifier:c,password:u})},successCallback:s=>{s.token?(localStorage.setItem("token",s.token),l.success("Logged in successfully!"),j.postData({endpoint:"/order/pending-order",body:{request:y({token:s.token})},successCallback:o=>{if(o?.products&&Array.isArray(o.products)&&o.products.length>0){let d=[];try{const t=localStorage.getItem("cart");t&&(d=JSON.parse(t))}catch{d=[]}const n=[...o.products];d.forEach(t=>{const f=n.findIndex(h=>h.productId===t.productId&&h.priceList?.id===t.priceList?.id);f===-1?n.push(t):n[f].quantity=t.quantity}),localStorage.setItem("cart",JSON.stringify(n)),l("You have a pending order, the cart has been updated.")}a(!1),p("/")},errorCallback:o=>{console.error("Error fetching pending order:",o),a(!1),p("/")}}),s.roles&&L({id:s.user?.id,username:s.user?.username,name:s.user?.name,email:s.user?.email,phone:s.user?.phone,roles:[...s.roles]})):(a(!1),console.error("Login failed:",s),l.error(s.message||s.error||"Login failed"),/(otp)/gmi.test(s?.message)===!0&&(sessionStorage.setItem("resetIdentifier",c),m("/reset-password")))},errorCallback:s=>{a(!1),console.error("Login failed:",s),l.error(s.error||"Login failed")}})};return i.useEffect(()=>{localStorage.getItem("token")&&m("/")},[]),e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(q,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center px-4 py-6 sm:py-8",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-42 h-42 sm:w-42 sm:h-42 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(I,{size:"xxl"})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground mb-2",children:"Welcome Back"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Sign in to your account to continue"})]}),e.jsxs("div",{className:"bg-card rounded-xl shadow-sm border border-border p-6 sm:p-8",children:[e.jsxs("form",{onSubmit:S,className:"space-y-5 sm:space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"identifier",className:"text-sm font-medium text-foreground",children:"Username or Phone Number"}),e.jsx(b,{type:"text",id:"identifier",value:c,onChange:r=>v(r.target.value),placeholder:"Enter your username or phone number",required:!0,className:"h-11 sm:h-12 text-sm sm:text-base"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(N,{htmlFor:"password",className:"text-sm font-medium text-foreground",children:"Password"}),e.jsx(g,{to:"/forgot-password",className:"text-xs sm:text-sm text-primary hover:underline",children:"Forgot Password?"})]}),e.jsx(b,{type:"password",id:"password",value:u,onChange:r=>w(r.target.value),placeholder:"Enter your password",required:!0,className:"h-11 sm:h-12 text-sm sm:text-base"})]}),e.jsx(F,{type:"submit",className:"w-full h-11 sm:h-12 text-sm sm:text-base font-medium",disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 mr-2 animate-spin"}),"Signing in..."]}):"Sign In"})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-border",children:e.jsxs("p",{className:"text-center text-sm text-muted-foreground",children:["Don't have an account?"," ",e.jsx(g,{to:"/register",className:"text-primary hover:underline font-medium",children:"Create account"})]})})]})]})}),e.jsx("footer",{className:"mt-auto",children:e.jsx(E,{})})]})};export{z as default};

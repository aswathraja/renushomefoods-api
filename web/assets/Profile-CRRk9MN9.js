import{a as e,j as s}from"./vendor-animation-CcgChT4Y.js";import{C as a}from"./dropdown-menu-DjLdUzkQ.js";import{T as r}from"./TopNav-BcoF5Zho.js";import{a as t,g as n,B as l,A as o,c as d,e as i}from"./index-QkJ4t2go.js";import{C as c,a as m,b as u,c as x}from"./card-CZoDjOMW.js";import{I as h}from"./input-group-ByqfbmvE.js";import{L as p,U as g,a6 as j,X as f,a0 as b}from"./vendor-icons-BYe_-sqm.js";import"./vendor-radix-CgisZDtL.js";import"./vendor-charts-1c3qO8Q0.js";import"./vendor-ui-utils-B4kPJlQS.js";import"./NavBar-Zl-a5m7p.js";import"./TopBar-CO3pAy7f.js";import"./vendor-pdf-export-F3dE0gEs.js";import"./input-hHw7iIA9.js";const v=e.forwardRef(({className:e,value:a=0,max:r=100,variant:n="default",showPercentage:l=!1,...o},d)=>{const i=Math.min(Math.max(a/r*100,0),100);return s.jsxs("div",{ref:d,className:t("relative h-2 w-full overflow-hidden rounded-full bg-secondary",e),...o,children:[s.jsx("div",{className:t("h-full w-full flex-1 transition-all",{default:"bg-primary",success:"bg-green-500",warning:"bg-yellow-500",danger:"bg-red-500"}[n]),style:{transform:`translateX(-${100-i}%)`}}),l&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsxs("span",{className:"text-xs font-medium text-primary-foreground",children:[Math.round(i),"%"]})})]})});v.displayName="Progress";const N=[{label:"At least 8 characters",test:e=>e.length>=8},{label:"One uppercase letter",test:e=>/[A-Z]/.test(e)},{label:"One lowercase letter",test:e=>/[a-z]/.test(e)},{label:"One digit",test:e=>/\d/.test(e)},{label:"One special character",test:e=>/[@$!%*?&()[\]{}#^~<>+=_|\\/.,:;"'-]/.test(e)}],X=()=>{const t=n(),[X,w]=e.useState(null),[y,C]=e.useState(null),[k,P]=e.useState(!0),[S,q]=e.useState(""),[B,A]=e.useState(""),[O,$]=e.useState(""),[E,I]=e.useState(N.map(()=>!1)),[D,L]=e.useState(!1),[z,F]=e.useState(!1),[T,M]=e.useState(null),[U,Z]=e.useState({}),[G,_]=e.useState(!1),[H,J]=e.useState(!1),[R,V]=e.useState(!1),[Y,K]=e.useState({}),[Q,W]=e.useState({}),[ee,se]=e.useState(!1),[ae,re]=e.useState(!1),[te,ne]=e.useState({}),[le,oe]=e.useState({}),de=()=>{const e=localStorage.getItem("token");e&&o.get("/user/details",{Authorization:`Bearer ${e}`}).then(e=>{w(e.user)}).catch(e=>{d.error("Failed to load user details")})},ie=()=>{const e=localStorage.getItem("token");e&&o.postData({endpoint:"/user/default-address",body:{request:i({token:e})},successCallback:e=>{C(e)},errorCallback:e=>{}})};e.useEffect(()=>{localStorage.getItem("token")?(de(),ie(),P(!1)):t("/login")},[t]),e.useEffect(()=>{M(B&&O?B===O:null)},[B,O]);const ce=()=>E.filter(Boolean).length,me=e=>/^(\+\d{1,3}\s?\d{10}|\+\d{12}|\d{10})$/.test(e),ue=(e,s)=>{const a={...te};switch(e){case"email":s&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)?a.email="Invalid email format":delete a.email;break;case"phone":s&&!me(s)?a.phone="Phone must be the format XXXXXXXXXX, +XX XXXXXXXXXX, or +XXXXXXXXXXXX":delete a.phone;break;default:s&&s.trim()?delete a[e]:a[e]="This field is required"}ne(a)},xe=(e,s)=>{const a={...le};switch(e){case"phone":s&&!me(s)?a.phone="Phone must be the format XXXXXXXXXX, +XX XXXXXXXXXX, or +XXXXXXXXXXXX":delete a.phone;break;case"pincode":s&&!/^\d{6}$/.test(s)?a.pincode="Pincode must be exactly 6 digits":delete a.pincode;break;default:s&&s.trim()?delete a[e]:a[e]="This field is required"}oe(a)};return k?s.jsxs(s.Fragment,{children:[s.jsx(r,{}),s.jsx("div",{className:"container page-container flex justify-center items-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx(p,{className:"h-8 w-8 animate-spin mx-auto text-primary"}),s.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading..."})]})}),s.jsx(a,{})]}):s.jsxs(s.Fragment,{children:[s.jsx(r,{}),s.jsxs("div",{className:"container min-h-screen mx-auto mt-8 px-4 sm:px-6 lg:px-8",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center",children:s.jsx(g,{size:"50px",className:"text-primary"})}),s.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground mb-2",children:(()=>{const e=(new Date).getHours();let s="Good Evening";return e>=5&&e<12?s="Good Morning":e>=12&&e<16&&(s="Good Afternoon"),`${s}${X?`, ${X.name}`:""}!`})()}),s.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mb-4",children:"Manage your personal information and password"})]}),s.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4 sm:gap-6 lg:gap-8",children:[s.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[s.jsxs(c,{className:"w-full",children:[s.jsxs(m,{className:"flex flex-row items-center justify-between pb-3 sm:pb-4",children:[s.jsx(u,{className:"text-base sm:text-lg font-semibold",children:"User Details"}),!H&&s.jsx(l,{variant:"outline",size:"sm",onClick:()=>{X&&(K({...X}),Object.keys(X).forEach(e=>{e in X&&ue(e,String(X[e]||""))})),J(!0)},className:"text-green-600 border-green-600 hover:bg-green-50 h-8 sm:h-9 px-2 sm:px-3 text-xs sm:text-sm",children:"Edit"})]}),s.jsx(x,{className:"pt-0",children:H?s.jsxs("div",{className:"space-y-4",children:[s.jsx(h,{label:"Name",value:Y.name||"",onChange:e=>{K({...Y,name:e}),ue("name",e)},onBlur:e=>ue("name",e.target.value),required:!0,error:te.name}),s.jsx(h,{label:"Username",value:Y.username||"",onChange:e=>{K({...Y,username:e}),ue("username",e)},onBlur:e=>ue("username",e.target.value),required:!0,error:te.username}),s.jsx(h,{label:"Email",type:"email",value:Y.email||"",onChange:e=>{const s=e.replace(/[^a-zA-Z0-9@._-]/g,"");K({...Y,email:s}),ue("email",s)},onBlur:e=>ue("email",e.target.value),required:!0,error:te.email}),s.jsx(h,{label:"Phone",value:Y.phone||"",onChange:e=>{const s=e.replace(/[^\d+\s]/g,"").slice(0,15);K({...Y,phone:s}),ue("phone",s)},onBlur:e=>ue("phone",e.target.value),required:!0,error:te.phone}),s.jsxs("div",{className:"flex gap-2 justify-end",children:[s.jsx(l,{variant:"outline",onClick:()=>{J(!1),K({}),ne({}),de()},disabled:ee,children:"Cancel"}),s.jsxs(l,{onClick:()=>{const e=localStorage.getItem("token");e&&Y.name&&Y.username&&Y.email&&Y.phone?Object.keys(te).length>0?d.error("Please fix the errors before saving"):(se(!0),o.postData({endpoint:"/user/update",body:{request:i({token:e,...Y})},successCallback:e=>{se(!1),d.success("User details updated successfully"),J(!1),K({}),ne({}),de()},errorCallback:e=>{if(se(!1),e.email||e.phone||e.username)try{const s={};if(e.email&&(s.email=e.email),e.phone&&(s.phone=e.phone),e.username&&(s.username=e.username),Object.keys(s).length>0)return void ne(s)}catch(s){}d.error("Failed to update user details")}})):d.error("All fields are required")},disabled:ee,children:[ee&&s.jsx(p,{className:"mr-2 h-4 w-4 animate-spin"}),"Save"]})]})]}):X?s.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[s.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2 sm:gap-4",children:[s.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Name:"}),s.jsx("span",{className:"text-sm sm:text-base col-span-2 sm:col-span-3",children:X.name})]}),s.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2 sm:gap-4",children:[s.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Username:"}),s.jsx("span",{className:"text-sm sm:text-base col-span-2 sm:col-span-3",children:X.username})]}),s.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2 sm:gap-4",children:[s.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Email:"}),s.jsx("span",{className:"text-sm sm:text-base col-span-2 sm:col-span-3",children:X.email})]}),s.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2 sm:gap-4",children:[s.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Phone:"}),s.jsx("span",{className:"text-sm sm:text-base col-span-2 sm:col-span-3",children:X.phone})]})]}):s.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Unable to load user details."})})]}),s.jsxs(c,{className:"w-full",children:[s.jsxs(m,{className:"flex flex-row items-center justify-between pb-3 sm:pb-4",children:[s.jsx(u,{className:"text-base sm:text-lg font-semibold",children:"Your Current Address Information"}),!R&&y&&s.jsx(l,{variant:"outline",size:"sm",onClick:()=>{y&&(W({...y}),Object.keys(y).forEach(e=>{e in y&&"id"!==e&&"isDefault"!==e&&xe(e,String(y[e]||""))})),V(!0)},className:"text-green-600 border-green-600 hover:bg-green-50 h-8 sm:h-9 px-2 sm:px-3 text-xs sm:text-sm",children:"Edit"})]}),s.jsx(x,{className:"pt-0",children:R?s.jsxs("div",{className:"space-y-4",children:[s.jsx(h,{label:"Name",value:Q.name||"",onChange:e=>{W({...Q,name:e}),xe("name",e)},onBlur:e=>xe("name",e.target.value),required:!0,error:le.name}),s.jsx(h,{label:"Address",value:Q.addressLine1||"",onChange:e=>{W({...Q,addressLine1:e}),xe("addressLine1",e)},onBlur:e=>xe("addressLine1",e.target.value),required:!0,error:le.addressLine1}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(h,{label:"City",value:Q.city||"",onChange:e=>{W({...Q,city:e}),xe("city",e)},onBlur:e=>xe("city",e.target.value),required:!0,error:le.city}),s.jsx(h,{label:"State",value:Q.state||"",onChange:e=>{W({...Q,state:e}),xe("state",e)},onBlur:e=>xe("state",e.target.value),required:!0,error:le.state})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(h,{label:"Country",value:Q.country||"",onChange:e=>{W({...Q,country:e}),xe("country",e)},onBlur:e=>xe("country",e.target.value),required:!0,error:le.country}),s.jsx(h,{label:"Pincode",value:Q.pincode||"",onChange:e=>{const s=e.replace(/\D/g,"").slice(0,6);W({...Q,pincode:s}),xe("pincode",s)},onBlur:e=>xe("pincode",e.target.value),required:!0,error:le.pincode})]}),s.jsx(h,{label:"Phone",value:Q.phone||"",onChange:e=>{const s=e.replace(/[^\d+\s]/g,"").slice(0,15);W({...Q,phone:s}),xe("phone",s)},onBlur:e=>xe("phone",e.target.value),required:!0,error:le.phone}),s.jsxs("div",{className:"flex gap-2 justify-end",children:[s.jsx(l,{variant:"outline",onClick:()=>{V(!1),W({}),oe({}),ie()},disabled:ae,children:"Cancel"}),s.jsxs(l,{onClick:()=>{const e=localStorage.getItem("token");e&&y&&Q.name&&Q.addressLine1&&Q.city&&Q.state&&Q.country&&Q.pincode&&Q.phone?Object.keys(le).length>0?d.error("Please fix the errors before saving"):(re(!0),o.postData({endpoint:"/user/address",body:{request:i({token:e,addressId:y.id,...Q})},successCallback:e=>{re(!1),d.success("Address updated successfully"),V(!1),W({}),oe({}),ie()},errorCallback:e=>{re(!1);const s=e.error?JSON.parse(e.error).error:"Failed to update address";d.error(s)}})):d.error("All fields are required")},disabled:ae,children:[ae&&s.jsx(p,{className:"mr-2 h-4 w-4 animate-spin"}),"Save"]})]})]}):y?s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("strong",{children:"Name:"})," ",y.name]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Address:"})," ",y.addressLine1]}),s.jsxs("div",{children:[s.jsx("strong",{children:"City:"})," ",y.city]}),s.jsxs("div",{children:[s.jsx("strong",{children:"State:"})," ",y.state]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Country:"})," ",y.country]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Pincode:"})," ",y.pincode]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Phone:"})," ",y.phone]})]}):s.jsx("p",{className:"text-muted-foreground",children:"No default address set."})})]})]}),s.jsx("div",{children:s.jsxs(c,{children:[s.jsx(m,{children:s.jsx(u,{className:"text-lg font-semibold mt-2",children:"Change Password"})}),s.jsx(x,{children:s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),Z({});const s={};if(S||(s.currentPassword="Current password is required"),/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&()[\]{}#^~<>+=_|\\/.,:;"'-])[A-Za-z\d@$!%*?&()[\]{}#^~<>+=_|\\/.,:;"'-]{8,}$/.test(B)||(s.newPassword="Password must be at least 8 characters long and include a capital letter, a lowercase letter, a number, and a special character."),B!==O&&(s.confirmPassword="Passwords do not match"),Object.keys(s).length>0)return void Z(s);_(!0);const a=localStorage.getItem("token");a&&o.postData({endpoint:"/user/change-password",body:{request:i({token:a,currentPassword:S,newPassword:B})},successCallback:e=>{_(!1),d.success("Password changed successfully"),q(""),A(""),$(""),L(!1),M(null)},errorCallback:e=>{_(!1),d.error(e?.error||"Failed to change password",{duration:5e3})}})},noValidate:!0,className:"space-y-4",children:[U.apiError&&s.jsx("div",{className:"p-3 rounded-md bg-destructive/10 border border-destructive/20",children:s.jsx("p",{className:"text-sm text-destructive",children:U.apiError})}),s.jsx(h,{label:"Current Password",type:"password",value:S,onChange:q,required:!0,showPasswordToggle:!0,error:U.currentPassword}),s.jsxs("div",{children:[s.jsx(h,{label:"New Password",type:"password",value:B,onChange:e=>{A(e),I(N.map(s=>s.test(e))),!D&&e&&L(!0)},onFocus:()=>F(!0),onBlur:()=>F(!1),required:!0,showPasswordToggle:!0,error:U.newPassword}),(z||D)&&s.jsxs("div",{className:"mt-3",children:[D&&s.jsx("div",{className:"mb-3",children:s.jsx(v,{value:ce(),max:N.length,variant:(()=>{const e=ce();return e<=2?"danger":e<=4?"warning":"success"})(),className:"h-2"})}),z&&s.jsx("div",{className:"space-y-2",children:N.map((e,a)=>s.jsxs("div",{className:"flex items-center gap-2",children:[E[a]?s.jsx(j,{className:"h-4 w-4 text-green-600"}):s.jsx(f,{className:"h-4 w-4 text-red-500"}),s.jsx("span",{className:"text-sm "+(E[a]?"text-green-600":"text-red-500"),children:e.label})]},e.label))})]})]}),s.jsxs("div",{children:[s.jsx(h,{label:"Confirm New Password",type:"password",value:O,onChange:$,required:!0,showPasswordToggle:!0,error:U.confirmPassword}),null!==T&&s.jsx("div",{className:"mt-2",children:s.jsxs("div",{className:"flex items-center gap-2",children:[T?s.jsx(j,{className:"h-4 w-4 text-green-600"}):s.jsx(b,{className:"h-4 w-4 text-red-500"}),s.jsx("span",{className:"text-sm "+(T?"text-green-600":"text-red-500"),children:T?"Passwords match":"Passwords do not match"})]})})]}),s.jsxs(l,{type:"submit",className:"w-full",disabled:G,children:[G&&s.jsx(p,{className:"mr-2 h-4 w-4 animate-spin"}),"Change Password"]})]})})]})})]})]}),s.jsx(a,{})]})};export{X as default};

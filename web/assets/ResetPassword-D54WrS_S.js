import{a as e,j as s}from"./vendor-animation-CcgChT4Y.js";import{L as t,C as r}from"./dropdown-menu-DjLdUzkQ.js";import{T as a}from"./TopNav-BcoF5Zho.js";import{g as l,L as n,B as o,A as i,e as d,c}from"./index-QkJ4t2go.js";import{C as m,a as u,b as x,c as p}from"./card-CZoDjOMW.js";import{I as h}from"./input-group-ByqfbmvE.js";import{J as g,af as j,L as f}from"./vendor-icons-BYe_-sqm.js";import"./vendor-radix-CgisZDtL.js";import"./vendor-charts-1c3qO8Q0.js";import"./vendor-ui-utils-B4kPJlQS.js";import"./NavBar-Zl-a5m7p.js";import"./TopBar-CO3pAy7f.js";import"./vendor-pdf-export-F3dE0gEs.js";import"./input-hHw7iIA9.js";const w=()=>{const w=[{label:"At least 8 characters",test:e=>e.length>=8},{label:"One uppercase letter",test:e=>/[A-Z]/.test(e)},{label:"One lowercase letter",test:e=>/[a-z]/.test(e)},{label:"One digit",test:e=>/\d/.test(e)},{label:"One special character",test:e=>/[@$!%*?&()[\]{}#^~<>+=_|\\/.,:;"'-]/.test(e)}],[b,v]=e.useState(""),[N,y]=e.useState(""),[P,S]=e.useState(""),[O,T]=e.useState({}),[C,E]=e.useState(!1),[k,I]=e.useState(""),[F,$]=e.useState(!1),[A,B]=e.useState(!1),[q,z]=e.useState(w.map(()=>!1)),[L,M]=e.useState(null),[R,Z]=e.useState(15),[D,_]=e.useState(!1),G=l(),H=sessionStorage.getItem("resetIdentifier");e.useEffect(()=>{H||G("/login")},[H,G]),e.useEffect(()=>{M(P||N?N===P:null)},[N,P]),e.useEffect(()=>{if(R>0){const e=setInterval(()=>{Z(e=>e-1)},1e3);return()=>clearInterval(e)}_(!0)},[R]);return e.useEffect(()=>{I((e=>{if(!e)return"";let s=0;return e.length>=8&&s++,/[A-Z]/.test(e)&&s++,/[a-z]/.test(e)&&s++,/\d/.test(e)&&s++,/[@$!%*?&()[\]{}#^~<>+=_|\\/.,:;"'-]/.test(e)&&s++,s>=5?"Strong":s>=3?"Medium":"Weak"})(N)),z(w.map(e=>e.test(N)))},[N]),s.jsxs(s.Fragment,{children:[s.jsx(a,{}),s.jsx("div",{className:"min-h-screen flex items-center justify-center py-6 sm:py-8 lg:py-12 px-4",children:s.jsxs("div",{className:"w-full max-w-md",children:[s.jsx("div",{className:"w-42 h-42 sm:w-42 sm:h-42 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center",children:s.jsx(t,{size:"xxl"})}),s.jsx("div",{className:"mb-6",children:s.jsxs(n,{to:"/login",className:"inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors",children:[s.jsx(g,{className:"h-4 w-4"}),"Back to Login"]})}),s.jsxs(m,{className:"shadow-lg",children:[s.jsxs(u,{className:"text-center pb-6",children:[s.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center",children:s.jsx(j,{className:"h-8 w-8 text-primary"})}),s.jsx(x,{className:"text-2xl sm:text-3xl font-bold",children:"Reset Password"}),s.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mt-2",children:"Enter the OTP sent to your email/phone and create a new password."})]}),s.jsx(p,{children:s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),T({}),(()=>{const e={};return b.match(/^\d{4}$/)||(e.otp="OTP must be exactly 4 digits"),/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&()[\]{}#^~<>+=_|\\/.,:;"'-])[A-Za-z\d@$!%*?&()[\]{}#^~<>+=_|\\/.,:;"'-]{8,}$/.test(N)||(e.newPassword="Password must be at least 8 characters long and include a capital letter, a lowercase letter, a number, and a special character."),N!==P&&(e.confirmPassword="Passwords do not match"),H||(e.apiError="Missing identifier. Please restart the forgot password process."),T(e),0===Object.keys(e).length})()&&(E(!0),i.postData({endpoint:"/user/reset-password",body:{request:d({identifier:H,otp:b,newPassword:N})},successCallback:()=>{E(!1),sessionStorage.removeItem("resetIdentifier"),c.success("Password has been reset. Please continue to login"),G("/login")},errorCallback:e=>{E(!1),T({apiError:e?.error||"Failed to reset password. Please try again."})}}))},className:"space-y-6",children:[O.apiError&&s.jsx("div",{className:"bg-destructive/10 text-destructive border border-destructive/20 rounded-md p-3 text-sm",role:"alert",children:O.apiError}),s.jsx(h,{label:"OTP",type:"text",value:b,onChange:e=>{/^\d{0,4}$/.test(e)&&v(e)},placeholder:"Enter 4-digit OTP",inputMode:"numeric",maxLength:4,error:O.otp,required:!0}),s.jsx("div",{className:"text-center",children:D?s.jsx("button",{type:"button",className:"text-sm text-primary hover:text-primary/80 font-medium transition-colors disabled:opacity-50",onClick:e=>{C||(e.preventDefault(),(async()=>{D&&H&&(E(!0),i.postData({endpoint:"/user/forgot-password",body:{request:d({identifier:H,regenerate:!1})},successCallback:e=>{E(!1),c.success(e.message||"OTP resent successfully."),Z(15),_(!1)},errorCallback:()=>{E(!1),c.error("Failed to resend OTP. Please try again.")}}))})())},disabled:C,children:"Resend OTP"}):s.jsxs("span",{className:"text-sm text-muted-foreground",children:["Resend OTP in ",R,"s"]})}),s.jsxs("div",{children:[s.jsx(h,{label:"New Password",type:"password",value:N,onChange:e=>{y(e),!A&&e&&B(!0)},placeholder:"Enter new password",onFocus:()=>$(!0),onBlur:()=>$(!1),error:O.newPassword,showPasswordToggle:!0,required:!0}),(F||A)&&s.jsxs("div",{className:"mt-2",children:[A&&s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"h-2 rounded-full transition-all "+("Strong"===k?"bg-primary":"Medium"===k?"bg-yellow-500":"bg-red-500"),style:{width:q.filter(Boolean).length/w.length*100+"%"}})}),F&&s.jsx("ul",{className:"mt-2 space-y-1",children:w.map((e,t)=>s.jsxs("li",{className:"text-xs flex items-center gap-2 "+(q[t]?"text-green-600":"text-red-500"),children:[q[t]?s.jsx("span",{className:"text-green-600",children:"✓"}):s.jsx("span",{className:"text-red-500",children:"✗"}),e.label]},e.label))})]})]}),s.jsxs("div",{children:[s.jsx(h,{label:"Confirm New Password",type:"password",value:P,onChange:e=>S(e),placeholder:"Confirm new password",error:O.confirmPassword,showPasswordToggle:!0,required:!0}),null!==L&&s.jsx("div",{className:"mt-2",children:s.jsx("span",{className:"text-xs flex items-center gap-2 "+(L?"text-green-600":"text-red-500"),children:L?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"text-green-600",children:"✓"}),"Passwords match"]}):s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"text-red-500",children:"✗"}),"Passwords do not match"]})})})]}),s.jsxs(o,{type:"submit",className:"w-full h-11 text-sm sm:text-base",disabled:C,children:[C&&s.jsx(f,{className:"mr-2 h-4 w-4 animate-spin"}),C?"Resetting Password...":"Reset Password"]})]})})]})]})}),s.jsx(r,{})]})};export{w as default};

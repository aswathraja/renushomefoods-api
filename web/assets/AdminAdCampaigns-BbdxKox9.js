import{u as Re,r as l,j as e,B as o,A as E,e as q,c as y}from"./index-BoxPh3JM.js";import{A as qe}from"./AdminNavBar-GJDeDHuW.js";import{X as ze,C as Ge}from"./dropdown-menu-BLfYlWZi.js";import{B as je}from"./badge-BH-uSzS_.js";import{f as c,C as z,a as G}from"./calendar-gWxg5eJB.js";import{C as le,a as fe,b as ge,c as re}from"./card-DTmY7R92.js";import{D as Oe,a as Le,b as He,c as Je,d as We}from"./dialog-BPO4MNaU.js";import{I as P}from"./input-Dho7y00w.js";import{L as m}from"./label-uPPhbx3V.js";import{P as S,a as D,b as w}from"./popover-C9ECzK7I.js";import{T as Xe}from"./textarea-DKVie1lc.js";import{P as pe}from"./PhotoGallaryModal-DX5Vw7HN.js";import{C as ve}from"./checkbox-DX5QLY66.js";import{T as Ke,a as Qe,b as ne,c as g,d as Ve,e as j}from"./table-D8PF9qXY.js";import{P as Ye}from"./plus-Btgo1p-c.js";import{F as Ze}from"./funnel-BwFhYy_a.js";import{S as _e}from"./square-pen-DzgK4WZe.js";import{M as es}from"./mail-Cm5qs3Uy.js";import{T as ss}from"./trash-B0Hvmv76.js";import"./TopBar-CX_8npq5.js";import"./chevron-left-C0smFANY.js";import"./chevron-down-Bb5q4sof.js";import"./index-BAkI59ym.js";const ws=()=>{const{effectiveTheme:ts}=Re(),[ie,de]=l.useState([]),[ye,O]=l.useState(!1),[be,$]=l.useState(!1),[b,oe]=l.useState(!1),[Ce,ce]=l.useState(null),[me,L]=l.useState({}),[Ne,M]=l.useState(!1),[H,T]=l.useState(null),[ue,Se]=l.useState(!1),[J,De]=l.useState(""),[W,we]=l.useState(""),[X,Me]=l.useState(""),[i,ke]=l.useState({}),[d,Fe]=l.useState({}),[f,K]=l.useState([]),[Q,V]=l.useState(""),[p,Y]=l.useState(new Date),[v,Z]=l.useState(new Date),[_,ee]=l.useState(""),[se,te]=l.useState(""),[h,C]=l.useState([]),[U,he]=l.useState([]),[B,k]=l.useState(null),[I,F]=l.useState(null),[u,A]=l.useState({}),N=l.useRef(null),ae=()=>{V(""),Y(new Date),Z(new Date),ee(""),te(""),C([]),k(null),F(null),A({}),oe(!1),ce(null),N.current&&(N.current.value="")},R=()=>{O(!0);const s=localStorage.getItem("token");if(!s)return;const t={name:J||null,subject:W||null,message:X||null,fromStartDate:i.from?c(i.from,"yyyy-MM-dd"):null,toStartDate:i.to?c(i.to,"yyyy-MM-dd"):null,fromEndDate:d.from?c(d.from,"yyyy-MM-dd"):null,toEndDate:d.to?c(d.to,"yyyy-MM-dd"):null,users:f.map(a=>a.value),token:s};E.postData({endpoint:"/admin/ad-campaigns",body:{request:q(t)},Authorization:`Bearer ${s}`,successCallback:a=>{de(a.adCampaigns||[]),O(!1)},errorCallback:a=>{de([]),O(!1)}})},Ae=()=>{const s=localStorage.getItem("token");s&&E.get("/admin/user-list",{Authorization:`Bearer ${s}`}).then(t=>{if(t?.users){const a=[{value:"All",label:"All"},...t.users.map(r=>({value:r.id,label:`${r.name} (${r.email||r.phone})`}))];he(a)}}).catch(()=>{he([])})};l.useEffect(()=>{Ae(),R()},[]),l.useEffect(()=>{R()},[J,W,X,i,d,f]);const Ee=s=>{if(s.target.files&&s.target.files.length>0){const t=s.target.files[0];if(!["image/jpeg","image/png","image/webp","image/gif"].includes(t.type)){A(n=>({...n,file:"Please upload a valid image file (JPEG, PNG, WebP, GIF)"}));return}if(t.size>5*1024*1024){A(n=>({...n,file:"File size must be less than 5MB"}));return}k(t),A(n=>({...n,file:""}));const r=new FileReader;r.onloadend=()=>{F(r.result)},r.readAsDataURL(t)}else k(null),F(null)},Pe=()=>{k(null),F(null),N.current&&(N.current.value="")},$e=()=>{const s={};if(Q.trim()||(s.name="Name is required."),p||(s.startDate="Start Date is required."),v||(s.endDate="End Date is required."),se.trim()||(s.subject="Subject is required."),_.trim()||(s.message="Message is required."),!b&&!B&&(s.file="File upload is required."),b&&!B&&!I&&(s.file="File upload is required."),h.length===0&&(s.users="Please select at least one user."),A(s),Object.keys(s).length>0)return;const t=localStorage.getItem("token");if(!t)return;const a=new FormData,r={id:b?Ce.id:void 0,name:Q,startDate:p?c(p,"yyyy-MM-dd"):"",endDate:v?c(v,"yyyy-MM-dd"):"",message:_,subject:se,userIds:h.some(n=>n.value==="All")?["All"]:h.map(n=>n.value)};a.append("request",q(r)),B&&a.append("file",B),E.postFormData({endpoint:"/admin/save-ad-campaign",body:a,Authorization:`Bearer ${t}`,successCallback:n=>{y.success(b?"Campaign updated successfully":"Campaign saved successfully"),R(),ae(),$(!1)},errorCallback:n=>{y.error(n?.error||n?.message||"Failed to save campaign")}})},Te=s=>{if(V(s.name),Y(new Date(s.startDate)),Z(new Date(s.endDate)),ee(s.message),te(s.subject),s.users?.length){const t=s.users.map(a=>({value:a.id,label:`${a.name} (${a.email||a.phone})`}));C(t)}else C([]);k(null),F(s.imagePath?`/static/ads/${s.imagePath.split("/").pop()}`:null),oe(!0),ce(s),$(!0)},Ue=()=>{if(!H)return;const s=localStorage.getItem("token");if(!s)return;const t={id:H.id};E.postData({endpoint:"/admin/delete-ad-campaign",body:{request:q(t)},Authorization:`Bearer ${s}`,successCallback:()=>{y.success("Ad campaign deleted successfully"),R(),M(!1),T(null)},errorCallback:a=>{y.error(a?.error||a?.message||"Failed to delete campaign"),M(!1),T(null)}})},Be=()=>{M(!1),T(null)},Ie=s=>{const t=localStorage.getItem("token");if(!t){y.error("User not authenticated");return}L(n=>({...n,[s.id]:!0}));const a={id:s.id,token:t},r=q(a);E.postData({endpoint:"/admin/send-ad-emails",body:{request:r},Authorization:`Bearer ${t}`,successCallback:()=>{y.success("Ad email sent successfully"),L(n=>({...n,[s.id]:!1}))},errorCallback:n=>{y.error(n?.error||n?.message||"Failed to send ad email"),L(x=>({...x,[s.id]:!1}))}})},xe=s=>{try{return c(new Date(s),"dd/MM/yyyy")}catch{return s}};return e.jsxs("div",{children:[e.jsx(qe,{}),e.jsxs("div",{className:"container mx-auto mt-6 p-6 min-h-screen",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Campaigns"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",onClick:()=>{ae(),$(!0)},className:"border-green-600 text-green-600 hover:text-primary",children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),"Add"]}),e.jsxs(o,{variant:"outline",onClick:()=>Se(!ue),className:"border-green-600 text-green-600 hover:text-primary",children:[e.jsx(Ze,{className:"w-4 h-4 mr-2"}),"Filters"]})]})]}),ue&&e.jsxs(le,{className:"mb-6",children:[e.jsx(fe,{children:e.jsx(ge,{children:"Filters"})}),e.jsx(re,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Name"}),e.jsx(P,{value:J,onChange:s=>De(s.target.value),placeholder:"Enter campaign name"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Subject"}),e.jsx(P,{value:W,onChange:s=>we(s.target.value),placeholder:"Enter subject"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Message"}),e.jsx(P,{value:X,onChange:s=>Me(s.target.value),placeholder:"Enter message"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Start Date Range"}),e.jsxs(S,{children:[e.jsx(D,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:`w-full justify-start text-left font-normal ${!i.from&&!i.to&&"text-muted-foreground"}`,children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),i.from?i.to?e.jsxs(e.Fragment,{children:[c(i.from,"dd/MM/yyyy")," -"," ",c(i.to,"dd/MM/yyyy")]}):c(i.from,"dd/MM/yyyy"):"Select date range"]})}),e.jsx(w,{className:"w-auto p-0",align:"start",children:e.jsx(G,{autoFocus:!0,mode:"range",defaultMonth:i.from,selected:{from:i.from,to:i.to},onSelect:s=>ke(s||{}),numberOfMonths:2})})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"End Date Range"}),e.jsxs(S,{children:[e.jsx(D,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:`w-full justify-start text-left font-normal ${!d.from&&!d.to&&"text-muted-foreground"}`,children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),d.from?d.to?e.jsxs(e.Fragment,{children:[c(d.from,"dd/MM/yyyy")," -"," ",c(d.to,"dd/MM/yyyy")]}):c(d.from,"dd/MM/yyyy"):"Select date range"]})}),e.jsx(w,{className:"w-auto p-0",align:"start",children:e.jsx(G,{autoFocus:!0,mode:"range",defaultMonth:d.from,selected:{from:d.from,to:d.to},onSelect:s=>Fe(s||{}),numberOfMonths:2})})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Users"}),e.jsxs(S,{children:[e.jsx(D,{asChild:!0,children:e.jsx(o,{variant:"outline",role:"combobox","aria-expanded":!1,className:"w-full justify-between",children:f.length>0?`${f.length} user(s) selected`:"Select users"})}),e.jsx(w,{className:"w-full p-0",align:"start",children:e.jsx("div",{className:"p-3 space-y-2",children:U.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ve,{id:`filter-user-${s.value}`,checked:f.some(t=>t.value===s.value),onCheckedChange:t=>{const a=f.some(r=>r.value===s.value);if(t&&!a){const r=[...f,s],n=r.some(x=>x.value==="All");K(n?U.filter(x=>x.value!=="All"):r)}else!t&&a&&K(f.filter(r=>r.value!==s.value))}}),e.jsx(m,{htmlFor:`filter-user-${s.value}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:s.label})]},s.value))})})]})]})]})})]}),be&&e.jsxs(le,{className:"mb-6",children:[e.jsx(fe,{children:e.jsx(ge,{children:b?"Edit Ad Campaign":"Create Ad Campaign"})}),e.jsxs(re,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Name"}),e.jsx(P,{value:Q,onChange:s=>V(s.target.value)}),u.name&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:u.name})]}),e.jsxs("div",{children:[e.jsxs(m,{children:["Photo ",e.jsx("span",{className:"text-muted-foreground",children:"(Optional)"})]}),I?e.jsxs("div",{className:"relative",children:[e.jsx(pe,{title:"Campaign Photo",imageSrcs:[I],children:e.jsx("img",{src:I,alt:"Preview",className:"w-full h-32 object-cover rounded-lg"})}),e.jsx("button",{type:"button",onClick:Pe,className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",children:e.jsx(ze,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/30 rounded-lg p-4 text-center cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>N.current?.click(),children:[e.jsx(Upload,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Click to upload a photo"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"JPEG, PNG, WebP, GIF (max 5MB)"}),e.jsx("input",{ref:N,type:"file",accept:"image/jpeg,image/png,image/webp,image/gif",onChange:Ee,className:"hidden"})]}),u.file&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:u.file})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Start Date"}),e.jsxs(S,{children:[e.jsx(D,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:`w-full justify-start text-left font-normal ${!p&&"text-muted-foreground"}`,children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),p?c(p,"dd/MM/yyyy"):"Pick a date"]})}),e.jsx(w,{className:"w-auto p-0",align:"start",children:e.jsx(G,{mode:"single",selected:p,onSelect:Y,autoFocus:!0})})]}),u.startDate&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:u.startDate})]}),e.jsxs("div",{children:[e.jsx(m,{children:"End Date"}),e.jsxs(S,{children:[e.jsx(D,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:`w-full justify-start text-left font-normal ${!v&&"text-muted-foreground"}`,children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),v?c(v,"dd/MM/yyyy"):"Pick a date"]})}),e.jsx(w,{className:"w-auto p-0",align:"start",children:e.jsx(G,{mode:"single",selected:v,onSelect:Z,autoFocus:!0})})]}),u.endDate&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:u.endDate})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(m,{children:"Users"}),e.jsxs(S,{children:[e.jsx(D,{asChild:!0,children:e.jsx(o,{variant:"outline",role:"combobox","aria-expanded":!1,className:"w-full justify-between",children:h.length>0?`${h.length} user(s) selected`:"Select users"})}),e.jsx(w,{className:"w-full p-0",align:"start",children:e.jsx("div",{className:"p-3 space-y-2",children:U.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ve,{id:`form-user-${s.value}`,checked:h.some(t=>t.value===s.value),onCheckedChange:t=>{const a=h.some(r=>r.value===s.value);if(t&&!a){const r=[...h,s],n=r.some(x=>x.value==="All");C(n?U.filter(x=>x.value!=="All"):r)}else!t&&a&&C(h.filter(r=>r.value!==s.value))}}),e.jsx(m,{htmlFor:`form-user-${s.value}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:s.label})]},s.value))})})]}),u.users&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:u.users}),h.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:h.map(s=>e.jsx(je,{variant:"secondary",children:s.label},s.value))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(m,{children:"Subject"}),e.jsx(P,{value:se,onChange:s=>te(s.target.value)}),u.subject&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:u.subject})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(m,{children:"Message"}),e.jsx(Xe,{rows:4,value:_,onChange:s=>ee(s.target.value)}),u.message&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:u.message})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(o,{variant:"outline",onClick:()=>{ae(),$(!1)},children:"Cancel"}),e.jsx(o,{onClick:$e,children:b?"Update Campaign":"Save Campaign"})]})]})]}),e.jsx(le,{children:e.jsx(re,{className:"p-0",children:ye?e.jsx("div",{className:"p-6 text-center",children:"Loading..."}):e.jsxs(Ke,{children:[e.jsx(Qe,{children:e.jsxs(ne,{children:[e.jsx(g,{children:"Name"}),e.jsx(g,{children:"Start Date"}),e.jsx(g,{children:"End Date"}),e.jsx(g,{className:"w-[220px]",children:"Subject"}),e.jsx(g,{children:"Message"}),e.jsx(g,{children:"Users"}),e.jsx(g,{children:"Image"}),e.jsx(g,{className:"sticky right-0 bg-background",children:"Actions"})]})}),e.jsxs(Ve,{children:[ie.map((s,t)=>e.jsxs(ne,{className:t%2===0?"bg-muted/20":"",children:[e.jsx(j,{children:s.name}),e.jsx(j,{children:xe(s.startDate)}),e.jsx(j,{children:xe(s.endDate)}),e.jsx(j,{className:"w-[220px]",children:s.subject}),e.jsx(j,{children:s.message.length>50?s.message.substr(0,50)+"...":s.message}),e.jsx(j,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s?.users?.map(a=>e.jsx(je,{variant:"secondary",children:a.name},a.id))})}),e.jsx(j,{children:s.imagePath?e.jsx(pe,{title:"Campaign Photo",imageSrcs:[`/static${s.imagePath}`],children:e.jsx("img",{src:`/static${s.imagePath}`,alt:s.name,className:"max-w-16 max-h-12 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity"})}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"No photo"})}),e.jsx(j,{className:"sticky right-0 bg-background",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(o,{size:"sm",variant:"outline",title:"Edit Ad Campaign","aria-label":"Edit Ad Campaign",onClick:()=>Te(s),children:e.jsx(_e,{className:"w-4 h-4"})}),e.jsx(o,{size:"sm",variant:"outline",title:"Send Emails",onClick:()=>Ie(s),disabled:me[s.id],"aria-label":"Send Emails",children:me[s.id]?e.jsx("div",{className:"w-4 h-4 animate-spin rounded-full border-2 border-current border-t-transparent"}):e.jsx(es,{className:"w-4 h-4"})}),e.jsx(o,{size:"sm",variant:"outline",title:"Delete Ad Campaign",onClick:()=>{T(s),M(!0)},"aria-label":"Delete Ad Campaign",children:e.jsx(ss,{className:"w-4 h-4"})})]})})]},s.id)),ie.length===0&&e.jsx(ne,{children:e.jsx(j,{colSpan:8,className:"text-center",children:"No Ad Campaigns found."})})]})]})})})]}),e.jsx(Oe,{open:Ne,onOpenChange:M,children:e.jsxs(Le,{children:[e.jsx(He,{children:e.jsx(Je,{children:"Delete Ad Campaign"})}),e.jsx("div",{className:"py-4",children:e.jsxs("p",{children:['Are you sure you want to delete ad campaign "',H?.name,'"? This action cannot be undone.']})}),e.jsxs(We,{children:[e.jsx(o,{variant:"outline",onClick:Be,children:"Cancel"}),e.jsx(o,{variant:"destructive",onClick:Ue,children:"Confirm Delete"})]})]})}),e.jsx(Ge,{})]})};export{ws as default};

import{u as ke,r as c,A as f,e as C,j as e,B as m,h as Pe,m as J,c as y}from"./index-DbPu8K_2.js";import{X as oe,C as Se}from"./dropdown-menu-ndXhbIqo.js";import{I as qe}from"./InventoryNavBar-Cyk7ZMcH.js";import{f as Fe,C as De,a as Le}from"./calendar-CtL8W_QE.js";import{C as K,c as X,a as Ae,b as Te}from"./card-BaY4vyi0.js";import{D as $e,a as Ee,b as ze,c as Be,e as Me,d as Oe}from"./dialog-CLav4IZ4.js";import{I as h}from"./input-uIhbwgE_.js";import{L as d}from"./label-Dx_XjS3E.js";import{P as Ue,a as Re,b as _e}from"./popover-Cyc9eECO.js";import{S as T,a as $,b as E,c as z,d as b}from"./select-KOpAoyEo.js";import{T as Ve,a as He,b as Y,c as g,d as Ge,e as p}from"./table-BtW2LytS.js";import{T as Qe}from"./textarea-BoYb-92F.js";import{P as ce}from"./PhotoGallaryModal-B6q__LCK.js";import{F as We}from"./funnel-CYFOiLLx.js";import{P as j}from"./plus-CAVwJglQ.js";import{T as k}from"./trash-BdGa3PjJ.js";import{U as Je}from"./upload-6cL1VcWr.js";import{S as Ke}from"./square-pen-BU1ldGM8.js";import"./TopBar-BblwwY8A.js";import"./chevron-left-BlR7maOI.js";import"./chevron-down-mIi7_xTw.js";import"./index-DsFJuTvR.js";const de=[.42,0,.58,1],Xe={initial:{opacity:0,y:-25},animate:{opacity:1,y:0,transition:{duration:.2,staggerChildren:.02,delayChildren:.02}},exit:{opacity:0,y:0,transition:{when:"afterChildren",staggerChildren:.02,staggerDirection:-1}}},me={initial:{x:50},animate:{x:0,transition:{duration:.02,ease:de}},exit:{x:0,transition:{duration:.02,ease:de}}},Pt=()=>{const{effectiveTheme:x}=ke(),[Z,ee]=c.useState([]),[te,B]=c.useState([]),[ae,M]=c.useState([]),[ue,v]=c.useState(!1),[u,w]=c.useState(null),[s,l]=c.useState({name:"",description:"",category:"",type:"",locations:[],images:[],invoices:[]}),[Ye,O]=c.useState(""),[P,N]=c.useState(null),[pe,I]=c.useState(!1),[U,R]=c.useState(null),[se,S]=c.useState(!1),[ie,_]=c.useState({}),q=c.useRef([]),[Ze,et]=c.useState(!1),[tt,at]=c.useState([]),[st,it]=c.useState(0),[re,he]=c.useState(!1),[V,ge]=c.useState(""),[H,xe]=c.useState(""),[G,ye]=c.useState({value:null,label:"All"}),[F,Q]=c.useState(null),ne=[{value:null,label:"All"},...te.map(t=>({value:t.category,label:t.category}))],D=te.map(t=>({value:t.id,label:t.category}));c.useEffect(()=>{f.postData({endpoint:"/inventory/get-categories",body:{type:null},successCallback:t=>{Array.isArray(t)?B(t):B([])},errorCallback:()=>{B([])}})},[]),c.useEffect(()=>{f.postData({endpoint:"/inventory/locations",body:{request:C({})},successCallback:t=>{Array.isArray(t)?M(t):M([])},errorCallback:()=>{M([])}})},[]);const L=()=>{const t={name:V||null,description:H||null,category:G?.value,image:F?.value,isAdmin:!0},a=new Promise((n,o)=>{f.postData({endpoint:"/inventory/get-products",body:{request:C(t)},successCallback:r=>{Array.isArray(r)?n(r.map(W=>({...W,type:"Product"}))):n([])},errorCallback:r=>{console.error("Failed to fetch products:",r),n([])}})}),i=new Promise((n,o)=>{f.postData({endpoint:"/inventory/get-items",body:{request:C(t)},successCallback:r=>{Array.isArray(r)?n(r.map(W=>({...W,type:"Item"}))):n([])},errorCallback:r=>{console.error("Failed to fetch items:",r),n([])}})});Promise.all([a,i]).then(([n,o])=>{const r=[...n,...o];ee(r)}).catch(n=>{console.error("Error fetching data:",n),ee([]),y.error("Failed to fetch items")})};c.useEffect(()=>{L()},[]),c.useEffect(()=>{L()},[V,H,G,F]);const je=t=>{if(t.preventDefault(),!s.name.trim()){y.error("Item name is required");return}if(!P){y.error("Category is required");return}const a=localStorage.getItem("token");if(!a){y.error("No token found");return}let i="/inventory/save-item",n={...s,name:s.name,description:s.description,category:P.value,image:u?.image||"",locations:s.locations.filter(r=>r.location).map(r=>({locationId:r.location.value,quantity:parseInt(r.quantity),id:r.id})),images:s.images.map(r=>({file:r.file,type:r.type,rank:parseInt(r.rank)||null,existing:r.existing})),invoices:s.invoices?.map(r=>({date:r.date?r.date?.toISOString()?.split("T")[0]:null,quantity:parseInt(r.quantity),unitPrice:parseFloat(r.unitPrice),basePrice:parseFloat(r.basePrice),weight:r.weight})),token:a,type:"item"};u?.type==="Product"?(i="/inventory/save-product",n={id:u.id,name:s.name,categoryid:P.value,pricelists:s.invoices.map(r=>({weight:r.weight,unitprice:parseFloat(r.unitPrice),basePrice:parseFloat(r.basePrice),bomCost:parseFloat(r.bomCost),quantity:parseInt(r.quantity),id:r.id})),productimages:s.images.map(r=>({id:r?.id,fileName:r.existing?.fileName||"",productId:u.id,rank:parseInt(r.rank),type:r.type})),tagline:s.description,rank:u.rank,locations:s.locations.filter(r=>r.location).map(r=>({locationId:r.location.value,quantity:r.quantity})),token:a}):u&&(n.id=u.id);const o=new FormData;o.append("request",C(n)),s.images.forEach(r=>{r.file&&o.append("files",r.file)}),f.postFormData({endpoint:i,body:o,Authorization:`Bearer ${a}`,successCallback:r=>{y.success(u?"Item updated successfully":"Item added successfully"),v(!1),w(null),l({name:"",description:"",category:"",locations:[],images:[],invoices:[],type:""}),O(""),L()},errorCallback:r=>{y.error("Failed to save item"),console.error("Error saving item:",r)}})},ve=t=>{w(t),l({name:t.name,description:t.description||"",category:"",locations:t.ItemLocations?.map(a=>({location:{value:a.Location.id,label:a.Location.name},quantity:a.quantity.toString(),id:a.id}))||[],images:t.ItemImages?.map(a=>({file:null,type:a.type||"",rank:a.rank,existing:{id:a.id,fileName:a.image,type:a.type,rank:null}}))||[],invoices:t.ItemInvoices?.map(a=>({date:a.date?new Date(a.date):null,quantity:a.quantity.toString(),unitPrice:a.unitprice,basePrice:a.basePrice,weight:a.weight,bomCost:""}))||[],type:t.type}),N(D.find(a=>a.value===t.categoryId)||null),O(""),v(!0)},fe=t=>{w(t),l({name:t.name,description:t.tagline||"",category:t.categoryid,locations:t.locations?.map(a=>({location:{value:a.id,label:a.name},quantity:a.ProductLocation?.quantity||a.quantity}))||[],images:t.ProductImages?.map(a=>({file:null,type:a.type||"",rank:a.rank?.toString()||"",existing:{id:a.id,fileName:a.fileName,type:a.type,rank:a.rank}}))||[],invoices:t.PriceLists?.map(a=>({date:new Date(a.updatedAt),quantity:a.quantity||"",unitPrice:a.unitprice.toString(),basePrice:a.basePrice.toString(),weight:a.weight||"",bomCost:a.bomCost?.toString()||""}))||[],type:t.type}),N(D.find(a=>a.value===t.categoryid)||null),O(""),v(!0)},be=t=>{t.type==="Item"?ve(t):t.type==="Product"&&fe(t)},we=t=>{R(t),I(!0)};c.useEffect(()=>{const t=a=>{a.target.closest(".dropdown")||S(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[]);const Ne=()=>{if(!U)return;const t=localStorage.getItem("token");if(!t){y.error("No token found");return}f.postData({endpoint:"/inventory/delete-item",body:{request:C({id:U.id,token:t})},successCallback:a=>{y.success("Item deleted successfully"),L(),I(!1),R(null)},errorCallback:a=>{y.error(a.error||"Failed to delete item"),I(!1),R(null)}})},Ie=t=>["image/jpeg","image/png","image/webp","image/gif"].includes(t.type)?t.size>5*1024*1024?"File size must be less than 5MB":null:"Please upload a valid image file (JPEG, PNG, WebP, GIF)",Ce=(t,a)=>{const i=a.target.files?.[0];if(i){const n=Ie(i);if(n){_(r=>({...r,[`image_${t}`]:n}));return}const o=[...s.images];o[t].file=i,l({...s,images:o}),_(r=>({...r,[`image_${t}`]:""}))}},le=t=>{const a=[...s.images];a[t].file=null,a[t].existing=void 0,l({...s,images:a}),q.current[t]&&(q.current[t].value=""),_(i=>({...i,[`image_${t}`]:""}))},A=t=>`/static/inventory/${t}`;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"min-h-screen",children:[e.jsx(qe,{}),e.jsxs("div",{className:"container mx-auto mt-6 px-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[e.jsx("h1",{className:"text-primary text-2xl font-bold",children:"Items"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",onClick:()=>he(!re),className:"border-green-600 text-green-600 hover:text-primary",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Filters"]}),e.jsxs("div",{className:"relative",children:[e.jsxs(m,{variant:"outline",onClick:()=>S(!se),className:"border-green-600 text-green-600 hover:text-primary",children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Add"]}),e.jsx(Pe,{children:se&&e.jsxs(J.ul,{className:"absolute right-0 top-full mt-2 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg z-10",variants:Xe,initial:"initial",animate:"animate",exit:"exit",children:[e.jsx(J.li,{variants:me,children:e.jsx("button",{className:"block w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>{w(null),l({name:"",description:"",category:"",locations:[],images:[],invoices:[],type:"Item"}),N(null),v(!0),S(!1)},children:"Item"})}),e.jsx(J.li,{variants:me,children:e.jsx("button",{className:"block w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>{w(null),l({name:"",description:"",category:"",locations:[],images:[],invoices:[],type:"Product"}),N(null),v(!0),S(!1)},children:"Product"})})]})})]})]})]}),re&&e.jsx(K,{className:"mb-6",children:e.jsx(X,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Name"}),e.jsx(h,{value:V,onChange:t=>ge(t.target.value),placeholder:"Enter item name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Description"}),e.jsx(h,{value:H,onChange:t=>xe(t.target.value),placeholder:"Enter description"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Category"}),e.jsxs(T,{value:G?.value||void 0,onValueChange:t=>{const a=ne.find(i=>i.value===(t==="all"?null:t));ye(a||{value:null,label:"All"})},children:[e.jsx($,{className:x==="dark"?"bg-gray-800 text-white border-gray-600":"",children:e.jsx(E,{placeholder:"Select Category"})}),e.jsx(z,{children:ne.map(t=>e.jsx(b,{value:t.value||"all",children:t.label},t.value||"all"))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Image"}),e.jsxs(T,{value:F?.value===null?"all":F?.value?"has":"no",onValueChange:t=>{Q(t==="all"?{value:null,label:"All"}:t==="has"?{value:!0,label:"Has Image"}:{value:!1,label:"No Image"})},children:[e.jsx($,{children:e.jsx(E,{placeholder:"Filter by image"})}),e.jsxs(z,{children:[e.jsx(b,{value:"all",children:"All"}),e.jsx(b,{value:"has",children:"Has Image"}),e.jsx(b,{value:"no",children:"No Image"})]})]})]})]})})}),ue&&e.jsxs(K,{className:"mb-6",children:[e.jsx(Ae,{children:e.jsx(Te,{children:u?`Edit ${u.type}`:`Add ${s.type}`})}),e.jsx("form",{onSubmit:je,children:e.jsxs(X,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"item-name",children:"Item Name"}),e.jsx(h,{id:"item-name",value:s.name,onChange:t=>l({...s,name:t.target.value}),placeholder:"Enter item name",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"category",children:"Category"}),e.jsxs(T,{value:P?.value?.toString()||void 0,onValueChange:t=>{const a=D.find(i=>i.value===parseInt(t));N(a||null)},children:[e.jsx($,{id:"category",className:x==="dark"?"bg-gray-800 text-white border-gray-600":"",children:e.jsx(E,{placeholder:"Select Category"})}),e.jsx(z,{children:D.map(t=>e.jsx(b,{value:t.value.toString(),children:t.label},t.value))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"description",children:"Description"}),e.jsx(Qe,{id:"description",value:s.description,onChange:t=>l({...s,description:t.target.value}),placeholder:"Enter description",rows:3,className:x==="dark"?"bg-gray-800 text-white border-gray-600":""})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Locations"}),e.jsxs("div",{className:"space-y-3",children:[s.locations.map((t,a)=>e.jsxs("div",{className:"flex flex-wrap gap-2 p-4 border rounded-md items-end",children:[e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Location"}),e.jsxs(T,{value:t.location?.value?.toString()||void 0,onValueChange:i=>{const n=[...s.locations],o=ae.find(r=>r.id===parseInt(i));n[a].location=o?{value:o.id,label:o.name}:null,l({...s,locations:n})},children:[e.jsx($,{children:e.jsx(E,{placeholder:"Select location"})}),e.jsx(z,{children:ae.filter(i=>!s.locations.some(n=>n.location?.value===i.id&&n!==t)).map(i=>e.jsx(b,{value:i.id.toString(),children:i.name},i.id))})]})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px] mb-2",children:[e.jsx(d,{children:"Quantity"}),e.jsx(h,{type:"text",value:t.quantity,onChange:i=>{const n=[...s.locations];n[a].quantity=i.target.value.replace(/[^0-9]/g,""),l({...s,locations:n})},placeholder:"Quantity",className:x==="dark"?"bg-gray-800 text-white border-gray-600":""})]}),e.jsxs("div",{className:"flex items-end gap-2 mb-2",children:[e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>l({...s,locations:[...s.locations,{location:null,quantity:""}]}),children:e.jsx(j,{className:"h-4 w-4"})}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>{const i=s.locations.filter((n,o)=>o!==a);l({...s,locations:i})},children:e.jsx(k,{className:"h-4 w-4"})})]})]},a)),s.locations?.length===0&&e.jsxs(m,{type:"button",variant:"outline",onClick:()=>l({...s,locations:[...s.locations,{location:null,quantity:""}]}),className:"w-full border-green-600 text-green-600 hover:text-primary",children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Add Location"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Images"}),e.jsxs("div",{className:"space-y-3",children:[s.images.map((t,a)=>e.jsxs("div",{className:"flex flex-wrap gap-2 p-4 border rounded-md items-end",children:[e.jsxs("div",{className:"space-y-2 flex-1 min-w-[150px]",children:[e.jsx(d,{children:"Image"}),t.existing?e.jsxs("div",{className:"relative group",children:[e.jsx(ce,{title:"Item Images",imageSrcs:s.images.filter(i=>i.existing).map(i=>A(i.existing.fileName)),children:e.jsx("img",{src:A(t.existing.fileName),alt:"Existing",className:"w-20 h-20 object-cover rounded-md border cursor-pointer hover:opacity-80 transition-opacity"})}),e.jsx("button",{type:"button",onClick:()=>le(a),className:"absolute -top-2 left-17 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(oe,{className:"h-3 w-3"})})]}):t.file?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:URL.createObjectURL(t.file),alt:"New",className:"w-20 h-20 object-cover rounded-md border"}),e.jsx("button",{type:"button",onClick:()=>le(a),className:"absolute -top-2 left-17 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",children:e.jsx(oe,{className:"h-3 w-3"})})]}):e.jsx("div",{className:"w-20 h-20 border-2 border-dashed border-muted-foreground/30 rounded-md flex items-center justify-center cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>q.current[a]?.click(),children:e.jsx(Je,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx("input",{ref:i=>{q.current[a]=i},type:"file",accept:"image/jpeg,image/png,image/webp,image/gif",onChange:i=>Ce(a,i),className:"hidden"}),ie[`image_${a}`]&&e.jsx("p",{className:"text-sm text-red-500",children:ie[`image_${a}`]})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Type"}),e.jsx(h,{value:t.type,onChange:i=>{const n=[...s.images];n[a].type=i.target.value,l({...s,images:n})},placeholder:"Type"})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Rank"}),e.jsx(h,{type:"text",value:t.rank,onChange:i=>{const n=[...s.images];n[a].rank=i.target.value.replace(/[^0-9]/g,""),l({...s,images:n})},placeholder:"Rank",className:x==="dark"?"bg-gray-800 text-white border-gray-600":""})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>l({...s,images:[...s.images,{file:null,type:"",rank:"",existing:void 0}]}),children:e.jsx(j,{className:"h-4 w-4"})}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>{const i=s.images.filter((n,o)=>o!==a);l({...s,images:i})},children:e.jsx(k,{className:"h-4 w-4"})})]})]},a)),s.images?.length===0&&e.jsxs(m,{type:"button",variant:"outline",onClick:()=>l({...s,images:[...s.images,{file:null,type:"",rank:"",existing:void 0}]}),className:"w-full border-green-600 text-green-600 hover:text-primary",children:[e.jsx(j,{className:"h-4 w-4 mr-2"})," Add Image"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:s.type==="Product"||u?.type==="Product"?"Price Lists":"Invoices"}),e.jsxs("div",{className:"space-y-3",children:[s.invoices.map((t,a)=>e.jsxs("div",{className:"flex flex-wrap gap-2 p-4 border rounded-md items-end",children:[e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Date"}),e.jsxs(Ue,{children:[e.jsx(Re,{asChild:!0,children:e.jsxs(m,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),t.date?Fe(t.date,"yyyy-MM-dd"):"Invoice Date"]})}),e.jsx(_e,{className:"w-auto p-0",children:e.jsx(Le,{mode:"single",selected:t.date,onSelect:i=>{const n=[...s.invoices];n[a].date=i,l({...s,invoices:n})},autoFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Quantity"}),e.jsx(h,{type:"text",value:t.quantity,onChange:i=>{const n=[...s.invoices];n[a].quantity=i.target.value.replace(/[^0-9]/g,""),l({...s,invoices:n})},placeholder:"Quantity"})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Unit Price"}),e.jsx(h,{type:"text",value:t.unitPrice,onChange:i=>{const n=[...s.invoices];n[a].unitPrice=i.target.value.replace(/[^0-9.]/g,""),l({...s,invoices:n})},placeholder:"Unit Price",className:x==="dark"?"bg-gray-800 text-white border-gray-600":""})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Base Price"}),e.jsx(h,{type:"text",value:t.basePrice,onChange:i=>{const n=[...s.invoices];n[a].basePrice=i.target.value.replace(/[^0-9.]/g,""),l({...s,invoices:n})},placeholder:"Base Price"})]}),e.jsxs("div",{className:"space-y-2 flex-1 min-w-[120px]",children:[e.jsx(d,{children:"Weight"}),e.jsx(h,{type:"text",value:t.weight,onChange:i=>{const n=[...s.invoices];n[a].weight=i.target.value,l({...s,invoices:n})},placeholder:"Weight",className:x==="dark"?"bg-gray-800 text-white border-gray-600":""})]}),s.type==="Product"||u?.type==="Product"?e.jsxs("div",{className:"flex items-end gap-2 flex-1 min-w-[150px]",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(d,{children:"BOM Cost"}),e.jsx(h,{type:"text",value:t.bomCost,onChange:i=>{const n=[...s.invoices];n[a].bomCost=i.target.value.replace(/[^0-9.]/g,""),l({...s,invoices:n})},placeholder:"BOM Cost"})]}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>l({...s,invoices:[...s.invoices,{date:null,quantity:"",unitPrice:"",basePrice:"",weight:"",bomCost:""}]}),children:e.jsx(j,{className:"h-4 w-4"})}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>{const i=s.invoices.filter((n,o)=>o!==a);l({...s,invoices:i})},children:e.jsx(k,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>l({...s,invoices:[...s.invoices,{date:null,quantity:"",unitPrice:"",basePrice:"",weight:"",bomCost:""}]}),children:e.jsx(j,{className:"h-4 w-4"})}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>{const i=s.invoices.filter((n,o)=>o!==a);l({...s,invoices:i})},children:e.jsx(k,{className:"h-4 w-4"})})]})]},t.date+a)),s.invoices?.length===0&&e.jsxs(m,{type:"button",variant:"outline",onClick:()=>l({...s,invoices:[...s.invoices,{date:null,quantity:"",unitPrice:"",basePrice:"",weight:"",bomCost:""}]}),className:"w-full border-green-600 text-green-600 hover:text-primary",children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Add ",s.type==="Product"||u?.type==="Product"?"SKU":"Invoice"]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-6",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(m,{type:"submit",children:u?`Update ${u.type}`:`Add ${s.type}`})]})]})})]}),e.jsx(K,{children:e.jsx(X,{className:"p-0",children:e.jsxs(Ve,{children:[e.jsx(He,{children:e.jsxs(Y,{children:[e.jsx(g,{style:{width:"100px"},children:"Actions"}),e.jsx(g,{children:"Image"}),e.jsx(g,{style:{width:"200px"},children:"Name"}),e.jsx(g,{style:{width:"300px"},children:"Description"}),e.jsx(g,{children:"Type"}),e.jsx(g,{style:{width:"210px"},children:"Category"}),e.jsx(g,{style:{width:"140px"},children:"Base Price"}),e.jsx(g,{style:{width:"120px"},children:"Unit Price"}),e.jsx(g,{style:{width:"100px"},children:"Stock"}),e.jsx(g,{style:{width:"230px"},children:"Locations"}),e.jsx(g,{style:{width:"220px"},children:"Invoices"})]})}),e.jsxs(Ge,{children:[Z.map(t=>e.jsxs(Y,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{size:"sm",variant:"outline",onClick:()=>be(t),children:e.jsx(Ke,{className:"h-4 w-4"})}),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>we(t),children:e.jsx(k,{className:"h-4 w-4"})})]})}),e.jsx(p,{children:(()=>{const a=t.ItemImages||[],i=t.ProductImages||[],n=[...a.map((o,r)=>({url:A(o.image),index:r})),...i.map((o,r)=>({url:A(o.fileName),index:a.length+r}))];return n.length>0?e.jsx(ce,{title:`${t.name} Images`,imageSrcs:n.map(o=>o.url),children:e.jsxs("div",{className:"relative group cursor-pointer",children:[e.jsx("img",{src:n[0].url,alt:t.name,className:"w-12 h-12 object-cover rounded-md border cursor-pointer hover:opacity-80 transition-opacity"}),n.length>1&&e.jsx("span",{className:"absolute -bottom-1 -right-1 bg-primary text-primary-foreground text-[10px] px-1 rounded-full",children:n.length})]})}):e.jsx("span",{className:"text-muted-foreground",children:"No Image"})})()}),e.jsx(p,{className:"font-medium",children:t.name}),e.jsx(p,{children:t.description||t.tagline||"-"}),e.jsx(p,{children:t.type}),e.jsx(p,{children:t.Category?.category}),e.jsxs(p,{children:["₹",t.PriceLists?.[0]?.basePrice||t.ItemInvoices?.[t.ItemInvoices.length-1]?.basePrice||"-"]}),e.jsxs(p,{children:["₹",t.PriceLists?.[0]?.unitprice||t.ItemInvoices?.[t.ItemInvoices.length-1]?.unitprice||"-"]}),e.jsx(p,{children:t.locations?.reduce((a,i)=>a+(i.ProductLocation.quantity||0),0)||t.ItemLocations?.reduce((a,i)=>a+(i.quantity||0),0)||"-"}),e.jsx(p,{children:t.locations?.map(a=>`${a.name} (${a.room}) [${a.ProductLocation.quantity}]`).join(", ")||t.ItemLocations?.map(a=>`${a.Location.name} (${a.Location.room}) [${a.quantity}]`).join(", ")||"-"}),e.jsx(p,{children:t.PriceLists?.length>0?`${new Date(t.updatedAt).toLocaleDateString()} (${t.PriceLists?.[t.PriceLists.length-1].quantity??0})`:t.ItemInvoices?.length>0?`${new Date(t.ItemInvoices?.[t.ItemInvoices.length-1].date).toLocaleDateString()} (${t.ItemInvoices?.[t.ItemInvoices.length-1].quantity??0} x ₹${t.ItemInvoices?.[t.ItemInvoices.length-1].unitprice})`:"-"})]},t.type+t.id)),Z.length===0&&e.jsx(Y,{children:e.jsx(p,{colSpan:11,className:"text-center py-8 text-muted-foreground",children:"No items found. Add some items to get started."})})]})]})})})]})]}),e.jsx($e,{open:pe,onOpenChange:I,children:e.jsxs(Ee,{className:x==="dark"?"bg-gray-800 text-white border-gray-600":"",children:[e.jsxs(ze,{children:[e.jsx(Be,{children:"Confirm Delete"}),e.jsxs(Me,{children:['Are you sure you want to delete the item "',U?.name,'"? This action cannot be undone.']})]}),e.jsxs(Oe,{children:[e.jsx(m,{variant:"outline",onClick:()=>I(!1),className:x==="dark"?"bg-gray-800 text-white border-gray-600":"",children:"Cancel"}),e.jsx(m,{variant:"destructive",onClick:Ne,children:"Delete"})]})]})}),e.jsx(Se,{})]})};export{Pt as default};

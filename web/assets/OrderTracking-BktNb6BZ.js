import{r as i,n as Z,o as _,j as e,V as ee}from"./vendor-react-Bv33ryjV.js";import{C as re}from"./dropdown-menu-BDj5FxyU.js";import{T as se}from"./TopNav-JT08H0jt.js";import{u as te,A as b,e as j,c as d,B as x}from"./index-BgzncNPj.js";import{B as ae}from"./badge-FegKslFz.js";import{C as R,c as z,a as le,b as de}from"./card-dPuP1Ci1.js";import{D as oe,a as ne,b as ce,c as ie,d as me}from"./dialog-DjJou7Bz.js";import{I as A}from"./input-B6PrAciv.js";import{L as H}from"./label-bvSFhUHd.js";import"./NavBar-BWSSAL5l.js";import"./TopBar-D2vj-zy0.js";import"./vendor-pdf-DxqLLkkN.js";const Ce=()=>{const{effectiveTheme:n}=te(),[P,B]=i.useState(""),[D,U]=i.useState(""),[O,S]=i.useState([]),[I,p]=i.useState(!!localStorage.getItem("token")),[m,Y]=i.useState(null),[u,y]=i.useState(null),[F,N]=i.useState(null),[L,$]=i.useState(null),[q,v]=Z.useState({}),[J,k]=i.useState(!1),[T,C]=i.useState(null),E=_(),h=!!localStorage.getItem("token");i.useEffect(()=>{const r=localStorage.getItem("token");r&&b.postData({endpoint:"/order/get-user-orders",body:{request:j({token:r})},isCriticalApi:!0,successCallback:t=>{t.error?d.error(t.error):S(t.orders||[]),p(!1)},errorCallback:t=>{d.error("Failed to fetch user orders: "+t?.error),p(!1)}})},[]);const K=r=>{if(r.preventDefault(),!P||!D){d.error("Please enter both Order ID and Phone Number");return}p(!0),b.postData({endpoint:"/order/get-order-details",body:{request:j({id:P,phone:D})},isCriticalApi:!0,successCallback:t=>{t.error?d.error(t.error):S([t]),p(!1)},errorCallback:t=>{d.error("Failed to fetch order details: "+t?.error),p(!1)}})},Q=r=>{C(r),k(!0)},V=()=>{if(!T)return;k(!1),N(T);const r=localStorage.getItem("token");if(!r){d.error("Please login to cancel orders"),N(null);return}b.postData({endpoint:"/order/cancel-order",body:{request:j({id:T,token:r})},successCallback:t=>{t.error?d.error(t.error):(d.success(t.response?.message||"Order cancelled successfully"),b.postData({endpoint:"/order/get-user-orders",body:{request:j({token:r})},successCallback:s=>{s.error?d.error(s.error):S(s.orders||[]),p(!1)},errorCallback:s=>{d.error("Failed to refresh orders: "+s?.error),p(!1)}})),N(null),C(null)},errorCallback:t=>{d.error("Failed to cancel order: "+t?.error),N(null),C(null)}})},W=()=>{k(!1),C(null)},G=r=>{$(r);const t=localStorage.getItem("token");if(!t){d.error("Please login to reorder");return}b.postData({endpoint:"/order/reorder",body:{request:j({id:r,token:t})},successCallback:s=>{s.error?d.error(s.error):(d.success(s.response?.message||"Order reordered successfully"),b.postData({endpoint:"/order/pending-order",body:{request:j({token:localStorage.getItem("token")})},successCallback:l=>{if(l?.products&&Array.isArray(l.products)&&l.products.length>0){let a=[];try{const o=localStorage.getItem("cart");o&&(a=JSON.parse(o))}catch{a=[]}const c=[...l.products];a.forEach(o=>{const g=c.findIndex(f=>f.productId===o.productId&&f.priceList?.id===o.priceList?.id);g===-1?c.push(o):c[g].quantity=o.quantity}),localStorage.setItem("cart",JSON.stringify(c)),E("/checkout")}},errorCallback:l=>{console.error("Error fetching pending order:",l),E("/")}}),d.success(`New cart created with ${s?.productsCount} item(s). Check your cart to proceed.`)),$(null)},errorCallback:s=>{d.error("Failed to reorder: "+s?.error),$(null)}})},X=r=>{v(s=>({...s,[r]:!0}));const t=localStorage.getItem("token");if(!t){d.error("Please login to download invoice"),v(s=>({...s,[r]:!1}));return}b.postData({endpoint:"/order/download-invoice",body:{request:j({orderId:r,token:t})},responseType:"blob",successCallback:s=>{const l=window.URL.createObjectURL(s),a=document.createElement("a");a.href=l,a.download=`Renus Home Foods - Order Invoice - ${r}.pdf`,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(l),document.body.removeChild(a),d.success("Invoice downloaded successfully"),v(c=>({...c,[r]:!1}))},errorCallback:s=>{d.error("Failed to download invoice: "+s?.error),v(l=>({...l,[r]:!1}))}})};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(se,{}),e.jsx("div",{className:"flex-1 pt-8 pb-20 px-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto py-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(ee,{size:"50px",className:"text-primary"})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground mb-2",children:h?"Your Orders":"Order Tracking"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:h?"Track and manage all your orders":"Track your order status in real-time"})]}),!h&&e.jsx(R,{className:"mb-6",children:e.jsxs(z,{className:"p-4 sm:p-6",children:[e.jsx("div",{className:"text-center mb-4",children:e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Track Your Order"})}),e.jsx("form",{onSubmit:K,children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:flex lg:gap-4 lg:items-end lg:justify-center",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(H,{htmlFor:"order-id",className:"text-sm font-medium text-foreground",children:["Order ID ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(A,{id:"order-id",type:"text",value:P,onChange:r=>B(r.target.value),placeholder:"Enter Your Order ID",required:!0,className:"h-11 sm:h-12 text-sm sm:text-base"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(H,{htmlFor:"phone",className:"text-sm font-medium text-foreground",children:["Phone Number ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(A,{id:"phone",type:"tel",value:D,onChange:r=>U(r.target.value),placeholder:"Enter Your Phone Number",required:!0,className:"h-11 sm:h-12 text-sm sm:text-base"})]}),e.jsx("div",{className:"lg:w-40",children:e.jsx(x,{type:"submit",className:"w-full h-11 sm:h-12 text-sm sm:text-base font-medium",disabled:I,children:I?"Tracking...":"Track Order"})})]})})]})}),e.jsx("div",{className:"w-full",children:I&&h?e.jsxs("div",{className:"text-center py-16 lg:py-20",children:[e.jsx("div",{className:"w-12 h-12 lg:w-16 lg:h-16 mx-auto mb-4",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 lg:h-16 lg:w-16 border-b-2 border-primary mx-auto"})}),e.jsx("p",{className:"text-sm lg:text-base text-muted-foreground",children:"Loading your orders..."})]}):e.jsxs(e.Fragment,{children:[O.length===0&&h&&e.jsxs("div",{className:"text-center py-16 lg:py-20",children:[e.jsx("div",{className:"w-16 h-16 lg:w-20 lg:h-20 mx-auto mb-4 bg-muted rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-2xl lg:text-3xl",children:"ðŸ›’"})}),e.jsx("h3",{className:"text-xl lg:text-2xl font-semibold text-foreground mb-2",children:"No Orders Yet"}),e.jsx("p",{className:"text-sm lg:text-base text-muted-foreground max-w-md mx-auto",children:"Place your first order to discover our delicious range of healthy snacks and instant foods!"})]}),O.length>0&&e.jsx("div",{children:O.map((r,t)=>e.jsxs(R,{className:"mb-4",children:[e.jsxs(le,{className:"flex flex-row justify-between items-center",children:[e.jsxs(de,{className:"text-lg",children:["Order #",r.order?.id]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"font-bold",children:["Order Total : ",(()=>{const s=r.products?.reduce((f,w)=>f+w.quantity*(w.priceList?.unitprice||0),0)||0,l=r.totalDiscount||0,a=r.order?.shippingMethod==="Home Delivery"&&s<999?99:0,c=r.shippingDiscount||0,o=a>0?a-c:0;return`â‚¹${(s-l+o).toFixed(2)}`})()]}),e.jsx(ae,{variant:r.order?.status==="Payment Processed"||r.order?.status==="Ordered"||r.order?.status==="Delivered"||r.order?.status==="Payment Processed"?"default":r.order?.status==="Cancelled"?"destructive":"secondary",children:r.order?.status})]})]}),e.jsxs(z,{children:[e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name & Address:"})," ",r.order?.name,", ",r.order?.address,", ",r.order?.city,", ",r.order?.state," - ",r.order?.pincode]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Mobile:"})," ",r.order?.mobile," | ",e.jsx("strong",{children:"Email:"})," ",r.order?.email," "]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Order Date:"})," ",r.order?.orderedDate?new Date(r.order.orderedDate).toLocaleDateString():""," | ",e.jsx("strong",{children:r.order?.status==="Delivered"?"Delivery Date: ":"Estimated Delivery Date: "})," ",r.order?.expectedDeliveryDate?new Date(r.order.expectedDeliveryDate).toLocaleDateString():""," "]}),r.order?.deliveryNote&&e.jsxs("p",{children:[e.jsx("strong",{children:"Notes:"})," ",r.order?.deliveryNote]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4 mr-2",children:[e.jsxs(x,{variant:m===t&&u==="products"?"default":"outline",size:"sm",className:m===t&&u==="products"?"":"border-green-600 text-green-600 hover:bg-green-50",onClick:()=>{m===t&&u==="products"?y(null):(Y(t),y("products"))},children:[m===t&&u==="products"?"Hide":"Show"," Order Details"]}),e.jsxs(x,{variant:m===t&&u==="tracking"?"default":"outline",size:"sm",className:m===t&&u==="tracking"?"":"border-green-600 text-green-600 hover:bg-green-50",onClick:()=>{m===t&&u==="tracking"?y(null):(Y(t),y("tracking"))},children:[m===t&&u==="tracking"?"Hide":"Show"," Order Tracking"]}),h&&(r.order?.status==="Payment Processed"||r.order?.status==="Ordered"||r.order?.status==="Processing"||r.order?.status==="Packed")&&e.jsx(x,{variant:"destructive",size:"sm",onClick:()=>Q(r.order?.id),disabled:F===r.order?.id,children:F===r.order?.id?"Cancelling...":"Cancel Order"}),h&&(r.order?.status==="Delivered"||r.order?.status==="Cancelled")&&e.jsx(x,{variant:"outline",size:"sm",className:"border-green-600 text-green-600 hover:bg-green-50",onClick:()=>G(r.order?.id),disabled:L===r.order?.id,children:L===r.order?.id?"Reordering...":"Reorder"}),h&&(r.order?.status==="Shipped"||r.order?.status==="Delivered")&&e.jsx(x,{variant:"outline",size:"sm",className:"border-green-600 text-green-600 hover:bg-green-50",onClick:()=>X(r.order?.id),disabled:q[r.order?.id]===!0,children:q[r.order?.id]===!0?"Downloading...":"Download Invoice"})]}),m===t&&u==="products"&&r.products&&r.products.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("b",{children:"Order Notes: "})," ",r?.order?.notes]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:`w-full border ${n==="dark"?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"}`,children:[e.jsx("thead",{children:e.jsxs("tr",{className:`${n==="dark"?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("th",{className:"text-left p-3 font-medium",children:"Products"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Name"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Weight"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Price"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Quantity"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Total"})]})}),e.jsx("tbody",{children:r.products.map((s,l)=>e.jsxs("tr",{className:`border-t ${n==="dark"?"border-gray-600":"border-gray-200"}`,children:[e.jsx("td",{className:"p-3",children:e.jsx("div",{className:"flex items-center",children:e.jsx("img",{src:s.image?`/static/inventory/${s.image}`:"/img/logo.webp",className:"w-12 h-12 object-cover rounded",alt:s.name||"Product"})})}),e.jsx("td",{className:"p-3",children:s.name}),e.jsx("td",{className:"p-3",children:s.priceList?.weight}),e.jsxs("td",{className:"p-3",children:["â‚¹",s.priceList?.unitprice]}),e.jsx("td",{className:"p-3",children:s.quantity}),e.jsxs("td",{className:"p-3",children:["â‚¹",s.quantity*(s.priceList?.unitprice||0)]})]},l))})]})}),e.jsx("div",{className:"mt-4",children:e.jsx("table",{className:`w-full border ${n==="dark"?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"}`,children:e.jsx("tbody",{children:(()=>{const s=r.products.reduce((w,M)=>w+M.quantity*(M.priceList?.unitprice||0),0).toFixed(2),l=(r.totalDiscount||0).toFixed(2),a=r.order?.shippingMethod==="Home Delivery"&&s<999?99:0,c=r.shippingDiscount||0,o=r.couponCode||null,g=Math.max(0,a-c),f=(s-l+g).toFixed(2);return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`border-t ${n==="dark"?"border-gray-600":"border-gray-200"}`,children:[e.jsx("td",{className:"p-3 text-right font-medium",children:"Subtotal"}),e.jsxs("td",{className:"p-3 text-right",children:["â‚¹",s]})]}),l>0&&e.jsxs("tr",{className:`border-t ${n==="dark"?"border-gray-600":"border-gray-200"}`,children:[e.jsxs("td",{className:"p-3 text-right font-medium",children:["Discount (Code: ",o,")"]}),e.jsxs("td",{className:"p-3 text-right",children:["-â‚¹",l]})]}),e.jsxs("tr",{className:`border-t ${n==="dark"?"border-gray-600":"border-gray-200"}`,children:[e.jsxs("td",{className:"p-3 text-right font-medium",children:["Shipping",o&&c>0?` (Code: ${o})`:""]}),e.jsxs("td",{className:"p-3 text-right",children:["â‚¹",g.toFixed(2)]})]}),e.jsxs("tr",{className:`border-t ${n==="dark"?"border-gray-600":"border-gray-200"}`,children:[e.jsx("td",{className:"p-3 text-right font-medium",children:"Total"}),e.jsxs("td",{className:"p-3 text-right font-bold",children:["â‚¹",f]})]}),e.jsxs("tr",{className:`border-t ${n==="dark"?"border-gray-600":"border-gray-200"}`,children:[e.jsx("td",{className:"p-3 text-right font-medium",children:"Shipping Method"}),e.jsx("td",{className:"p-3 text-right",children:r.order?.shippingMethod})]}),e.jsxs("tr",{className:`border-t ${n==="dark"?"border-gray-600":"border-gray-200"}`,children:[e.jsx("td",{className:"p-3 text-right font-medium",children:"Payment Method"}),e.jsx("td",{className:"p-3 text-right",children:r.order?.paymentMethod})]})]})})()})})})]}),m===t&&u==="tracking"&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex justify-between items-center relative",style:{zIndex:2},children:(r.order?.status==="Cancelled"?[{key:"cancelled",label:"Cancelled",descPending:"",descInProgress:"",descCompleted:"Your order has been cancelled and refunded",img:"/img/cancelled.svg"}]:[{key:"ordered",label:"Ordered",descPending:"",descInProgress:"Your order has been successfully placed",descCompleted:"Your order has been successfully placed",img:"/img/ordered.svg"},{key:"processing",label:"Processing",descPending:"Your order will be prepared shortly",descInProgress:"Your order is being prepared",descCompleted:"Your order was prepared",img:"/img/processing.svg"},{key:"packed",label:"Packed",descPending:"Your order will be packed soon",descInProgress:"Your order is being packed",descCompleted:"Your order was packed",img:"/img/packed.svg"},{key:"dispatched",label:"Shipped",descPending:"Your order will be dispatched soon",descInProgress:"Your order has been shipped",descCompleted:"Your order was shipped",img:"/img/shipped.svg"},{key:"delivered",label:"Delivered",descPending:"Your order will be delivered soon",descInProgress:"Your order has been delivered",descCompleted:"Your order has been delivered",img:"/img/delivered.svg"}]).map((l,a)=>{const c=r.order?.status==="Payment Processed"&&a<=0||r.order?.status==="Ordered"&&a<=0||r.order?.status==="Processing"&&a<=1||r.order?.status==="Packed"&&a<=2||r.order?.status==="Shipped"&&a<=3||r.order?.status==="Delivered"&&a<=4||r.order?.status==="Cancelled"&&a<=0,o=r.order?.status==="Payment Processed"&&a===0||r.order?.status==="Ordered"&&a===0||r.order?.status==="Processing"&&a===1||r.order?.status==="Packed"&&a===2||r.order?.status==="Shipped"&&a===3||r.order?.status==="Delivered"&&a===4,g=r.order?.status==="Ordered"&&a>0||r.order?.status==="Payment Processed"&&a>0||r.order?.status==="Processing"&&a>1||r.order?.status==="Packed"&&a>2||r.order?.status==="Shipped"&&a>3||r.order?.status==="Delivered"&&a>4||r.order?.status==="Cancelled"&&a>0;return e.jsx("div",{className:"text-center relative flex w-44 h-36 z-2 bg-background",children:e.jsxs("div",{className:`p-3 rounded-lg border-2 ${c?"border-green-500 text-green-500":o?"border-blue-500":"border-gray-300"}`,children:[e.jsx("img",{src:l.img,alt:l.label,className:`w-20 h-12 mx-auto mb-2 object-contain ${n==="dark"?"brightness-0 invert":""}`}),e.jsx("div",{className:`font-bold text-sm ${c?"text-green-600":"text-grey-600"}`,children:l.label}),g&&e.jsx("small",{className:`block mt-1 text-sm ${n==="dark"?"text-gray-300":"text-gray-600"}`,children:l.descPending}),o&&e.jsx("small",{className:`block mt-1 text-sm ${n==="dark"?"text-green-200":"text-green-600"}`,children:l.descInProgress}),c&&!o&&e.jsx("small",{className:`block mt-1 text-sm ${n==="dark"?"text-green-200":"text-green-600"}`,children:l.descCompleted})]})},l.key)})}),r.order?.status!=="Cancelled"&&e.jsx("div",{className:"absolute top-1/2 left-0 right-0 -translate-y-1/2 pointer-events-none",children:e.jsx("div",{className:"relative h-1 bg-gray-300",children:e.jsx("div",{className:"h-full absolute left-0 bg-green-500 transition-all duration-300",style:{width:`${(()=>{const s=["Payment Processed","Ordered","Processing","Packed","Shipped","Delivered"],l=s.indexOf(r.order?.status);return l<=0?"0%":l>=s.length-1?"100%":`${l/(s.length-1)*100}%`})()}`}})})})]})})]})]},t))})]})})]})}),e.jsx(oe,{open:J,onOpenChange:k,children:e.jsxs(ne,{className:"sm:max-w-[425px]",children:[e.jsx(ce,{children:e.jsx(ie,{children:"Cancel Order"})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{children:"Are you sure you want to cancel this order? This action cannot be undone."})}),e.jsxs(me,{children:[e.jsx(x,{variant:"outline",onClick:W,children:"No, Keep Order"}),e.jsx(x,{variant:"destructive",onClick:V,children:"Yes, Cancel Order"})]})]})}),e.jsx(re,{})]})};export{Ce as default};

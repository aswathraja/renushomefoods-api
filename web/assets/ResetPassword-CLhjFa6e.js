import{r as e,m as s,j as t,aj as r,ak as a,aJ as l,L as n}from"./vendor-react-Tc4xLtOv.js";import{L as o,C as i}from"./dropdown-menu-Dweh6OYL.js";import{T as d}from"./TopNav-BXcsdcnw.js";import{B as c,A as m,e as u,c as x}from"./index-CCl3TzR2.js";import{C as p,a as h,b as j,c as g}from"./card-ZRElQZzO.js";import{I as f}from"./input-group-BGtxGQoB.js";import"./vendor-charts-DKw1ZHYY.js";import"./vendor-ui-utils-B4kPJlQS.js";import"./vendor-radix-O0RUyoIw.js";import"./NavBar-CdfgxkT6.js";import"./TopBar-DKySbC2h.js";import"./vendor-pdf-export-C4gp01y5.js";import"./vendor-animation-BGrdDg6I.js";import"./input-F4kRSedd.js";const w=()=>{const w=[{label:"At least 8 characters",test:e=>e.length>=8},{label:"One uppercase letter",test:e=>/[A-Z]/.test(e)},{label:"One lowercase letter",test:e=>/[a-z]/.test(e)},{label:"One digit",test:e=>/\d/.test(e)},{label:"One special character",test:e=>/[@$!%*?&()[\]{}#^~<>+=_|\\/.,:;"'-]/.test(e)}],[b,v]=e.useState(""),[N,y]=e.useState(""),[P,S]=e.useState(""),[O,T]=e.useState({}),[C,E]=e.useState(!1),[k,I]=e.useState(""),[F,$]=e.useState(!1),[A,B]=e.useState(!1),[q,z]=e.useState(w.map(()=>!1)),[M,R]=e.useState(null),[Z,D]=e.useState(15),[L,_]=e.useState(!1),G=s(),H=sessionStorage.getItem("resetIdentifier");e.useEffect(()=>{H||G("/login")},[H,G]),e.useEffect(()=>{R(P||N?N===P:null)},[N,P]),e.useEffect(()=>{if(Z>0){const e=setInterval(()=>{D(e=>e-1)},1e3);return()=>clearInterval(e)}_(!0)},[Z]);return e.useEffect(()=>{I((e=>{if(!e)return"";let s=0;return e.length>=8&&s++,/[A-Z]/.test(e)&&s++,/[a-z]/.test(e)&&s++,/\d/.test(e)&&s++,/[@$!%*?&()[\]{}#^~<>+=_|\\/.,:;"'-]/.test(e)&&s++,s>=5?"Strong":s>=3?"Medium":"Weak"})(N)),z(w.map(e=>e.test(N)))},[N]),t.jsxs(t.Fragment,{children:[t.jsx(d,{}),t.jsx("div",{className:"min-h-screen flex items-center justify-center py-6 sm:py-8 lg:py-12 px-4",children:t.jsxs("div",{className:"w-full max-w-md",children:[t.jsx("div",{className:"w-42 h-42 sm:w-42 sm:h-42 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center",children:t.jsx(o,{size:"xxl"})}),t.jsx("div",{className:"mb-6",children:t.jsxs(r,{to:"/login",className:"inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors",children:[t.jsx(a,{className:"h-4 w-4"}),"Back to Login"]})}),t.jsxs(p,{className:"shadow-lg",children:[t.jsxs(h,{className:"text-center pb-6",children:[t.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center",children:t.jsx(l,{className:"h-8 w-8 text-primary"})}),t.jsx(j,{className:"text-2xl sm:text-3xl font-bold",children:"Reset Password"}),t.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mt-2",children:"Enter the OTP sent to your email/phone and create a new password."})]}),t.jsx(g,{children:t.jsxs("form",{onSubmit:async e=>{e.preventDefault(),T({}),(()=>{const e={};return b.match(/^\d{4}$/)||(e.otp="OTP must be exactly 4 digits"),/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&()[\]{}#^~<>+=_|\\/.,:;"'-])[A-Za-z\d@$!%*?&()[\]{}#^~<>+=_|\\/.,:;"'-]{8,}$/.test(N)||(e.newPassword="Password must be at least 8 characters long and include a capital letter, a lowercase letter, a number, and a special character."),N!==P&&(e.confirmPassword="Passwords do not match"),H||(e.apiError="Missing identifier. Please restart the forgot password process."),T(e),0===Object.keys(e).length})()&&(E(!0),m.postData({endpoint:"/user/reset-password",body:{request:u({identifier:H,otp:b,newPassword:N})},successCallback:()=>{E(!1),sessionStorage.removeItem("resetIdentifier"),x.success("Password has been reset. Please continue to login"),G("/login")},errorCallback:e=>{E(!1),T({apiError:e?.error||"Failed to reset password. Please try again."})}}))},className:"space-y-6",children:[O.apiError&&t.jsx("div",{className:"bg-destructive/10 text-destructive border border-destructive/20 rounded-md p-3 text-sm",role:"alert",children:O.apiError}),t.jsx(f,{label:"OTP",type:"text",value:b,onChange:e=>{/^\d{0,4}$/.test(e)&&v(e)},placeholder:"Enter 4-digit OTP",inputMode:"numeric",maxLength:4,error:O.otp,required:!0}),t.jsx("div",{className:"text-center",children:L?t.jsx("button",{type:"button",className:"text-sm text-primary hover:text-primary/80 font-medium transition-colors disabled:opacity-50",onClick:e=>{C||(e.preventDefault(),(async()=>{L&&H&&(E(!0),m.postData({endpoint:"/user/forgot-password",body:{request:u({identifier:H,regenerate:!1})},successCallback:e=>{E(!1),x.success(e.message||"OTP resent successfully."),D(15),_(!1)},errorCallback:()=>{E(!1),x.error("Failed to resend OTP. Please try again.")}}))})())},disabled:C,children:"Resend OTP"}):t.jsxs("span",{className:"text-sm text-muted-foreground",children:["Resend OTP in ",Z,"s"]})}),t.jsxs("div",{children:[t.jsx(f,{label:"New Password",type:"password",value:N,onChange:e=>{y(e),!A&&e&&B(!0)},placeholder:"Enter new password",onFocus:()=>$(!0),onBlur:()=>$(!1),error:O.newPassword,showPasswordToggle:!0,required:!0}),(F||A)&&t.jsxs("div",{className:"mt-2",children:[A&&t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:"h-2 rounded-full transition-all "+("Strong"===k?"bg-primary":"Medium"===k?"bg-yellow-500":"bg-red-500"),style:{width:q.filter(Boolean).length/w.length*100+"%"}})}),F&&t.jsx("ul",{className:"mt-2 space-y-1",children:w.map((e,s)=>t.jsxs("li",{className:"text-xs flex items-center gap-2 "+(q[s]?"text-green-600":"text-red-500"),children:[q[s]?t.jsx("span",{className:"text-green-600",children:"✓"}):t.jsx("span",{className:"text-red-500",children:"✗"}),e.label]},e.label))})]})]}),t.jsxs("div",{children:[t.jsx(f,{label:"Confirm New Password",type:"password",value:P,onChange:e=>S(e),placeholder:"Confirm new password",error:O.confirmPassword,showPasswordToggle:!0,required:!0}),null!==M&&t.jsx("div",{className:"mt-2",children:t.jsx("span",{className:"text-xs flex items-center gap-2 "+(M?"text-green-600":"text-red-500"),children:M?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-green-600",children:"✓"}),"Passwords match"]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-red-500",children:"✗"}),"Passwords do not match"]})})})]}),t.jsxs(c,{type:"submit",className:"w-full h-11 text-sm sm:text-base",disabled:C,children:[C&&t.jsx(n,{className:"mr-2 h-4 w-4 animate-spin"}),C?"Resetting Password...":"Reset Password"]})]})})]})]})}),t.jsx(i,{})]})};export{w as default};

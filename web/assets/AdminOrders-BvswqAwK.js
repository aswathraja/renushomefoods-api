import{r as e,j as s,Z as t,X as r,K as a,P as d,L as n,_ as l,$ as o,F as i,G as c}from"./vendor-react-Tc4xLtOv.js";import{A as u}from"./AdminNavBar-nV0t9olM.js";import{C as m}from"./dropdown-menu-Dweh6OYL.js";import{O as h}from"./OrdersTable-D1Fx7FXr.js";import{B as p,c as x,s as j,a as v,u as y,A as g,e as N}from"./index-CCl3TzR2.js";import{C as f}from"./calendar-Cnbaz_2s.js";import{D as b,a as C,b as S,c as P}from"./dialog-CT_0QHuT.js";import{I as D}from"./input-F4kRSedd.js";import{L as I}from"./label-DxpSIJ1C.js";import{P as w,a as A,b as O}from"./popover-B3nRiRzT.js";import{S as k,a as F,b as L,c as M,d as E}from"./select-BWzYtSB5.js";import{T}from"./textarea-LiP7jPED.js";import{B as q}from"./badge-BZaNuTv-.js";import{f as R}from"./vendor-dates-BQQoqOpn.js";import{Q as $}from"./vendor-qr-CvcLm1-U.js";import{C as U,a as z,b as V,c as B}from"./card-ZRElQZzO.js";import"./vendor-charts-DKw1ZHYY.js";import"./vendor-ui-utils-B4kPJlQS.js";import"./TopBar-DKySbC2h.js";import"./vendor-radix-O0RUyoIw.js";import"./table-DDweQ1vw.js";import"./vendor-pdf-export-C4gp01y5.js";import"./vendor-animation-BGrdDg6I.js";const Q=({coupons:a,customCoupon:d,setCustomCoupon:n,appliedCoupon:l,setAppliedCoupon:o,setTotalDiscount:i,setShippingDiscount:c,formData:u,newProducts:m=[],isLoading:h=!1})=>{const[v,y]=e.useState(""),g=(u.products?.reduce((e,s)=>e+s.productTotal,0)||0)+m.filter(e=>e.product&&e.quantity>0).reduce((e,s)=>e+s.total,0),N=e=>{let s=0,t=0;const r=(e=>{const s=[],t=new Set(e.products.map(e=>e.name));return u.products?.forEach(e=>{t.has(e.productName)&&s.push({name:e.productName,quantity:e.quantity,total:e.productTotal,price:e.price})}),m.filter(e=>e.product&&e.quantity>0).forEach(e=>{t.has(e.product.name)&&s.push({name:e.name,quantity:e.quantity,total:e.total,price:e.priceList?.unitprice||0})}),s})(e);if(0===r.length)return i(0),c(0),x.error("Coupon not applicable to selected products"),o(null),y(""),void n("");const a=(e=>e.reduce((e,s)=>e+s.quantity,0))(r),d=(e=>e.reduce((e,s)=>e+s.total,0))(r);e.discounts.forEach(e=>{const r=e.name.toLowerCase().includes("shipping");if(e.flatrate)r?t+=e.discount*a:s+=e.discount*a;else if(r){const s=g<999?99*e.discount/100:0;t+=s}else{const t=d*e.discount/100;s+=t}}),i(s),c(t),y(e.code),o(e)};return e.useEffect(()=>{y(d);const e=a.find(e=>e.code.toLowerCase()===d.toLowerCase());e&&N(e)},[a]),s.jsxs("div",{className:"space-y-4",children:[l&&s.jsxs("div",{className:"border border-green-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(t,{className:"h-4 w-4 text-green-600"}),s.jsx("span",{className:"font-medium text-green-800",children:"Applied Coupon:"}),s.jsx(q,{variant:"secondary",children:l.code})]}),s.jsx(p,{variant:"ghost",size:"sm",onClick:()=>{o(null),n(""),i(0),c(0),y("")},children:s.jsx(r,{className:"h-4 w-4"})})]}),s.jsx("div",{className:"mt-2 text-sm text-green-700",children:l.discounts.map((e,t)=>s.jsx("div",{children:e.flatrate?`₹${e.discount} off ${e.name}`:`${e.discount}% off ${e.name}`},t))})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx(I,{htmlFor:"customCoupon",children:"Enter Coupon Code"}),s.jsx(D,{id:"customCoupon",value:v,onChange:e=>y(e.target.value.toUpperCase()),placeholder:"Enter coupon code...",disabled:!!l})]}),s.jsx("div",{className:"flex items-end",children:s.jsx(p,{onClick:()=>{if(!v.trim())return;const e=a.find(e=>e.code.toLowerCase()===v.toLowerCase()&&(e=>{if(!e.isActive)return!1;const s=new Date,t=new Date(e.startDate.split("/").reverse().join("-")),r=new Date(e.endDate.split("/").reverse().join("-"));if(s<t||s>r)return!1;if(e.products.length>0){const s=new Set(e.products.map(e=>e.name));if(![...u.products?.map(e=>e.productName)??[],...m?.map(e=>e.name)??[]].some(e=>s.has(e)))return!1}if(!e.isForAllUsers&&e.users.length>0&&u.userId&&!e.users.some(e=>e.id===j(u.userId)))return!1;return!0})(e));e?N(e):x.error("Invalid Coupon Code"),n("")},disabled:!v.trim()||!!l,children:"Apply"})})]}),h?s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{children:"Available Coupons"}),s.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),"Loading coupons..."]})]}):a.length>0&&!l?s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{children:"Available Coupons"}),s.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:a.map(e=>s.jsx("div",{className:"border rounded-lg p-3 hover:bg-muted/20 cursor-pointer",onClick:()=>N(e),children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(q,{variant:"outline",children:e.code})}),s.jsx("div",{className:"mt-1 text-sm",children:e.discounts.map((e,t)=>s.jsxs("div",{children:[e.name," - ",e.flatrate?`₹${e.discount} off`:`${e.discount}% off`]},t))}),e.products.length>0&&s.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Valid for ",e.products.map(e=>e.name).join(", ")]}),!e.isForAllUsers&&e.users.length>0&&s.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Valid for ",e.users.map(e=>e.name).join(", ")]}),e.isForAllUsers&&s.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Valid for All Users"}),e.isForNewUsers&&s.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Valid for New Users"})]}),s.jsx(p,{variant:"outline",size:"sm",children:"Apply"})]})},e.id))})]}):h||0!==a.length||l?null:s.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"No available coupons for this order"})]})},H=({newProducts:e,setNewProducts:t,existingProducts:r,onRemoveExistingProduct:n,categories:l,products:o,onCategoryChange:i,onProductChange:c,onPricelistChange:u,onQuantityChange:m,onRemoveNewProduct:h,effectiveTheme:x})=>{const j=e=>{if(!o||0===o.length)return[];return o.filter(s=>(s.categoryId||s.categoryid||s.CategoryId)===e)},v=e=>e?.PriceLists||[];return s.jsxs("div",{className:"space-y-4",children:[r&&r.length>0&&s.jsxs("div",{className:"space-y-3",children:[s.jsx(I,{className:"text-base font-medium",children:"Current Products"}),s.jsx("div",{className:"space-y-2",children:r.map((e,t)=>s.jsx("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:e.productName}),s.jsx("p",{className:"text-sm text-muted-foreground",children:e.categoryName}),s.jsxs("p",{className:"text-sm",children:["Qty: ",e.quantity," × ₹",e.price," = ₹",e.productTotal]})]}),!x.includes("admin")&&s.jsx(p,{variant:"ghost",size:"sm",onClick:()=>n(t),children:s.jsx(a,{className:"h-4 w-4"})})]})})},t))})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(I,{className:"text-base font-medium",children:"Add Products"}),s.jsxs(p,{onClick:()=>{t([...e,{quantity:1,total:0,categoryId:0,productId:0,priceListId:0}])},variant:"outline",size:"sm",children:[s.jsx(d,{className:"h-4 w-4 mr-1"}),"Add Product"]})]}),e.map((e,t)=>s.jsxs("div",{className:"p-4 border rounded-lg space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{children:"Category"}),s.jsxs(k,{value:e.categoryId?.toString()||"",onValueChange:e=>{const s=l.find(s=>s.id.toString()===e);i(t,s)},children:[s.jsx(F,{children:s.jsx(L,{placeholder:"Select Category"})}),s.jsx(M,{children:l.map(e=>s.jsx(E,{value:e.id.toString(),children:e.category},e.id))})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{children:"Product"}),s.jsxs(k,{value:e.productId?.toString()||"",onValueChange:s=>{const r=j(e.categoryId||0).find(e=>e.id.toString()===s);c(t,r)},disabled:!e.categoryId||0===o.length,children:[s.jsx(F,{className:"w-48",children:s.jsx(L,{placeholder:e.categoryId?0===o.length?"Loading Products...":"Select Product":"Select Category First"})}),s.jsx(M,{children:e.categoryId?j(e.categoryId||0).length>0?j(e.categoryId||0).map(e=>s.jsx(E,{value:e.id.toString(),children:e.name},e.id)):s.jsx(E,{value:"no-products",disabled:!0,children:"No products found for this category"}):s.jsx(E,{value:"select-category",disabled:!0,children:"Select a category first"})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{children:"Price List"}),s.jsxs(k,{value:e.priceListId?.toString()||"",onValueChange:s=>{const r=v(e.product).find(e=>e.id.toString()===s);u(t,r)},disabled:!e.product,children:[s.jsx(F,{children:s.jsx(L,{placeholder:"Select Price"})}),s.jsx(M,{children:v(e.product).map(e=>s.jsxs(E,{value:e.id.toString(),children:[e.weight," - ₹",e.unitprice]},e.id))})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{children:"Quantity"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(D,{type:"number",min:"1",value:e.quantity,onChange:e=>m(t,parseInt(e.target.value)||1),className:"w-30"}),s.jsx(p,{variant:"ghost",size:"sm",onClick:()=>h(t),className:"px-2",children:s.jsx(a,{className:"h-4 w-4"})})]})]})]}),e.total>0&&s.jsxs("div",{className:"flex justify-between items-center pt-2 border-t",children:[s.jsx("span",{className:"font-medium",children:"Product Total:"}),s.jsxs("span",{className:"font-semibold",children:["₹",e.total.toFixed(2)]})]})]},t)),0===e.length&&s.jsx("div",{className:"text-center py-8 text-muted-foreground",children:'No products added. Click "Add Product" to add products to this order.'})]})]})},G=({isOpen:t,onClose:r,isCreateMode:a,editingOrder:d,users:l,userAddresses:o,isLoadingAddresses:i,isLoadingCoupons:c,onSaveOrder:u,isSaving:m,setIsSaving:h,formData:x,setFormData:j,errors:y,newProducts:g,setNewProducts:N,categories:q,products:$,coupons:U,selectedUser:z,setSelectedUser:V,selectedAddress:B,setSelectedAddress:G,customCoupon:J,setCustomCoupon:W,appliedCoupon:K,setAppliedCoupon:Y,totalDiscount:Z,setTotalDiscount:_,shippingDiscount:X,setShippingDiscount:ee,onCategoryChange:se,onProductChange:te,onPricelistChange:re,onQuantityChange:ae,onRemoveNewProduct:de,onRemoveExistingProduct:ne,effectiveTheme:le})=>{const[oe,ie]=e.useState(!1),[ce,ue]=e.useState(!1),me=e=>{let s=e.replace(/[^\d+\s]/g,"");if(!s.startsWith("+"))return s.replace(/\D/g,"").slice(0,10);{const e=s.match(/^(\+\d{0,2})(\s?)(\d{0,10})/);if(e){const s=e[1],t=e[2],r=e[3];return s+(t||(r.length>0?" ":""))+r}}return s.slice(0,15)},he=(x.products?.reduce((e,s)=>e+s.productTotal,0)||0)+g.filter(e=>e.product&&e.quantity>0).reduce((e,s)=>e+s.total,0),pe=he<999&&"Home Delivery"===x.shippingMethod,xe=pe?99-X:0,je=he-Z+xe;return s.jsx(b,{open:t,onOpenChange:r,children:s.jsxs(C,{className:"max-w-4xl max-h-screen mt-4 mb-4 overflow-y-auto",children:[s.jsx(S,{children:s.jsx(P,{children:a?"Create Order":"Edit Order"})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"user",children:"User"}),s.jsxs(k,{value:"new-customer"===z?.value?z.value:z?.value?.id?.toString()||"",onValueChange:e=>{if("new-customer"===e)V({value:"new-customer",label:"New Customer"});else{const s=l.find(s=>s.id.toString()===e);s&&(V({value:s,label:`${s.name} (${s.phone})`}),j({...x,customerName:s.name,customerPhone:s.phone,customerEmail:s.email}))}},children:[s.jsx(F,{className:y.userId?"border-red-500":"",children:s.jsx(L,{placeholder:"Select User"})}),s.jsxs(M,{children:[s.jsx(E,{value:"new-customer",children:"New Customer"}),l?.map(e=>s.jsxs(E,{value:e.id.toString(),children:[e.name," (",e.phone,")"]},e.id))]})]}),y.userId&&s.jsx("p",{className:"text-sm text-red-500",children:y.userId})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"address",children:"User Address"}),s.jsxs(k,{value:B?.value?.toString()||"",onValueChange:e=>{if("new-address"===e)G({value:"new-address",label:"New Address"}),j({...x,deliveryName:"",addressLine1:"",city:"",state:"",country:"",pincode:"",deliveryPhone:""});else{const s=o.find(s=>s.id.toString()===e);G(s?{value:s.id,label:`${s.name} - ${s.addressLine1}, ${s.city}`}:null),s&&j({...x,customerName:z?.value?.name||"",customerPhone:z?.value?.phone||"",customerEmail:z?.value?.email||"",deliveryName:s.name,addressLine1:s.addressLine1,city:s.city,state:s.state,country:s.country,pincode:s.pincode,deliveryPhone:s.phone})}},disabled:i,children:[s.jsx(F,{className:y.addressLine1?"border-red-500":"",children:s.jsx(L,{placeholder:i?"Loading addresses...":"Select Address"})}),s.jsxs(M,{children:[s.jsx(E,{value:"new-address",children:"New Address"}),o?.map(e=>s.jsxs(E,{value:e.id.toString(),children:[e.name," - ",e.addressLine1,", ",e.city]},e.id))]})]}),y.addressLine1&&s.jsx("p",{className:"text-sm text-red-500",children:y.addressLine1})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"customerName",children:"Customer Name"}),s.jsx(D,{id:"customerName",value:x.customerName||"",onChange:e=>j({...x,customerName:e.target.value}),className:y.customerName?"border-red-500":""}),y.customerName&&s.jsx("p",{className:"text-sm text-red-500",children:y.customerName})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"customerPhone",children:"Customer Phone"}),s.jsx(D,{id:"customerPhone",value:x.customerPhone||"",onChange:e=>{const s=me(e.target.value);j({...x,customerPhone:s})},className:y.customerPhone?"border-red-500":""}),y.customerPhone&&s.jsx("p",{className:"text-sm text-red-500",children:y.customerPhone})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"customerEmail",children:"Customer Email"}),s.jsx(D,{id:"customerEmail",type:"email",value:x.customerEmail||"",onChange:e=>j({...x,customerEmail:e.target.value}),className:y.customerEmail?"border-red-500":""}),y.customerEmail&&s.jsx("p",{className:"text-sm text-red-500",children:y.customerEmail})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{children:"Order Date"}),s.jsxs(w,{open:oe,onOpenChange:ie,children:[s.jsx(A,{asChild:!0,children:s.jsx(p,{variant:"outline",className:v("w-full justify-start text-left font-normal",!x.orderDate&&"text-muted-foreground",y.orderDate&&"border-red-500"),children:x.orderDate?R(x.orderDate,"dd/MM/yyyy"):"Select date"})}),s.jsx(O,{className:"w-auto p-0",align:"start",children:s.jsx(f,{mode:"single",selected:x.orderDate,onSelect:e=>{j({...x,orderDate:e}),ie(!1)},autoFocus:!0})})]}),y.orderDate&&s.jsx("p",{className:"text-sm text-red-500",children:y.orderDate})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{children:"Expected Delivery Date"}),s.jsxs(w,{open:ce,onOpenChange:ue,children:[s.jsx(A,{asChild:!0,children:s.jsx(p,{variant:"outline",className:v("w-full justify-start text-left font-normal",!x.expectedDeliveryDate&&"text-muted-foreground",y.expectedDeliveryDate&&"border-red-500"),children:x.expectedDeliveryDate?R(x.expectedDeliveryDate,"dd/MM/yyyy"):"Select date"})}),s.jsx(O,{className:"w-auto p-0",align:"start",children:s.jsx(f,{mode:"single",selected:x.expectedDeliveryDate,onSelect:e=>{j({...x,expectedDeliveryDate:e}),ue(!1)},autoFocus:!0})})]}),y.expectedDeliveryDate&&s.jsx("p",{className:"text-sm text-red-500",children:y.expectedDeliveryDate})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"orderStatus",children:"Order Status"}),s.jsxs(k,{value:x.orderStatus||"",onValueChange:e=>j({...x,orderStatus:e}),children:[s.jsx(F,{className:y.orderStatus?"border-red-500":"",children:s.jsx(L,{placeholder:"Select Order Status"})}),s.jsxs(M,{children:[s.jsx(E,{value:"Ordered",children:"Ordered"}),s.jsx(E,{value:"Payment Processed",children:"Payment Processed"}),s.jsx(E,{value:"Processing",children:"Processing"}),s.jsx(E,{value:"Packed",children:"Packed"}),s.jsx(E,{value:"Shipped",children:"Shipped"}),s.jsx(E,{value:"Delivered",children:"Delivered"}),s.jsx(E,{value:"Cancelled",children:"Cancelled"})]})]}),y.orderStatus&&s.jsx("p",{className:"text-sm text-red-500",children:y.orderStatus})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"shippingMethod",children:"Shipping Method"}),s.jsxs(k,{value:x.shippingMethod||"",onValueChange:e=>j({...x,shippingMethod:e}),children:[s.jsx(F,{className:y.shippingMethod?"border-red-500":"",children:s.jsx(L,{placeholder:"Select Shipping Method"})}),s.jsxs(M,{children:[s.jsx(E,{value:"Home Delivery",children:"Home Delivery"}),s.jsx(E,{value:"Free Store Pickup",children:"Free Store Pickup"})]})]}),y.shippingMethod&&s.jsx("p",{className:"text-sm text-red-500",children:y.shippingMethod})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"paymentMethod",children:"Payment Method"}),s.jsxs(k,{value:x.paymentMethod||"",onValueChange:e=>j({...x,paymentMethod:e}),children:[s.jsx(F,{className:y.paymentMethod?"border-red-500":"",children:s.jsx(L,{placeholder:"Select Payment Method"})}),s.jsxs(M,{children:[s.jsx(E,{value:"UPI",children:"UPI"}),s.jsx(E,{value:"Cash on Delivery",children:"Cash on Delivery"}),s.jsx(E,{value:"Direct Bank Transfer",children:"Direct Bank Transfer"})]})]}),y.paymentMethod&&s.jsx("p",{className:"text-sm text-red-500",children:y.paymentMethod})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"deliveryName",children:"Delivery Name"}),s.jsx(D,{id:"deliveryName",value:x.deliveryName||"",onChange:e=>j({...x,deliveryName:e.target.value}),className:y.deliveryName?"border-red-500":""}),y.deliveryName&&s.jsx("p",{className:"text-sm text-red-500",children:y.deliveryName})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"deliveryPhone",children:"Delivery Phone"}),s.jsx(D,{id:"deliveryPhone",value:x.deliveryPhone||"",onChange:e=>{const s=me(e.target.value);j({...x,deliveryPhone:s})},className:y.deliveryPhone?"border-red-500":""}),y.deliveryPhone&&s.jsx("p",{className:"text-sm text-red-500",children:y.deliveryPhone})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"addressLine1",children:"Address Line 1"}),s.jsx(D,{id:"addressLine1",value:x.addressLine1||"",onChange:e=>j({...x,addressLine1:e.target.value}),className:y.addressLine1?"border-red-500":""}),y.addressLine1&&s.jsx("p",{className:"text-sm text-red-500",children:y.addressLine1})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"city",children:"City"}),s.jsx(D,{id:"city",value:x.city||"",onChange:e=>j({...x,city:e.target.value}),className:y.city?"border-red-500":""}),y.city&&s.jsx("p",{className:"text-sm text-red-500",children:y.city})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"state",children:"State"}),s.jsx(D,{id:"state",value:x.state||"",onChange:e=>j({...x,state:e.target.value}),className:y.state?"border-red-500":""}),y.state&&s.jsx("p",{className:"text-sm text-red-500",children:y.state})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"country",children:"Country"}),s.jsx(D,{id:"country",value:x.country||"",onChange:e=>j({...x,country:e.target.value}),className:y.country?"border-red-500":""}),y.country&&s.jsx("p",{className:"text-sm text-red-500",children:y.country})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"pincode",children:"Pincode"}),s.jsx(D,{id:"pincode",value:x.pincode||"",onChange:e=>{const s=e.target.value.replace(/[^\d]/g,"").slice(0,6);j({...x,pincode:s})},className:y.pincode?"border-red-500":""}),y.pincode&&s.jsx("p",{className:"text-sm text-red-500",children:y.pincode})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h4",{className:"text-lg font-medium",children:"Products"}),y.products&&s.jsx("p",{className:"text-sm text-red-500",children:y.products})]}),s.jsx(H,{newProducts:g,setNewProducts:N,existingProducts:x.products||[],onRemoveExistingProduct:ne,categories:q,products:$,onCategoryChange:se,onProductChange:te,onPricelistChange:re,onQuantityChange:ae,onRemoveNewProduct:de,effectiveTheme:le}),s.jsx("div",{className:"bg-muted/20 p-4 rounded-lg",children:s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Subtotal:"}),s.jsxs("span",{children:["₹",he.toFixed(2)]})]}),Z>0&&s.jsxs("div",{className:"flex justify-between text-destructive",children:[s.jsx("span",{children:"Discount:"}),s.jsxs("span",{children:["-₹",Z.toFixed(2)]})]}),pe&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Shipping:"}),s.jsxs("span",{children:["₹",xe.toFixed(2)]})]}),s.jsxs("div",{className:"flex justify-between font-semibold text-lg border-t pt-2",children:[s.jsx("span",{children:"Order Total:"}),s.jsxs("span",{children:["₹",je.toFixed(2)]})]})]})})]}),s.jsx(Q,{coupons:U,customCoupon:J,setCustomCoupon:W,appliedCoupon:K,setAppliedCoupon:Y,setTotalDiscount:_,setShippingDiscount:ee,formData:x,newProducts:g,isLoading:c}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"notes",children:"Order Notes"}),s.jsx(T,{id:"notes",value:x.notes||"",onChange:e=>j({...x,notes:e.target.value}),placeholder:"Enter any additional notes for the order...",rows:3})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"deliveryNote",children:"Delivery Note"}),s.jsx(T,{id:"deliveryNote",value:x.deliveryNote||"",onChange:e=>j({...x,deliveryNote:e.target.value}),placeholder:"Enter delivery note...",rows:3,className:y.deliveryNote?"border-red-500":""}),y.deliveryNote&&s.jsx("p",{className:"text-sm text-red-500",children:y.deliveryNote})]})]})]}),s.jsxs("div",{className:"flex justify-end space-x-2 pt-4 border-t",children:[s.jsx(p,{variant:"outline",onClick:r,disabled:m(),children:"Close"}),s.jsx(p,{onClick:()=>{h(!0),u()},disabled:m(),children:m()?s.jsxs(s.Fragment,{children:[s.jsx(n,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):a?"Create Order":"Save Changes"})]})]})})},J=({isOpen:t,onClose:r,orderId:a,orderTotal:d,customerName:o,currentOrderStatus:i,onRefund:c,isRefunding:u})=>{const[m,h]=e.useState(d.toString()),[x,j]=e.useState(""),[v,y]=e.useState(""),[g,N]=e.useState(""),[f,w]=e.useState(i||"Pending"),[A,O]=e.useState({amount:!1,reason:!1,method:!1}),q=e=>{h((d*e/100).toFixed(2))},R=()=>{const e=parseFloat(m);return e>0&&e<=d};return e.useEffect(()=>{h(d.toString())},[d]),e.useEffect(()=>{t||(h(d.toString()),j(""),y(""),N(""),w(i||"Pending"),O({amount:!1,reason:!1,method:!1}))},[t,d,i]),s.jsx(b,{open:t,onOpenChange:r,children:s.jsxs(C,{className:"max-w-md",children:[s.jsx(S,{children:s.jsxs(P,{className:"flex items-center gap-2",children:[s.jsx(l,{className:"h-5 w-5"}),"Process Refund - Order #",a]})}),s.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!x||!v)return;const s={orderId:a,amount:parseFloat(m),reason:x,refundMethod:v,notes:g,orderStatus:f};c(s)},className:"space-y-4",children:[s.jsxs("div",{className:"bg-muted/20 p-4 rounded-lg",children:[s.jsx("h4",{className:"font-medium mb-2",children:"Order Summary"}),s.jsxs("div",{className:"space-y-1 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Order ID:"}),s.jsxs("span",{className:"font-medium",children:["#",a]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Customer:"}),s.jsx("span",{className:"font-medium",children:o})]}),s.jsxs("div",{className:"flex justify-between font-semibold",children:[s.jsx("span",{children:"Total Amount:"}),s.jsxs("span",{children:["₹",d.toFixed(2)]})]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{children:"Quick Refund Options"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(p,{type:"button",variant:"outline",size:"sm",onClick:()=>{h(d.toString())},className:"flex-1",children:"Full Refund"}),s.jsx(p,{type:"button",variant:"outline",size:"sm",onClick:()=>q(50),className:"flex-1",children:"50%"}),s.jsx(p,{type:"button",variant:"outline",size:"sm",onClick:()=>q(25),className:"flex-1",children:"25%"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"refundAmount",children:"Refund Amount (₹) *"}),s.jsx(D,{id:"refundAmount",type:"number",min:"0",max:d,step:"0.01",value:m,onChange:e=>h(e.target.value),onBlur:()=>O(e=>({...e,amount:!0})),placeholder:"Enter refund amount",className:!R()&&m&&A.amount?"border-red-500":""}),!R()&&m&&A.amount&&s.jsxs("p",{className:"text-sm text-red-500",children:["Amount must be between ₹0 and ₹",d.toFixed(2)]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"refundReason",children:"Refund Reason *"}),s.jsxs(k,{value:x,onValueChange:e=>{j(e),O(e=>({...e,reason:!0}))},children:[s.jsx(F,{className:!x&&A.reason?"border-red-500":"",children:s.jsx(L,{placeholder:"Select reason for refund"})}),s.jsx(M,{children:["Customer request","Product damaged","Product not as described","Wrong item delivered","Delivery failure","Quality issues","Order cancellation","Duplicate order","Payment error","Other"].map(e=>s.jsx(E,{value:e,children:e},e))})]}),!x&&A.reason&&s.jsx("p",{className:"text-sm text-red-500",children:"Please select a reason"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"refundMethod",children:"Refund Method *"}),s.jsxs(k,{value:v,onValueChange:e=>{y(e),O(e=>({...e,method:!0}))},children:[s.jsx(F,{className:!v&&A.method?"border-red-500":"",children:s.jsx(L,{placeholder:"Select refund method"})}),s.jsx(M,{children:["Original payment method","Bank transfer","Cash refund"].map(e=>s.jsx(E,{value:e,children:e},e))})]}),!v&&A.method&&s.jsx("p",{className:"text-sm text-red-500",children:"Please select a refund method"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"refundNotes",children:"Additional Notes"}),s.jsx(T,{id:"refundNotes",value:g,onChange:e=>N(e.target.value),placeholder:"Enter any additional notes about the refund...",rows:3})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"refundOrderStatus",children:"Order Status After Refund"}),s.jsxs(k,{value:f,onValueChange:w,children:[s.jsx(F,{children:s.jsx(L,{placeholder:"Select order status"})}),s.jsxs(M,{children:[s.jsx(E,{value:"Ordered",children:"Ordered"}),s.jsx(E,{value:"Payment Processed",children:"Payment Processed"}),s.jsx(E,{value:"Processing",children:"Processing"}),s.jsx(E,{value:"Packed",children:"Packed"}),s.jsx(E,{value:"Shipped",children:"Shipped"}),s.jsx(E,{value:"Delivered",children:"Delivered"}),s.jsx(E,{value:"Cancelled",children:"Cancelled"})]})]})]}),s.jsxs("div",{className:"flex justify-end space-x-2 pt-4 border-t",children:[s.jsx(p,{type:"button",variant:"outline",onClick:r,disabled:u,children:"Cancel"}),s.jsx(p,{type:"submit",disabled:u||!R()||!x||!v,variant:"destructive",children:u?s.jsxs(s.Fragment,{children:[s.jsx(n,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing Refund..."]}):`Process Refund of ₹${parseFloat(m||"0").toFixed(2)}`})]})]})]})})},W=({isOpen:e,onClose:t,onPaymentSuccess:r,orderId:a,orderTotal:d,customerName:n,customerPhone:l})=>{const i=(()=>{const e=`Order #${a}`;return`upi://pay?pa=renugarenuga36-1@okhdfcbank&pn=${encodeURIComponent("Renus Home Foods")}&am=${d}&cu=INR&tn=${encodeURIComponent(e)}`})();return s.jsx(b,{open:e,onOpenChange:t,children:s.jsxs(C,{className:"max-w-md max-h-screen mt-4 mb-4 flex flex-col p-0",children:[s.jsx(S,{className:"sticky top-0 bg-background z-10 px-6 py-4 border-b",children:s.jsxs(P,{className:"flex items-center gap-2",children:[s.jsx(o,{className:"h-5 w-5"}),"UPI Payment - Order #",a]})}),s.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-6",children:[s.jsxs("div",{className:"bg-muted/20 p-4 rounded-lg",children:[s.jsx("h4",{className:"font-medium mb-2",children:"Order Details"}),s.jsxs("div",{className:"space-y-1 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Order ID:"}),s.jsxs("span",{className:"font-medium",children:["#",a]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Customer:"}),s.jsx("span",{className:"font-medium",children:n})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Phone:"}),s.jsx("span",{className:"font-medium",children:l})]}),s.jsxs("div",{className:"flex justify-between text-lg font-semibold border-t pt-2",children:[s.jsx("span",{children:"Total Amount:"}),s.jsxs("span",{children:["₹",d.toFixed(2)]})]})]})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("h4",{className:"font-medium mb-4",children:"Scan QR Code to Pay"}),s.jsx("div",{className:"flex justify-center mb-4",children:s.jsx("div",{className:"bg-background p-3 rounded-xl border border-border",children:s.jsx($,{value:i,size:180,qrStyle:"dots",eyeRadius:10,logoPaddingStyle:"circle",logoImage:"/img/logo.webp"})})}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Scan this QR code using any UPI app (PhonePe, Google Pay, Paytm, etc.)"})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("h4",{className:"font-medium",children:"Or pay manually:"}),s.jsx("div",{className:"bg-muted/20 p-3 rounded-lg",children:s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-sm text-muted-foreground",children:"UPI ID:"}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsx("code",{className:"flex-1 bg-background px-2 py-1 rounded text-sm",children:"renugarenuga36-1@okhdfcbank"}),s.jsx(p,{variant:"outline",size:"sm",onClick:()=>{navigator.clipboard.writeText("renugarenuga36-1@okhdfcbank").then(()=>{})},children:"Copy"})]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-sm text-muted-foreground",children:"Amount:"}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsxs("code",{className:"flex-1 bg-background px-2 py-1 rounded text-sm",children:["₹",d.toFixed(2)]}),s.jsx(p,{variant:"outline",size:"sm",onClick:()=>navigator.clipboard.writeText(d.toFixed(2)),children:"Copy"})]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-sm text-muted-foreground",children:"Reference:"}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsxs("code",{className:"flex-1 bg-background px-2 py-1 rounded text-sm",children:["Order #",a]}),s.jsx(p,{variant:"outline",size:"sm",onClick:()=>navigator.clipboard.writeText(`Order #${a}`),children:"Copy"})]})]})]})})]}),s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Payment Instructions:"}),s.jsxs("ol",{className:"text-sm text-blue-700 space-y-1 list-decimal list-inside",children:[s.jsx("li",{children:"Open your UPI app (PhonePe, Google Pay, Paytm, etc.)"}),s.jsx("li",{children:"Scan the QR code or use the UPI ID above"}),s.jsxs("li",{children:["Enter the exact amount: ₹",d.toFixed(2)]}),s.jsxs("li",{children:["Use reference: Order #",a]}),s.jsx("li",{children:"Complete the payment and share the transaction ID"})]})]})]}),s.jsxs("div",{className:"bg-background z-10 px-6 py-4 border-t flex justify-between",children:[s.jsx(p,{variant:"outline",onClick:t,children:"Close"}),s.jsx(p,{onClick:r,children:"Payment Completed"})]})]})})},K=()=>{const{effectiveTheme:t}=y(),r=new Date,a=new Date(r.getFullYear(),r.getMonth(),1),n=r,[l,o]=e.useState({from:a,to:n}),{from:j,to:v}=l||{},[b,C]=e.useState("All"),[S,P]=e.useState("All"),[D,T]=e.useState("All"),[q,$]=e.useState("All"),[Q,H]=e.useState(!1),[K,Y]=e.useState([]),[Z,_]=e.useState([]),[X,ee]=e.useState([]),[se,te]=e.useState([]),[re,ae]=e.useState([]),[de,ne]=e.useState(!1),[le,oe]=e.useState(!1),[ie,ce]=e.useState([]),[ue,me]=e.useState(null),[he,pe]=e.useState(!1),[xe,je]=e.useState(!1),[ve,ye]=e.useState(null),[ge,Ne]=e.useState({userId:"",cartId:null,orderDate:new Date,orderStatus:"",shippingMethod:"",paymentMethod:"",expectedDeliveryDate:new Date,deliveryName:"",addressLine1:"",city:"",state:"",country:"",pincode:"",deliveryPhone:"",customerName:"",customerPhone:"",customerEmail:"",notes:"",deliveryNote:"",products:[]}),[fe,be]=e.useState({}),[Ce,Se]=e.useState([]),[Pe,De]=e.useState(null),[Ie,we]=e.useState(null),[Ae,Oe]=e.useState(""),[ke,Fe]=e.useState(null),[Le,Me]=e.useState(0),[Ee,Te]=e.useState(0),[qe,Re]=e.useState(!1),[$e,Ue]=e.useState(!1),[ze,Ve]=e.useState(!1),[Be,Qe]=e.useState({orderId:0,orderTotal:0,customerName:"",customerPhone:""}),[He,Ge]=e.useState({orderId:0,orderTotal:0,customerName:"",currentOrderStatus:""}),Je=[{value:"All",label:"All"},...K.map(e=>({value:e.category,label:e.category}))],We=[{value:"All",label:"All"},...Z.map(e=>({value:e.name,label:e.name}))],Ke=[{value:"All",label:"All"},...X.map(e=>({value:JSON.stringify(e),label:e.name+" ( "+e.phone+" )"}))];e.useEffect(()=>{g.postData({endpoint:"/inventory/get-categories",body:{request:N({type:"Product"})},successCallback:e=>{Array.isArray(e)?Y(e):Y([])},errorCallback:()=>{Y([])}})},[]),e.useEffect(()=>{const e=localStorage.getItem("token");e&&g.get("/admin/user-list",{Authorization:`Bearer ${e}`}).then(e=>{Array.isArray(e?.users)?ee(e?.users||[]):ee([])}).catch(e=>{ee([])})},[]),e.useEffect(()=>{S&&"All"!==S?g.postData({endpoint:"/inventory/get-products",body:{request:N({category:S})},successCallback:e=>{_(e||[])},errorCallback:()=>{_([])}}):_([])},[S]);e.useEffect(()=>{K.length>0&&g.postData({endpoint:"/inventory/get-products",body:{request:N({})},successCallback:e=>{_(s=>{const t=s.map(e=>e.id),r=(e||[]).filter(e=>!t.includes(e.id));return[...s,...r]})},errorCallback:e=>{}})},[K.length]),e.useEffect(()=>{Pe&&Pe.value&&"new-customer"!==Pe.value&&_e(Pe?.value?.id)},[Pe]),e.useEffect(()=>{he&&Ze()},[Pe,Ce,ge.products,ge.orderDate,he]);const Ye=()=>{const e=localStorage.getItem("token");if(!e)return;let s=null,t=null;if("All"!==q&&q)try{const e=q;s=e.name,t=e.phone}catch(a){}const r={fromDate:j?j.toISOString().split("T")[0]:null,toDate:v?v.toISOString().split("T")[0]:null,orderStatus:"All"!==b?b:null,category:"All"!==S?S:null,product:"All"!==D?D:null,name:s,phone:t};g.postData({endpoint:"/admin/fetch-orders",body:{request:N(r)},Authorization:`Bearer ${e}`,successCallback:e=>{if(ve?.orderId){const s=e.orders.find(e=>e.orderId===ve?.orderId);ye(s)}ce(e.orders||[])},errorCallback:e=>{}})},Ze=()=>{oe(!0);const e=[...ge.products?.map(e=>e.productId).filter(Boolean)||[],...Ce.filter(e=>e.product&&e.quantity>0).map(e=>e.productId).filter(Boolean)],s=Pe?.value?.id?[Pe.value.id]:[],t=ge.orderDate?ge.orderDate.toISOString().split("T")[0]:null,r={products:e,token:localStorage.getItem("token")||void 0,users:s,fromStartDate:t,fromEndDate:t};g.postData({endpoint:"/order/get-coupons",body:{request:N(r)},successCallback:e=>{let s=[];if(e&&e.coupons)s=e.coupons;else if(e&&e.response)try{s=JSON.parse(e.response).coupons||[]}catch(t){}ae(s||[]),oe(!1)},errorCallback:e=>{ae([]),oe(!1)}})},_e=async e=>{if(!e)return te([]),void we(null);ne(!0);try{const s=localStorage.getItem("token");if(!s)return;await g.postData({endpoint:"/admin/user-addresses",body:{request:N({userId:e})},Authorization:`Bearer ${s}`,successCallback:e=>{const s=e?.addresses||[];if(te(s),s.length>0){const e=s.find(e=>e.isDefault)||s[0];we({value:e.id,label:`${e.name} - ${e.addressLine1}, ${e.city}`}),Ne({...ge,customerEmail:Pe?.value?.email||"",customerName:Pe?.value?.name||"",customerPhone:Pe?.value?.phone||"",deliveryName:e.name,addressLine1:e.addressLine1,city:e.city,state:e.state,country:e.country,pincode:e.pincode,deliveryPhone:e.phone})}else we(null),Ne({...ge,deliveryName:"",addressLine1:"",city:"",state:"",country:"",pincode:"",deliveryPhone:""})},errorCallback:e=>{te([]),we(null)}})}catch(s){te([]),we(null)}finally{ne(!1)}};e.useEffect(()=>{Ye()},[j,v,b,S,D,q]);const Xe=()=>{Ne({userId:"",orderDate:new Date,orderStatus:"",shippingMethod:"",paymentMethod:"",expectedDeliveryDate:new Date,deliveryName:"",addressLine1:"",city:"",state:"",country:"",pincode:"",deliveryPhone:"",customerName:"",customerPhone:"",customerEmail:"",notes:"",deliveryNote:"",products:[]}),be({}),Se([]),De(null),we(null),Oe(""),Fe(null),Me(0),Te(0),ye(null),ae([])},es=e=>{if(e){je(!1),Se([]),ye(e),Fe(re.find(s=>s.code===e.couponCode)||null),Oe(e.couponCode||""),Ne({userId:e.userId.toString(),cartId:e.cartId,orderId:e.orderId,orderDate:new Date(e.orderDate),orderStatus:e.orderStatus,shippingMethod:e.shippingMethod,paymentMethod:e.paymentMethod,expectedDeliveryDate:new Date(e.expectedDeliveryDate),deliveryName:e.deliveryName,addressLine1:e.addressLine1,city:e.city,state:e.state,country:e.country,pincode:e.pincode,deliveryPhone:e.deliveryPhone,customerName:e.customerName,customerPhone:e.customerPhone,customerEmail:e.customerEmail,notes:e.notes||"",deliveryNote:e.deliveryNote||"",products:e.products});const s=X.find(s=>s.id===e.userId);De({value:s,label:`${s.name} (${s.phone})`})}else je(!0),Xe();pe(!0)};return s.jsxs(s.Fragment,{children:[s.jsx(u,{}),s.jsxs("div",{className:"container mx-auto mt-6 p-6 min-h-screen",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Orders"}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs(p,{variant:"outline",onClick:()=>es(),className:"border-green-600 text-green-600 hover:text-primary",children:[s.jsx(d,{className:"w-4 h-4 mr-2"})," Create Order"]}),s.jsxs(p,{variant:"outline",onClick:()=>H(!Q),className:"border-green-600 text-green-600 hover:text-primary",children:[s.jsx(i,{className:"w-4 h-4 mr-2"})," Filters"]})]})]}),Q&&s.jsxs(U,{className:"mb-6",children:[s.jsx(z,{children:s.jsx(V,{children:"Filters"})}),s.jsx(B,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{children:"Date Range"}),s.jsxs(w,{children:[s.jsx(A,{asChild:!0,children:s.jsxs(p,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[s.jsx(c,{className:"mr-2 h-4 w-4"}),j&&v?`${R(j,"dd/MM/yyyy")} - ${R(v,"dd/MM/yyyy")}`:"Select date range"]})}),s.jsx(O,{className:"w-auto p-0",align:"start",children:s.jsx(f,{mode:"range",selected:l,onSelect:o,numberOfMonths:1,autoFocus:!0})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{children:"Order Status"}),s.jsxs(k,{value:b,onValueChange:C,children:[s.jsx(F,{children:s.jsx(L,{})}),s.jsx(M,{children:[{value:"All",label:"All"},{value:"Pending",label:"Pending"},{value:"Delivered",label:"Delivered"},{value:"Cancelled",label:"Cancelled"}].map(e=>s.jsx(E,{value:e.value,children:e.label},e.value))})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{children:"Category"}),s.jsxs(k,{value:S,onValueChange:P,children:[s.jsx(F,{children:s.jsx(L,{})}),s.jsx(M,{children:Je.map(e=>s.jsx(E,{value:e.value,children:e.label},e.value))})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{children:"Product"}),s.jsxs(k,{value:D,onValueChange:T,children:[s.jsx(F,{children:s.jsx(L,{})}),s.jsx(M,{children:We.map(e=>s.jsx(E,{value:e.value,children:e.label},e.value))})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{children:"User"}),s.jsxs(k,{value:q,onValueChange:$,children:[s.jsx(F,{children:s.jsx(L,{})}),s.jsx(M,{children:Ke.map(e=>s.jsx(E,{value:e.value,children:e.label},e.value))})]})]})]})})]}),s.jsx(h,{orders:ie,expandedOrderId:ue,setExpandedOrderId:me,viewType:"ManageOrders",onEditOrder:es}),s.jsx(G,{isOpen:he,onClose:()=>{pe(!1),Xe()},isCreateMode:xe,editingOrder:ve,users:X,userAddresses:se,isLoadingAddresses:de,isLoadingCoupons:le,onSaveOrder:async()=>{try{const e={};if(ge.orderStatus||(e.orderStatus="Order status is required"),ge.shippingMethod||(e.shippingMethod="Shipping method is required"),ge.paymentMethod||(e.paymentMethod="Payment method is required"),ge.deliveryName||(e.deliveryName="Delivery name is required"),ge.addressLine1||(e.addressLine1="Address is required"),ge.city||(e.city="City is required"),ge.state||(e.state="State is required"),ge.country||(e.country="Country is required"),ge.pincode||(e.pincode="Pincode is required"),ge.deliveryPhone||(e.deliveryPhone="Delivery phone is required"),ge.customerName||(e.customerName="Customer name is required"),ge.customerPhone||(e.customerPhone="Customer phone is required"),ge.customerEmail||(e.customerEmail="Customer email is required"),0===ge.products.length&&0===Ce.filter(e=>e.product&&e.quantity>0).length&&(e.products="At least one product is required"),Object.keys(e).length>0)return void be(e);be({});const s={orderId:xe?void 0:ve?.orderId,userAddressId:!1===Boolean(Ie?.value)||"new-address"===Ie?.value?void 0:Ie?.value,cartId:ge.cartId,orderDate:ge.orderDate?ge.orderDate.toISOString().split("T")[0]:null,orderStatus:ge.orderStatus,shippingMethod:ge.shippingMethod,expectedDeliveryDate:ge.expectedDeliveryDate?ge.expectedDeliveryDate.toISOString().split("T")[0]:null,deliveryName:ge.deliveryName,addressLine1:ge.addressLine1,city:ge.city,state:ge.state,country:ge.country,pincode:ge.pincode,deliveryPhone:ge.deliveryPhone,customerName:ge.customerName,customerPhone:ge.customerPhone,customerEmail:ge.customerEmail,products:[...ge.products,...Ce.filter(e=>e.product&&e.quantity>0).map(e=>({quantity:e.quantity,productName:e.product.name,price:e.priceList.unitprice,categoryName:e.category.category,productTotal:e.priceList.unitprice*e.quantity,priceListId:e.priceListId,productDiscount:0}))],notes:ge.notes||"",deliveryNote:ge.deliveryNote||"",paymentMethod:ge.paymentMethod,couponId:ke?.id||null,userId:Pe?.value?.id||null,totalDiscount:Le,shippingDiscount:Ee},t=localStorage.getItem("token");if(!t)return x.error("Authentication token not found"),void Re(!1);g.postData({endpoint:"/admin/save-order",body:{request:N(s)},Authorization:`Bearer ${t}`,successCallback:e=>{Re(!1);const t=s.products.reduce((e,s)=>e+(s.productTotal||0),0),r=t<999&&"Home Delivery"===ge.shippingMethod?99:0,a=ve?(ve?.orderTotal||0)-ve?.productDiscount-ve?.shippingDiscount+r:0,d=t-Le-Ee+r,n=e?.orderId||ve?.orderId,l="UPI"===ge.paymentMethod,o=!xe&&d>a,i=!xe&&d<a,c=Math.abs(d-a);x.success(xe?"Order created successfully!":"Order updated successfully!"),pe(!1),Ye(),xe&&l?(Qe({orderId:n||0,orderTotal:d,customerName:ge.customerName,customerPhone:ge.customerPhone}),Ue(!0)):o&&l?(Qe({orderId:n||0,orderTotal:c,customerName:ge.customerName,customerPhone:ge.customerPhone}),Ue(!0)):i&&(Ge({orderId:n||0,orderTotal:Number(c.toFixed(2)),customerName:ge.customerName,currentOrderStatus:ge.orderStatus}),Ve(!0))},errorCallback:e=>{Re(!1),x.error(e?.error||e?.message||"Failed to save order")}})}catch(e){Re(!1),x.error("Failed to save order")}},setIsSaving:Re,isSaving:()=>qe,formData:ge,setFormData:Ne,errors:fe,newProducts:Ce,setNewProducts:Se,categories:K,products:Z,coupons:re,selectedUser:Pe,setSelectedUser:e=>{De(e),e&&e.value&&"new-customer"!==e.value?Ne({...ge,customerName:e.value.name,customerPhone:e.value.phone,customerEmail:e.value.email}):(te([]),we(null),e&&"new-customer"===e.value&&Ne({...ge,deliveryName:"",addressLine1:"",city:"",state:"",country:"",pincode:"",deliveryPhone:"",customerName:"",customerPhone:"",customerEmail:""}))},selectedAddress:Ie,setSelectedAddress:we,customCoupon:Ae,setCustomCoupon:Oe,appliedCoupon:ke,setAppliedCoupon:Fe,totalDiscount:Le,setTotalDiscount:Me,shippingDiscount:Ee,setShippingDiscount:Te,onCategoryChange:(e,s)=>{const t=[...Ce];t[e]={...t[e],category:s,categoryId:s?.id,product:null,productId:null,priceList:null,priceListId:null,total:0},Se(t)},onProductChange:(e,s)=>{const t=[...Ce];t[e]={...t[e],product:s,productId:s?.id,priceList:null,priceListId:null,total:t[e].quantity*(s?.priceLists?.[0]?.unitprice||0)},Se(t)},onPricelistChange:(e,s)=>{const t=[...Ce];t[e]={...t[e],priceList:s,priceListId:s?.id,total:t[e].quantity*(s?.unitprice||0)},Se(t)},onQuantityChange:(e,s)=>{const t=[...Ce];t[e]={...t[e],quantity:s,total:s*(t[e].priceList?.unitprice||0)},Se(t)},onRemoveNewProduct:e=>{Se(Ce.filter((s,t)=>t!==e))},onRemoveExistingProduct:e=>{Ne({...ge,products:ge.products.filter((s,t)=>t!==e)})},effectiveTheme:t}),s.jsx(W,{isOpen:$e,onClose:()=>Ue(!1),onPaymentSuccess:()=>{Ue(!1),x.success("Payment successful!")},orderId:Be.orderId,orderTotal:Be.orderTotal,customerName:Be.customerName,customerPhone:Be.customerPhone}),s.jsx(J,{isOpen:ze,onClose:()=>Ve(!1),orderId:He.orderId,orderTotal:He.orderTotal,customerName:He.customerName,currentOrderStatus:He.currentOrderStatus,onRefund:e=>{(e=>{let s=`The Order has been cancelled or modified and we have refunded ₹${e.amount.toFixed(2)} via ${e.refundMethod} because of ${e.reason}.`;e.notes&&e.notes.trim().length>0&&(s+=` Additional Notes: ${e.notes}`);const t={orderId:ve?.orderId||e.orderId,userAddressId:ve?.userAddressId||null,cartId:ve?.cartId||null,orderDate:ve?.orderDate?new Date(ve.orderDate).toISOString().split("T")[0]:null,orderStatus:e.orderStatus,shippingMethod:ve?.shippingMethod||"",expectedDeliveryDate:ve?.expectedDeliveryDate?new Date(ve.expectedDeliveryDate).toISOString().split("T")[0]:null,deliveryName:ve?.deliveryName||"",addressLine1:ve?.addressLine1||"",city:ve?.city||"",state:ve?.state||"",country:ve?.country||"",pincode:ve?.pincode||"",deliveryPhone:ve?.deliveryPhone||"",customerName:ve?.customerName||"",customerPhone:ve?.customerPhone||"",customerEmail:ve?.customerEmail||"",products:ve?.products||[],notes:ve?.notes||"",deliveryNote:s,paymentMethod:ve?.paymentMethod||"",couponId:ke?.id||null,userId:ve?.userId||null,totalDiscount:ve?.totalDiscount||0,shippingDiscount:ve?.shippingDiscount||0},r=localStorage.getItem("token");r?g.postData({endpoint:"/admin/save-order",body:{request:N(t)},Authorization:`Bearer ${r}`,successCallback:e=>{x.success("Refund processed successfully!"),Ve(!1),Ye()},errorCallback:e=>{x.error(e?.error||e?.message||"Failed to process refund")}}):x.error("Authentication token not found")})(e)},isRefunding:!1})]}),s.jsx(m,{})]})};export{K as default};

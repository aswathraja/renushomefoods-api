import{o as W,r as i,j as e,w as G,P as U,d as Y,e as J}from"./vendor-react-Bv33ryjV.js";import{C as K}from"./dropdown-menu-BDj5FxyU.js";import{T as Q}from"./TopNav-JT08H0jt.js";import{A as y,c as a,B as c,e as N}from"./index-BgzncNPj.js";import{B as Z}from"./badge-FegKslFz.js";import{C as _,a as ee,b as se,c as te}from"./card-dPuP1Ci1.js";import{D as w,a as A,b as S,c as L,d as E}from"./dialog-DjJou7Bz.js";import{I as x}from"./input-group-AlYMXmbe.js";import{S as re}from"./switch-D6BMZ9fM.js";import{T as ae}from"./textarea-C9SzNJ62.js";import"./NavBar-BWSSAL5l.js";import"./TopBar-D2vj-zy0.js";import"./vendor-pdf-DxqLLkkN.js";import"./input-B6PrAciv.js";import"./index-BlLmK--u.js";const be=({modalMode:u=!1})=>{const C=W(),[D,q]=i.useState([]),[I,P]=i.useState(!0),[F,h]=i.useState(!1),[p,k]=i.useState(null),[T,g]=i.useState(!1),[l,X]=i.useState(null),[d,n]=i.useState({name:"",addressLine1:"",city:"",state:"",country:"",pincode:"",phone:"",isDefault:!1}),[b,v]=i.useState({});i.useEffect(()=>{if(!localStorage.getItem("token")&&!u){C("/login");return}j()},[C,u]);const j=async()=>{const s=localStorage.getItem("token");if(s)try{const t=await y.get("/user/addresses",{Authorization:`Bearer ${s}`});t.addresses?q(t.addresses||[]):a.error("Failed to fetch addresses")}catch{a.error("Error fetching addresses")}finally{P(!1)}},z=()=>{k(null),n({name:"",addressLine1:"",city:"",state:"",country:"",pincode:"",phone:"",isDefault:!1}),v({}),h(!0)},B=s=>{k(s),n({name:s.name,addressLine1:s.addressLine1,city:s.city,state:s.state,country:s.country,pincode:s.pincode,phone:s.phone,isDefault:s.isDefault}),v({}),f("pincode",s.pincode),f("phone",s.phone),h(!0)},M=s=>{X(s),g(!0)},O=async s=>{const t=localStorage.getItem("token");if(!t)return;const r={addressId:s.id,isDefault:!0,token:t};try{await y.postData({endpoint:"/user/address",body:{request:N(r)},successCallback:()=>{a.success("Default address updated successfully"),j()},errorCallback:o=>{a.error(o?.error||"Failed to update default address")}})}catch{a.error("Error updating default address")}},R=async()=>{if(!l)return;const s=localStorage.getItem("token");if(s)try{const t=await y.delete("/user/address",{request:N({addressId:l.id,token:s})},{Authorization:s});t.status?(a.success("Address deleted successfully"),j()):a.error(t.error||"Failed to delete address")}catch{a.error("Error deleting address")}finally{g(!1),X(null)}},V=async s=>{s.preventDefault();const t=localStorage.getItem("token");if(!t)return;if(Object.values(b).some(m=>m!=="")){a.error("Please fix the validation errors before submitting.");return}const o={...d,token:t};p&&(o.addressId=p.id);try{await y.postData({endpoint:"/user/address",body:{request:N(o)},successCallback:()=>{a.success(p?"Address updated successfully":"Address added successfully"),h(!1),j()},errorCallback:m=>{a.error(m?.error||"Failed to save address")}})}catch{a.error("Error saving address")}},f=(s,t)=>{let r="";s==="pincode"?/^\d{6}$/.test(t)||(r="Pincode must be exactly 6 digits."):s==="phone"&&(/^(\+\d{2} \d{10}|\+\d{12}|\d{10})$/.test(t)||(r="Phone number must be in format +XX XXXXXXXXXX, +XXXXXXXXXXXX, or XXXXXXXXXX.")),v(o=>({...o,[s]:r}))},$=s=>{const{name:t,value:r,type:o}=s.target;let m=r;t==="pincode"&&(m=r.replace(/\D/g,"").slice(0,6)),n(H=>({...H,[t]:o==="checkbox"?s.target.checked:m})),(t==="pincode"||t==="phone")&&f(t,m)};return I?u?e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading..."})]}):e.jsx("div",{className:"container mx-auto max-h-screen mt-8 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading..."})]})}):e.jsxs(e.Fragment,{children:[!u&&e.jsx(Q,{}),e.jsxs("div",{className:u?"":"container min-h-screen mx-auto mt-8 px-4 sm:px-6 lg:px-8",children:[!u&&e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(G,{size:"50px",className:"text-primary"})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground mb-2",children:"Your Addresses"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mb-4",children:"Manage your delivery addresses for faster checkout"}),e.jsxs(c,{onClick:z,className:"w-full sm:w-auto",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Add Address"]})]}),D.length===0?e.jsxs("div",{className:"text-center p-12",children:[e.jsx("div",{className:"text-muted-foreground mb-4",children:e.jsxs("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"No addresses found. Add your first address!"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:D.map(s=>e.jsxs(_,{className:"h-full",children:[e.jsxs(ee,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs(se,{className:"text-lg mb-1",children:[s.name,s.isDefault&&e.jsx(Z,{className:"mt-3 ml-2 bg-primary",children:"Default"})]}),e.jsxs("div",{className:"flex gap-2",children:[!s.isDefault&&e.jsx(c,{variant:"outline",size:"sm",onClick:()=>O(s),className:"text-primary border-primary hover:bg-primary/10",children:"Make Default"}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>B(s),className:"text-green-600 border-green-600 hover:text-primary",children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>M(s),className:"text-red-600 border-red-600 hover:text-primary",children:e.jsx(J,{className:"h-4 w-4"})})]})]}),e.jsx(te,{children:e.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsx("p",{children:s.addressLine1}),e.jsxs("p",{children:[s.city,", ",s.state," ",s.pincode]}),e.jsx("p",{children:s.country}),e.jsxs("p",{children:["Phone: ",s.phone]})]})})]},s.id))}),e.jsx(w,{open:F,onOpenChange:h,children:e.jsxs(A,{className:"sm:max-w-[600px]",children:[e.jsx(S,{children:e.jsx(L,{children:p?"Edit Address":"Add Address"})}),e.jsxs("form",{onSubmit:V,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(x,{label:"Name",name:"name",value:d.name,onChange:s=>n(t=>({...t,name:s})),required:!0}),e.jsx(x,{label:"Phone",name:"phone",value:d.phone,onChange:s=>{const t=s.replace(/[^\d+\s]/g,"").slice(0,15);n(r=>({...r,phone:t})),f("phone",t)},error:b.phone,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:["Address Line 1 ",e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),e.jsx(ae,{name:"addressLine1",value:d.addressLine1,onChange:$,className:"mt-2",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(x,{label:"City",name:"city",value:d.city,onChange:s=>n(t=>({...t,city:s})),required:!0}),e.jsx(x,{label:"State",name:"state",value:d.state,onChange:s=>n(t=>({...t,state:s})),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(x,{label:"Pincode",name:"pincode",value:d.pincode,onChange:s=>{const t=s.replace(/\D/g,"").slice(0,6);n(r=>({...r,pincode:t})),f("pincode",t)},error:b.pincode,required:!0}),e.jsx(x,{label:"Country",name:"country",value:d.country,onChange:s=>n(t=>({...t,country:s})),required:!0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"isDefault",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Set as default address"}),e.jsx(re,{id:"isDefault",name:"isDefault",checked:d.isDefault,onCheckedChange:s=>n(t=>({...t,isDefault:s}))})]}),e.jsxs(E,{children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsxs(c,{type:"submit",children:[p?"Update":"Add"," Address"]})]})]})]})}),e.jsx(w,{open:T,onOpenChange:g,children:e.jsxs(A,{children:[e.jsx(S,{children:e.jsx(L,{children:"Confirm Delete"})}),e.jsxs("div",{className:"py-4",children:[e.jsx("p",{className:"text-muted-foreground",children:"Are you sure you want to delete this address?"}),l&&e.jsxs("div",{className:"mt-4 p-4 border rounded-md bg-muted/50",children:[e.jsx("p",{className:"font-medium",children:l.name}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[l.addressLine1,e.jsx("br",{}),l.city,", ",l.state," ",l.pincode]})]})]}),e.jsxs(E,{children:[e.jsx(c,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(c,{variant:"destructive",onClick:R,children:"Delete"})]})]})})]}),!u&&e.jsx(K,{})]})};export{be as default};

import{r as d,j as e,q as Ne,Q as Is}from"./vendor-react-Bk0qDDMD.js";import{A as Os}from"./AdminNavBar-CfrK-OPK.js";import{C as ws}from"./dropdown-menu-Dae-Y6FG.js";import{O as Ds}from"./OrdersTable-9jN72OVY.js";import{B as P,c as ee,s as As,b as _e,u as ks,A as te,e as ne}from"./index-Bzbs1pXN.js";import{C as Ee}from"./calendar-BHXoJ3A4.js";import{D as qe,a as Ue,b as $e,c as Ve}from"./dialog-CLX5gY7u.js";import{I as _}from"./input-Cpcu6Bjn.js";import{L as m}from"./label-COuHthBN.js";import{P as Le,a as Fe,b as Te}from"./popover-BbjHyeoe.js";import{S as Q,a as H,b as G,c as J,d as g}from"./select-D6maGY_v.js";import{T as Re}from"./textarea-Ds-7KeaI.js";import{B as Xe}from"./badge-BCB6vZm7.js";import{ab as Ms,X as Es,e as Ye,P as Ke,L as Ze,ac as Ls,ad as Fs,F as Ts,C as Rs}from"./vendor-icons-FTV6Dp_q.js";import{C as qs,a as Us,b as $s,c as Vs}from"./card-CEH0XzyS.js";import"./vendor-base-ui-BXIcfa4M.js";import"./TopBar-CaoAhFRU.js";import"./vendor-motion-DKNEqpS6.js";import"./vendor-radix-B6Rg7jVq.js";import"./table-D3hkCJyW.js";import"./vendor-pdf-CtkwMsdI.js";import"./vendor-charts-DTq7uDuz.js";const zs=({coupons:A,customCoupon:U,setCustomCoupon:T,appliedCoupon:b,setAppliedCoupon:k,setTotalDiscount:M,setShippingDiscount:R,formData:E,newProducts:w=[],isLoading:q=!1})=>{const[S,a]=d.useState(""),h=E.products?.reduce((l,c)=>l+c.productTotal,0)||0,t=w.filter(l=>l.product&&l.quantity>0).reduce((l,c)=>l+c.total,0),$=h+t,v=l=>{if(!l.isActive)return!1;const c=new Date,D=new Date(l.startDate.split("/").reverse().join("-")),y=new Date(l.endDate.split("/").reverse().join("-"));if(c<D||c>y)return!1;if(l.products.length>0){const p=new Set(l.products.map(z=>z.name));if(![...E.products?.map(z=>z.productName)??[],...w?.map(z=>z.name)??[]].some(z=>p.has(z)))return!1}return!(!l.isForAllUsers&&l.users.length>0&&E.userId&&!l.users.some(F=>F.id===As(E.userId)))},L=l=>{const c=[],D=new Set(l.products.map(y=>y.name));return E.products?.forEach(y=>{D.has(y.productName)&&c.push({name:y.productName,quantity:y.quantity,total:y.productTotal,price:y.price})}),w.filter(y=>y.product&&y.quantity>0).forEach(y=>{D.has(y.product.name)&&c.push({name:y.name,quantity:y.quantity,total:y.total,price:y.priceList?.unitprice||0})}),c},f=l=>l.reduce((c,D)=>c+D.quantity,0),I=l=>l.reduce((c,D)=>c+D.total,0),C=l=>{let c=0,D=0;const y=L(l);if(y.length===0){M(0),R(0),ee.error("Coupon not applicable to selected products"),k(null),a(""),T("");return}const p=f(y),F=I(y);l.discounts.forEach(X=>{const z=X.name.toLowerCase().includes("shipping");if(X.flatrate)z?D+=X.discount*p:c+=X.discount*p;else if(z){const de=$<999?99*X.discount/100:0;D+=de}else{const ce=F*X.discount/100;c+=ce}}),M(c),R(D),a(l.code),k(l)},se=()=>{k(null),T(""),M(0),R(0),a("")},K=()=>{if(!S.trim())return;const l=A.find(c=>c.code.toLowerCase()===S.toLowerCase()&&v(c));l?C(l):ee.error("Invalid Coupon Code"),T("")};return d.useEffect(()=>{a(U);const l=A.find(c=>c.code.toLowerCase()===U.toLowerCase());l&&C(l)},[A]),e.jsxs("div",{className:"space-y-4",children:[b&&e.jsxs("div",{className:"border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ms,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800",children:"Applied Coupon:"}),e.jsx(Xe,{variant:"secondary",children:b.code})]}),e.jsx(P,{variant:"ghost",size:"sm",onClick:se,children:e.jsx(Es,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"mt-2 text-sm text-green-700",children:b.discounts.map((l,c)=>e.jsx("div",{children:l.flatrate?`₹${l.discount} off ${l.name}`:`${l.discount}% off ${l.name}`},c))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(m,{htmlFor:"customCoupon",children:"Enter Coupon Code"}),e.jsx(_,{id:"customCoupon",value:S,onChange:l=>a(l.target.value.toUpperCase()),placeholder:"Enter coupon code...",disabled:!!b})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(P,{onClick:K,disabled:!S.trim()||!!b,children:"Apply"})})]}),q?e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Available Coupons"}),e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),"Loading coupons..."]})]}):A.length>0&&!b?e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Available Coupons"}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:A.map(l=>e.jsx("div",{className:"border rounded-lg p-3 hover:bg-muted/20 cursor-pointer",onClick:()=>C(l),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Xe,{variant:"outline",children:l.code})}),e.jsx("div",{className:"mt-1 text-sm",children:l.discounts.map((c,D)=>e.jsxs("div",{children:[c.name," - ",c.flatrate?`₹${c.discount} off`:`${c.discount}% off`]},D))}),l.products.length>0&&e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Valid for ",l.products.map(c=>c.name).join(", ")]}),!l.isForAllUsers&&l.users.length>0&&e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Valid for ",l.users.map(c=>c.name).join(", ")]}),l.isForAllUsers&&e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Valid for All Users"}),l.isForNewUsers&&e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Valid for New Users"})]}),e.jsx(P,{variant:"outline",size:"sm",children:"Apply"})]})},l.id))})]}):!q&&A.length===0&&!b?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"No available coupons for this order"}):null]})},Bs=({newProducts:A,setNewProducts:U,existingProducts:T,onRemoveExistingProduct:b,categories:k,products:M,onCategoryChange:R,onProductChange:E,onPricelistChange:w,onQuantityChange:q,onRemoveNewProduct:S,effectiveTheme:a})=>{const h=()=>{U([...A,{quantity:1,total:0,categoryId:0,productId:0,priceListId:0}])},t=v=>!M||M.length===0?[]:M.filter(f=>(f.categoryId||f.categoryid||f.CategoryId)===v),$=v=>v?.PriceLists||[];return e.jsxs("div",{className:"space-y-4",children:[T&&T.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{className:"text-base font-medium",children:"Current Products"}),e.jsx("div",{className:"space-y-2",children:T.map((v,L)=>e.jsx("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:v.productName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:v.categoryName}),e.jsxs("p",{className:"text-sm",children:["Qty: ",v.quantity," × ₹",v.price," = ₹",v.productTotal]})]}),!a.includes("admin")&&e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>b(L),children:e.jsx(Ye,{className:"h-4 w-4"})})]})})},L))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{className:"text-base font-medium",children:"Add Products"}),e.jsxs(P,{onClick:h,variant:"outline",size:"sm",children:[e.jsx(Ke,{className:"h-4 w-4 mr-1"}),"Add Product"]})]}),A.map((v,L)=>e.jsxs("div",{className:"p-4 border rounded-lg space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Category"}),e.jsxs(Q,{value:v.categoryId?.toString()||"",onValueChange:f=>{const I=k.find(C=>C.id.toString()===f);R(L,I)},children:[e.jsx(H,{children:e.jsx(G,{placeholder:"Select Category"})}),e.jsx(J,{children:k.map(f=>e.jsx(g,{value:f.id.toString(),children:f.category},f.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Product"}),e.jsxs(Q,{value:v.productId?.toString()||"",onValueChange:f=>{const I=t(v.categoryId||0).find(C=>C.id.toString()===f);E(L,I)},disabled:!v.categoryId||M.length===0,children:[e.jsx(H,{className:"w-48",children:e.jsx(G,{placeholder:v.categoryId?M.length===0?"Loading Products...":"Select Product":"Select Category First"})}),e.jsx(J,{children:v.categoryId?t(v.categoryId||0).length>0?t(v.categoryId||0).map(f=>e.jsx(g,{value:f.id.toString(),children:f.name},f.id)):e.jsx(g,{value:"no-products",disabled:!0,children:"No products found for this category"}):e.jsx(g,{value:"select-category",disabled:!0,children:"Select a category first"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Price List"}),e.jsxs(Q,{value:v.priceListId?.toString()||"",onValueChange:f=>{const I=$(v.product).find(C=>C.id.toString()===f);w(L,I)},disabled:!v.product,children:[e.jsx(H,{children:e.jsx(G,{placeholder:"Select Price"})}),e.jsx(J,{children:$(v.product).map(f=>e.jsxs(g,{value:f.id.toString(),children:[f.weight," - ₹",f.unitprice]},f.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Quantity"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{type:"number",min:"1",value:v.quantity,onChange:f=>q(L,parseInt(f.target.value)||1),className:"w-30"}),e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>S(L),className:"px-2",children:e.jsx(Ye,{className:"h-4 w-4"})})]})]})]}),v.total>0&&e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t",children:[e.jsx("span",{className:"font-medium",children:"Product Total:"}),e.jsxs("span",{className:"font-semibold",children:["₹",v.total.toFixed(2)]})]})]},L)),A.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:'No products added. Click "Add Product" to add products to this order.'})]})]})},Qs=({isOpen:A,onClose:U,isCreateMode:T,editingOrder:b,users:k,userAddresses:M,isLoadingAddresses:R,isLoadingCoupons:E,onSaveOrder:w,isSaving:q,setIsSaving:S,formData:a,setFormData:h,errors:t,newProducts:$,setNewProducts:v,categories:L,products:f,coupons:I,selectedUser:C,setSelectedUser:se,selectedAddress:K,setSelectedAddress:l,customCoupon:c,setCustomCoupon:D,appliedCoupon:y,setAppliedCoupon:p,totalDiscount:F,setTotalDiscount:X,shippingDiscount:z,setShippingDiscount:ce,onCategoryChange:de,onProductChange:be,onPricelistChange:Se,onQuantityChange:Ce,onRemoveNewProduct:Pe,onRemoveExistingProduct:he,effectiveTheme:xe})=>{const[re,pe]=d.useState(!1),[j,oe]=d.useState(!1),n=r=>{let u=r.replace(/[^\d+\s]/g,"");if(u.startsWith("+")){const V=u.match(/^(\+\d{0,2})(\s?)(\d{0,10})/);if(V){const Oe=V[1],je=V[2],ue=V[3];return Oe+(je||(ue.length>0?" ":""))+ue}}else return u.replace(/\D/g,"").slice(0,10);return u.slice(0,15)},Z=a.products?.reduce((r,u)=>r+u.productTotal,0)||0,Ie=$.filter(r=>r.product&&r.quantity>0).reduce((r,u)=>r+u.total,0),ie=Z+Ie,W=ie<999&&a.shippingMethod==="Home Delivery",Y=W?99-z:0,B=ie-F+Y;return e.jsx(qe,{open:A,onOpenChange:U,children:e.jsxs(Ue,{className:"max-w-4xl max-h-screen mt-4 mb-4 overflow-y-auto",children:[e.jsx($e,{children:e.jsx(Ve,{children:T?"Create Order":"Edit Order"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"user",children:"User"}),e.jsxs(Q,{value:C?.value==="new-customer"?C.value:C?.value?.id?.toString()||"",onValueChange:r=>{if(r==="new-customer")se({value:"new-customer",label:"New Customer"});else{const u=k.find(V=>V.id.toString()===r);u&&(se({value:u,label:`${u.name} (${u.phone})`}),h({...a,customerName:u.name,customerPhone:u.phone,customerEmail:u.email}))}},children:[e.jsx(H,{className:t.userId?"border-red-500":"",children:e.jsx(G,{placeholder:"Select User"})}),e.jsxs(J,{children:[e.jsx(g,{value:"new-customer",children:"New Customer"}),k?.map(r=>e.jsxs(g,{value:r.id.toString(),children:[r.name," (",r.phone,")"]},r.id))]})]}),t.userId&&e.jsx("p",{className:"text-sm text-red-500",children:t.userId})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"address",children:"User Address"}),e.jsxs(Q,{value:K?.value?.toString()||"",onValueChange:r=>{if(r==="new-address")l({value:"new-address",label:"New Address"}),h({...a,deliveryName:"",addressLine1:"",city:"",state:"",country:"",pincode:"",deliveryPhone:""});else{const u=M.find(V=>V.id.toString()===r);l(u?{value:u.id,label:`${u.name} - ${u.addressLine1}, ${u.city}`}:null),u&&h({...a,customerName:C?.value?.name||"",customerPhone:C?.value?.phone||"",customerEmail:C?.value?.email||"",deliveryName:u.name,addressLine1:u.addressLine1,city:u.city,state:u.state,country:u.country,pincode:u.pincode,deliveryPhone:u.phone})}},disabled:R,children:[e.jsx(H,{className:t.addressLine1?"border-red-500":"",children:e.jsx(G,{placeholder:R?"Loading addresses...":"Select Address"})}),e.jsxs(J,{children:[e.jsx(g,{value:"new-address",children:"New Address"}),M?.map(r=>e.jsxs(g,{value:r.id.toString(),children:[r.name," - ",r.addressLine1,", ",r.city]},r.id))]})]}),t.addressLine1&&e.jsx("p",{className:"text-sm text-red-500",children:t.addressLine1})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"customerName",children:"Customer Name"}),e.jsx(_,{id:"customerName",value:a.customerName||"",onChange:r=>h({...a,customerName:r.target.value}),className:t.customerName?"border-red-500":""}),t.customerName&&e.jsx("p",{className:"text-sm text-red-500",children:t.customerName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"customerPhone",children:"Customer Phone"}),e.jsx(_,{id:"customerPhone",value:a.customerPhone||"",onChange:r=>{const u=n(r.target.value);h({...a,customerPhone:u})},className:t.customerPhone?"border-red-500":""}),t.customerPhone&&e.jsx("p",{className:"text-sm text-red-500",children:t.customerPhone})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"customerEmail",children:"Customer Email"}),e.jsx(_,{id:"customerEmail",type:"email",value:a.customerEmail||"",onChange:r=>h({...a,customerEmail:r.target.value}),className:t.customerEmail?"border-red-500":""}),t.customerEmail&&e.jsx("p",{className:"text-sm text-red-500",children:t.customerEmail})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Order Date"}),e.jsxs(Le,{open:re,onOpenChange:pe,children:[e.jsx(Fe,{asChild:!0,children:e.jsx(P,{variant:"outline",className:_e("w-full justify-start text-left font-normal",!a.orderDate&&"text-muted-foreground",t.orderDate&&"border-red-500"),children:a.orderDate?Ne(a.orderDate,"dd/MM/yyyy"):"Select date"})}),e.jsx(Te,{className:"w-auto p-0",align:"start",children:e.jsx(Ee,{mode:"single",selected:a.orderDate,onSelect:r=>{h({...a,orderDate:r}),pe(!1)},autoFocus:!0})})]}),t.orderDate&&e.jsx("p",{className:"text-sm text-red-500",children:t.orderDate})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Expected Delivery Date"}),e.jsxs(Le,{open:j,onOpenChange:oe,children:[e.jsx(Fe,{asChild:!0,children:e.jsx(P,{variant:"outline",className:_e("w-full justify-start text-left font-normal",!a.expectedDeliveryDate&&"text-muted-foreground",t.expectedDeliveryDate&&"border-red-500"),children:a.expectedDeliveryDate?Ne(a.expectedDeliveryDate,"dd/MM/yyyy"):"Select date"})}),e.jsx(Te,{className:"w-auto p-0",align:"start",children:e.jsx(Ee,{mode:"single",selected:a.expectedDeliveryDate,onSelect:r=>{h({...a,expectedDeliveryDate:r}),oe(!1)},autoFocus:!0})})]}),t.expectedDeliveryDate&&e.jsx("p",{className:"text-sm text-red-500",children:t.expectedDeliveryDate})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"orderStatus",children:"Order Status"}),e.jsxs(Q,{value:a.orderStatus||"",onValueChange:r=>h({...a,orderStatus:r}),children:[e.jsx(H,{className:t.orderStatus?"border-red-500":"",children:e.jsx(G,{placeholder:"Select Order Status"})}),e.jsxs(J,{children:[e.jsx(g,{value:"Ordered",children:"Ordered"}),e.jsx(g,{value:"Payment Processed",children:"Payment Processed"}),e.jsx(g,{value:"Processing",children:"Processing"}),e.jsx(g,{value:"Packed",children:"Packed"}),e.jsx(g,{value:"Shipped",children:"Shipped"}),e.jsx(g,{value:"Delivered",children:"Delivered"}),e.jsx(g,{value:"Cancelled",children:"Cancelled"})]})]}),t.orderStatus&&e.jsx("p",{className:"text-sm text-red-500",children:t.orderStatus})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"shippingMethod",children:"Shipping Method"}),e.jsxs(Q,{value:a.shippingMethod||"",onValueChange:r=>h({...a,shippingMethod:r}),children:[e.jsx(H,{className:t.shippingMethod?"border-red-500":"",children:e.jsx(G,{placeholder:"Select Shipping Method"})}),e.jsxs(J,{children:[e.jsx(g,{value:"Home Delivery",children:"Home Delivery"}),e.jsx(g,{value:"Free Store Pickup",children:"Free Store Pickup"})]})]}),t.shippingMethod&&e.jsx("p",{className:"text-sm text-red-500",children:t.shippingMethod})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"paymentMethod",children:"Payment Method"}),e.jsxs(Q,{value:a.paymentMethod||"",onValueChange:r=>h({...a,paymentMethod:r}),children:[e.jsx(H,{className:t.paymentMethod?"border-red-500":"",children:e.jsx(G,{placeholder:"Select Payment Method"})}),e.jsxs(J,{children:[e.jsx(g,{value:"UPI",children:"UPI"}),e.jsx(g,{value:"Cash on Delivery",children:"Cash on Delivery"}),e.jsx(g,{value:"Direct Bank Transfer",children:"Direct Bank Transfer"})]})]}),t.paymentMethod&&e.jsx("p",{className:"text-sm text-red-500",children:t.paymentMethod})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"deliveryName",children:"Delivery Name"}),e.jsx(_,{id:"deliveryName",value:a.deliveryName||"",onChange:r=>h({...a,deliveryName:r.target.value}),className:t.deliveryName?"border-red-500":""}),t.deliveryName&&e.jsx("p",{className:"text-sm text-red-500",children:t.deliveryName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"deliveryPhone",children:"Delivery Phone"}),e.jsx(_,{id:"deliveryPhone",value:a.deliveryPhone||"",onChange:r=>{const u=n(r.target.value);h({...a,deliveryPhone:u})},className:t.deliveryPhone?"border-red-500":""}),t.deliveryPhone&&e.jsx("p",{className:"text-sm text-red-500",children:t.deliveryPhone})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"addressLine1",children:"Address Line 1"}),e.jsx(_,{id:"addressLine1",value:a.addressLine1||"",onChange:r=>h({...a,addressLine1:r.target.value}),className:t.addressLine1?"border-red-500":""}),t.addressLine1&&e.jsx("p",{className:"text-sm text-red-500",children:t.addressLine1})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"city",children:"City"}),e.jsx(_,{id:"city",value:a.city||"",onChange:r=>h({...a,city:r.target.value}),className:t.city?"border-red-500":""}),t.city&&e.jsx("p",{className:"text-sm text-red-500",children:t.city})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"state",children:"State"}),e.jsx(_,{id:"state",value:a.state||"",onChange:r=>h({...a,state:r.target.value}),className:t.state?"border-red-500":""}),t.state&&e.jsx("p",{className:"text-sm text-red-500",children:t.state})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"country",children:"Country"}),e.jsx(_,{id:"country",value:a.country||"",onChange:r=>h({...a,country:r.target.value}),className:t.country?"border-red-500":""}),t.country&&e.jsx("p",{className:"text-sm text-red-500",children:t.country})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"pincode",children:"Pincode"}),e.jsx(_,{id:"pincode",value:a.pincode||"",onChange:r=>{const u=r.target.value.replace(/[^\d]/g,"").slice(0,6);h({...a,pincode:u})},className:t.pincode?"border-red-500":""}),t.pincode&&e.jsx("p",{className:"text-sm text-red-500",children:t.pincode})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-medium",children:"Products"}),t.products&&e.jsx("p",{className:"text-sm text-red-500",children:t.products})]}),e.jsx(Bs,{newProducts:$,setNewProducts:v,existingProducts:a.products||[],onRemoveExistingProduct:he,categories:L,products:f,onCategoryChange:de,onProductChange:be,onPricelistChange:Se,onQuantityChange:Ce,onRemoveNewProduct:Pe,effectiveTheme:xe}),e.jsx("div",{className:"bg-muted/20 p-4 rounded-lg",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["₹",ie.toFixed(2)]})]}),F>0&&e.jsxs("div",{className:"flex justify-between text-destructive",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["-₹",F.toFixed(2)]})]}),W&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Shipping:"}),e.jsxs("span",{children:["₹",Y.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg border-t pt-2",children:[e.jsx("span",{children:"Order Total:"}),e.jsxs("span",{children:["₹",B.toFixed(2)]})]})]})})]}),e.jsx(zs,{coupons:I,customCoupon:c,setCustomCoupon:D,appliedCoupon:y,setAppliedCoupon:p,setTotalDiscount:X,setShippingDiscount:ce,formData:a,newProducts:$,isLoading:E}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"notes",children:"Order Notes"}),e.jsx(Re,{id:"notes",value:a.notes||"",onChange:r=>h({...a,notes:r.target.value}),placeholder:"Enter any additional notes for the order...",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"deliveryNote",children:"Delivery Note"}),e.jsx(Re,{id:"deliveryNote",value:a.deliveryNote||"",onChange:r=>h({...a,deliveryNote:r.target.value}),placeholder:"Enter delivery note...",rows:3,className:t.deliveryNote?"border-red-500":""}),t.deliveryNote&&e.jsx("p",{className:"text-sm text-red-500",children:t.deliveryNote})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4 border-t",children:[e.jsx(P,{variant:"outline",onClick:U,disabled:q(),children:"Close"}),e.jsx(P,{onClick:()=>{S(!0),w()},disabled:q(),children:q()?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):T?"Create Order":"Save Changes"})]})]})})},Hs=({isOpen:A,onClose:U,orderId:T,orderTotal:b,customerName:k,currentOrderStatus:M,onRefund:R,isRefunding:E})=>{const[w,q]=d.useState(b.toString()),[S,a]=d.useState(""),[h,t]=d.useState(""),[$,v]=d.useState(""),[L,f]=d.useState(M||"Pending"),[I,C]=d.useState({amount:!1,reason:!1,method:!1}),se=["Customer request","Product damaged","Product not as described","Wrong item delivered","Delivery failure","Quality issues","Order cancellation","Duplicate order","Payment error","Other"],K=["Original payment method","Bank transfer","Cash refund"],l=p=>{if(p.preventDefault(),!S||!h)return;const F={orderId:T,amount:parseFloat(w),reason:S,refundMethod:h,notes:$,orderStatus:L};R(F)},c=()=>{q(b.toString())},D=p=>{const F=b*p/100;q(F.toFixed(2))},y=()=>{const p=parseFloat(w);return p>0&&p<=b};return d.useEffect(()=>{q(b.toString())},[b]),d.useEffect(()=>{A||(q(b.toString()),a(""),t(""),v(""),f(M||"Pending"),C({amount:!1,reason:!1,method:!1}))},[A,b,M]),e.jsx(qe,{open:A,onOpenChange:U,children:e.jsxs(Ue,{className:"max-w-md",children:[e.jsx($e,{children:e.jsxs(Ve,{className:"flex items-center gap-2",children:[e.jsx(Ls,{className:"h-5 w-5"}),"Process Refund - Order #",T]})}),e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Order Summary"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Order ID:"}),e.jsxs("span",{className:"font-medium",children:["#",T]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Customer:"}),e.jsx("span",{className:"font-medium",children:k})]}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Total Amount:"}),e.jsxs("span",{children:["₹",b.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Quick Refund Options"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{type:"button",variant:"outline",size:"sm",onClick:c,className:"flex-1",children:"Full Refund"}),e.jsx(P,{type:"button",variant:"outline",size:"sm",onClick:()=>D(50),className:"flex-1",children:"50%"}),e.jsx(P,{type:"button",variant:"outline",size:"sm",onClick:()=>D(25),className:"flex-1",children:"25%"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"refundAmount",children:"Refund Amount (₹) *"}),e.jsx(_,{id:"refundAmount",type:"number",min:"0",max:b,step:"0.01",value:w,onChange:p=>q(p.target.value),onBlur:()=>C(p=>({...p,amount:!0})),placeholder:"Enter refund amount",className:!y()&&w&&I.amount?"border-red-500":""}),!y()&&w&&I.amount&&e.jsxs("p",{className:"text-sm text-red-500",children:["Amount must be between ₹0 and ₹",b.toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"refundReason",children:"Refund Reason *"}),e.jsxs(Q,{value:S,onValueChange:p=>{a(p),C(F=>({...F,reason:!0}))},children:[e.jsx(H,{className:!S&&I.reason?"border-red-500":"",children:e.jsx(G,{placeholder:"Select reason for refund"})}),e.jsx(J,{children:se.map(p=>e.jsx(g,{value:p,children:p},p))})]}),!S&&I.reason&&e.jsx("p",{className:"text-sm text-red-500",children:"Please select a reason"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"refundMethod",children:"Refund Method *"}),e.jsxs(Q,{value:h,onValueChange:p=>{t(p),C(F=>({...F,method:!0}))},children:[e.jsx(H,{className:!h&&I.method?"border-red-500":"",children:e.jsx(G,{placeholder:"Select refund method"})}),e.jsx(J,{children:K.map(p=>e.jsx(g,{value:p,children:p},p))})]}),!h&&I.method&&e.jsx("p",{className:"text-sm text-red-500",children:"Please select a refund method"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"refundNotes",children:"Additional Notes"}),e.jsx(Re,{id:"refundNotes",value:$,onChange:p=>v(p.target.value),placeholder:"Enter any additional notes about the refund...",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"refundOrderStatus",children:"Order Status After Refund"}),e.jsxs(Q,{value:L,onValueChange:f,children:[e.jsx(H,{children:e.jsx(G,{placeholder:"Select order status"})}),e.jsxs(J,{children:[e.jsx(g,{value:"Ordered",children:"Ordered"}),e.jsx(g,{value:"Payment Processed",children:"Payment Processed"}),e.jsx(g,{value:"Processing",children:"Processing"}),e.jsx(g,{value:"Packed",children:"Packed"}),e.jsx(g,{value:"Shipped",children:"Shipped"}),e.jsx(g,{value:"Delivered",children:"Delivered"}),e.jsx(g,{value:"Cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4 border-t",children:[e.jsx(P,{type:"button",variant:"outline",onClick:U,disabled:E,children:"Cancel"}),e.jsx(P,{type:"submit",disabled:E||!y()||!S||!h,variant:"destructive",children:E?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing Refund..."]}):`Process Refund of ₹${parseFloat(w||"0").toFixed(2)}`})]})]})]})})},Gs=({isOpen:A,onClose:U,onPaymentSuccess:T,orderId:b,orderTotal:k,customerName:M,customerPhone:R})=>{const w=(()=>{const S="renugarenuga36-1@okhdfcbank",a="Renus Home Foods",h=`Order #${b}`;return`upi://pay?pa=${S}&pn=${encodeURIComponent(a)}&am=${k}&cu=INR&tn=${encodeURIComponent(h)}`})(),q=()=>{navigator.clipboard.writeText("renugarenuga36-1@okhdfcbank").then(()=>{})};return e.jsx(qe,{open:A,onOpenChange:U,children:e.jsxs(Ue,{className:"max-w-md max-h-screen mt-4 mb-4 flex flex-col p-0",children:[e.jsx($e,{className:"sticky top-0 bg-background z-10 px-6 py-4 border-b",children:e.jsxs(Ve,{className:"flex items-center gap-2",children:[e.jsx(Fs,{className:"h-5 w-5"}),"UPI Payment - Order #",b]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-6",children:[e.jsxs("div",{className:"bg-muted/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Order Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Order ID:"}),e.jsxs("span",{className:"font-medium",children:["#",b]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Customer:"}),e.jsx("span",{className:"font-medium",children:M})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Phone:"}),e.jsx("span",{className:"font-medium",children:R})]}),e.jsxs("div",{className:"flex justify-between text-lg font-semibold border-t pt-2",children:[e.jsx("span",{children:"Total Amount:"}),e.jsxs("span",{children:["₹",k.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"font-medium mb-4",children:"Scan QR Code to Pay"}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-background p-3 rounded-xl border border-border",children:e.jsx(Is,{value:w,size:180,qrStyle:"dots",eyeRadius:10,logoPaddingStyle:"circle",logoImage:"/img/logo.webp"})})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Scan this QR code using any UPI app (PhonePe, Google Pay, Paytm, etc.)"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Or pay manually:"}),e.jsx("div",{className:"bg-muted/20 p-3 rounded-lg",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"UPI ID:"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("code",{className:"flex-1 bg-background px-2 py-1 rounded text-sm",children:"renugarenuga36-1@okhdfcbank"}),e.jsx(P,{variant:"outline",size:"sm",onClick:q,children:"Copy"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Amount:"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("code",{className:"flex-1 bg-background px-2 py-1 rounded text-sm",children:["₹",k.toFixed(2)]}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>navigator.clipboard.writeText(k.toFixed(2)),children:"Copy"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Reference:"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("code",{className:"flex-1 bg-background px-2 py-1 rounded text-sm",children:["Order #",b]}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>navigator.clipboard.writeText(`Order #${b}`),children:"Copy"})]})]})]})})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Payment Instructions:"}),e.jsxs("ol",{className:"text-sm text-blue-700 space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:"Open your UPI app (PhonePe, Google Pay, Paytm, etc.)"}),e.jsx("li",{children:"Scan the QR code or use the UPI ID above"}),e.jsxs("li",{children:["Enter the exact amount: ₹",k.toFixed(2)]}),e.jsxs("li",{children:["Use reference: Order #",b]}),e.jsx("li",{children:"Complete the payment and share the transaction ID"})]})]})]}),e.jsxs("div",{className:"bg-background z-10 px-6 py-4 border-t flex justify-between",children:[e.jsx(P,{variant:"outline",onClick:U,children:"Close"}),e.jsx(P,{onClick:T,children:"Payment Completed"})]})]})})},pt=()=>{const{effectiveTheme:A}=ks(),U=new Date,T=new Date(U.getFullYear(),U.getMonth(),1),b=U,[k,M]=d.useState({from:T,to:b}),{from:R,to:E}=k||{},[w,q]=d.useState("All"),[S,a]=d.useState("All"),[h,t]=d.useState("All"),[$,v]=d.useState("All"),[L,f]=d.useState(!1),[I,C]=d.useState([]),[se,K]=d.useState([]),[l,c]=d.useState([]),[D,y]=d.useState([]),[p,F]=d.useState([]),[X,z]=d.useState(!1),[ce,de]=d.useState(!1),[be,Se]=d.useState([]),[Ce,Pe]=d.useState(null),[he,xe]=d.useState(!1),[re,pe]=d.useState(!1),[j,oe]=d.useState(null),[n,Z]=d.useState({userId:"",cartId:null,orderDate:new Date,orderStatus:"",shippingMethod:"",paymentMethod:"",expectedDeliveryDate:new Date,deliveryName:"",addressLine1:"",city:"",state:"",country:"",pincode:"",deliveryPhone:"",customerName:"",customerPhone:"",customerEmail:"",notes:"",deliveryNote:"",products:[]}),[Ie,ie]=d.useState({}),[W,Y]=d.useState([]),[B,r]=d.useState(null),[u,V]=d.useState(null),[Oe,je]=d.useState(""),[ue,we]=d.useState(null),[De,ze]=d.useState(0),[Ae,Be]=d.useState(0),[es,ve]=d.useState(!1),[ss,ye]=d.useState(!1),[ts,ke]=d.useState(!1),[ge,Qe]=d.useState({orderId:0,orderTotal:0,customerName:"",customerPhone:""}),[fe,rs]=d.useState({orderId:0,orderTotal:0,customerName:"",currentOrderStatus:""}),as=[{value:"All",label:"All"},{value:"Pending",label:"Pending"},{value:"Delivered",label:"Delivered"},{value:"Cancelled",label:"Cancelled"}],ls=[{value:"All",label:"All"},...I.map(s=>({value:s.category,label:s.category}))],ns=[{value:"All",label:"All"},...se.map(s=>({value:s.name,label:s.name}))],ds=[{value:"All",label:"All"},...l.map(s=>({value:JSON.stringify(s),label:s.name+" ( "+s.phone+" )"}))];d.useEffect(()=>{te.postData({endpoint:"/inventory/get-categories",body:{request:ne({type:"Product"})},successCallback:s=>{Array.isArray(s)?C(s):C([])},errorCallback:()=>{C([])}})},[]),d.useEffect(()=>{const s=localStorage.getItem("token");if(!s){console.error("No token found");return}te.get("/admin/user-list",{Authorization:`Bearer ${s}`}).then(i=>{Array.isArray(i?.users)?c(i?.users||[]):c([])}).catch(i=>{console.error("Error fetching users:",i),c([])})},[]),d.useEffect(()=>{S&&S!=="All"?te.postData({endpoint:"/inventory/get-products",body:{request:ne({category:S})},successCallback:s=>{K(s||[])},errorCallback:()=>{console.error("Failed to fetch products for filter"),K([])}}):K([])},[S]);const is=()=>{te.postData({endpoint:"/inventory/get-products",body:{request:ne({})},successCallback:s=>{K(i=>{const o=i.map(x=>x.id),N=(s||[]).filter(x=>!o.includes(x.id));return[...i,...N]})},errorCallback:s=>{console.error("Failed to fetch all products:",s)}})};d.useEffect(()=>{I.length>0&&is()},[I.length]),d.useEffect(()=>{B&&B.value&&B.value!=="new-customer"&&os(B?.value?.id)},[B]),d.useEffect(()=>{he&&cs()},[B,W,n.products,n.orderDate,he]);const Me=()=>{const s=localStorage.getItem("token");if(!s){console.error("No token found");return}let i=null,o=null;if($!=="All"&&$)try{const x=$;i=x.name,o=x.phone}catch(x){console.error("Error parsing user object:",x)}const N={fromDate:R?R.toISOString().split("T")[0]:null,toDate:E?E.toISOString().split("T")[0]:null,orderStatus:w!=="All"?w:null,category:S!=="All"?S:null,product:h!=="All"?h:null,name:i,phone:o};te.postData({endpoint:"/admin/fetch-orders",body:{request:ne(N)},Authorization:`Bearer ${s}`,successCallback:x=>{if(j?.orderId){const ae=x.orders.find(O=>O.orderId===j?.orderId);oe(ae)}Se(x.orders||[])},errorCallback:x=>{console.error("Error fetching orders:",x)}})},cs=()=>{de(!0);const s=n.products?.map(O=>O.productId).filter(Boolean)||[],i=W.filter(O=>O.product&&O.quantity>0).map(O=>O.productId).filter(Boolean),o=[...s,...i],N=B?.value?.id?[B.value.id]:[],x=n.orderDate?n.orderDate.toISOString().split("T")[0]:null,ae={products:o,token:localStorage.getItem("token")||void 0,users:N,fromStartDate:x,fromEndDate:x};te.postData({endpoint:"/order/get-coupons",body:{request:ne(ae)},successCallback:O=>{let le=[];if(O&&O.coupons)le=O.coupons;else if(O&&O.response)try{le=JSON.parse(O.response).coupons||[]}catch(me){console.error("Error parsing response:",me)}F(le||[]),de(!1)},errorCallback:O=>{console.error("Error fetching coupons:",O),console.error("Error details:",O.response?.data),F([]),de(!1)}})},os=async s=>{if(!s){y([]),V(null);return}z(!0);try{const i=localStorage.getItem("token");if(!i){console.error("No token found");return}await te.postData({endpoint:"/admin/user-addresses",body:{request:ne({userId:s})},Authorization:`Bearer ${i}`,successCallback:o=>{const N=o?.addresses||[];if(y(N),N.length>0){const x=N.find(ae=>ae.isDefault)||N[0];V({value:x.id,label:`${x.name} - ${x.addressLine1}, ${x.city}`}),Z({...n,customerEmail:B?.value?.email||"",customerName:B?.value?.name||"",customerPhone:B?.value?.phone||"",deliveryName:x.name,addressLine1:x.addressLine1,city:x.city,state:x.state,country:x.country,pincode:x.pincode,deliveryPhone:x.phone})}else V(null),Z({...n,deliveryName:"",addressLine1:"",city:"",state:"",country:"",pincode:"",deliveryPhone:""})},errorCallback:o=>{console.error("Error fetching user addresses:",o),y([]),V(null)}})}catch(i){console.error("Error fetching user addresses:",i),y([]),V(null)}finally{z(!1)}};d.useEffect(()=>{Me()},[R,E,w,S,h,$]);const us=()=>R&&E?`${Ne(R,"dd/MM/yyyy")} - ${Ne(E,"dd/MM/yyyy")}`:"Select date range",He=()=>{Z({userId:"",orderDate:new Date,orderStatus:"",shippingMethod:"",paymentMethod:"",expectedDeliveryDate:new Date,deliveryName:"",addressLine1:"",city:"",state:"",country:"",pincode:"",deliveryPhone:"",customerName:"",customerPhone:"",customerEmail:"",notes:"",deliveryNote:"",products:[]}),ie({}),Y([]),r(null),V(null),je(""),we(null),ze(0),Be(0),oe(null),F([])},Ge=s=>{if(s){pe(!1),Y([]),oe(s),we(p.find(o=>o.code===s.couponCode)||null),je(s.couponCode||""),Z({userId:s.userId.toString(),cartId:s.cartId,orderId:s.orderId,orderDate:new Date(s.orderDate),orderStatus:s.orderStatus,shippingMethod:s.shippingMethod,paymentMethod:s.paymentMethod,expectedDeliveryDate:new Date(s.expectedDeliveryDate),deliveryName:s.deliveryName,addressLine1:s.addressLine1,city:s.city,state:s.state,country:s.country,pincode:s.pincode,deliveryPhone:s.deliveryPhone,customerName:s.customerName,customerPhone:s.customerPhone,customerEmail:s.customerEmail,notes:s.notes||"",deliveryNote:s.deliveryNote||"",products:s.products});const i=l.find(o=>o.id===s.userId);r({value:i,label:`${i.name} (${i.phone})`})}else pe(!0),He();xe(!0)},ms=()=>{xe(!1),He()},hs=s=>{r(s),s&&s.value&&s.value!=="new-customer"?Z({...n,customerName:s.value.name,customerPhone:s.value.phone,customerEmail:s.value.email}):(y([]),V(null),s&&s.value==="new-customer"&&Z({...n,deliveryName:"",addressLine1:"",city:"",state:"",country:"",pincode:"",deliveryPhone:"",customerName:"",customerPhone:"",customerEmail:""}))},xs=async()=>{try{const s={};if(n.orderStatus||(s.orderStatus="Order status is required"),n.shippingMethod||(s.shippingMethod="Shipping method is required"),n.paymentMethod||(s.paymentMethod="Payment method is required"),n.deliveryName||(s.deliveryName="Delivery name is required"),n.addressLine1||(s.addressLine1="Address is required"),n.city||(s.city="City is required"),n.state||(s.state="State is required"),n.country||(s.country="Country is required"),n.pincode||(s.pincode="Pincode is required"),n.deliveryPhone||(s.deliveryPhone="Delivery phone is required"),n.customerName||(s.customerName="Customer name is required"),n.customerPhone||(s.customerPhone="Customer phone is required"),n.customerEmail||(s.customerEmail="Customer email is required"),n.products.length===0&&W.filter(N=>N.product&&N.quantity>0).length===0&&(s.products="At least one product is required"),Object.keys(s).length>0){ie(s);return}else ie({});const i={orderId:re?void 0:j?.orderId,userAddressId:!u?.value||u?.value==="new-address"?void 0:u?.value,cartId:n.cartId,orderDate:n.orderDate?n.orderDate.toISOString().split("T")[0]:null,orderStatus:n.orderStatus,shippingMethod:n.shippingMethod,expectedDeliveryDate:n.expectedDeliveryDate?n.expectedDeliveryDate.toISOString().split("T")[0]:null,deliveryName:n.deliveryName,addressLine1:n.addressLine1,city:n.city,state:n.state,country:n.country,pincode:n.pincode,deliveryPhone:n.deliveryPhone,customerName:n.customerName,customerPhone:n.customerPhone,customerEmail:n.customerEmail,products:[...n.products,...W.filter(N=>N.product&&N.quantity>0).map(N=>({quantity:N.quantity,productName:N.product.name,price:N.priceList.unitprice,categoryName:N.category.category,productTotal:N.priceList.unitprice*N.quantity,priceListId:N.priceListId,productDiscount:0}))],notes:n.notes||"",deliveryNote:n.deliveryNote||"",paymentMethod:n.paymentMethod,couponId:ue?.id||null,userId:B?.value?.id||null,totalDiscount:De,shippingDiscount:Ae},o=localStorage.getItem("token");if(!o){ee.error("Authentication token not found"),ve(!1);return}te.postData({endpoint:"/admin/save-order",body:{request:ne(i)},Authorization:`Bearer ${o}`,successCallback:N=>{ve(!1);const x=i.products.reduce((Cs,Ps)=>Cs+(Ps.productTotal||0),0),ae=x<999&&n.shippingMethod==="Home Delivery"?99:0,O=j?(j?.orderTotal||0)-j?.productDiscount-j?.shippingDiscount+ae:0,le=x-De-Ae+ae,me=N?.orderId||j?.orderId,Je=n.paymentMethod==="UPI",bs=!re&&le>O,Ss=!re&&le<O,We=Math.abs(le-O);ee.success(re?"Order created successfully!":"Order updated successfully!"),xe(!1),Me(),re&&Je?(Qe({orderId:me||0,orderTotal:le,customerName:n.customerName,customerPhone:n.customerPhone}),ye(!0)):bs&&Je?(Qe({orderId:me||0,orderTotal:We,customerName:n.customerName,customerPhone:n.customerPhone}),ye(!0)):Ss&&(rs({orderId:me||0,orderTotal:Number(We.toFixed(2)),customerName:n.customerName,currentOrderStatus:n.orderStatus}),ke(!0))},errorCallback:N=>{ve(!1),console.error("Error saving order:",N),ee.error(N?.error||N?.message||"Failed to save order")}})}catch(s){ve(!1),ee.error("Failed to save order"),console.error("Error saving order:",s)}},ps=s=>{let i=`The Order has been cancelled or modified and we have refunded ₹${s.amount.toFixed(2)} via ${s.refundMethod} because of ${s.reason}.`;s.notes&&s.notes.trim().length>0&&(i+=` Additional Notes: ${s.notes}`);const o={orderId:j?.orderId||s.orderId,userAddressId:j?.userAddressId||null,cartId:j?.cartId||null,orderDate:j?.orderDate?new Date(j.orderDate).toISOString().split("T")[0]:null,orderStatus:s.orderStatus,shippingMethod:j?.shippingMethod||"",expectedDeliveryDate:j?.expectedDeliveryDate?new Date(j.expectedDeliveryDate).toISOString().split("T")[0]:null,deliveryName:j?.deliveryName||"",addressLine1:j?.addressLine1||"",city:j?.city||"",state:j?.state||"",country:j?.country||"",pincode:j?.pincode||"",deliveryPhone:j?.deliveryPhone||"",customerName:j?.customerName||"",customerPhone:j?.customerPhone||"",customerEmail:j?.customerEmail||"",products:j?.products||[],notes:j?.notes||"",deliveryNote:i,paymentMethod:j?.paymentMethod||"",couponId:ue?.id||null,userId:j?.userId||null,totalDiscount:j?.totalDiscount||0,shippingDiscount:j?.shippingDiscount||0},N=localStorage.getItem("token");if(!N){ee.error("Authentication token not found");return}te.postData({endpoint:"/admin/save-order",body:{request:ne(o)},Authorization:`Bearer ${N}`,successCallback:x=>{ee.success("Refund processed successfully!"),ke(!1),Me()},errorCallback:x=>{console.error("Error processing refund:",x),ee.error(x?.error||x?.message||"Failed to process refund")}})},js=(s,i)=>{const o=[...W];o[s]={...o[s],category:i,categoryId:i?.id,product:null,productId:null,priceList:null,priceListId:null,total:0},Y(o)},vs=(s,i)=>{const o=[...W];o[s]={...o[s],product:i,productId:i?.id,priceList:null,priceListId:null,total:o[s].quantity*(i?.priceLists?.[0]?.unitprice||0)},Y(o)},ys=(s,i)=>{const o=[...W];o[s]={...o[s],priceList:i,priceListId:i?.id,total:o[s].quantity*(i?.unitprice||0)},Y(o)},gs=(s,i)=>{const o=[...W];o[s]={...o[s],quantity:i,total:i*(o[s].priceList?.unitprice||0)},Y(o)},fs=s=>{Y(W.filter((i,o)=>o!==s))},Ns=s=>{Z({...n,products:n.products.filter((i,o)=>o!==s)})};return e.jsxs(e.Fragment,{children:[e.jsx(Os,{}),e.jsxs("div",{className:"container mx-auto mt-6 p-6 min-h-screen",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Orders"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(P,{variant:"outline",onClick:()=>Ge(),className:"border-green-600 text-green-600 hover:text-primary",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"})," Create Order"]}),e.jsxs(P,{variant:"outline",onClick:()=>f(!L),className:"border-green-600 text-green-600 hover:text-primary",children:[e.jsx(Ts,{className:"w-4 h-4 mr-2"})," Filters"]})]})]}),L&&e.jsxs(qs,{className:"mb-6",children:[e.jsx(Us,{children:e.jsx($s,{children:"Filters"})}),e.jsx(Vs,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Date Range"}),e.jsxs(Le,{children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(P,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(Rs,{className:"mr-2 h-4 w-4"}),us()]})}),e.jsx(Te,{className:"w-auto p-0",align:"start",children:e.jsx(Ee,{mode:"range",selected:k,onSelect:M,numberOfMonths:1,autoFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Order Status"}),e.jsxs(Q,{value:w,onValueChange:q,children:[e.jsx(H,{children:e.jsx(G,{})}),e.jsx(J,{children:as.map(s=>e.jsx(g,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Category"}),e.jsxs(Q,{value:S,onValueChange:a,children:[e.jsx(H,{children:e.jsx(G,{})}),e.jsx(J,{children:ls.map(s=>e.jsx(g,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Product"}),e.jsxs(Q,{value:h,onValueChange:t,children:[e.jsx(H,{children:e.jsx(G,{})}),e.jsx(J,{children:ns.map(s=>e.jsx(g,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"User"}),e.jsxs(Q,{value:$,onValueChange:v,children:[e.jsx(H,{children:e.jsx(G,{})}),e.jsx(J,{children:ds.map(s=>e.jsx(g,{value:s.value,children:s.label},s.value))})]})]})]})})]}),e.jsx(Ds,{orders:be,expandedOrderId:Ce,setExpandedOrderId:Pe,viewType:"ManageOrders",onEditOrder:Ge}),e.jsx(Qs,{isOpen:he,onClose:ms,isCreateMode:re,editingOrder:j,users:l,userAddresses:D,isLoadingAddresses:X,isLoadingCoupons:ce,onSaveOrder:xs,setIsSaving:ve,isSaving:()=>es,formData:n,setFormData:Z,errors:Ie,newProducts:W,setNewProducts:Y,categories:I,products:se,coupons:p,selectedUser:B,setSelectedUser:hs,selectedAddress:u,setSelectedAddress:V,customCoupon:Oe,setCustomCoupon:je,appliedCoupon:ue,setAppliedCoupon:we,totalDiscount:De,setTotalDiscount:ze,shippingDiscount:Ae,setShippingDiscount:Be,onCategoryChange:js,onProductChange:vs,onPricelistChange:ys,onQuantityChange:gs,onRemoveNewProduct:fs,onRemoveExistingProduct:Ns,effectiveTheme:A}),e.jsx(Gs,{isOpen:ss,onClose:()=>ye(!1),onPaymentSuccess:()=>{ye(!1),ee.success("Payment successful!")},orderId:ge.orderId,orderTotal:ge.orderTotal,customerName:ge.customerName,customerPhone:ge.customerPhone}),e.jsx(Hs,{isOpen:ts,onClose:()=>ke(!1),orderId:fe.orderId,orderTotal:fe.orderTotal,customerName:fe.customerName,currentOrderStatus:fe.currentOrderStatus,onRefund:s=>{ps(s)},isRefunding:!1})]}),e.jsx(ws,{})]})};export{pt as default};

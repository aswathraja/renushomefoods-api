import{r as a,j as e,R as _,F as Xe,C as Ze,D as _e,f as pe,g as et,h as tt}from"./vendor-react-Bv33ryjV.js";import{A as st}from"./AdminNavBar-C4EyqKDd.js";import{C as at}from"./dropdown-menu-BDj5FxyU.js";import{O as rt}from"./OrdersTable-ZESn4eMN.js";import{u as lt,A as y,e as C,B as Q}from"./index-BgzncNPj.js";import{A as ot,c as X,i as h,G as nt,I as Z,a as B,t as N,b as ct}from"./InteractivePieChart-ifuDDKb5.js";import{f as U,C as dt}from"./calendar-DeP6F9X6.js";import{C as x,c as g,a as w,b as A}from"./card-dPuP1Ci1.js";import{L as k}from"./label-bvSFhUHd.js";import{P as it,a as ut,b as mt}from"./popover-BSIvycCC.js";import{S as L,a as R,b as E,c as H,d}from"./select-CpYWT6P5.js";import"./TopBar-D2vj-zy0.js";import"./badge-FegKslFz.js";import"./table-bzACJohG.js";import"./vendor-pdf-DxqLLkkN.js";import"./index-BlLmK--u.js";const M=({title:o,value:p,icon:b,trend:I,trendUp:K,isLoading:P,lastUpdated:O})=>e.jsxs(x,{className:"relative overflow-hidden group hover:shadow-lg transition-all duration-300 hover:-translate-y-1",children:[e.jsx(w,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-sm font-medium text-muted-foreground",children:o}),e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 text-primary",children:b})]})}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold mb-1",children:P?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-muted-foreground",children:"Loading..."})]}):p}),I&&e.jsxs("div",{className:`flex items-center text-xs ${K?"text-green-600":"text-red-600"}`,children:[e.jsx(pe,{className:"w-3 h-3 mr-1"}),I]}),O&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Updated: ",U(O,"HH:mm:ss")]})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),ht=({isAutoRefreshEnabled:o,onToggleAutoRefresh:p})=>e.jsx("div",{className:"flex basis-43",children:e.jsxs(Q,{variant:"outline",size:"default",onClick:p,className:`items-center gap-3 flex basis-43 w-full transition-colors hover:text-primary ${o?"text-green-600 border-green-600":"text-muted-foreground"}`,children:[e.jsx(_,{className:`w-4 h-4 ${o?"animate-spin":""}`}),"Auto-Refresh"]})}),Dt=()=>{const{effectiveTheme:o}=lt(),p=a.useRef(null),b=new Date,I=new Date(b.getFullYear(),b.getMonth(),1),K=b,[P,O]=a.useState({from:I,to:K}),{from:i,to:u}=P||{},[n,ee]=a.useState("All"),[c,te]=a.useState("All"),[m,q]=a.useState("All"),[V,fe]=a.useState("All"),[se,je]=a.useState(!1),[ae,ye]=a.useState([]),[re,le]=a.useState([]),[oe,ne]=a.useState([]),[ce,de]=a.useState([]),[xt,D]=a.useState(null),[W,be]=a.useState(!0),[f,Se]=a.useState(null),[j,T]=a.useState(!1),[ve,Ce]=a.useState({fromDate:i?i.toISOString().split("T")[0]:null,toDate:u?u.toISOString().split("T")[0]:null,orderStatus:n!=="All"?n:null,category:c!=="All"?c:null,product:m!=="All"?m:null,name:null,phone:null}),ie=["Payment Processed","Ordered","Processing","Packed","Shipped"],Ne=t=>ie.includes(t)?"Pending":t,ue=t=>t==="Pending"?ie:t==="Delivered"?["Delivered"]:t==="Cancelled"?["Cancelled"]:[],[ke,z]=a.useState([]),[we,Ae]=a.useState([]),[Ie,G]=a.useState([]),[J,Pe]=a.useState([]),[me,Oe]=a.useState([]),[Y,De]=a.useState([]),[$,Te]=a.useState([]),[S,$e]=a.useState({totalSales:0,avgOrderValue:0,totalOrders:0,pendingOrders:0}),[he,Fe]=a.useState([]),[Be,Le]=a.useState(null),[F]=a.useState(()=>new ot);a.useEffect(()=>{y.postData({endpoint:"/inventory/get-categories",body:{request:C({type:"Product"})},successCallback:t=>{Array.isArray(t)?z(t):z([])},errorCallback:()=>z([])})},[]),a.useEffect(()=>{const t=localStorage.getItem("token");if(!t){console.error("No token found");return}y.get("/admin/user-list",{Authorization:`Bearer ${t}`}).then(s=>{Array.isArray(s?.users)?G(s?.users||[]):G([])}).catch(s=>{console.error("Error fetching users:",s),G([])})},[]),a.useEffect(()=>{y.postData({endpoint:"/inventory/get-products",body:{request:C({category:c==="All"?void 0:c})},successCallback:t=>{Ae(t)}})},[c]);const Re=t=>{if(t==="All"||!t)return{name:null,phone:null};try{const s=JSON.parse(t);return{name:s.name,phone:s.phone}}catch(s){return console.error("Error parsing user object:",s),{name:null,phone:null}}},v=a.useCallback(()=>{T(!0);const t=localStorage.getItem("token");if(!t){console.error("No token found"),T(!1);return}const s=Re(V),r={fromDate:i?i.toISOString().split("T")[0]:null,toDate:u?u.toISOString().split("T")[0]:null,orderStatus:n!=="All"?n:null,category:c!=="All"?c:null,product:m!=="All"?m:null,name:s.name,phone:s.phone};Ce(r),y.postData({endpoint:"/admin/dashboard-kpis",body:{request:C(r)},Authorization:`Bearer ${t}`,successCallback:l=>{$e(l)},errorCallback:l=>{console.error("Error fetching KPIs:",l)}}),y.postData({endpoint:"/admin/chart-data",body:{request:C(r)},Authorization:`Bearer ${t}`,successCallback:l=>{Pe(l.totalsalesbycategory||[]),Oe(l.totalsalesbyproduct||[]),De(l.totalsalesbyorderstatus||[]),Te(l.productswithquantitiesbyorderstatus||[])},errorCallback:l=>{console.error("Error fetching chart data:",l)}}),y.postData({endpoint:"/admin/fetch-orders",body:{request:C(r)},Authorization:`Bearer ${t}`,successCallback:l=>{Fe(l.orders||[]),Se(new Date),T(!1)},errorCallback:l=>{console.error("Error fetching orders:",l),T(!1)}})},[i,u,n,c,m,V]);a.useEffect(()=>(W?F.start(()=>{v()},3e4):F.stop(),()=>{F.stop()}),[W,v,F]),a.useEffect(()=>{ne(ue(n))},[n]),a.useEffect(()=>{v()},[v]);const Ee=a.useCallback(t=>{},[]),He=a.useCallback(t=>{},[]),Me=a.useCallback(t=>{},[]),Qe=a.useCallback(t=>{},[]),Ue=a.useCallback(t=>{D(t)},[]),Ke=a.useCallback(t=>{D(t)},[]),qe=a.useCallback(t=>{D(t)},[]),Ve=a.useCallback(t=>{D(t)},[]),We=a.useCallback(()=>{be(t=>!t)},[]),xe=()=>i&&u?`${U(i,"dd/MM/yyyy")} - ${U(u,"dd/MM/yyyy")}`:"Select date range",ze=a.useMemo(()=>X(J.map((t,s)=>({...t,name:t.category,value:t.totalSales,color:h.normal[s%h.normal.length]}))),[J]),ge=a.useMemo(()=>X(me.map((t,s)=>({...t,name:t.product,value:t.totalSales,color:h.normal[(s+3)%h.normal.length]}))),[me]),Ge=a.useMemo(()=>X(Y.map((t,s)=>({...t,name:t.orderStatus,value:t.totalSales,color:h.normal[(s+6)%h.normal.length]}))),[Y]),Je=a.useMemo(()=>{const t=$.reduce((s,r)=>s+(r.pendingQuantity||0)+(r.fulfilledQuantity||0),0);return $.map((s,r)=>({...s,name:s.product,value:(s.pendingQuantity||0)+(s.fulfilledQuantity||0),percentage:t>0?((s.pendingQuantity||0)+(s.fulfilledQuantity||0))/t*100:0,color:h.normal[r%h.normal.length]}))},[$]),Ye=[{dataKey:"pendingQuantity",name:"Pending",color:"#f69568"},{dataKey:"fulfilledQuantity",name:"Fulfilled",color:"#059669"}];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"min-h-screen",children:[e.jsx(st,{}),e.jsxs("div",{className:"container mx-auto p-6 space-y-6",ref:p,children:[e.jsx("div",{className:"p-0 m-0 flex justify-end items-center",children:f&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Updated: ",U(f,"dd/mm/yyyy HH:mm:ss")]})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center mb-4",children:[e.jsx("h1",{className:"text-primary text-2xl font-bold",children:"Admin Dashboard"}),e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center",children:[e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx("div",{className:"flex basis-43",children:e.jsx(ht,{isAutoRefreshEnabled:W,onToggleAutoRefresh:We})}),e.jsxs(Q,{variant:"outline",onClick:v,disabled:j,className:"flex items-center gap-2 flex basis-47 dark:border-green-600 hover:text-primary",children:[e.jsx(_,{className:`h-4 w-4 ${j?"animate-spin":""}`}),"Refresh"]})]}),e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsxs(Q,{variant:"outline",onClick:()=>je(!se),className:"flex items-center gap-2 hover:text-primary transition-colors flex basis-40 dark:border-green-600",children:[e.jsx(Xe,{className:"h-4 w-4"}),"Filters"]}),e.jsx("div",{className:"flex-1",children:e.jsx(nt,{dashboardRef:p,tableData:he,filterState:ve,tableColumns:[{key:"orderId",label:"Order ID"},{key:"customerName",label:"Customer"},{key:"orderStatus",label:"Status"},{key:"totalAmount",label:"Amount"},{key:"orderDate",label:"Date"}],title:"Admin Dashboard",kpis:S,dateRange:xe()})})]})]})]}),se&&e.jsx(x,{className:"mb-6 shadow-sm border-0 bg-card/50 backdrop-blur-sm",children:e.jsx(g,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Date Range"}),e.jsxs(it,{children:[e.jsx(ut,{asChild:!0,children:e.jsxs(Q,{variant:"outline",className:`w-full justify-start text-left font-normal hover:bg-accent transition-colors ${!i&&!u&&"text-muted-foreground"}`,children:[e.jsx(Ze,{className:"mr-2 h-4 w-4"}),xe()]})}),e.jsx(mt,{className:"w-auto p-0",align:"start",children:e.jsx(dt,{mode:"range",selected:P,onSelect:O,numberOfMonths:1,autoFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Order Status"}),e.jsxs(L,{value:n,onValueChange:ee,children:[e.jsx(R,{className:"hover:bg-accent transition-colors",children:e.jsx(E,{placeholder:"Select status"})}),e.jsxs(H,{children:[e.jsx(d,{value:"All",children:"All"}),e.jsx(d,{value:"Pending",children:"Pending"}),e.jsx(d,{value:"Delivered",children:"Delivered"}),e.jsx(d,{value:"Cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Category"}),e.jsxs(L,{value:c,onValueChange:te,children:[e.jsx(R,{className:"hover:bg-accent transition-colors",children:e.jsx(E,{placeholder:"Select Category"})}),e.jsxs(H,{children:[e.jsx(d,{value:"All",children:"All"}),ke.map(t=>e.jsx(d,{value:t.category,children:t.category},t.category))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Product"}),e.jsxs(L,{value:m,onValueChange:q,children:[e.jsx(R,{className:"hover:bg-accent transition-colors",children:e.jsx(E,{placeholder:"Select product"})}),e.jsxs(H,{children:[e.jsx(d,{value:"All",children:"All"}),we?.map(t=>e.jsx(d,{value:t.name,children:t.name},t.name))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"User"}),e.jsxs(L,{value:V,onValueChange:fe,children:[e.jsx(R,{className:"hover:bg-accent transition-colors",children:e.jsx(E,{placeholder:"Select user"})}),e.jsxs(H,{children:[e.jsx(d,{value:"All",children:"All"}),Ie.map(t=>e.jsxs(d,{value:JSON.stringify(t),children:[t.name," (",t.phone,")"]},`${t.name}-${t.phone}`))]})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(M,{title:"Total Sales",value:`₹${S.totalSales?.toLocaleString()||"0"}`,icon:e.jsx(_e,{className:"h-4 w-4"}),isLoading:j,lastUpdated:f}),e.jsx(M,{title:"Avg Order Value",value:`₹${S.avgOrderValue?.toFixed(2).toLocaleString()||"0.00"}`,icon:e.jsx(pe,{className:"h-4 w-4"}),isLoading:j,lastUpdated:f}),e.jsx(M,{title:"Total Orders",value:S.totalOrders||0,icon:e.jsx(et,{className:"h-4 w-4"}),isLoading:j,lastUpdated:f}),e.jsx(M,{title:"Pending Orders",value:S.pendingOrders||0,icon:e.jsx(tt,{className:"h-4 w-4"}),isLoading:j,lastUpdated:f})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(x,{className:"shadow-lg hover:shadow-xl transition-shadow duration-300 border-0 bg-card/50 backdrop-blur-sm","data-chart":"category",children:[e.jsx(w,{children:e.jsxs(A,{className:"text-lg flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary animate-pulse"}),"Total Sales by Category"]})}),e.jsxs(g,{className:"space-y-4",children:[e.jsx(Z,{data:J,title:"Total Sales by Category",dataKey:"totalSales",nameKey:"category",selectedItems:ae,onItemClick:Ee,onItemHover:Ue,labelFormatter:(t,s,r)=>`${t} ₹${s.toLocaleString()} (${(r.percent*100).toFixed(2)}%)`,theme:o}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-3 text-muted-foreground",children:"Filter & Legend"}),e.jsx(B,{data:ze,selectedItems:ae,onItemToggle:t=>{ye(s=>N(s,t)),te(t===c?"All":t)},theme:o})]})]})]}),e.jsxs(x,{className:"shadow-lg hover:shadow-xl transition-shadow duration-300 border-0 bg-card/50 backdrop-blur-sm","data-chart":"product",children:[e.jsx(w,{children:e.jsxs(A,{className:"text-lg flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary animate-pulse"}),"Total Sales by Product"]})}),e.jsxs(g,{className:"space-y-4",children:[e.jsx(Z,{data:ge,title:"Total Sales by Product",dataKey:"value",nameKey:"name",selectedItems:re,onItemClick:He,onItemHover:Ke,theme:o,labelFormatter:(t,s,r)=>`${t} ₹${s.toLocaleString()} (${(r.percent*100).toFixed(2)}%)`}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-3 text-muted-foreground",children:"Filter & Legend"}),e.jsx(B,{data:ge,selectedItems:re,onItemToggle:t=>{le(s=>N(s,t)),de(s=>N(s,t)),q(t===m?"All":t)},theme:o})]})]})]}),e.jsxs(x,{className:"shadow-lg hover:shadow-xl transition-shadow duration-300 border-0 bg-card/50 backdrop-blur-sm","data-chart":"status",children:[e.jsx(w,{children:e.jsxs(A,{className:"text-lg flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary animate-pulse"}),"Total Sales by Order Status"]})}),e.jsxs(g,{className:"space-y-4",children:[e.jsx(Z,{data:Y,title:"Total Sales by Order Status",dataKey:"totalSales",nameKey:"orderStatus",selectedItems:oe,labelFormatter:(t,s,r)=>`${t} ₹${s.toLocaleString()} (${(r.percent*100).toFixed(2)}%)`,onItemClick:Me,onItemHover:qe,theme:o}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-3 text-muted-foreground",children:"Filter & Legend"}),e.jsx(B,{data:Ge,selectedItems:oe,onItemToggle:t=>{const s=Ne(t);ee(s===n?"All":s),ne(ue(s===n?"All":s))},theme:o})]})]})]}),e.jsxs(x,{className:"shadow-lg hover:shadow-xl transition-shadow duration-300 border-0 bg-card/50 backdrop-blur-sm","data-chart":"quantities",children:[e.jsx(w,{children:e.jsxs(A,{className:"text-lg flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary animate-pulse"}),"Products with Quantities by Order Status"]})}),e.jsxs(g,{className:"space-y-4",children:[e.jsx(ct,{data:$,title:"Products with Quantities by Order Status",bars:Ye,selectedItems:ce,onItemClick:Qe,onItemHover:Ve,theme:o,showPercentage:!0,yAxisTickFormatter:t=>t.toLocaleString()}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-3 text-muted-foreground",children:"Filter & Legend"}),e.jsx(B,{data:Je,selectedItems:ce,onItemToggle:t=>{de(s=>N(s,t)),le(s=>N(s,t)),q(t===m?"All":t)},theme:o,showPercentage:!0,formatAsCurrency:!1})]})]})]})]}),e.jsx(x,{className:"shadow-lg border-0 bg-card/50 backdrop-blur-sm",children:e.jsx(g,{children:e.jsx(rt,{orders:he,expandedOrderId:Be,setExpandedOrderId:Le,viewType:"ViewOnly"})})})]})]}),e.jsx("div",{className:"no-print",children:e.jsx(at,{})})]})};export{Dt as default};

import{r as e,j as s,P as a,F as t,G as l,X as r,I as n,M as i,J as d}from"./vendor-react-Tc4xLtOv.js";import{A as c}from"./AdminNavBar-nV0t9olM.js";import{C as o}from"./dropdown-menu-Dweh6OYL.js";import{u as m,B as u,A as x,e as h,c as j}from"./index-CCl3TzR2.js";import{B as g}from"./badge-BZaNuTv-.js";import{C as p}from"./calendar-Cnbaz_2s.js";import{C as f,a as v,b as y,c as b}from"./card-ZRElQZzO.js";import{D as N,a as C,b as S,c as w,d as M}from"./dialog-CT_0QHuT.js";import{I as D}from"./input-F4kRSedd.js";import{L as k}from"./label-DxpSIJ1C.js";import{P as A,a as P,b as F}from"./popover-B3nRiRzT.js";import{T as $}from"./textarea-LiP7jPED.js";import{P as E}from"./PhotoGallaryModal-piAobPR-.js";import{C as I}from"./checkbox-C1BQOpNB.js";import{T as q,a as B,b as z,c as G,d as U,e as O}from"./table-DDweQ1vw.js";import{f as R}from"./vendor-dates-BQQoqOpn.js";import"./vendor-charts-DKw1ZHYY.js";import"./vendor-ui-utils-B4kPJlQS.js";import"./TopBar-DKySbC2h.js";import"./vendor-radix-O0RUyoIw.js";import"./vendor-pdf-export-C4gp01y5.js";import"./vendor-animation-BGrdDg6I.js";const T=()=>{const{effectiveTheme:T}=m(),[J,L]=e.useState([]),[W,K]=e.useState(!1),[Q,H]=e.useState(!1),[V,X]=e.useState(!1),[Y,Z]=e.useState(null),[_,ee]=e.useState({}),[se,ae]=e.useState(!1),[te,le]=e.useState(null),[re,ne]=e.useState(!1),[ie,de]=e.useState(""),[ce,oe]=e.useState(""),[me,ue]=e.useState(""),[xe,he]=e.useState({}),[je,ge]=e.useState({}),[pe,fe]=e.useState([]),[ve,ye]=e.useState(""),[be,Ne]=e.useState(new Date),[Ce,Se]=e.useState(new Date),[we,Me]=e.useState(""),[De,ke]=e.useState(""),[Ae,Pe]=e.useState([]),[Fe,$e]=e.useState([]),[Ee,Ie]=e.useState(null),[qe,Be]=e.useState(null),[ze,Ge]=e.useState({}),Ue=e.useRef(null),Oe=()=>{ye(""),Ne(new Date),Se(new Date),Me(""),ke(""),Pe([]),Ie(null),Be(null),Ge({}),X(!1),Z(null),Ue.current&&(Ue.current.value="")},Re=()=>{K(!0);const e=localStorage.getItem("token");if(!e)return;const s={name:ie||null,subject:ce||null,message:me||null,fromStartDate:xe.from?R(xe.from,"yyyy-MM-dd"):null,toStartDate:xe.to?R(xe.to,"yyyy-MM-dd"):null,fromEndDate:je.from?R(je.from,"yyyy-MM-dd"):null,toEndDate:je.to?R(je.to,"yyyy-MM-dd"):null,users:pe.map(e=>e.value),token:e};x.postData({endpoint:"/admin/ad-campaigns",body:{request:h(s)},Authorization:`Bearer ${e}`,successCallback:e=>{L(e.adCampaigns||[]),K(!1)},errorCallback:e=>{L([]),K(!1)}})};e.useEffect(()=>{(()=>{const e=localStorage.getItem("token");e&&x.get("/admin/user-list",{Authorization:`Bearer ${e}`}).then(e=>{if(e?.users){const s=[{value:"All",label:"All"},...e.users.map(e=>({value:e.id,label:`${e.name} (${e.email||e.phone})`}))];$e(s)}}).catch(()=>{$e([])})})(),Re()},[]),e.useEffect(()=>{Re()},[ie,ce,me,xe,je,pe]);const Te=e=>{try{return R(new Date(e),"dd/MM/yyyy")}catch{return e}};return s.jsxs("div",{children:[s.jsx(c,{}),s.jsxs("div",{className:"container mx-auto mt-6 p-6 min-h-screen",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:"Campaigns"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(u,{variant:"outline",onClick:()=>{Oe(),H(!0)},className:"border-green-600 text-green-600 hover:text-primary",children:[s.jsx(a,{className:"w-4 h-4 mr-2"}),"Add"]}),s.jsxs(u,{variant:"outline",onClick:()=>ne(!re),className:"border-green-600 text-green-600 hover:text-primary",children:[s.jsx(t,{className:"w-4 h-4 mr-2"}),"Filters"]})]})]}),re&&s.jsxs(f,{className:"mb-6",children:[s.jsx(v,{children:s.jsx(y,{children:"Filters"})}),s.jsx(b,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx(k,{children:"Name"}),s.jsx(D,{value:ie,onChange:e=>de(e.target.value),placeholder:"Enter campaign name"})]}),s.jsxs("div",{children:[s.jsx(k,{children:"Subject"}),s.jsx(D,{value:ce,onChange:e=>oe(e.target.value),placeholder:"Enter subject"})]}),s.jsxs("div",{children:[s.jsx(k,{children:"Message"}),s.jsx(D,{value:me,onChange:e=>ue(e.target.value),placeholder:"Enter message"})]}),s.jsxs("div",{children:[s.jsx(k,{children:"Start Date Range"}),s.jsxs(A,{children:[s.jsx(P,{asChild:!0,children:s.jsxs(u,{variant:"outline",className:`w-full justify-start text-left font-normal ${!xe.from&&!xe.to&&"text-muted-foreground"}`,children:[s.jsx(l,{className:"mr-2 h-4 w-4"}),xe.from?xe.to?s.jsxs(s.Fragment,{children:[R(xe.from,"dd/MM/yyyy")," -"," ",R(xe.to,"dd/MM/yyyy")]}):R(xe.from,"dd/MM/yyyy"):"Select date range"]})}),s.jsx(F,{className:"w-auto p-0",align:"start",children:s.jsx(p,{autoFocus:!0,mode:"range",defaultMonth:xe.from,selected:{from:xe.from,to:xe.to},onSelect:e=>he(e||{}),numberOfMonths:2})})]})]}),s.jsxs("div",{children:[s.jsx(k,{children:"End Date Range"}),s.jsxs(A,{children:[s.jsx(P,{asChild:!0,children:s.jsxs(u,{variant:"outline",className:`w-full justify-start text-left font-normal ${!je.from&&!je.to&&"text-muted-foreground"}`,children:[s.jsx(l,{className:"mr-2 h-4 w-4"}),je.from?je.to?s.jsxs(s.Fragment,{children:[R(je.from,"dd/MM/yyyy")," -"," ",R(je.to,"dd/MM/yyyy")]}):R(je.from,"dd/MM/yyyy"):"Select date range"]})}),s.jsx(F,{className:"w-auto p-0",align:"start",children:s.jsx(p,{autoFocus:!0,mode:"range",defaultMonth:je.from,selected:{from:je.from,to:je.to},onSelect:e=>ge(e||{}),numberOfMonths:2})})]})]}),s.jsxs("div",{children:[s.jsx(k,{children:"Users"}),s.jsxs(A,{children:[s.jsx(P,{asChild:!0,children:s.jsx(u,{variant:"outline",role:"combobox","aria-expanded":!1,className:"w-full justify-between",children:pe.length>0?`${pe.length} user(s) selected`:"Select users"})}),s.jsx(F,{className:"w-full p-0",align:"start",children:s.jsx("div",{className:"p-3 space-y-2",children:Fe.map(e=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(I,{id:`filter-user-${e.value}`,checked:pe.some(s=>s.value===e.value),onCheckedChange:s=>{const a=pe.some(s=>s.value===e.value);if(s&&!a){const s=[...pe,e],a=s.some(e=>"All"===e.value);fe(a?Fe.filter(e=>"All"!==e.value):s)}else!s&&a&&fe(pe.filter(s=>s.value!==e.value))}}),s.jsx(k,{htmlFor:`filter-user-${e.value}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:e.label})]},e.value))})})]})]})]})})]}),Q&&s.jsxs(f,{className:"mb-6",children:[s.jsx(v,{children:s.jsx(y,{children:V?"Edit Ad Campaign":"Create Ad Campaign"})}),s.jsxs(b,{children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx(k,{children:"Name"}),s.jsx(D,{value:ve,onChange:e=>ye(e.target.value)}),ze.name&&s.jsx("p",{className:"text-sm text-red-500 mt-1",children:ze.name})]}),s.jsxs("div",{children:[s.jsxs(k,{children:["Photo ",s.jsx("span",{className:"text-muted-foreground",children:"(Optional)"})]}),qe?s.jsxs("div",{className:"relative",children:[s.jsx(E,{title:"Campaign Photo",imageSrcs:[qe],children:s.jsx("img",{src:qe,alt:"Preview",className:"w-full h-32 object-cover rounded-lg"})}),s.jsx("button",{type:"button",onClick:()=>{Ie(null),Be(null),Ue.current&&(Ue.current.value="")},className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",children:s.jsx(r,{className:"h-3 w-3"})})]}):s.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/30 rounded-lg p-4 text-center cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>Ue.current?.click(),children:[s.jsx(Upload,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Click to upload a photo"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"JPEG, PNG, WebP, GIF (max 5MB)"}),s.jsx("input",{ref:Ue,type:"file",accept:"image/jpeg,image/png,image/webp,image/gif",onChange:e=>{if(e.target.files&&e.target.files.length>0){const s=e.target.files[0];if(!["image/jpeg","image/png","image/webp","image/gif"].includes(s.type))return void Ge(e=>({...e,file:"Please upload a valid image file (JPEG, PNG, WebP, GIF)"}));if(s.size>5242880)return void Ge(e=>({...e,file:"File size must be less than 5MB"}));Ie(s),Ge(e=>({...e,file:""}));const a=new FileReader;a.onloadend=()=>{Be(a.result)},a.readAsDataURL(s)}else Ie(null),Be(null)},className:"hidden"})]}),ze.file&&s.jsx("p",{className:"text-sm text-red-500 mt-1",children:ze.file})]}),s.jsxs("div",{children:[s.jsx(k,{children:"Start Date"}),s.jsxs(A,{children:[s.jsx(P,{asChild:!0,children:s.jsxs(u,{variant:"outline",className:`w-full justify-start text-left font-normal ${!be&&"text-muted-foreground"}`,children:[s.jsx(l,{className:"mr-2 h-4 w-4"}),be?R(be,"dd/MM/yyyy"):"Pick a date"]})}),s.jsx(F,{className:"w-auto p-0",align:"start",children:s.jsx(p,{mode:"single",selected:be,onSelect:Ne,autoFocus:!0})})]}),ze.startDate&&s.jsx("p",{className:"text-sm text-red-500 mt-1",children:ze.startDate})]}),s.jsxs("div",{children:[s.jsx(k,{children:"End Date"}),s.jsxs(A,{children:[s.jsx(P,{asChild:!0,children:s.jsxs(u,{variant:"outline",className:`w-full justify-start text-left font-normal ${!Ce&&"text-muted-foreground"}`,children:[s.jsx(l,{className:"mr-2 h-4 w-4"}),Ce?R(Ce,"dd/MM/yyyy"):"Pick a date"]})}),s.jsx(F,{className:"w-auto p-0",align:"start",children:s.jsx(p,{mode:"single",selected:Ce,onSelect:Se,autoFocus:!0})})]}),ze.endDate&&s.jsx("p",{className:"text-sm text-red-500 mt-1",children:ze.endDate})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx(k,{children:"Users"}),s.jsxs(A,{children:[s.jsx(P,{asChild:!0,children:s.jsx(u,{variant:"outline",role:"combobox","aria-expanded":!1,className:"w-full justify-between",children:Ae.length>0?`${Ae.length} user(s) selected`:"Select users"})}),s.jsx(F,{className:"w-full p-0",align:"start",children:s.jsx("div",{className:"p-3 space-y-2",children:Fe.map(e=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(I,{id:`form-user-${e.value}`,checked:Ae.some(s=>s.value===e.value),onCheckedChange:s=>{const a=Ae.some(s=>s.value===e.value);if(s&&!a){const s=[...Ae,e],a=s.some(e=>"All"===e.value);Pe(a?Fe.filter(e=>"All"!==e.value):s)}else!s&&a&&Pe(Ae.filter(s=>s.value!==e.value))}}),s.jsx(k,{htmlFor:`form-user-${e.value}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:e.label})]},e.value))})})]}),ze.users&&s.jsx("p",{className:"text-sm text-red-500 mt-1",children:ze.users}),Ae.length>0&&s.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:Ae.map(e=>s.jsx(g,{variant:"secondary",children:e.label},e.value))})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx(k,{children:"Subject"}),s.jsx(D,{value:De,onChange:e=>ke(e.target.value)}),ze.subject&&s.jsx("p",{className:"text-sm text-red-500 mt-1",children:ze.subject})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx(k,{children:"Message"}),s.jsx($,{rows:4,value:we,onChange:e=>Me(e.target.value)}),ze.message&&s.jsx("p",{className:"text-sm text-red-500 mt-1",children:ze.message})]})]}),s.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[s.jsx(u,{variant:"outline",onClick:()=>{Oe(),H(!1)},children:"Cancel"}),s.jsx(u,{onClick:()=>{const e={};if(ve.trim()||(e.name="Name is required."),be||(e.startDate="Start Date is required."),Ce||(e.endDate="End Date is required."),De.trim()||(e.subject="Subject is required."),we.trim()||(e.message="Message is required."),V||Ee||(e.file="File upload is required."),!V||Ee||qe||(e.file="File upload is required."),0===Ae.length&&(e.users="Please select at least one user."),Ge(e),Object.keys(e).length>0)return;const s=localStorage.getItem("token");if(!s)return;const a=new FormData,t={id:V?Y.id:void 0,name:ve,startDate:be?R(be,"yyyy-MM-dd"):"",endDate:Ce?R(Ce,"yyyy-MM-dd"):"",message:we,subject:De,userIds:Ae.some(e=>"All"===e.value)?["All"]:Ae.map(e=>e.value)};a.append("request",h(t)),Ee&&a.append("file",Ee),x.postFormData({endpoint:"/admin/save-ad-campaign",body:a,Authorization:`Bearer ${s}`,successCallback:e=>{j.success(V?"Campaign updated successfully":"Campaign saved successfully"),Re(),Oe(),H(!1)},errorCallback:e=>{j.error(e?.error||e?.message||"Failed to save campaign")}})},children:V?"Update Campaign":"Save Campaign"})]})]})]}),s.jsx(f,{children:s.jsx(b,{className:"p-0",children:W?s.jsx("div",{className:"p-6 text-center",children:"Loading..."}):s.jsxs(q,{children:[s.jsx(B,{children:s.jsxs(z,{children:[s.jsx(G,{children:"Name"}),s.jsx(G,{children:"Start Date"}),s.jsx(G,{children:"End Date"}),s.jsx(G,{className:"w-[220px]",children:"Subject"}),s.jsx(G,{children:"Message"}),s.jsx(G,{children:"Users"}),s.jsx(G,{children:"Image"}),s.jsx(G,{className:"sticky right-0 bg-background",children:"Actions"})]})}),s.jsxs(U,{children:[J.map((e,a)=>s.jsxs(z,{className:a%2==0?"bg-muted/20":"",children:[s.jsx(O,{children:e.name}),s.jsx(O,{children:Te(e.startDate)}),s.jsx(O,{children:Te(e.endDate)}),s.jsx(O,{className:"w-[220px]",children:e.subject}),s.jsx(O,{children:e.message.length>50?e.message.substr(0,50)+"...":e.message}),s.jsx(O,{children:s.jsx("div",{className:"flex flex-wrap gap-1",children:e?.users?.map(e=>s.jsx(g,{variant:"secondary",children:e.name},e.id))})}),s.jsx(O,{children:e.imagePath?s.jsx(E,{title:"Campaign Photo",imageSrcs:[`/static${e.imagePath}`],children:s.jsx("img",{src:`/static${e.imagePath}`,alt:e.name,className:"max-w-16 max-h-12 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity"})}):s.jsx("span",{className:"text-muted-foreground text-sm",children:"No photo"})}),s.jsx(O,{className:"sticky right-0 bg-background",children:s.jsxs("div",{className:"flex gap-1",children:[s.jsx(u,{size:"sm",variant:"outline",title:"Edit Ad Campaign","aria-label":"Edit Ad Campaign",onClick:()=>(e=>{if(ye(e.name),Ne(new Date(e.startDate)),Se(new Date(e.endDate)),Me(e.message),ke(e.subject),e.users?.length){const s=e.users.map(e=>({value:e.id,label:`${e.name} (${e.email||e.phone})`}));Pe(s)}else Pe([]);Ie(null),Be(e.imagePath?`/static/ads/${e.imagePath.split("/").pop()}`:null),X(!0),Z(e),H(!0)})(e),children:s.jsx(n,{className:"w-4 h-4"})}),s.jsx(u,{size:"sm",variant:"outline",title:"Send Emails",onClick:()=>(e=>{const s=localStorage.getItem("token");if(!s)return void j.error("User not authenticated");ee(s=>({...s,[e.id]:!0}));const a={id:e.id,token:s},t=h(a);x.postData({endpoint:"/admin/send-ad-emails",body:{request:t},Authorization:`Bearer ${s}`,successCallback:()=>{j.success("Ad email sent successfully"),ee(s=>({...s,[e.id]:!1}))},errorCallback:s=>{j.error(s?.error||s?.message||"Failed to send ad email"),ee(s=>({...s,[e.id]:!1}))}})})(e),disabled:_[e.id],"aria-label":"Send Emails",children:_[e.id]?s.jsx("div",{className:"w-4 h-4 animate-spin rounded-full border-2 border-current border-t-transparent"}):s.jsx(i,{className:"w-4 h-4"})}),s.jsx(u,{size:"sm",variant:"outline",title:"Delete Ad Campaign",onClick:()=>{le(e),ae(!0)},"aria-label":"Delete Ad Campaign",children:s.jsx(d,{className:"w-4 h-4"})})]})})]},e.id)),0===J.length&&s.jsx(z,{children:s.jsx(O,{colSpan:8,className:"text-center",children:"No Ad Campaigns found."})})]})]})})})]}),s.jsx(N,{open:se,onOpenChange:ae,children:s.jsxs(C,{children:[s.jsx(S,{children:s.jsx(w,{children:"Delete Ad Campaign"})}),s.jsx("div",{className:"py-4",children:s.jsxs("p",{children:['Are you sure you want to delete ad campaign "',te?.name,'"? This action cannot be undone.']})}),s.jsxs(M,{children:[s.jsx(u,{variant:"outline",onClick:()=>{ae(!1),le(null)},children:"Cancel"}),s.jsx(u,{variant:"destructive",onClick:()=>{if(!te)return;const e=localStorage.getItem("token");if(!e)return;const s={id:te.id};x.postData({endpoint:"/admin/delete-ad-campaign",body:{request:h(s)},Authorization:`Bearer ${e}`,successCallback:()=>{j.success("Ad campaign deleted successfully"),Re(),ae(!1),le(null)},errorCallback:e=>{j.error(e?.error||e?.message||"Failed to delete campaign"),ae(!1),le(null)}})},children:"Confirm Delete"})]})]})}),s.jsx(o,{})]})};export{T as default};

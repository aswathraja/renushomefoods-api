import{r as n,j as e,P as K,F as fe,d as ge,e as ye,L as ve}from"./vendor-react-Bv33ryjV.js";import{A as Ne}from"./AdminNavBar-C4EyqKDd.js";import{C as _e}from"./dropdown-menu-BDj5FxyU.js";import{u as be,B as g,c as m,A,e as T,d as we}from"./index-BgzncNPj.js";import{B as I}from"./badge-FegKslFz.js";import{C as B,a as $e,b as Ce,c as Q}from"./card-dPuP1Ci1.js";import{D as Fe,a as Pe,b as Se,c as ke,e as Ae}from"./dialog-DjJou7Bz.js";import{I as o}from"./input-B6PrAciv.js";import{L as i}from"./label-bvSFhUHd.js";import{T as Ee,a as De,b as z,c as h,d as Xe,e as c}from"./table-bzACJohG.js";import{C as Y}from"./checkbox-DrHO4LUx.js";import{P as Z,a as ee,b as se}from"./popover-BSIvycCC.js";import{S as ae}from"./switch-D6BMZ9fM.js";import"./TopBar-D2vj-zy0.js";import"./vendor-pdf-DxqLLkkN.js";import"./index-BlLmK--u.js";const Ye=()=>{const{effectiveTheme:qe}=be(),[H,re]=n.useState(!1),[O,te]=n.useState([]),[E,M]=n.useState([]),[u,b]=n.useState([]),[D,le]=n.useState(""),[X,ie]=n.useState(""),[q,de]=n.useState(""),[x,V]=n.useState([]),[ne,w]=n.useState(!1),[N,L]=n.useState(null),[d,$]=n.useState({name:"",phone:"",email:"",password:""}),[C,P]=n.useState(!1),[j,y]=n.useState([]),[l,_]=n.useState({}),[U,R]=n.useState(!1),W=s=>{if(!s)return"";let a=s.replace(/[^\d+\s]/g,"");if(a=a.replace(/\s+/g," ").trim(),a.includes("+")&&(a="+"+a.replace(/\+/g,"").trim()),a.startsWith("+")){const r=a.slice(1);if(r.indexOf(" ")!==-1){const S=r.split(" "),k=S[0].replace(/\D/g,"").slice(0,3),J=S.slice(1).join("").replace(/\D/g,"").slice(0,10);return J?`+${k} ${J}`:`+${k}`}const t=r.replace(/\D/g,""),f=t.slice(0,a.length>=11?2:3),p=t.slice(f.length,f.length+10);return`+${f}${p}`}return a.replace(/\D/g,"").slice(0,10)},oe=async()=>{try{const s=localStorage.getItem("token");if(!s){m.error("Authentication token not found");return}const a=await A.get("/admin/roles",{Authorization:`Bearer ${s}`});if(Array.isArray(a.roles)){const r=a.roles.map(t=>({label:t.name,value:t.id}));M(r)}else M([])}catch(s){console.error("Error fetching roles",s),m.error("Failed to fetch roles")}},G=async()=>{try{const s=localStorage.getItem("token");if(!s){m.error("Authentication token not found");return}A.postData({endpoint:"/admin/users",body:{request:T({name:D.trim()||null,phone:X.trim()||null,email:q.trim()||null,roles:x.length>0?x.map(a=>a.value):[]})},Authorization:`Bearer ${s}`,successCallback:a=>{te(a.users||[])},errorCallback:a=>{console.error("Error fetching users",a),m.error("Failed to fetch users")}})}catch(s){console.error("Error fetching users",s),m.error("Failed to fetch users")}};n.useEffect(()=>{G()},[D,X,q,x]),n.useEffect(()=>{oe()},[]);const ce=()=>{L(null),$({name:"",phone:"",email:"",password:""}),b([]),y([{name:"",addressLine1:"",city:"",state:"",country:"",pincode:"",phone:"",isDefault:!0}]),_({}),P(!1),w(!0)},me=async s=>{try{const a=localStorage.getItem("token");if(!a){m.error("Authentication token not found");return}A.postData({endpoint:"/admin/user-details",body:{request:T({token:a,userId:s.id,phone:s.phone,email:s.email})},Authorization:`Bearer ${a}`,successCallback:r=>{const t=r.user;L(t),$({id:t.id,name:t.name||"",phone:t.phone||"",email:t.email||"",password:""}),y(t.UserAddresses||[]),P(!1);const f=t.roles||[],p=E.filter(S=>f.some(k=>k.id===S.value));b(p),_({}),w(!0)},errorCallback:r=>{console.error("Error fetching user details:",r)}})}catch(a){console.error("Error editing user",a),m.error("Failed to fetch user details")}},F=s=>{let{name:a,value:r}=s.target;a==="phone"&&(r=W(r)),$({...d,[a]:r});const t={...l};a==="phone"&&(r.trim()?/^(\+\d{1,3}\s?\d{10}|\d{10})$/.test(r.trim())?delete t.phone:t.phone="Phone must be 10 digits or include country code like +91 1234567890":t.phone="Phone is required"),a==="email"&&(r.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.trim())?delete t.email:t.email="Invalid email format":t.email="Email is required"),_(t)},v=(s,a,r)=>{let t=r;a==="pincode"&&(t=t.replace(/[^\d]/g,"").slice(0,6)),a==="phone"&&(t=W(String(t)));const f=[...j];f[s]={...f[s],[a]:t},y(f);const p={...l};a==="phone"&&(t.trim()?/^(\+\d{1,3}\s?\d{10}|\d{10})$/.test(t.trim())?delete p[`address_phone_${s}`]:p[`address_phone_${s}`]="Phone must be 10 digits or include country code like +91 1234567890":p[`address_phone_${s}`]="Phone is required"),a==="pincode"&&(t.trim()?t.length!==6?p[`address_pincode_${s}`]="Pincode must be exactly 6 digits":delete p[`address_pincode_${s}`]:p[`address_pincode_${s}`]="Pincode is required"),_(p)},he=()=>{y([...j,{name:"",addressLine1:"",city:"",state:"",country:"",pincode:"",phone:"",isDefault:j.length===0}])},pe=s=>{const a=j.filter((r,t)=>t!==s);y(a)},ue=()=>{const s={};return d.name.trim()||(s.name="Name is required"),d.phone.trim()?/^(\+\d{1,3}\s?\d{10}|\d{10})$/.test(d.phone.trim())||(s.phone="Phone must be 10 digits or include country code like +91 XX"):s.phone="Phone is required",d.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.email.trim())||(s.email="Invalid email format"):s.email="Email is required",!N&&!C&&!d.password.trim()&&(s.password="Password is required"),j.forEach((a,r)=>{a.name?.trim()||(s[`address_name_${r}`]="Address name is required"),a.addressLine1?.trim()||(s[`address_addressLine1_${r}`]="Address line 1 is required"),a.city?.trim()||(s[`address_city_${r}`]="City is required"),a.state?.trim()||(s[`address_staXte_${r}`]="State is required"),a.country?.trim()||(s[`address_country_${r}`]="Country is required"),a.pincode?.trim()?a.pincode.length!==6&&(s[`address_pincode_${r}`]="Pincode must be exactly 6 digits"):s[`address_pincode_${r}`]="Pincode is required",a.phone?.trim()?/^(\+\d{1,3}\s?\d{10}|\d{10})$/.test(a.phone.trim())||(s[`address_phone_${r}`]="Phone must be in the format +XX XXXXXXXXXX or XXXXXXXXXX"):s[`address_phone_${r}`]="Phone is required"}),_(s),Object.keys(s).length===0},xe=s=>{const a=j.map((r,t)=>({...r,isDefault:t===s}));y(a)},je=async()=>{if(!ue()){m.error("Please fix errors before submitting");return}R(!0);try{const s=localStorage.getItem("token");if(!s){m.error("Authentication token not found"),R(!1);return}const a={user:{id:d.id,name:d.name,phone:d.phone,email:d.email,password:d.password||"",resetPassword:C,roles:u.map(r=>r.value)},addresses:j};await A.postData({endpoint:"/admin/save-user",body:{request:T(a)},Authorization:`Bearer ${s}`,successCallback:r=>{const t=we(r);m.success(t.message||"User saved successfully"),w(!1),G(),y([]),P(!1),$({name:"",phone:"",email:"",password:""}),L(null),b([]),_({})},errorCallback:r=>{console.error("Error saving user:",r),m.error("Failed to save user")}})}catch(s){console.error("Error saving user:",s),m.error("Failed to save user")}R(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(Ne,{}),e.jsxs("div",{className:"container mx-auto mt-6 p-6 min-h-screen",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Users"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(g,{variant:"outline",onClick:ce,className:"border-green-600 text-green-600 hover:text-primary",children:[e.jsx(K,{className:"w-4 h-4 mr-2"})," Create User"]}),e.jsxs(g,{variant:"outline",onClick:()=>re(!H),className:"border-green-600 text-green-600 hover:text-primary",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"})," Filters"]})]})]}),H&&e.jsxs(B,{className:"mb-6",children:[e.jsx($e,{children:e.jsx(Ce,{children:"Filters"})}),e.jsx(Q,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"name-filter",children:"Name"}),e.jsx(o,{id:"name-filter",type:"text",value:D,onChange:s=>le(s.target.value),placeholder:"Filter by name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"phone-filter",children:"Phone"}),e.jsx(o,{id:"phone-filter",type:"text",value:X,onChange:s=>ie(s.target.value),placeholder:"Filter by phone"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"email-filter",children:"Email"}),e.jsx(o,{id:"email-filter",type:"text",value:q,onChange:s=>de(s.target.value),placeholder:"Filter by email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"roles-filter",children:"Roles"}),e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(g,{variant:"outline",role:"combobox","aria-expanded":!1,className:"w-full justify-between",children:x.length>0?`${x.length} role(s) selected`:"Filter by roles"})}),e.jsx(se,{className:"w-full p-0",align:"start",children:e.jsx("div",{className:"p-3 space-y-2",children:E.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{id:`role-filter-${s.value}`,checked:x.some(a=>a.value===s.value),onCheckedChange:a=>{const r=x.some(t=>t.value===s.value);a&&!r?V([...x,s]):!a&&r&&V(x.filter(t=>t.value!==s.value))}}),e.jsx(i,{htmlFor:`role-filter-${s.value}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:s.label})]},s.value))})})]})]})]})})]}),e.jsx(B,{children:e.jsx(Q,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ee,{children:[e.jsx(De,{children:e.jsxs(z,{children:[e.jsx(h,{className:"min-w-[200px]",children:"Name"}),e.jsx(h,{className:"min-w-[150px]",children:"Phone"}),e.jsx(h,{className:"min-w-[200px]",children:"Email"}),e.jsx(h,{className:"min-w-[250px]",children:"Roles"}),e.jsx(h,{className:"min-w-[200px]",children:"Address Name"}),e.jsx(h,{className:"min-w-[250px]",children:"Address Line 1"}),e.jsx(h,{className:"min-w-[150px]",children:"City"}),e.jsx(h,{className:"min-w-[150px]",children:"State"}),e.jsx(h,{className:"min-w-[150px]",children:"Country"}),e.jsx(h,{className:"min-w-[150px]",children:"Pincode"}),e.jsx(h,{className:"min-w-[150px]",children:"Address Phone"}),e.jsx(h,{className:"sticky right-0 bg-background",children:"Actions"})]})}),e.jsxs(Xe,{children:[O.map(s=>e.jsxs(z,{children:[e.jsx(c,{className:"font-medium",children:s.name}),e.jsx(c,{children:s.phone}),e.jsx(c,{children:s.email}),e.jsx(c,{children:s?.roles&&s?.roles?.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:s?.roles.split(",").map((a,r)=>e.jsx(I,{variant:"secondary",className:"text-xs",children:a},r))}):e.jsx("span",{className:"text-primary text-sm",children:"No roles"})}),e.jsx(c,{children:s.addressName?s.addressName:"-"}),e.jsx(c,{children:s.addressLine1?s.addressLine1:"-"}),e.jsx(c,{children:s.city?s.city:"-"}),e.jsx(c,{children:s.state?s.state:"-"}),e.jsx(c,{children:s.country?s.country:"-"}),e.jsx(c,{children:s.pincode?s.pincode:"-"}),e.jsx(c,{children:s.addressPhone?s.addressPhone:"-"}),e.jsx(c,{className:"sticky right-0 bg-background",children:e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>me(s),className:"border-primary text-primary",children:[e.jsx(ge,{className:"text-primary w-4 h-4 mr-1"})," Edit"]})})]},s.id)),O.length===0&&e.jsx(z,{children:e.jsx(c,{colSpan:11,className:"text-center text-muted py-8",children:"No users found"})})]})]})})})}),e.jsx(Fe,{open:ne,onOpenChange:w,children:e.jsxs(Pe,{className:"max-w-4xl max-h-screen overflow-y-auto",children:[e.jsxs(Se,{children:[e.jsx(ke,{children:N?"Edit User":"Create User"}),e.jsx(Ae,{children:N?"Edit user information and addresses":"Create a new user with their information and addresses"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"name",children:"Name"}),e.jsx(o,{id:"name",type:"text",value:d.name,onChange:F,name:"name",className:l.name?"border-red-500":"",placeholder:"Enter full name"}),l.name&&e.jsx("p",{className:"text-sm text-red-500",children:l.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"phone",children:"Phone"}),e.jsx(o,{id:"phone",type:"text",value:d.phone,onChange:F,name:"phone",className:l.phone?"border-red-500":"",placeholder:"Enter phone number"}),l.phone&&e.jsx("p",{className:"text-sm text-red-500",children:l.phone})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"email",children:"Email"}),e.jsx(o,{id:"email",type:"email",value:d.email,onChange:F,name:"email",className:l.email?"border-red-500":"",placeholder:"Enter email address"}),l.email&&e.jsx("p",{className:"text-sm text-red-500",children:l.email})]}),N&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(i,{children:"Password"}),e.jsx(ae,{id:"resetPasswordSwitch",checked:C,onCheckedChange:s=>{P(s),s&&$(a=>({...a,password:""}))}}),e.jsx(i,{htmlFor:"resetPasswordSwitch",className:"text-sm font-normal",children:"Reset Password"})]}),C&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"password",children:"New Password"}),e.jsx(o,{id:"password",type:"password",value:d.password,onChange:F,name:"password",className:l.password?"border-red-500":"",placeholder:"Enter password"}),l.password&&e.jsx("p",{className:"text-sm text-red-500",children:l.password})]})]}),!N&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"password",children:"Password"}),e.jsx(o,{id:"password",type:"password",value:d.password,onChange:F,name:"password",className:l.password?"border-red-500":"",placeholder:"Enter password",disabled:C}),l.password&&e.jsx("p",{className:"text-sm text-red-500",children:l.password})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"roles-select",children:"Roles"}),e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(g,{variant:"outline",role:"combobox","aria-expanded":!1,className:"w-full justify-between",children:u.length>0?`${u.length} role(s) selected`:"Select roles"})}),e.jsx(se,{className:"w-full p-0",align:"start",children:e.jsx("div",{className:"p-3 space-y-2",children:E.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{id:`role-select-${s.value}`,checked:u.some(a=>a.value===s.value),onCheckedChange:a=>{const r=u.some(t=>t.value===s.value);a&&!r?b([...u,s]):!a&&r&&b(u.filter(t=>t.value!==s.value))}}),e.jsx(i,{htmlFor:`role-select-${s.value}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:s.label})]},s.value))})})]}),u.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:u.map(s=>e.jsx(I,{variant:"secondary",className:"text-xs",children:s.label},s.value))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h5",{className:"text-lg font-semibold",children:"Addresses"}),e.jsxs(g,{type:"button",variant:"outline",size:"sm",onClick:he,"aria-label":"Add address",className:"border-primary-600 text-primary-600 hover:bg-primary/10",children:[e.jsx(K,{className:"w-4 h-4 mr-1"})," Add Address"]})]}),e.jsx("div",{className:"space-y-4",children:j.map((s,a)=>e.jsxs(B,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"font-medium",children:["Address ",a+1]}),s.isDefault&&e.jsx(I,{variant:"default",className:"bg-primary",children:"Default"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{id:`defaultAddress${a}`,checked:s.isDefault||!1,onCheckedChange:()=>xe(a)}),e.jsx(i,{htmlFor:`defaultAddress${a}`,className:"text-sm font-normal",children:"Default"}),e.jsx(g,{type:"button",variant:"outline",size:"sm",onClick:()=>pe(a),disabled:j.length===1,"aria-label":`Delete address ${a+1}`,className:"border-red-600 text-red-600 hover:bg-red-50",children:e.jsx(ye,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:`address_name_${a}`,children:"Name"}),e.jsx(o,{id:`address_name_${a}`,type:"text",value:s.name,onChange:r=>v(a,"name",r.target.value),className:l[`address_name_${a}`]?"border-red-500":"",placeholder:"Name"}),l[`address_name_${a}`]&&e.jsx("p",{className:"text-sm text-red-500",children:l[`address_name_${a}`]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:`address_phone_${a}`,children:"Phone"}),e.jsx(o,{id:`address_phone_${a}`,type:"text",value:s.phone,onChange:r=>v(a,"phone",r.target.value),className:l[`address_phone_${a}`]?"border-red-500":"",placeholder:"Phone number"}),l[`address_phone_${a}`]&&e.jsx("p",{className:"text-sm text-red-500",children:l[`address_phone_${a}`]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:`address_pincode_${a}`,children:"Pincode"}),e.jsx(o,{id:`address_pincode_${a}`,type:"text",value:s.pincode,onChange:r=>v(a,"pincode",r.target.value),className:l[`address_pincode_${a}`]?"border-red-500":"",placeholder:"6-digit pincode"}),l[`address_pincode_${a}`]&&e.jsx("p",{className:"text-sm text-red-500",children:l[`address_pincode_${a}`]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(i,{htmlFor:`address_addressLine1_${a}`,children:"Address Line 1"}),e.jsx(o,{id:`address_addressLine1_${a}`,type:"text",value:s.addressLine1,onChange:r=>v(a,"addressLine1",r.target.value),className:l[`address_addressLine1_${a}`]?"border-red-500":"",placeholder:"Street address, building, etc."}),l[`address_addressLine1_${a}`]&&e.jsx("p",{className:"text-sm text-red-500",children:l[`address_addressLine1_${a}`]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:`address_city_${a}`,children:"City"}),e.jsx(o,{id:`address_city_${a}`,type:"text",value:s.city,onChange:r=>v(a,"city",r.target.value),className:l[`address_city_${a}`]?"border-red-500":"",placeholder:"City"}),l[`address_city_${a}`]&&e.jsx("p",{className:"text-sm text-red-500",children:l[`address_city_${a}`]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:`address_state_${a}`,children:"State"}),e.jsx(o,{id:`address_state_${a}`,type:"text",value:s.state,onChange:r=>v(a,"state",r.target.value),className:l[`address_state_${a}`]?"border-red-500":"",placeholder:"State"}),l[`address_state_${a}`]&&e.jsx("p",{className:"text-sm text-red-500",children:l[`address_state_${a}`]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:`address_country_${a}`,children:"Country"}),e.jsx(o,{id:`address_country_${a}`,type:"text",value:s.country,onChange:r=>v(a,"country",r.target.value),className:l[`address_country_${a}`]?"border-red-500":"",placeholder:"Country"}),l[`address_country_${a}`]&&e.jsx("p",{className:"text-sm text-red-500",children:l[`address_country_${a}`]})]})]})]},a))})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4 border-t",children:[e.jsx(g,{variant:"outline",onClick:()=>w(!1),disabled:U,children:"Close"}),e.jsx(g,{onClick:je,disabled:U,className:"bg-primary text-white",children:U?e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):N?"Save Changes":"Create User"})]})]})})]}),e.jsx(_e,{})]})};export{Ye as default};

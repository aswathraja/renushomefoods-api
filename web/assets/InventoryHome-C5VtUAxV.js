import{r as l,j as e,R as fe,F as rt,C as ct,G as it,I as dt,J as mt,N as ut,O as gt,f as ht,Q as ft}from"./vendor-react-Bv33ryjV.js";import{C as xt}from"./dropdown-menu-BDj5FxyU.js";import{c as ue,i as f,G as pt,I as ge,a as J,t as X,b as yt}from"./InteractivePieChart-ifuDDKb5.js";import{I as bt}from"./InventoryNavBar-CIk6Z_D_.js";import{u as jt,A as Y,e as Z,B as b}from"./index-BgzncNPj.js";import{f as se,C as It}from"./calendar-DeP6F9X6.js";import{C as k,c as C,a as P,b as Q}from"./card-dPuP1Ci1.js";import{C as he}from"./checkbox-DrHO4LUx.js";import{L as y}from"./label-bvSFhUHd.js";import{P as _,a as ee,b as te}from"./popover-BSIvycCC.js";import"./vendor-pdf-DxqLLkkN.js";import"./TopBar-D2vj-zy0.js";import"./index-BlLmK--u.js";const B=({title:g,value:j,icon:N,trend:H,trendUp:M,isLoading:w,lastUpdated:K})=>e.jsxs(k,{className:"relative overflow-hidden group hover:shadow-lg transition-all duration-300 hover:-translate-y-1",children:[e.jsx(P,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Q,{className:"text-sm font-medium text-muted-foreground",children:g}),e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 text-primary",children:N})]})}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold mb-1",children:w?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-muted-foreground",children:"Loading..."})]}):j}),H&&e.jsxs("div",{className:`flex items-center text-xs ${M?"text-green-600":"text-red-600"}`,children:[M?e.jsx(ht,{className:"w-3 h-3 mr-1"}):e.jsx(ft,{className:"w-3 h-3 mr-1"}),H]}),K&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Updated: ",se(K,"HH:mm:ss")]})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),vt=({isAutoRefreshEnabled:g,onToggleAutoRefresh:j})=>e.jsx("div",{className:"flex basis-43",children:e.jsxs(b,{variant:"outline",size:"default",onClick:j,className:`items-center gap-3 flex basis-43 w-full transition-colors hover:text-primary ${g?"text-green-600 border-green-600":"text-muted-foreground"}`,children:[e.jsx(fe,{className:`w-4 h-4 ${g?"animate-spin":""}`}),"Auto-Refresh"]})}),Mt=()=>{const{effectiveTheme:g}=jt(),j=l.useRef(null),N=new Date,H=new Date(N.getFullYear(),N.getMonth(),1),M=N,[w,K]=l.useState({from:H,to:M}),d=w?.from,m=w?.to,[n,V]=l.useState([]),[r,E]=l.useState([]),[c,O]=l.useState([]),[xe,Te]=l.useState(!1),[I,De]=l.useState("All"),[v,Ae]=l.useState("All"),[S,$e]=l.useState("All"),[pe,Re]=l.useState([]),[ye,Be]=l.useState([]),[be,Pe]=l.useState([]),[je,Qe]=l.useState([]),[St,U]=l.useState(null),[ae,He]=l.useState(!0),[x,q]=l.useState(null),[p,kt]=l.useState(!1),[Ct,le]=l.useState(!1),[Me,Ke]=l.useState({fromDate:d?d.toISOString().split("T")[0]:null,toDate:m?m.toISOString().split("T")[0]:null,categoryIds:n.length>0?n:null,itemIds:r.length>0?r:null,locationIds:c.length>0?c:null}),[z,L]=l.useState([]),[F,Ie]=l.useState([]),[W,oe]=l.useState([]),[T,Ve]=l.useState({totalItems:0,totalCategories:0,availableStock:0,unfulfilledItems:0,fulfilledStock:0}),[ne,Ee]=l.useState([]),[ve,Oe]=l.useState([]),[re,Ue]=l.useState([]),[G,qe]=l.useState([]);l.useEffect(()=>{Y.postData({endpoint:"/inventory/get-categories",body:{request:Z({type:"Product"})},successCallback:t=>{Array.isArray(t)?L(t):L([])},errorCallback:()=>{L([])}})},[]),l.useEffect(()=>{oe([{id:1,name:"Main Kitchen"},{id:2,name:"Pantry A"},{id:3,name:"Store Room"},{id:4,name:"Cold Storage"}])},[]);const Se=l.useCallback(()=>{const t=localStorage.getItem("token");if(!t){console.error("No token found");return}const s={categoryIds:n.length>0?n:null,itemIds:r.length>0?r:null,locationIds:c.length>0?c:null};Y.postData({endpoint:"/inventory/filters",body:{request:Z(s)},Authorization:`Bearer ${t}`,successCallback:a=>{L(a.categories||[]),Ie(a.items||[]),oe(a.locations||[])},errorCallback:a=>{console.error("Error fetching filters:",a),L([]),Ie([]),oe([])}})},[n,r,c]);l.useEffect(()=>{Se()},[Se]),l.useEffect(()=>{Ke({fromDate:d?d.toISOString().split("T")[0]:null,toDate:m?m.toISOString().split("T")[0]:null,categoryIds:n.length>0?n:null,itemIds:r.length>0?r:null,locationIds:c.length>0?c:null})},[d,m,n,r,c]);const D=l.useCallback(()=>{const t=localStorage.getItem("token");if(!t){console.error("No token found");return}const s=Ce(),a=Ne(),o=we(),h=s.length>0?s:n,$=a.length>0?a:r,R=o.length>0?o:c,me={fromDate:d?d.toISOString().split("T")[0]:null,toDate:m?m.toISOString().split("T")[0]:null,categoryIds:h.length>0?h:null,itemIds:$.length>0?$:null,locationIds:R.length>0?R:null};Y.postData({endpoint:"/inventory/kpis",body:{request:Z(me)},Authorization:`Bearer ${t}`,successCallback:u=>{Ve({totalItems:u.totalItems||0,totalCategories:u.totalCategories||0,availableStock:u.availableStock||0,unfulfilledItems:u.pendingQuantity||0,fulfilledStock:u.fulfilledQuantity||0}),q(new Date)},errorCallback:u=>{console.error("Error fetching KPIs:",u),q(new Date)}})},[d,m,n,r,c,I,S,v,z,F,W]),A=l.useCallback(()=>{const t=localStorage.getItem("token");if(!t){console.error("No token found");return}const s=Ce(),a=Ne(),o=we(),h=s.length>0?s:n,$=a.length>0?a:r,R=o.length>0?o:c,me={fromDate:d?d.toISOString().split("T")[0]:null,toDate:m?m.toISOString().split("T")[0]:null,categoryIds:h.length>0?h:null,itemIds:$.length>0?$:null,locationIds:R.length>0?R:null};le(!0),Y.postData({endpoint:"/inventory/chart-data",body:{request:Z(me)},Authorization:`Bearer ${t}`,successCallback:u=>{Ee(u.byCategory?.map(i=>({category:i.categoryName,totalStock:parseInt(i.availableStock)||0,costValue:parseFloat(i.costValue)||0}))||[]),Oe(u.byLocation?.map(i=>({name:i.locationName,totalStock:parseInt(i.availableStock)||0,costValue:parseFloat(i.costValue)||0}))||[]),Ue(u.byItem?.map(i=>({item:i.name,stock:parseInt(i.availableStock)||0,costValue:parseFloat(i.costValue)||0,unit:"kg"}))||[]),qe(u.topItems?.map(i=>({product:i.name,availableStock:parseInt(i.availableStock)||0,unfulfilledQuantity:parseInt(i.pendingQuantity)||0,fulfilledQuantity:parseInt(i.fulfilledQuantity)||0,unit:"kg"}))||[]),q(new Date),le(!1)},errorCallback:u=>{console.error("Error fetching chart data:",u),q(new Date),le(!1)}})},[d,m,n,r,c,I,S,v,z,F,W]);l.useEffect(()=>{D(),A()},[D,A]),l.useEffect(()=>{let t;return ae&&(t=window.setInterval(()=>{D(),A()},6e4)),()=>{t&&clearInterval(t)}},[ae,D,A]);const ze=l.useCallback(()=>{He(t=>!t)},[]),ke=()=>d&&m?`${se(d,"dd/MM/yyyy")} - ${se(m,"dd/MM/yyyy")}`:"Select date range",ce=t=>{const s=z.find(a=>a.name===t);return s?s.id:null},ie=t=>{const s=F.find(a=>a.name===t);return s?s.id:null},de=t=>{const s=W.find(a=>a.name===t);return s?s.id:null},Ce=()=>{if(I==="All")return[];const t=ce(I);return t?[t]:[]},Ne=()=>{if(S==="All")return[];const t=ie(S);return t?[t]:[]},we=()=>{if(v==="All")return[];const t=de(v);return t?[t]:[]},We=t=>{const s=I!==t;if(De(t===I?"All":t),s){const a=ce(t);a&&!n.includes(a)&&V(o=>[...o,a])}else{const a=ce(t);a&&V(o=>o.filter(h=>h!==a))}},Ge=t=>{const s=v!==t;if(Ae(t===v?"All":t),s){const a=de(t);a&&!c.includes(a)&&O(o=>[...o,a])}else{const a=de(t);a&&O(o=>o.filter(h=>h!==a))}},Le=t=>{const s=S!==t;if($e(t===S?"All":t),s){const a=ie(t);a&&!r.includes(a)&&E(o=>[...o,a])}else{const a=ie(t);a&&E(o=>o.filter(h=>h!==a))}},Je=l.useCallback(t=>{},[]),Xe=l.useCallback(t=>{U(t)},[]),Ye=l.useCallback(t=>{},[]),Ze=l.useCallback(t=>{U(t)},[]),_e=l.useCallback(t=>{},[]),et=l.useCallback(t=>{U(t)},[]),tt=l.useCallback(t=>{},[]),st=l.useCallback(t=>{U(t)},[]),at=l.useMemo(()=>ue(ne.map((t,s)=>({...t,name:t.category,value:t.totalStock,color:f.normal[s%f.normal.length]}))),[ne]),Fe=l.useMemo(()=>ue(ve.map((t,s)=>({...t,name:t.name,value:t.totalStock||0,color:f.normal[s%f.normal.length],costValue:t.costValue||0}))),[ve]),lt=l.useMemo(()=>ue(re.map((t,s)=>({...t,name:t.item,value:t.stock,color:f.normal[s%f.normal.length]}))),[re]),ot=l.useMemo(()=>{const t=G.reduce((s,a)=>s+a.availableStock+a.unfulfilledQuantity+a.fulfilledQuantity,0);return G.map((s,a)=>({...s,name:s.product,value:s.availableStock+s.unfulfilledQuantity+s.fulfilledQuantity,percentage:t>0?(s.availableStock+s.unfulfilledQuantity+s.fulfilledQuantity)/t*100:0,color:f.normal[a%f.normal.length]}))},[G]),nt=[{dataKey:"availableStock",name:"Available Stock",color:"#059669"},{dataKey:"unfulfilledQuantity",name:"Unfulfilled Quantity",color:"#f69568"},{dataKey:"fulfilledQuantity",name:"Fulfilled Quantity",color:"#894829"}];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"min-h-screen",ref:j,children:[e.jsx(bt,{}),e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"p-0 m-0 flex justify-end items-center",children:x&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Updated: ",se(x,"dd/MM/yyyy HH:mm:ss")]})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center mb-4",children:[e.jsx("h1",{className:"text-primary text-2xl font-bold",children:"Inventory Dashboard"}),e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center",children:[e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx(vt,{isAutoRefreshEnabled:ae,onToggleAutoRefresh:ze}),e.jsxs(b,{variant:"outline",onClick:()=>{D(),A()},disabled:p,className:"flex items-center gap-2 flex basis-47 dark:border-green-600 hover:text-primary",children:[e.jsx(fe,{className:`h-4 w-4 ${p?"animate-spin":""}`}),"Refresh"]})]}),e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsxs(b,{variant:"outline",onClick:()=>Te(!xe),className:"flex items-center gap-2 hover:text-primary transition-colors flex basis-40 dark:border-green-600",children:[e.jsx(rt,{className:"h-4 w-4"}),"Filters"]}),e.jsx(pt,{dashboardRef:j,title:"Inventory Dashboard",dateRange:ke(),filterState:Me,tableData:F,tableColumns:[{key:"id",label:"ID"},{key:"name",label:"Item Name"},{key:"categoryName",label:"Category"},{key:"availableStock",label:"Available Stock"},{key:"locationName",label:"Location"}]})]})]})]}),xe&&e.jsx(k,{className:"mb-6 shadow-sm border-0 bg-card/50 backdrop-blur-sm",children:e.jsx(C,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Date Range"}),e.jsxs(_,{children:[e.jsx(ee,{asChild:!0,children:e.jsxs(b,{variant:"outline",className:`w-full justify-start text-left font-normal hover:bg-accent transition-colors ${!d&&!m&&"text-muted-foreground"}`,children:[e.jsx(ct,{className:"mr-2 h-4 w-4"}),ke()]})}),e.jsx(te,{className:"w-auto p-0",align:"start",children:e.jsx(It,{mode:"range",selected:w,onSelect:K,numberOfMonths:1,autoFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Category"}),e.jsxs(_,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(b,{variant:"outline",role:"combobox",className:"w-full justify-between hover:bg-accent transition-colors",children:n.length>0?n.length===1?`${n.length} category selected`:`${n.length} categories selected`:"Select categories"})}),e.jsx(te,{className:"w-full p-0",align:"start",children:e.jsx("div",{className:"p-3 space-y-2",children:z.map(t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{id:`category-${t.id}`,checked:n.includes(t.id),onCheckedChange:s=>{const a=n.includes(t.id);s&&!a?V([...n,t.id]):!s&&a&&V(n.filter(o=>o!==t.id))}}),e.jsx(y,{htmlFor:`category-${t.id}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:t.name})]},t.id))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Item"}),e.jsxs(_,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(b,{variant:"outline",role:"combobox",className:"w-full justify-between hover:bg-accent transition-colors",children:r.length>0?`${r.length} item(s) selected`:"Select items"})}),e.jsx(te,{className:"w-full p-0",align:"start",children:e.jsx("div",{className:"p-3 space-y-2",children:F.map(t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{id:`item-${t.id}`,checked:r.includes(t.id),onCheckedChange:s=>{const a=r.includes(t.id);s&&!a?E([...r,t.id]):!s&&a&&E(r.filter(o=>o!==t.id))}}),e.jsx(y,{htmlFor:`item-${t.id}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:t.name})]},t.id))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Location"}),e.jsxs(_,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(b,{variant:"outline",role:"combobox",className:"w-full justify-between hover:bg-accent transition-colors",children:c.length>0?`${c.length} location(s) selected`:"Select locations"})}),e.jsx(te,{className:"w-full p-0",align:"start",children:e.jsx("div",{className:"p-3 space-y-2",children:W.map(t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{id:`location-${t.id}`,checked:c.includes(t.id),onCheckedChange:s=>{const a=c.includes(t.id);s&&!a?O([...c,t.id]):!s&&a&&O(c.filter(o=>o!==t.id))}}),e.jsx(y,{htmlFor:`location-${t.id}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:t.name})]},t.id))})})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(B,{title:"Total Items",value:T.totalItems,icon:e.jsx(it,{className:"h-4 w-4"}),isLoading:p,lastUpdated:x}),e.jsx(B,{title:"Total Categories",value:T.totalCategories,icon:e.jsx(dt,{className:"h-4 w-4"}),isLoading:p,lastUpdated:x}),e.jsx(B,{title:"Available Stock",value:T.availableStock,icon:e.jsx(mt,{className:"h-4 w-4"}),isLoading:p,lastUpdated:x}),e.jsx(B,{title:"Unfulfilled Items",value:T.unfulfilledItems,icon:e.jsx(ut,{className:"h-4 w-4"}),isLoading:p,lastUpdated:x}),e.jsx(B,{title:"Fulfilled Stock",value:T.fulfilledStock,icon:e.jsx(gt,{className:"h-4 w-4"}),isLoading:p,lastUpdated:x})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(k,{className:"shadow-lg hover:shadow-xl transition-shadow duration-300 border-0 bg-card/50 backdrop-blur-sm",children:[e.jsx(P,{children:e.jsxs(Q,{className:"text-lg flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary animate-pulse"}),"Stock by Category"]})}),e.jsxs(C,{className:"space-y-4",children:[e.jsx(ge,{data:ne,title:"Stock by Category",dataKey:"totalStock",nameKey:"category",selectedItems:pe,onItemClick:Je,onItemHover:Xe,theme:g,labelFormatter:(t,s,a)=>`${t} (${s.toLocaleString()})`,tooltipFormatter:(t,s,a)=>e.jsxs("div",{children:[e.jsxs("div",{children:["Stock: ",t.toLocaleString()]}),e.jsxs("div",{children:["Cost Value: ₹",a?.costValue?.toLocaleString()||"0"]})]}),innerRadius:100,outerRadius:120}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-3 text-muted-foreground",children:"Filter & Legend"}),e.jsx(J,{data:at,selectedItems:pe,onItemToggle:t=>{Re(s=>X(s,t)),We(t)},theme:g,formatAsCurrency:!1})]})]})]}),e.jsxs(k,{className:"shadow-lg hover:shadow-xl transition-shadow duration-300 border-0 bg-card/50 backdrop-blur-sm",children:[e.jsx(P,{children:e.jsxs(Q,{className:"text-lg flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary animate-pulse"}),"Stock by Items"]})}),e.jsxs(C,{className:"space-y-4",children:[e.jsx(ge,{data:re,title:"Stock by Items",dataKey:"stock",nameKey:"item",selectedItems:be,onItemClick:_e,onItemHover:et,theme:g,innerRadius:100,outerRadius:120,labelFormatter:(t,s,a)=>`${t} (${s.toLocaleString()})`,tooltipFormatter:(t,s,a)=>e.jsxs("div",{children:[e.jsxs("div",{children:["Stock: ",t.toLocaleString()]}),e.jsxs("div",{children:["Cost Value: ₹",a?.costValue?.toLocaleString()||"0"]})]})}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-3 text-muted-foreground",children:"Legend"}),e.jsx(J,{data:lt,selectedItems:be,onItemToggle:t=>{Pe(s=>X(s,t)),Le(t)},theme:g,formatAsCurrency:!1})]})]})]}),e.jsxs(k,{className:"shadow-lg hover:shadow-xl transition-shadow duration-300 border-0 bg-card/50 backdrop-blur-sm",children:[e.jsx(P,{children:e.jsxs(Q,{className:"text-lg flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary animate-pulse"}),"Stock by Location"]})}),e.jsxs(C,{className:"space-y-4",children:[e.jsx(ge,{data:Fe,title:"Stock by Location",dataKey:"value",nameKey:"name",selectedItems:ye,onItemClick:Ye,onItemHover:Ze,labelFormatter:(t,s,a)=>`${t} (${s.toLocaleString()})`,tooltipFormatter:(t,s,a)=>e.jsxs("div",{children:[e.jsxs("div",{children:["Stock: ",t.toLocaleString()]}),e.jsxs("div",{children:["Cost Value: ₹",a?.costValue?.toLocaleString()||"0"]})]}),theme:g,innerRadius:100,outerRadius:120}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-3 text-muted-foreground",children:"Filter & Legend"}),e.jsx(J,{data:Fe,selectedItems:ye,onItemToggle:t=>{Be(s=>X(s,t)),Ge(t)},theme:g,showPercentage:!0,formatAsCurrency:!1})]})]})]}),e.jsxs(k,{className:"shadow-lg hover:shadow-xl transition-shadow duration-300 border-0 bg-card/50 backdrop-blur-sm",children:[e.jsx(P,{children:e.jsxs(Q,{className:"text-lg flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary animate-pulse"}),"Top Items by Stock"]})}),e.jsxs(C,{className:"space-y-4",children:[e.jsx(yt,{data:G,title:"Top Items by Stock",bars:nt,selectedItems:je,onItemClick:tt,onItemHover:st,theme:g,showPercentage:!0,yAxisTickFormatter:t=>t.toLocaleString()}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-3 text-muted-foreground",children:"Legend"}),e.jsx(J,{data:ot,selectedItems:je,onItemToggle:t=>{Qe(s=>X(s,t)),Le(t)},theme:g,showPercentage:!0,formatAsCurrency:!1})]})]})]})]})]})]}),e.jsx("div",{className:"no-print",children:e.jsx(xt,{})})]})};export{Mt as default};

import{a as e,j as s}from"./vendor-animation-CcgChT4Y.js";import{A as a}from"./AdminNavBar--NFVZBTP.js";import{C as t}from"./dropdown-menu-DjLdUzkQ.js";import{u as l,B as r,A as n,e as i,c as d}from"./index-QkJ4t2go.js";import{B as c}from"./badge-DjmmXEHi.js";import{C as o}from"./calendar-D3_6b9UR.js";import{C as m,a as u,b as x,c as h}from"./card-CZoDjOMW.js";import{D as j,a as g,b as p,c as f,d as v}from"./dialog-B1BfGlYi.js";import{I as y}from"./input-hHw7iIA9.js";import{L as b}from"./label-CdSwSrYM.js";import{P as N,a as C,b as S}from"./popover-8ziMr3tt.js";import{T as w}from"./textarea-Dez3uDdp.js";import{P as M}from"./PhotoGallaryModal-cbPzwdvL.js";import{C as D}from"./checkbox-_sSNwR25.js";import{T as k,a as A,b as P,c as F,d as $,e as E}from"./table-18gPuSSS.js";import{P as q,F as B,f as I,X as z,g as U,M as G,T}from"./vendor-icons-BYe_-sqm.js";import{f as O}from"./vendor-dates-BQQoqOpn.js";import"./TopBar-CO3pAy7f.js";import"./vendor-radix-CgisZDtL.js";import"./vendor-charts-1c3qO8Q0.js";import"./vendor-ui-utils-B4kPJlQS.js";import"./vendor-pdf-export-F3dE0gEs.js";const R=()=>{const{effectiveTheme:R}=l(),[L,J]=e.useState([]),[W,K]=e.useState(!1),[Q,H]=e.useState(!1),[V,X]=e.useState(!1),[Y,Z]=e.useState(null),[_,ee]=e.useState({}),[se,ae]=e.useState(!1),[te,le]=e.useState(null),[re,ne]=e.useState(!1),[ie,de]=e.useState(""),[ce,oe]=e.useState(""),[me,ue]=e.useState(""),[xe,he]=e.useState({}),[je,ge]=e.useState({}),[pe,fe]=e.useState([]),[ve,ye]=e.useState(""),[be,Ne]=e.useState(new Date),[Ce,Se]=e.useState(new Date),[we,Me]=e.useState(""),[De,ke]=e.useState(""),[Ae,Pe]=e.useState([]),[Fe,$e]=e.useState([]),[Ee,qe]=e.useState(null),[Be,Ie]=e.useState(null),[ze,Ue]=e.useState({}),Ge=e.useRef(null),Te=()=>{ye(""),Ne(new Date),Se(new Date),Me(""),ke(""),Pe([]),qe(null),Ie(null),Ue({}),X(!1),Z(null),Ge.current&&(Ge.current.value="")},Oe=()=>{K(!0);const e=localStorage.getItem("token");if(!e)return;const s={name:ie||null,subject:ce||null,message:me||null,fromStartDate:xe.from?O(xe.from,"yyyy-MM-dd"):null,toStartDate:xe.to?O(xe.to,"yyyy-MM-dd"):null,fromEndDate:je.from?O(je.from,"yyyy-MM-dd"):null,toEndDate:je.to?O(je.to,"yyyy-MM-dd"):null,users:pe.map(e=>e.value),token:e};n.postData({endpoint:"/admin/ad-campaigns",body:{request:i(s)},Authorization:`Bearer ${e}`,successCallback:e=>{J(e.adCampaigns||[]),K(!1)},errorCallback:e=>{J([]),K(!1)}})};e.useEffect(()=>{(()=>{const e=localStorage.getItem("token");e&&n.get("/admin/user-list",{Authorization:`Bearer ${e}`}).then(e=>{if(e?.users){const s=[{value:"All",label:"All"},...e.users.map(e=>({value:e.id,label:`${e.name} (${e.email||e.phone})`}))];$e(s)}}).catch(()=>{$e([])})})(),Oe()},[]),e.useEffect(()=>{Oe()},[ie,ce,me,xe,je,pe]);const Re=e=>{try{return O(new Date(e),"dd/MM/yyyy")}catch{return e}};return s.jsxs("div",{children:[s.jsx(a,{}),s.jsxs("div",{className:"container mx-auto mt-6 p-6 min-h-screen",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:"Campaigns"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(r,{variant:"outline",onClick:()=>{Te(),H(!0)},className:"border-green-600 text-green-600 hover:text-primary",children:[s.jsx(q,{className:"w-4 h-4 mr-2"}),"Add"]}),s.jsxs(r,{variant:"outline",onClick:()=>ne(!re),className:"border-green-600 text-green-600 hover:text-primary",children:[s.jsx(B,{className:"w-4 h-4 mr-2"}),"Filters"]})]})]}),re&&s.jsxs(m,{className:"mb-6",children:[s.jsx(u,{children:s.jsx(x,{children:"Filters"})}),s.jsx(h,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx(b,{children:"Name"}),s.jsx(y,{value:ie,onChange:e=>de(e.target.value),placeholder:"Enter campaign name"})]}),s.jsxs("div",{children:[s.jsx(b,{children:"Subject"}),s.jsx(y,{value:ce,onChange:e=>oe(e.target.value),placeholder:"Enter subject"})]}),s.jsxs("div",{children:[s.jsx(b,{children:"Message"}),s.jsx(y,{value:me,onChange:e=>ue(e.target.value),placeholder:"Enter message"})]}),s.jsxs("div",{children:[s.jsx(b,{children:"Start Date Range"}),s.jsxs(N,{children:[s.jsx(C,{asChild:!0,children:s.jsxs(r,{variant:"outline",className:`w-full justify-start text-left font-normal ${!xe.from&&!xe.to&&"text-muted-foreground"}`,children:[s.jsx(I,{className:"mr-2 h-4 w-4"}),xe.from?xe.to?s.jsxs(s.Fragment,{children:[O(xe.from,"dd/MM/yyyy")," -"," ",O(xe.to,"dd/MM/yyyy")]}):O(xe.from,"dd/MM/yyyy"):"Select date range"]})}),s.jsx(S,{className:"w-auto p-0",align:"start",children:s.jsx(o,{autoFocus:!0,mode:"range",defaultMonth:xe.from,selected:{from:xe.from,to:xe.to},onSelect:e=>he(e||{}),numberOfMonths:2})})]})]}),s.jsxs("div",{children:[s.jsx(b,{children:"End Date Range"}),s.jsxs(N,{children:[s.jsx(C,{asChild:!0,children:s.jsxs(r,{variant:"outline",className:`w-full justify-start text-left font-normal ${!je.from&&!je.to&&"text-muted-foreground"}`,children:[s.jsx(I,{className:"mr-2 h-4 w-4"}),je.from?je.to?s.jsxs(s.Fragment,{children:[O(je.from,"dd/MM/yyyy")," -"," ",O(je.to,"dd/MM/yyyy")]}):O(je.from,"dd/MM/yyyy"):"Select date range"]})}),s.jsx(S,{className:"w-auto p-0",align:"start",children:s.jsx(o,{autoFocus:!0,mode:"range",defaultMonth:je.from,selected:{from:je.from,to:je.to},onSelect:e=>ge(e||{}),numberOfMonths:2})})]})]}),s.jsxs("div",{children:[s.jsx(b,{children:"Users"}),s.jsxs(N,{children:[s.jsx(C,{asChild:!0,children:s.jsx(r,{variant:"outline",role:"combobox","aria-expanded":!1,className:"w-full justify-between",children:pe.length>0?`${pe.length} user(s) selected`:"Select users"})}),s.jsx(S,{className:"w-full p-0",align:"start",children:s.jsx("div",{className:"p-3 space-y-2",children:Fe.map(e=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(D,{id:`filter-user-${e.value}`,checked:pe.some(s=>s.value===e.value),onCheckedChange:s=>{const a=pe.some(s=>s.value===e.value);if(s&&!a){const s=[...pe,e],a=s.some(e=>"All"===e.value);fe(a?Fe.filter(e=>"All"!==e.value):s)}else!s&&a&&fe(pe.filter(s=>s.value!==e.value))}}),s.jsx(b,{htmlFor:`filter-user-${e.value}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:e.label})]},e.value))})})]})]})]})})]}),Q&&s.jsxs(m,{className:"mb-6",children:[s.jsx(u,{children:s.jsx(x,{children:V?"Edit Ad Campaign":"Create Ad Campaign"})}),s.jsxs(h,{children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx(b,{children:"Name"}),s.jsx(y,{value:ve,onChange:e=>ye(e.target.value)}),ze.name&&s.jsx("p",{className:"text-sm text-red-500 mt-1",children:ze.name})]}),s.jsxs("div",{children:[s.jsxs(b,{children:["Photo ",s.jsx("span",{className:"text-muted-foreground",children:"(Optional)"})]}),Be?s.jsxs("div",{className:"relative",children:[s.jsx(M,{title:"Campaign Photo",imageSrcs:[Be],children:s.jsx("img",{src:Be,alt:"Preview",className:"w-full h-32 object-cover rounded-lg"})}),s.jsx("button",{type:"button",onClick:()=>{qe(null),Ie(null),Ge.current&&(Ge.current.value="")},className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",children:s.jsx(z,{className:"h-3 w-3"})})]}):s.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/30 rounded-lg p-4 text-center cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>Ge.current?.click(),children:[s.jsx(Upload,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Click to upload a photo"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"JPEG, PNG, WebP, GIF (max 5MB)"}),s.jsx("input",{ref:Ge,type:"file",accept:"image/jpeg,image/png,image/webp,image/gif",onChange:e=>{if(e.target.files&&e.target.files.length>0){const s=e.target.files[0];if(!["image/jpeg","image/png","image/webp","image/gif"].includes(s.type))return void Ue(e=>({...e,file:"Please upload a valid image file (JPEG, PNG, WebP, GIF)"}));if(s.size>5242880)return void Ue(e=>({...e,file:"File size must be less than 5MB"}));qe(s),Ue(e=>({...e,file:""}));const a=new FileReader;a.onloadend=()=>{Ie(a.result)},a.readAsDataURL(s)}else qe(null),Ie(null)},className:"hidden"})]}),ze.file&&s.jsx("p",{className:"text-sm text-red-500 mt-1",children:ze.file})]}),s.jsxs("div",{children:[s.jsx(b,{children:"Start Date"}),s.jsxs(N,{children:[s.jsx(C,{asChild:!0,children:s.jsxs(r,{variant:"outline",className:`w-full justify-start text-left font-normal ${!be&&"text-muted-foreground"}`,children:[s.jsx(I,{className:"mr-2 h-4 w-4"}),be?O(be,"dd/MM/yyyy"):"Pick a date"]})}),s.jsx(S,{className:"w-auto p-0",align:"start",children:s.jsx(o,{mode:"single",selected:be,onSelect:Ne,autoFocus:!0})})]}),ze.startDate&&s.jsx("p",{className:"text-sm text-red-500 mt-1",children:ze.startDate})]}),s.jsxs("div",{children:[s.jsx(b,{children:"End Date"}),s.jsxs(N,{children:[s.jsx(C,{asChild:!0,children:s.jsxs(r,{variant:"outline",className:`w-full justify-start text-left font-normal ${!Ce&&"text-muted-foreground"}`,children:[s.jsx(I,{className:"mr-2 h-4 w-4"}),Ce?O(Ce,"dd/MM/yyyy"):"Pick a date"]})}),s.jsx(S,{className:"w-auto p-0",align:"start",children:s.jsx(o,{mode:"single",selected:Ce,onSelect:Se,autoFocus:!0})})]}),ze.endDate&&s.jsx("p",{className:"text-sm text-red-500 mt-1",children:ze.endDate})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx(b,{children:"Users"}),s.jsxs(N,{children:[s.jsx(C,{asChild:!0,children:s.jsx(r,{variant:"outline",role:"combobox","aria-expanded":!1,className:"w-full justify-between",children:Ae.length>0?`${Ae.length} user(s) selected`:"Select users"})}),s.jsx(S,{className:"w-full p-0",align:"start",children:s.jsx("div",{className:"p-3 space-y-2",children:Fe.map(e=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(D,{id:`form-user-${e.value}`,checked:Ae.some(s=>s.value===e.value),onCheckedChange:s=>{const a=Ae.some(s=>s.value===e.value);if(s&&!a){const s=[...Ae,e],a=s.some(e=>"All"===e.value);Pe(a?Fe.filter(e=>"All"!==e.value):s)}else!s&&a&&Pe(Ae.filter(s=>s.value!==e.value))}}),s.jsx(b,{htmlFor:`form-user-${e.value}`,className:"text-sm font-normal leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:e.label})]},e.value))})})]}),ze.users&&s.jsx("p",{className:"text-sm text-red-500 mt-1",children:ze.users}),Ae.length>0&&s.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:Ae.map(e=>s.jsx(c,{variant:"secondary",children:e.label},e.value))})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx(b,{children:"Subject"}),s.jsx(y,{value:De,onChange:e=>ke(e.target.value)}),ze.subject&&s.jsx("p",{className:"text-sm text-red-500 mt-1",children:ze.subject})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx(b,{children:"Message"}),s.jsx(w,{rows:4,value:we,onChange:e=>Me(e.target.value)}),ze.message&&s.jsx("p",{className:"text-sm text-red-500 mt-1",children:ze.message})]})]}),s.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[s.jsx(r,{variant:"outline",onClick:()=>{Te(),H(!1)},children:"Cancel"}),s.jsx(r,{onClick:()=>{const e={};if(ve.trim()||(e.name="Name is required."),be||(e.startDate="Start Date is required."),Ce||(e.endDate="End Date is required."),De.trim()||(e.subject="Subject is required."),we.trim()||(e.message="Message is required."),V||Ee||(e.file="File upload is required."),!V||Ee||Be||(e.file="File upload is required."),0===Ae.length&&(e.users="Please select at least one user."),Ue(e),Object.keys(e).length>0)return;const s=localStorage.getItem("token");if(!s)return;const a=new FormData,t={id:V?Y.id:void 0,name:ve,startDate:be?O(be,"yyyy-MM-dd"):"",endDate:Ce?O(Ce,"yyyy-MM-dd"):"",message:we,subject:De,userIds:Ae.some(e=>"All"===e.value)?["All"]:Ae.map(e=>e.value)};a.append("request",i(t)),Ee&&a.append("file",Ee),n.postFormData({endpoint:"/admin/save-ad-campaign",body:a,Authorization:`Bearer ${s}`,successCallback:e=>{d.success(V?"Campaign updated successfully":"Campaign saved successfully"),Oe(),Te(),H(!1)},errorCallback:e=>{d.error(e?.error||e?.message||"Failed to save campaign")}})},children:V?"Update Campaign":"Save Campaign"})]})]})]}),s.jsx(m,{children:s.jsx(h,{className:"p-0",children:W?s.jsx("div",{className:"p-6 text-center",children:"Loading..."}):s.jsxs(k,{children:[s.jsx(A,{children:s.jsxs(P,{children:[s.jsx(F,{children:"Name"}),s.jsx(F,{children:"Start Date"}),s.jsx(F,{children:"End Date"}),s.jsx(F,{className:"w-[220px]",children:"Subject"}),s.jsx(F,{children:"Message"}),s.jsx(F,{children:"Users"}),s.jsx(F,{children:"Image"}),s.jsx(F,{className:"sticky right-0 bg-background",children:"Actions"})]})}),s.jsxs($,{children:[L.map((e,a)=>s.jsxs(P,{className:a%2==0?"bg-muted/20":"",children:[s.jsx(E,{children:e.name}),s.jsx(E,{children:Re(e.startDate)}),s.jsx(E,{children:Re(e.endDate)}),s.jsx(E,{className:"w-[220px]",children:e.subject}),s.jsx(E,{children:e.message.length>50?e.message.substr(0,50)+"...":e.message}),s.jsx(E,{children:s.jsx("div",{className:"flex flex-wrap gap-1",children:e?.users?.map(e=>s.jsx(c,{variant:"secondary",children:e.name},e.id))})}),s.jsx(E,{children:e.imagePath?s.jsx(M,{title:"Campaign Photo",imageSrcs:[`/static${e.imagePath}`],children:s.jsx("img",{src:`/static${e.imagePath}`,alt:e.name,className:"max-w-16 max-h-12 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity"})}):s.jsx("span",{className:"text-muted-foreground text-sm",children:"No photo"})}),s.jsx(E,{className:"sticky right-0 bg-background",children:s.jsxs("div",{className:"flex gap-1",children:[s.jsx(r,{size:"sm",variant:"outline",title:"Edit Ad Campaign","aria-label":"Edit Ad Campaign",onClick:()=>(e=>{if(ye(e.name),Ne(new Date(e.startDate)),Se(new Date(e.endDate)),Me(e.message),ke(e.subject),e.users?.length){const s=e.users.map(e=>({value:e.id,label:`${e.name} (${e.email||e.phone})`}));Pe(s)}else Pe([]);qe(null),Ie(e.imagePath?`/static/ads/${e.imagePath.split("/").pop()}`:null),X(!0),Z(e),H(!0)})(e),children:s.jsx(U,{className:"w-4 h-4"})}),s.jsx(r,{size:"sm",variant:"outline",title:"Send Emails",onClick:()=>(e=>{const s=localStorage.getItem("token");if(!s)return void d.error("User not authenticated");ee(s=>({...s,[e.id]:!0}));const a={id:e.id,token:s},t=i(a);n.postData({endpoint:"/admin/send-ad-emails",body:{request:t},Authorization:`Bearer ${s}`,successCallback:()=>{d.success("Ad email sent successfully"),ee(s=>({...s,[e.id]:!1}))},errorCallback:s=>{d.error(s?.error||s?.message||"Failed to send ad email"),ee(s=>({...s,[e.id]:!1}))}})})(e),disabled:_[e.id],"aria-label":"Send Emails",children:_[e.id]?s.jsx("div",{className:"w-4 h-4 animate-spin rounded-full border-2 border-current border-t-transparent"}):s.jsx(G,{className:"w-4 h-4"})}),s.jsx(r,{size:"sm",variant:"outline",title:"Delete Ad Campaign",onClick:()=>{le(e),ae(!0)},"aria-label":"Delete Ad Campaign",children:s.jsx(T,{className:"w-4 h-4"})})]})})]},e.id)),0===L.length&&s.jsx(P,{children:s.jsx(E,{colSpan:8,className:"text-center",children:"No Ad Campaigns found."})})]})]})})})]}),s.jsx(j,{open:se,onOpenChange:ae,children:s.jsxs(g,{children:[s.jsx(p,{children:s.jsx(f,{children:"Delete Ad Campaign"})}),s.jsx("div",{className:"py-4",children:s.jsxs("p",{children:['Are you sure you want to delete ad campaign "',te?.name,'"? This action cannot be undone.']})}),s.jsxs(v,{children:[s.jsx(r,{variant:"outline",onClick:()=>{ae(!1),le(null)},children:"Cancel"}),s.jsx(r,{variant:"destructive",onClick:()=>{if(!te)return;const e=localStorage.getItem("token");if(!e)return;const s={id:te.id};n.postData({endpoint:"/admin/delete-ad-campaign",body:{request:i(s)},Authorization:`Bearer ${e}`,successCallback:()=>{d.success("Ad campaign deleted successfully"),Oe(),ae(!1),le(null)},errorCallback:e=>{d.error(e?.error||e?.message||"Failed to delete campaign"),ae(!1),le(null)}})},children:"Confirm Delete"})]})]})}),s.jsx(t,{})]})};export{R as default};

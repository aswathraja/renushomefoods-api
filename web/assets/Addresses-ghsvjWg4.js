import{m as e,r as s,j as r,af as a,P as t,I as d,K as n}from"./vendor-react-Tc4xLtOv.js";import{C as i}from"./dropdown-menu-Dweh6OYL.js";import{T as o}from"./TopNav-BXcsdcnw.js";import{A as l,c,B as m,e as u}from"./index-CCl3TzR2.js";import{B as x}from"./badge-BZaNuTv-.js";import{C as p,a as h,b as j,c as f}from"./card-ZRElQZzO.js";import{D as g,a as y,b,c as v,d as N}from"./dialog-CT_0QHuT.js";import{I as X}from"./input-group-BGtxGQoB.js";import{S as k}from"./switch-adH75S8E.js";import{T as C}from"./textarea-LiP7jPED.js";import"./vendor-charts-DKw1ZHYY.js";import"./vendor-ui-utils-B4kPJlQS.js";import"./vendor-radix-O0RUyoIw.js";import"./NavBar-CdfgxkT6.js";import"./TopBar-DKySbC2h.js";import"./vendor-pdf-export-C4gp01y5.js";import"./vendor-animation-BGrdDg6I.js";import"./input-F4kRSedd.js";const w=({modalMode:w=!1})=>{const D=e(),[A,S]=s.useState([]),[L,I]=s.useState(!0),[q,z]=s.useState(!1),[F,P]=s.useState(null),[B,E]=s.useState(!1),[M,O]=s.useState(null),[T,$]=s.useState({name:"",addressLine1:"",city:"",state:"",country:"",pincode:"",phone:"",isDefault:!1}),[K,W]=s.useState({});s.useEffect(()=>{localStorage.getItem("token")||w?G():D("/login")},[D,w]);const G=async()=>{const e=localStorage.getItem("token");if(e)try{const s=await l.get("/user/addresses",{Authorization:`Bearer ${e}`});s.addresses?S(s.addresses||[]):c.error("Failed to fetch addresses")}catch{c.error("Error fetching addresses")}finally{I(!1)}},H=(e,s)=>{let r="";if("pincode"===e)/^\d{6}$/.test(s)||(r="Pincode must be exactly 6 digits.");else if("phone"===e){/^(\+\d{2} \d{10}|\+\d{12}|\d{10})$/.test(s)||(r="Phone number must be in format +XX XXXXXXXXXX, +XXXXXXXXXXXX, or XXXXXXXXXX.")}W(s=>({...s,[e]:r}))};return L?w?r.jsxs("div",{className:"text-center p-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),r.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading..."})]}):r.jsx("div",{className:"container mx-auto max-h-screen mt-8 px-4 sm:px-6 lg:px-8",children:r.jsxs("div",{className:"text-center p-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),r.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading..."})]})}):r.jsxs(r.Fragment,{children:[!w&&r.jsx(o,{}),r.jsxs("div",{className:w?"":"container min-h-screen mx-auto mt-8 px-4 sm:px-6 lg:px-8",children:[!w&&r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center",children:r.jsx(a,{size:"50px",className:"text-primary"})}),r.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground mb-2",children:"Your Addresses"}),r.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mb-4",children:"Manage your delivery addresses for faster checkout"}),r.jsxs(m,{onClick:()=>{P(null),$({name:"",addressLine1:"",city:"",state:"",country:"",pincode:"",phone:"",isDefault:!1}),W({}),z(!0)},className:"w-full sm:w-auto",children:[r.jsx(t,{className:"h-4 w-4 mr-2"}),"Add Address"]})]}),0===A.length?r.jsxs("div",{className:"text-center p-12",children:[r.jsx("div",{className:"text-muted-foreground mb-4",children:r.jsxs("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),r.jsx("p",{className:"text-lg text-muted-foreground",children:"No addresses found. Add your first address!"})]}):r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:A.map(e=>r.jsxs(p,{className:"h-full",children:[r.jsxs(h,{className:"flex flex-row items-center justify-between pb-2",children:[r.jsxs(j,{className:"text-lg mb-1",children:[e.name,e.isDefault&&r.jsx(x,{className:"mt-3 ml-2 bg-primary",children:"Default"})]}),r.jsxs("div",{className:"flex gap-2",children:[!e.isDefault&&r.jsx(m,{variant:"outline",size:"sm",onClick:()=>(async e=>{const s=localStorage.getItem("token");if(!s)return;const r={addressId:e.id,isDefault:!0,token:s};try{await l.postData({endpoint:"/user/address",body:{request:u(r)},successCallback:()=>{c.success("Default address updated successfully"),G()},errorCallback:e=>{c.error(e?.error||"Failed to update default address")}})}catch{c.error("Error updating default address")}})(e),className:"text-primary border-primary hover:bg-primary/10",children:"Make Default"}),r.jsx(m,{variant:"outline",size:"sm",onClick:()=>(e=>{P(e),$({name:e.name,addressLine1:e.addressLine1,city:e.city,state:e.state,country:e.country,pincode:e.pincode,phone:e.phone,isDefault:e.isDefault}),W({}),H("pincode",e.pincode),H("phone",e.phone),z(!0)})(e),className:"text-green-600 border-green-600 hover:text-primary",children:r.jsx(d,{className:"h-4 w-4"})}),r.jsx(m,{variant:"outline",size:"sm",onClick:()=>(e=>{O(e),E(!0)})(e),className:"text-red-600 border-red-600 hover:text-primary",children:r.jsx(n,{className:"h-4 w-4"})})]})]}),r.jsx(f,{children:r.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[r.jsx("p",{children:e.addressLine1}),r.jsxs("p",{children:[e.city,", ",e.state," ",e.pincode]}),r.jsx("p",{children:e.country}),r.jsxs("p",{children:["Phone: ",e.phone]})]})})]},e.id))}),r.jsx(g,{open:q,onOpenChange:z,children:r.jsxs(y,{className:"sm:max-w-[600px]",children:[r.jsx(b,{children:r.jsx(v,{children:F?"Edit Address":"Add Address"})}),r.jsxs("form",{onSubmit:async e=>{e.preventDefault();const s=localStorage.getItem("token");if(!s)return;if(Object.values(K).some(e=>""!==e))return void c.error("Please fix the validation errors before submitting.");const r={...T,token:s};F&&(r.addressId=F.id);try{await l.postData({endpoint:"/user/address",body:{request:u(r)},successCallback:()=>{c.success(F?"Address updated successfully":"Address added successfully"),z(!1),G()},errorCallback:e=>{c.error(e?.error||"Failed to save address")}})}catch{c.error("Error saving address")}},className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx(X,{label:"Name",name:"name",value:T.name,onChange:e=>$(s=>({...s,name:e})),required:!0}),r.jsx(X,{label:"Phone",name:"phone",value:T.phone,onChange:e=>{const s=e.replace(/[^\d+\s]/g,"").slice(0,15);$(e=>({...e,phone:s})),H("phone",s)},error:K.phone,required:!0})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:["Address Line 1 ",r.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),r.jsx(C,{name:"addressLine1",value:T.addressLine1,onChange:e=>{const{name:s,value:r,type:a}=e.target;let t=r;"pincode"===s&&(t=r.replace(/\D/g,"").slice(0,6)),$(r=>({...r,[s]:"checkbox"===a?e.target.checked:t})),"pincode"!==s&&"phone"!==s||H(s,t)},className:"mt-2",required:!0})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx(X,{label:"City",name:"city",value:T.city,onChange:e=>$(s=>({...s,city:e})),required:!0}),r.jsx(X,{label:"State",name:"state",value:T.state,onChange:e=>$(s=>({...s,state:e})),required:!0})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx(X,{label:"Pincode",name:"pincode",value:T.pincode,onChange:e=>{const s=e.replace(/\D/g,"").slice(0,6);$(e=>({...e,pincode:s})),H("pincode",s)},error:K.pincode,required:!0}),r.jsx(X,{label:"Country",name:"country",value:T.country,onChange:e=>$(s=>({...s,country:e})),required:!0})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("label",{htmlFor:"isDefault",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Set as default address"}),r.jsx(k,{id:"isDefault",name:"isDefault",checked:T.isDefault,onCheckedChange:e=>$(s=>({...s,isDefault:e}))})]}),r.jsxs(N,{children:[r.jsx(m,{type:"button",variant:"outline",onClick:()=>z(!1),children:"Cancel"}),r.jsxs(m,{type:"submit",children:[F?"Update":"Add"," Address"]})]})]})]})}),r.jsx(g,{open:B,onOpenChange:E,children:r.jsxs(y,{children:[r.jsx(b,{children:r.jsx(v,{children:"Confirm Delete"})}),r.jsxs("div",{className:"py-4",children:[r.jsx("p",{className:"text-muted-foreground",children:"Are you sure you want to delete this address?"}),M&&r.jsxs("div",{className:"mt-4 p-4 border rounded-md bg-muted/50",children:[r.jsx("p",{className:"font-medium",children:M.name}),r.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[M.addressLine1,r.jsx("br",{}),M.city,", ",M.state," ",M.pincode]})]})]}),r.jsxs(N,{children:[r.jsx(m,{variant:"outline",onClick:()=>E(!1),children:"Cancel"}),r.jsx(m,{variant:"destructive",onClick:async()=>{if(!M)return;const e=localStorage.getItem("token");if(e)try{const s=await l.delete("/user/address",{request:u({addressId:M.id,token:e})},{Authorization:e});s.status?(c.success("Address deleted successfully"),G()):c.error(s.error||"Failed to delete address")}catch{c.error("Error deleting address")}finally{E(!1),O(null)}},children:"Delete"})]})]})})]}),!w&&r.jsx(i,{})]})};export{w as default};
